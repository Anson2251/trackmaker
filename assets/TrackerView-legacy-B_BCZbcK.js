!function(){function e(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t,o,i){var a=n(r(1&i?e.prototype:e),t,o);return 2&i&&"function"==typeof a?function(e){return a.apply(o,e)}:a}function n(){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var o=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},n.apply(null,arguments)}function o(e,t,n){return t=r(t),function(e,t){if(t&&("object"==w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,i()?Reflect.construct(t,n||[],r(e).constructor):t.apply(e,n))}function i(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(i=function(){return!!e})()}function r(e){return r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},r(e)}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}function s(e,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},s(e,t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,C(o.key),o)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t,n,o,i,r,a){try{var s=e[r](a),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(o,i)}function h(e){return function(){var t=this,n=arguments;return new Promise((function(o,i){var r=e.apply(t,n);function a(e){d(r,o,i,a,s,"next",e)}function s(e){d(r,o,i,a,s,"throw",e)}a(void 0)}))}}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,r,a,s=[],l=!0,c=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(o=r.call(n)).done)&&(s.push(o.value),s.length!==t);l=!0);}catch(e){c=!0,i=e}finally{try{if(!l&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=y(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,r=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw r}}}}function y(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function b(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */b=function(){return t};var e,t={},n=Object.prototype,o=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,o){var r=t&&t.prototype instanceof y?t:y,a=Object.create(r.prototype),s=new B(o||[]);return i(a,"_invoke",{value:O(e,n,s)}),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=u;var h="suspendedStart",p="suspendedYield",f="executing",g="completed",v={};function y(){}function m(){}function x(){}var C={};c(C,a,(function(){return this}));var k=Object.getPrototypeOf,P=k&&k(k(E([])));P&&P!==n&&o.call(P,a)&&(C=P);var S=x.prototype=y.prototype=Object.create(C);function M(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function I(e,t){function n(i,r,a,s){var l=d(e[i],e,r);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"==w(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,a,s)}),(function(e){n("throw",e,a,s)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return n("throw",e,a,s)}))}s(l.arg)}var r;i(this,"_invoke",{value:function(e,o){function i(){return new t((function(t,i){n(e,o,t,i)}))}return r=r?r.then(i,i):i()}})}function O(t,n,o){var i=h;return function(r,a){if(i===f)throw Error("Generator is already running");if(i===g){if("throw"===r)throw a;return{value:e,done:!0}}for(o.method=r,o.arg=a;;){var s=o.delegate;if(s){var l=F(s,o);if(l){if(l===v)continue;return l}}if("next"===o.method)o.sent=o._sent=o.arg;else if("throw"===o.method){if(i===h)throw i=g,o.arg;o.dispatchException(o.arg)}else"return"===o.method&&o.abrupt("return",o.arg);i=f;var c=d(t,n,o);if("normal"===c.type){if(i=o.done?g:p,c.arg===v)continue;return{value:c.arg,done:o.done}}"throw"===c.type&&(i=g,o.method="throw",o.arg=c.arg)}}}function F(t,n){var o=n.method,i=t.iterator[o];if(i===e)return n.delegate=null,"throw"===o&&t.iterator.return&&(n.method="return",n.arg=e,F(t,n),"throw"===n.method)||"return"!==o&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+o+"' method")),v;var r=d(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var a=r.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function _(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function B(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(_,this),this.reset(!0)}function E(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function n(){for(;++i<t.length;)if(o.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(w(t)+" is not iterable")}return m.prototype=x,i(S,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:m,configurable:!0}),m.displayName=c(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},M(I.prototype),c(I.prototype,s,(function(){return this})),t.AsyncIterator=I,t.async=function(e,n,o,i,r){void 0===r&&(r=Promise);var a=new I(u(e,n,o,i),r);return t.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},M(S),c(S,l,"Generator"),c(S,a,(function(){return this})),c(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var o in t)n.push(o);return n.reverse(),function e(){for(;n.length;){var o=n.pop();if(o in t)return e.value=o,e.done=!1,e}return e.done=!0,e}},t.values=E,B.prototype={constructor:B,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(D),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(o,i){return s.type="throw",s.arg=t,n.next=o,i&&(n.method="next",n.arg=e),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var l=o.call(a,"catchLoc"),c=o.call(a,"finallyLoc");if(l&&c){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&o.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=e,a.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var i=o.arg;D(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,o){return this.delegate={iterator:E(t),resultName:n,nextLoc:o},"next"===this.method&&(this.arg=e),v}},t}function x(e,t,n){return(t=C(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e){var t=function(e,t){if("object"!=w(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=w(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==w(t)?t:t+""}function w(e){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},w(e)}System.register(["./index-legacy-DcbaEgcH.js","./Image-legacy-C4gOQDlY.js"],(function(n,i){"use strict";var r,s,c,d,p,y,m,C,k,P,S,M,I,O,F,_,D,B,E,j,R,L,z,T,N,W,A,U,G,V,H,X,Y,q,K,Z,$,J,Q,ee,te,ne,oe,ie,re,ae,se,le,ce,ue,de,he,pe,fe,ge,ve,ye,me,be,xe,Ce,we,ke,Pe,Se,Me,Ie,Oe,Fe,_e,De,Be,Ee,je,Re,Le,ze,Te,Ne,We,Ae,Ue,Ge,Ve,He,Xe,Ye,qe,Ke,Ze,$e,Je,Qe,et,tt,nt,ot,it,rt,at,st,lt,ct,ut,dt,ht,pt,ft,gt,vt,yt,mt,bt,xt,Ct,wt,kt,Pt,St,Mt,It,Ot,Ft,_t,Dt,Bt,Et,jt;return{setters:[function(e){r=e.i,s=e.r,c=e.a,d=e.o,p=e.h,y=e.b,m=e.c,C=e.d,k=e.e,P=e.w,S=e.f,M=e.g,I=e.j,O=e.p,F=e.k,_=e.l,D=e.m,B=e.n,E=e.q,j=e.s,R=e.u,L=e.t,z=e.v,T=e.x,N=e.y,W=e.z,A=e.A,U=e.B,G=e.C,V=e.N,H=e.D,X=e.E,Y=e.F,q=e.G,K=e.H,Z=e.I,$=e.J,J=e.K,Q=e.L,ee=e.M,te=e.O,ne=e.P,oe=e.Q,ie=e.R,re=e.S,ae=e.T,se=e.U,le=e.V,ce=e.W,ue=e.X,de=e.Y,he=e.Z,pe=e._,fe=e.$,ge=e.a0,ve=e.a1,ye=e.a2,me=e.a3,be=e.a4,xe=e.a5,Ce=e.a6,we=e.a7,ke=e.a8,Pe=e.a9,Se=e.aa,Me=e.ab,Ie=e.ac,Oe=e.ad,Fe=e.ae,_e=e.af,De=e.ag,Be=e.ah,Ee=e.ai,je=e.aj,Re=e.ak,Le=e.al,ze=e.am,Te=e.an,Ne=e.ao,We=e.ap,Ae=e.aq,Ue=e.ar,Ge=e.as,Ve=e.at,He=e.au,Xe=e.av,Ye=e.aw,qe=e.ax,Ke=e.ay,Ze=e.az,$e=e.aA,Je=e.aB,Qe=e.aC,et=e.aD,tt=e.aE,nt=e.aF,ot=e.aG,it=e.aH,rt=e.aI,at=e.aJ,st=e.aK,lt=e.aL,ct=e.aM,ut=e.aN,dt=e.aO,ht=e.aP,pt=e.aQ,ft=e.aR,gt=e.aS,vt=e.aT,yt=e.aU,mt=e.aV,bt=e.aW,xt=e.aX,Ct=e.aY,wt=e.aZ,kt=e.a_,Pt=e.a$,St=e.b0},function(e){Mt=e.i,It=e.c,Ot=e.a,Ft=e.N,_t=e.b,Dt=e.d,Bt=e.D,Et=e.e,jt=e.f}],execute:function(){var i=c(null);function Rt(e){if(e.clientX>0||e.clientY>0)i.value={x:e.clientX,y:e.clientY};else{var t=e.target;if(t instanceof Element){var n=t.getBoundingClientRect(),o=n.left,r=n.top,a=n.width,s=n.height;i.value=o>0||r>0?{x:o+a/2,y:r+s/2}:{x:0,y:0}}else i.value=null}}var Lt=0,zt=!0;var Tt=c(void 0),Nt=0;function Wt(){Tt.value=Date.now()}var At=!0;var Ut=c(!1);function Gt(){Ut.value=!0}function Vt(){Ut.value=!1}var Ht=0;function Xt(){return Mt&&(y((function(){Ht||(window.addEventListener("compositionstart",Gt),window.addEventListener("compositionend",Vt)),Ht++})),m((function(){Ht<=1?(window.removeEventListener("compositionstart",Gt),window.removeEventListener("compositionend",Vt),Ht=0):Ht--}))),Ut}var Yt=0,qt="",Kt="",Zt="",$t="",Jt=c("0px");var Qt=new WeakSet;var en=I("n-form-item");function tn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.defaultSize,o=void 0===n?"medium":n,i=t.mergedSize,r=t.mergedDisabled,a=M(en,null);O(en,null);var s=S(i?function(){return i(a)}:function(){var t=e.size;if(t)return t;if(a){var n=a.mergedSize;if(void 0!==n.value)return n.value}return o}),l=S(r?function(){return r(a)}:function(){var t=e.disabled;return void 0!==t?t:!!a&&a.disabled.value}),c=S((function(){var t=e.status;return t||(null==a?void 0:a.mergedValidationStatus.value)}));return m((function(){a&&a.restoreValidation()})),{mergedSizeRef:s,mergedDisabledRef:l,mergedStatusRef:c,nTriggerFormBlur:function(){a&&a.handleContentBlur()},nTriggerFormChange:function(){a&&a.handleContentChange()},nTriggerFormFocus:function(){a&&a.handleContentFocus()},nTriggerFormInput:function(){a&&a.handleContentInput()}}}var nn=F({name:"Add",render:function(){return _("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},_("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),on=D("attach",(function(){return _("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},_("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},_("g",{fill:"currentColor","fill-rule":"nonzero"},_("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))})),rn=D("cancel",(function(){return _("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},_("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},_("g",{fill:"currentColor","fill-rule":"nonzero"},_("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))})),an=F({name:"Eye",render:function(){return _("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},_("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),_("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),sn=D("retry",(function(){return _("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},_("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),_("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))})),ln=D("trash",(function(){return _("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},_("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),_("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),_("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),_("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))})),cn=E.cubicBezierEaseInOut;var un=j("base-wave","\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n"),dn=F({name:"BaseWave",props:{clsPrefix:{type:String,required:!0}},setup:function(e){R("-base-wave",un,L(e,"clsPrefix"));var t=c(null),n=c(!1),o=null;return m((function(){null!==o&&window.clearTimeout(o)})),{active:n,selfRef:t,play:function(){null!==o&&(window.clearTimeout(o),n.value=!1,o=null),z((function(){var e;null===(e=t.value)||void 0===e||e.offsetHeight,n.value=!0,o=window.setTimeout((function(){n.value=!1,o=null}),1e3)}))}}},render:function(){var e=this.clsPrefix;return _("div",{ref:"selfRef","aria-hidden":!0,class:["".concat(e,"-base-wave"),this.active&&"".concat(e,"-base-wave--active")]})}}),hn=Mt&&"chrome"in window;Mt&&navigator.userAgent.includes("Firefox");var pn=Mt&&navigator.userAgent.includes("Safari")&&!hn;function fn(e){return T(e,[255,255,255,.16])}function gn(e){return T(e,[0,0,0,.12])}var vn=I("n-button-group"),yn=B([j("button","\n margin: 0;\n font-weight: var(--n-font-weight);\n line-height: 1;\n font-family: inherit;\n padding: var(--n-padding);\n height: var(--n-height);\n font-size: var(--n-font-size);\n border-radius: var(--n-border-radius);\n color: var(--n-text-color);\n background-color: var(--n-color);\n width: var(--n-width);\n white-space: nowrap;\n outline: none;\n position: relative;\n z-index: auto;\n border: none;\n display: inline-flex;\n flex-wrap: nowrap;\n flex-shrink: 0;\n align-items: center;\n justify-content: center;\n user-select: none;\n -webkit-user-select: none;\n text-align: center;\n cursor: pointer;\n text-decoration: none;\n transition:\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n ",[N("color",[A("border",{borderColor:"var(--n-border-color)"}),N("disabled",[A("border",{borderColor:"var(--n-border-color-disabled)"})]),W("disabled",[B("&:focus",[A("state-border",{borderColor:"var(--n-border-color-focus)"})]),B("&:hover",[A("state-border",{borderColor:"var(--n-border-color-hover)"})]),B("&:active",[A("state-border",{borderColor:"var(--n-border-color-pressed)"})]),N("pressed",[A("state-border",{borderColor:"var(--n-border-color-pressed)"})])])]),N("disabled",{backgroundColor:"var(--n-color-disabled)",color:"var(--n-text-color-disabled)"},[A("border",{border:"var(--n-border-disabled)"})]),W("disabled",[B("&:focus",{backgroundColor:"var(--n-color-focus)",color:"var(--n-text-color-focus)"},[A("state-border",{border:"var(--n-border-focus)"})]),B("&:hover",{backgroundColor:"var(--n-color-hover)",color:"var(--n-text-color-hover)"},[A("state-border",{border:"var(--n-border-hover)"})]),B("&:active",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[A("state-border",{border:"var(--n-border-pressed)"})]),N("pressed",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[A("state-border",{border:"var(--n-border-pressed)"})])]),N("loading","cursor: wait;"),j("base-wave","\n pointer-events: none;\n top: 0;\n right: 0;\n bottom: 0;\n left: 0;\n animation-iteration-count: 1;\n animation-duration: var(--n-ripple-duration);\n animation-timing-function: var(--n-bezier-ease-out), var(--n-bezier-ease-out);\n ",[N("active",{zIndex:1,animationName:"button-wave-spread, button-wave-opacity"})]),Mt&&"MozBoxSizing"in document.createElement("div").style?B("&::moz-focus-inner",{border:0}):null,A("border, state-border","\n position: absolute;\n left: 0;\n top: 0;\n right: 0;\n bottom: 0;\n border-radius: inherit;\n transition: border-color .3s var(--n-bezier);\n pointer-events: none;\n "),A("border",{border:"var(--n-border)"}),A("state-border",{border:"var(--n-border)",borderColor:"#0000",zIndex:1}),A("icon","\n margin: var(--n-icon-margin);\n margin-left: 0;\n height: var(--n-icon-size);\n width: var(--n-icon-size);\n max-width: var(--n-icon-size);\n font-size: var(--n-icon-size);\n position: relative;\n flex-shrink: 0;\n ",[j("icon-slot","\n height: var(--n-icon-size);\n width: var(--n-icon-size);\n position: absolute;\n left: 0;\n top: 50%;\n transform: translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n ",[U({top:"50%",originalTransform:"translateY(-50%)"})]),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.duration,n=void 0===t?".2s":t,o=e.delay,i=void 0===o?".1s":o;return[B("&.fade-in-width-expand-transition-leave-from, &.fade-in-width-expand-transition-enter-to",{opacity:1}),B("&.fade-in-width-expand-transition-leave-to, &.fade-in-width-expand-transition-enter-from","\n opacity: 0!important;\n margin-left: 0!important;\n margin-right: 0!important;\n "),B("&.fade-in-width-expand-transition-leave-active","\n overflow: hidden;\n transition:\n opacity ".concat(n," ").concat(cn,",\n max-width ").concat(n," ").concat(cn," ").concat(i,",\n margin-left ").concat(n," ").concat(cn," ").concat(i,",\n margin-right ").concat(n," ").concat(cn," ").concat(i,";\n ")),B("&.fade-in-width-expand-transition-enter-active","\n overflow: hidden;\n transition:\n opacity ".concat(n," ").concat(cn," ").concat(i,",\n max-width ").concat(n," ").concat(cn,",\n margin-left ").concat(n," ").concat(cn,",\n margin-right ").concat(n," ").concat(cn,";\n "))]}()]),A("content","\n display: flex;\n align-items: center;\n flex-wrap: nowrap;\n min-width: 0;\n ",[B("~",[A("icon",{margin:"var(--n-icon-margin)",marginRight:0})])]),N("block","\n display: flex;\n width: 100%;\n "),N("dashed",[A("border, state-border",{borderStyle:"dashed !important"})]),N("disabled",{cursor:"not-allowed",opacity:"var(--n-opacity-disabled)"})]),B("@keyframes button-wave-spread",{from:{boxShadow:"0 0 0.5px 0 var(--n-ripple-color)"},to:{boxShadow:"0 0 0.5px 4.5px var(--n-ripple-color)"}}),B("@keyframes button-wave-opacity",{from:{opacity:"var(--n-wave-opacity)"},to:{opacity:0}})]),mn=Object.assign(Object.assign({},Z.props),{color:String,textColor:String,text:Boolean,block:Boolean,loading:Boolean,disabled:Boolean,circle:Boolean,size:String,ghost:Boolean,round:Boolean,secondary:Boolean,tertiary:Boolean,quaternary:Boolean,strong:Boolean,focusable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},tag:{type:String,default:"button"},type:{type:String,default:"default"},dashed:Boolean,renderIcon:Function,iconPlacement:{type:String,default:"left"},attrType:{type:String,default:"button"},bordered:{type:Boolean,default:!0},onClick:[Function,Array],nativeFocusBehavior:{type:Boolean,default:!pn}}),bn=F({name:"Button",props:mn,slots:Object,setup:function(e){var t=c(null),n=c(null),o=c(!1),i=q((function(){return!e.quaternary&&!e.tertiary&&!e.secondary&&!e.text&&(!e.color||e.ghost||e.dashed)&&e.bordered})),r=M(vn,{}),a=tn({},{defaultSize:"medium",mergedSize:function(t){var n=e.size;if(n)return n;var o=r.size;if(o)return o;var i=(t||{}).mergedSize;return i?i.value:"medium"}}).mergedSizeRef,s=S((function(){return e.focusable&&!e.disabled})),l=K(e),u=l.inlineThemeDisabled,d=l.mergedClsPrefixRef,h=l.mergedRtlRef,p=Z("Button","-button",yn,$,e,d),f=J("Button",h,d),g=S((function(){var t=p.value,n=t.common,o=n.cubicBezierEaseInOut,i=n.cubicBezierEaseOut,r=t.self,s=r.rippleDuration,l=r.opacityDisabled,c=r.fontWeight,u=r.fontWeightStrong,d=a.value,h=e.dashed,f=e.type,g=e.ghost,v=e.text,y=e.color,m=e.round,b=e.circle,x=e.textColor,C=e.secondary,w=e.tertiary,k=e.quaternary,P={"--n-font-weight":e.strong?u:c},S={"--n-color":"initial","--n-color-hover":"initial","--n-color-pressed":"initial","--n-color-focus":"initial","--n-color-disabled":"initial","--n-ripple-color":"initial","--n-text-color":"initial","--n-text-color-hover":"initial","--n-text-color-pressed":"initial","--n-text-color-focus":"initial","--n-text-color-disabled":"initial"},M="tertiary"===f,I="default"===f,O=M?"default":f;if(v){var F=x||y;S={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":"#0000","--n-text-color":F||r[Q("textColorText",O)],"--n-text-color-hover":F?fn(F):r[Q("textColorTextHover",O)],"--n-text-color-pressed":F?gn(F):r[Q("textColorTextPressed",O)],"--n-text-color-focus":F?fn(F):r[Q("textColorTextHover",O)],"--n-text-color-disabled":F||r[Q("textColorTextDisabled",O)]}}else if(g||h){var _=x||y;S={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":y||r[Q("rippleColor",O)],"--n-text-color":_||r[Q("textColorGhost",O)],"--n-text-color-hover":_?fn(_):r[Q("textColorGhostHover",O)],"--n-text-color-pressed":_?gn(_):r[Q("textColorGhostPressed",O)],"--n-text-color-focus":_?fn(_):r[Q("textColorGhostHover",O)],"--n-text-color-disabled":_||r[Q("textColorGhostDisabled",O)]}}else if(C){var D=I?r.textColor:M?r.textColorTertiary:r[Q("color",O)],B=y||D,E="default"!==f&&"tertiary"!==f;S={"--n-color":E?ee(B,{alpha:Number(r.colorOpacitySecondary)}):r.colorSecondary,"--n-color-hover":E?ee(B,{alpha:Number(r.colorOpacitySecondaryHover)}):r.colorSecondaryHover,"--n-color-pressed":E?ee(B,{alpha:Number(r.colorOpacitySecondaryPressed)}):r.colorSecondaryPressed,"--n-color-focus":E?ee(B,{alpha:Number(r.colorOpacitySecondaryHover)}):r.colorSecondaryHover,"--n-color-disabled":r.colorSecondary,"--n-ripple-color":"#0000","--n-text-color":B,"--n-text-color-hover":B,"--n-text-color-pressed":B,"--n-text-color-focus":B,"--n-text-color-disabled":B}}else if(w||k){var j=I?r.textColor:M?r.textColorTertiary:r[Q("color",O)],R=y||j;w?(S["--n-color"]=r.colorTertiary,S["--n-color-hover"]=r.colorTertiaryHover,S["--n-color-pressed"]=r.colorTertiaryPressed,S["--n-color-focus"]=r.colorSecondaryHover,S["--n-color-disabled"]=r.colorTertiary):(S["--n-color"]=r.colorQuaternary,S["--n-color-hover"]=r.colorQuaternaryHover,S["--n-color-pressed"]=r.colorQuaternaryPressed,S["--n-color-focus"]=r.colorQuaternaryHover,S["--n-color-disabled"]=r.colorQuaternary),S["--n-ripple-color"]="#0000",S["--n-text-color"]=R,S["--n-text-color-hover"]=R,S["--n-text-color-pressed"]=R,S["--n-text-color-focus"]=R,S["--n-text-color-disabled"]=R}else S={"--n-color":y||r[Q("color",O)],"--n-color-hover":y?fn(y):r[Q("colorHover",O)],"--n-color-pressed":y?gn(y):r[Q("colorPressed",O)],"--n-color-focus":y?fn(y):r[Q("colorFocus",O)],"--n-color-disabled":y||r[Q("colorDisabled",O)],"--n-ripple-color":y||r[Q("rippleColor",O)],"--n-text-color":x||(y?r.textColorPrimary:M?r.textColorTertiary:r[Q("textColor",O)]),"--n-text-color-hover":x||(y?r.textColorHoverPrimary:r[Q("textColorHover",O)]),"--n-text-color-pressed":x||(y?r.textColorPressedPrimary:r[Q("textColorPressed",O)]),"--n-text-color-focus":x||(y?r.textColorFocusPrimary:r[Q("textColorFocus",O)]),"--n-text-color-disabled":x||(y?r.textColorDisabledPrimary:r[Q("textColorDisabled",O)])};var L={"--n-border":"initial","--n-border-hover":"initial","--n-border-pressed":"initial","--n-border-focus":"initial","--n-border-disabled":"initial"};L=v?{"--n-border":"none","--n-border-hover":"none","--n-border-pressed":"none","--n-border-focus":"none","--n-border-disabled":"none"}:{"--n-border":r[Q("border",O)],"--n-border-hover":r[Q("borderHover",O)],"--n-border-pressed":r[Q("borderPressed",O)],"--n-border-focus":r[Q("borderFocus",O)],"--n-border-disabled":r[Q("borderDisabled",O)]};var z=r[Q("height",d)],T=r[Q("fontSize",d)],N=r[Q("padding",d)],W=r[Q("paddingRound",d)],A=r[Q("iconSize",d)],U=r[Q("borderRadius",d)],G=r[Q("iconMargin",d)],V=r.waveOpacity,H={"--n-width":b&&!v?z:"initial","--n-height":v?"initial":z,"--n-font-size":T,"--n-padding":b||v?"initial":m?W:N,"--n-icon-size":A,"--n-icon-margin":G,"--n-border-radius":v?"initial":b||m?z:U};return Object.assign(Object.assign(Object.assign(Object.assign({"--n-bezier":o,"--n-bezier-ease-out":i,"--n-ripple-duration":s,"--n-opacity-disabled":l,"--n-wave-opacity":V},P),S),L),H)})),v=u?te("button",S((function(){var t="",n=e.dashed,o=e.type,i=e.ghost,r=e.text,s=e.color,l=e.round,c=e.circle,u=e.textColor;n&&(t+="a"),i&&(t+="b"),r&&(t+="c"),l&&(t+="d"),c&&(t+="e"),e.secondary&&(t+="f"),e.tertiary&&(t+="g"),e.quaternary&&(t+="h"),e.strong&&(t+="i"),s&&(t+="j".concat(It(s))),u&&(t+="k".concat(It(u)));var d=a.value;return t+="l".concat(d[0]),t+="m".concat(o[0])})),g,e):void 0;return{selfElRef:t,waveElRef:n,mergedClsPrefix:d,mergedFocusable:s,mergedSize:a,showBorder:i,enterPressed:o,rtlEnabled:f,handleMousedown:function(n){var o;s.value||n.preventDefault(),e.nativeFocusBehavior||(n.preventDefault(),e.disabled||s.value&&(null===(o=t.value)||void 0===o||o.focus({preventScroll:!0})))},handleKeydown:function(t){if("Enter"===t.key){if(!e.keyboard||e.loading)return void t.preventDefault();o.value=!0}},handleBlur:function(){o.value=!1},handleKeyup:function(t){if("Enter"===t.key){if(!e.keyboard)return;o.value=!1}},handleClick:function(t){var o;if(!e.disabled&&!e.loading){var i=e.onClick;i&&ne(i,t),e.text||null===(o=n.value)||void 0===o||o.play()}},customColorCssVars:S((function(){var t=e.color;if(!t)return null;var n=fn(t);return{"--n-border-color":t,"--n-border-color-hover":n,"--n-border-color-pressed":gn(t),"--n-border-color-focus":n,"--n-border-color-disabled":t}})),cssVars:u?void 0:g,themeClass:null==v?void 0:v.themeClass,onRender:null==v?void 0:v.onRender}},render:function(){var e=this,t=this.mergedClsPrefix,n=this.tag,o=this.onRender;null==o||o();var i=G(this.$slots.default,(function(e){return e&&_("span",{class:"".concat(t,"-button__content")},e)}));return _(n,{ref:"selfElRef",class:[this.themeClass,"".concat(t,"-button"),"".concat(t,"-button--").concat(this.type,"-type"),"".concat(t,"-button--").concat(this.mergedSize,"-type"),this.rtlEnabled&&"".concat(t,"-button--rtl"),this.disabled&&"".concat(t,"-button--disabled"),this.block&&"".concat(t,"-button--block"),this.enterPressed&&"".concat(t,"-button--pressed"),!this.text&&this.dashed&&"".concat(t,"-button--dashed"),this.color&&"".concat(t,"-button--color"),this.secondary&&"".concat(t,"-button--secondary"),this.loading&&"".concat(t,"-button--loading"),this.ghost&&"".concat(t,"-button--ghost")],tabindex:this.mergedFocusable?0:-1,type:this.attrType,style:this.cssVars,disabled:this.disabled,onClick:this.handleClick,onBlur:this.handleBlur,onMousedown:this.handleMousedown,onKeyup:this.handleKeyup,onKeydown:this.handleKeydown},"right"===this.iconPlacement&&i,_(V,{width:!0},{default:function(){return G(e.$slots.icon,(function(n){return(e.loading||e.renderIcon||n)&&_("span",{class:"".concat(t,"-button__icon"),style:{margin:H(e.$slots.default)?"0":""}},_(X,null,{default:function(){return e.loading?_(Y,{clsPrefix:t,key:"loading",class:"".concat(t,"-icon-slot"),strokeWidth:20}):_("div",{key:"icon",class:"".concat(t,"-icon-slot"),role:"none"},e.renderIcon?e.renderIcon():n)}}))}))}}),"left"===this.iconPlacement&&i,this.text?null:_(dn,{ref:"waveElRef",clsPrefix:t}),this.showBorder?_("div",{"aria-hidden":!0,class:"".concat(t,"-button__border"),style:this.customColorCssVars}):null,this.showBorder?_("div",{"aria-hidden":!0,class:"".concat(t,"-button__state-border"),style:this.customColorCssVars}):null)}}),xn=I("n-dialog-provider"),Cn={icon:Function,type:{type:String,default:"default"},title:[String,Function],closable:{type:Boolean,default:!0},negativeText:String,positiveText:String,positiveButtonProps:Object,negativeButtonProps:Object,content:[String,Function],action:Function,showIcon:{type:Boolean,default:!0},loading:Boolean,bordered:Boolean,iconPlacement:String,titleClass:[String,Array],titleStyle:[String,Object],contentClass:[String,Array],contentStyle:[String,Object],actionClass:[String,Array],actionStyle:[String,Object],onPositiveClick:Function,onNegativeClick:Function,onClose:Function},wn=oe(Cn),kn=B([j("dialog","\n --n-icon-margin: var(--n-icon-margin-top) var(--n-icon-margin-right) var(--n-icon-margin-bottom) var(--n-icon-margin-left);\n word-break: break-word;\n line-height: var(--n-line-height);\n position: relative;\n background: var(--n-color);\n color: var(--n-text-color);\n box-sizing: border-box;\n margin: auto;\n border-radius: var(--n-border-radius);\n padding: var(--n-padding);\n transition: \n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n ",[A("icon",{color:"var(--n-icon-color)"}),N("bordered",{border:"var(--n-border)"}),N("icon-top",[A("close",{margin:"var(--n-close-margin)"}),A("icon",{margin:"var(--n-icon-margin)"}),A("content",{textAlign:"center"}),A("title",{justifyContent:"center"}),A("action",{justifyContent:"center"})]),N("icon-left",[A("icon",{margin:"var(--n-icon-margin)"}),N("closable",[A("title","\n padding-right: calc(var(--n-close-size) + 6px);\n ")])]),A("close","\n position: absolute;\n right: 0;\n top: 0;\n margin: var(--n-close-margin);\n transition:\n background-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n z-index: 1;\n "),A("content","\n font-size: var(--n-font-size);\n margin: var(--n-content-margin);\n position: relative;\n word-break: break-word;\n ",[N("last","margin-bottom: 0;")]),A("action","\n display: flex;\n justify-content: flex-end;\n ",[B("> *:not(:last-child)","\n margin-right: var(--n-action-space);\n ")]),A("icon","\n font-size: var(--n-icon-size);\n transition: color .3s var(--n-bezier);\n "),A("title","\n transition: color .3s var(--n-bezier);\n display: flex;\n align-items: center;\n font-size: var(--n-title-font-size);\n font-weight: var(--n-title-font-weight);\n color: var(--n-title-text-color);\n "),j("dialog-icon-container","\n display: flex;\n justify-content: center;\n ")]),ie(j("dialog","\n width: 446px;\n max-width: calc(100vw - 32px);\n ")),j("dialog",[re("\n width: 446px;\n max-width: calc(100vw - 32px);\n ")])]),Pn={default:function(){return _(ge,null)},info:function(){return _(ge,null)},success:function(){return _(fe,null)},warning:function(){return _(pe,null)},error:function(){return _(he,null)}},Sn=F({name:"Dialog",alias:["NimbusConfirmCard","Confirm"],props:Object.assign(Object.assign({},Z.props),Cn),slots:Object,setup:function(e){var t=K(e),n=t.mergedComponentPropsRef,o=t.mergedClsPrefixRef,i=t.inlineThemeDisabled,r=t.mergedRtlRef,a=J("Dialog",r,o),s=S((function(){var t,o;return e.iconPlacement||(null===(o=null===(t=null==n?void 0:n.value)||void 0===t?void 0:t.Dialog)||void 0===o?void 0:o.iconPlacement)||"left"}));var l=Z("Dialog","-dialog",kn,ue,e,o),c=S((function(){var t=e.type,n=s.value,o=l.value,i=o.common.cubicBezierEaseInOut,r=o.self,a=r.fontSize,c=r.lineHeight,u=r.border,d=r.titleTextColor,h=r.textColor,p=r.color,f=r.closeBorderRadius,g=r.closeColorHover,v=r.closeColorPressed,y=r.closeIconColor,m=r.closeIconColorHover,b=r.closeIconColorPressed,x=r.closeIconSize,C=r.borderRadius,w=r.titleFontWeight,k=r.titleFontSize,P=r.padding,S=r.iconSize,M=r.actionSpace,I=r.contentMargin,O=r.closeSize,F=r["top"===n?"iconMarginIconTop":"iconMargin"],_=r["top"===n?"closeMarginIconTop":"closeMargin"],D=r[Q("iconColor",t)],B=de(F);return{"--n-font-size":a,"--n-icon-color":D,"--n-bezier":i,"--n-close-margin":_,"--n-icon-margin-top":B.top,"--n-icon-margin-right":B.right,"--n-icon-margin-bottom":B.bottom,"--n-icon-margin-left":B.left,"--n-icon-size":S,"--n-close-size":O,"--n-close-icon-size":x,"--n-close-border-radius":f,"--n-close-color-hover":g,"--n-close-color-pressed":v,"--n-close-icon-color":y,"--n-close-icon-color-hover":m,"--n-close-icon-color-pressed":b,"--n-color":p,"--n-text-color":h,"--n-border-radius":C,"--n-padding":P,"--n-line-height":c,"--n-border":u,"--n-content-margin":I,"--n-title-font-size":k,"--n-title-font-weight":w,"--n-title-text-color":d,"--n-action-space":M}})),u=i?te("dialog",S((function(){return"".concat(e.type[0]).concat(s.value[0])})),c,e):void 0;return{mergedClsPrefix:o,rtlEnabled:a,mergedIconPlacement:s,mergedTheme:l,handlePositiveClick:function(t){var n=e.onPositiveClick;n&&n(t)},handleNegativeClick:function(t){var n=e.onNegativeClick;n&&n(t)},handleCloseClick:function(){var t=e.onClose;t&&t()},cssVars:i?void 0:c,themeClass:null==u?void 0:u.themeClass,onRender:null==u?void 0:u.onRender}},render:function(){var e,t=this,n=this.bordered,o=this.mergedIconPlacement,i=this.cssVars,r=this.closable,a=this.showIcon,s=this.title,l=this.content,c=this.action,u=this.negativeText,d=this.positiveText,h=this.positiveButtonProps,p=this.negativeButtonProps,f=this.handlePositiveClick,g=this.handleNegativeClick,v=this.mergedTheme,y=this.loading,m=this.type,b=this.mergedClsPrefix;null===(e=this.onRender)||void 0===e||e.call(this);var x=a?_(ae,{clsPrefix:b,class:"".concat(b,"-dialog__icon")},{default:function(){return G(t.$slots.icon,(function(e){return e||(t.icon?se(t.icon):Pn[t.type]())}))}}):null,C=G(this.$slots.action,(function(e){return e||d||u||c?_("div",{class:["".concat(b,"-dialog__action"),t.actionClass],style:t.actionStyle},e||(c?[se(c)]:[t.negativeText&&_(bn,Object.assign({theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,ghost:!0,size:"small",onClick:g},p),{default:function(){return se(t.negativeText)}}),t.positiveText&&_(bn,Object.assign({theme:v.peers.Button,themeOverrides:v.peerOverrides.Button,size:"small",type:"default"===m?"primary":m,disabled:y,loading:y,onClick:f},h),{default:function(){return se(t.positiveText)}})])):null}));return _("div",{class:["".concat(b,"-dialog"),this.themeClass,this.closable&&"".concat(b,"-dialog--closable"),"".concat(b,"-dialog--icon-").concat(o),n&&"".concat(b,"-dialog--bordered"),this.rtlEnabled&&"".concat(b,"-dialog--rtl")],style:i,role:"dialog"},r?G(this.$slots.close,(function(e){var n=["".concat(b,"-dialog__close"),t.rtlEnabled&&"".concat(b,"-dialog--rtl")];return e?_("div",{class:n},e):_(ce,{clsPrefix:b,class:n,onClick:t.handleCloseClick})})):null,a&&"top"===o?_("div",{class:"".concat(b,"-dialog-icon-container")},x):null,_("div",{class:["".concat(b,"-dialog__title"),this.titleClass],style:this.titleStyle},a&&"left"===o?x:null,le(this.$slots.header,(function(){return[se(s)]}))),_("div",{class:["".concat(b,"-dialog__content"),C?"":"".concat(b,"-dialog__content--last"),this.contentClass],style:this.contentStyle},le(this.$slots.default,(function(){return[se(l)]}))),C)}}),Mn="n-draggable";var In=Object.assign(Object.assign({},Ot),Cn),On=oe(In),Fn=F({name:"ModalBody",inheritAttrs:!1,slots:Object,props:Object.assign(Object.assign({show:{type:Boolean,required:!0},preset:String,displayDirective:{type:String,required:!0},trapFocus:{type:Boolean,default:!0},autoFocus:{type:Boolean,default:!0},blockScroll:Boolean,draggable:{type:[Boolean,Object],default:!1}},In),{renderMask:Function,onClickoutside:Function,onBeforeLeave:{type:Function,required:!0},onAfterLeave:{type:Function,required:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0},onClose:{type:Function,required:!0},onAfterEnter:Function,onEsc:Function}),setup:function(e){var t=c(null),n=c(null),o=c(e.show),i=c(null),r=c(null),a=M(Fe),s=null;P(L(e,"show"),(function(e){e&&(s=a.getMousePosition())}),{immediate:!0});var l=function(e,t){var n,o=S((function(){return!1!==e.value})),i=S((function(){return o.value?Mn:""})),r=S((function(){var t=e.value;return!0===t||!1===t||!t||"none"!==t.bounds}));function a(){n&&(n(),n=void 0)}return ve(a),{stopDrag:a,startDrag:function(e){var o=e.querySelector(".".concat(Mn));if(o&&i.value){var a,s=0,l=0,c=0,u=0,h=0,p=0;d("mousedown",o,f),d("mousemove",window,g),d("mouseup",window,v),n=function(){C("mousedown",o,f),d("mousemove",window,g),d("mouseup",window,v)}}function f(t){t.preventDefault(),a=t;var n=e.getBoundingClientRect(),o=n.x,i=n.y,r=n.right,d=n.bottom;l=o,u=i,s=window.innerWidth-r,c=window.innerHeight-d;var f=e.style,g=f.left,v=f.top;h=+v.slice(0,-2),p=+g.slice(0,-2)}function g(t){if(a){var n=a,o=n.clientX,i=n.clientY,d=t.clientX-o,f=t.clientY-i;r.value&&(d>s?d=s:-d>l&&(d=-l),f>c?f=c:-f>u&&(f=-u));var g=d+p,v=f+h;e.style.top="".concat(v,"px"),e.style.left="".concat(g,"px")}}function v(){a=void 0,t.onEnd(e)}},draggableRef:o,draggableClassRef:i}}(L(e,"draggable"),{onEnd:function(e){b(e)}}),u=l.stopDrag,h=l.startDrag,p=l.draggableRef,f=l.draggableClassRef,g=S((function(){return Oe([e.titleClass,f.value])})),v=S((function(){return Oe([e.headerClass,f.value])}));function y(){if("center"===a.transformOriginRef.value)return"";var e=i.value,t=r.value;if(null===e||null===t)return"";if(n.value){var o=n.value.containerScrollTop;return"".concat(e,"px ").concat(t+o,"px")}return""}function b(e){if("center"!==a.transformOriginRef.value&&s&&n.value){var t=n.value.containerScrollTop,o=e.offsetLeft,l=e.offsetTop,c=s.y,u=s.x;i.value=-(o-u),r.value=-(l-c-t),e.style.transformOrigin=y()}}P(L(e,"show"),(function(e){e&&(o.value=!0)})),function(e){if("undefined"!=typeof document){var t,n=document.documentElement,o=!1,i=function(){n.style.marginRight=qt,n.style.overflow=Kt,n.style.overflowX=Zt,n.style.overflowY=$t,Jt.value="0px"};k((function(){t=P(e,(function(e){if(e){if(!Yt){var t=window.innerWidth-n.offsetWidth;t>0&&(qt=n.style.marginRight,n.style.marginRight="".concat(t,"px"),Jt.value="".concat(t,"px")),Kt=n.style.overflow,Zt=n.style.overflowX,$t=n.style.overflowY,n.style.overflow="hidden",n.style.overflowX="hidden",n.style.overflowY="hidden"}o=!0,Yt++}else--Yt||i(),o=!1}),{immediate:!0})})),m((function(){null==t||t(),o&&(--Yt||i(),o=!1)}))}}(S((function(){return e.blockScroll&&o.value})));var x=c(null);return P(x,(function(e){e&&z((function(){var n=e.el;n&&t.value!==n&&(t.value=n)}))})),O(_e,t),O(De,null),O(Be,null),{mergedTheme:a.mergedThemeRef,appear:a.appearRef,isMounted:a.isMountedRef,mergedClsPrefix:a.mergedClsPrefixRef,bodyRef:t,scrollbarRef:n,draggableClass:f,displayed:o,childNodeRef:x,cardHeaderClass:v,dialogTitleClass:g,handlePositiveClick:function(){e.onPositiveClick()},handleNegativeClick:function(){e.onNegativeClick()},handleCloseClick:function(){var t=e.onClose;t&&t()},handleAfterEnter:function(t){var n=t;p.value&&h(n),e.onAfterEnter&&e.onAfterEnter(n)},handleAfterLeave:function(){o.value=!1,i.value=null,r.value=null,u(),e.onAfterLeave()},handleBeforeLeave:function(t){t.style.transformOrigin=y(),e.onBeforeLeave()},handleEnter:function(e){z((function(){b(e)}))}}},render:function(){var e=this,t=this.$slots,n=this.$attrs,o=this.handleEnter,i=this.handleAfterEnter,r=this.handleAfterLeave,a=this.handleBeforeLeave,s=this.preset,l=this.mergedClsPrefix,c=null;if(!s){if(!(c=ye("default",t.default,{draggableClass:this.draggableClass})))return void me("modal","default slot is empty");(c=be(c)).props=xe({class:"".concat(l,"-modal")},n,c.props||{})}return"show"===this.displayDirective||this.displayed||this.show?Ce(_("div",{role:"none",class:"".concat(l,"-modal-body-wrapper")},_(we,{ref:"scrollbarRef",theme:this.mergedTheme.peers.Scrollbar,themeOverrides:this.mergedTheme.peerOverrides.Scrollbar,contentClass:"".concat(l,"-modal-scroll-content")},{default:function(){var n;return[null===(n=e.renderMask)||void 0===n?void 0:n.call(e),_(ke,{disabled:!e.trapFocus,active:e.show,onEsc:e.onEsc,autoFocus:e.autoFocus},{default:function(){var n;return _(Pe,{name:"fade-in-scale-up-transition",appear:null!==(n=e.appear)&&void 0!==n?n:e.isMounted,onEnter:o,onAfterEnter:i,onAfterLeave:r,onBeforeLeave:a},{default:function(){var n=[[Se,e.show]];return e.onClickoutside&&n.push([Me,e.onClickoutside,void 0,{capture:!0}]),Ce("confirm"===e.preset||"dialog"===e.preset?_(Sn,Object.assign({},e.$attrs,{class:["".concat(l,"-modal"),e.$attrs.class],ref:"bodyRef",theme:e.mergedTheme.peers.Dialog,themeOverrides:e.mergedTheme.peerOverrides.Dialog},Ie(e.$props,wn),{titleClass:e.dialogTitleClass,"aria-modal":"true"}),t):"card"===e.preset?_(Ft,Object.assign({},e.$attrs,{ref:"bodyRef",class:["".concat(l,"-modal"),e.$attrs.class],theme:e.mergedTheme.peers.Card,themeOverrides:e.mergedTheme.peerOverrides.Card},Ie(e.$props,_t),{headerClass:e.cardHeaderClass,"aria-modal":"true",role:"dialog"}),t):e.childNodeRef=c,n)}})}})]}})),[[Se,"if"===this.displayDirective||this.displayed||this.show]]):null}}),_n=B([j("modal-container","\n position: fixed;\n left: 0;\n top: 0;\n height: 0;\n width: 0;\n display: flex;\n "),j("modal-mask","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n background-color: rgba(0, 0, 0, .4);\n ",[Ee({enterDuration:".25s",leaveDuration:".25s",enterCubicBezier:"var(--n-bezier-ease-out)",leaveCubicBezier:"var(--n-bezier-ease-out)"})]),j("modal-body-wrapper","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n overflow: visible;\n ",[j("modal-scroll-content","\n min-height: 100%;\n display: flex;\n position: relative;\n ")]),j("modal","\n position: relative;\n align-self: center;\n color: var(--n-text-color);\n margin: auto;\n box-shadow: var(--n-box-shadow);\n ",[je({duration:".25s",enterScale:".5"}),B(".".concat(Mn),"\n cursor: move;\n user-select: none;\n ")])]),Dn=Object.assign(Object.assign(Object.assign(Object.assign({},Z.props),{show:Boolean,unstableShowMask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},preset:String,to:[String,Object],displayDirective:{type:String,default:"if"},transformOrigin:{type:String,default:"mouse"},zIndex:Number,autoFocus:{type:Boolean,default:!0},trapFocus:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!0}}),In),{draggable:[Boolean,Object],onEsc:Function,"onUpdate:show":[Function,Array],onUpdateShow:[Function,Array],onAfterEnter:Function,onBeforeLeave:Function,onAfterLeave:Function,onClose:Function,onPositiveClick:Function,onNegativeClick:Function,onMaskClick:Function,internalDialog:Boolean,internalModal:Boolean,internalAppear:{type:Boolean,default:void 0},overlayStyle:[String,Object],onBeforeHide:Function,onAfterHide:Function,onHide:Function}),Bn=F({name:"Modal",inheritAttrs:!1,props:Dn,slots:Object,setup:function(e){var t=c(null),n=K(e),o=n.mergedClsPrefixRef,a=n.namespaceRef,l=n.inlineThemeDisabled,u=Z("Modal","-modal",_n,Te,e,o),h=function(e){if(!r)return s(c(!1));var t=c(!1),n=null;function o(){null!==n&&window.clearTimeout(n)}function i(){o(),t.value=!0,n=window.setTimeout((function(){t.value=!1}),e)}0===Nt&&d("click",window,Wt,!0);var a=function(){Nt+=1,d("click",window,i,!0)};return At&&(At=p())?(y(a),m((function(){0==(Nt-=1)&&C("click",window,Wt,!0),C("click",window,i,!0),o()}))):a(),s(t)}(64),f=function(){if(!r)return s(c(null));0===Lt&&d("click",document,Rt,!0);var e=function(){Lt+=1};return zt&&(zt=p())?(y(e),m((function(){0==(Lt-=1)&&C("click",document,Rt,!0)}))):e(),s(i)}(),g=ze(),v=e.internalDialog?M(xn,null):null,b=e.internalModal?M(We,null):null,x=Xt();function w(t){var n=e.onUpdateShow,o=e["onUpdate:show"],i=e.onHide;n&&ne(n,t),o&&ne(o,t),i&&!t&&i(t)}O(Fe,{getMousePosition:function(){var e=v||b;if(e){var t=e.clickedRef,n=e.clickedPositionRef;if(t.value&&n.value)return n.value}return h.value?f.value:null},mergedClsPrefixRef:o,mergedThemeRef:u,isMountedRef:g,appearRef:L(e,"internalAppear"),transformOriginRef:L(e,"transformOrigin")});var k=S((function(){var e=u.value,t=e.common.cubicBezierEaseOut,n=e.self;return{"--n-bezier-ease-out":t,"--n-box-shadow":n.boxShadow,"--n-color":n.color,"--n-text-color":n.textColor}})),P=l?te("theme-class",void 0,k,e):void 0;return{mergedClsPrefix:o,namespace:a,isMounted:g,containerRef:t,presetProps:S((function(){return Ie(e,On)})),handleEsc:function(t){var n,o;null===(n=e.onEsc)||void 0===n||n.call(e),e.show&&e.closeOnEsc&&(o=t,!Qt.has(o))&&(x.value||w(!1))},handleAfterLeave:function(){var t=e.onAfterLeave,n=e.onAfterHide;t&&ne(t),n&&n()},handleClickoutside:function(n){var o,i=e.onMaskClick;i&&i(n),e.maskClosable&&(null===(o=t.value)||void 0===o?void 0:o.contains(Ne(n)))&&w(!1)},handleBeforeLeave:function(){var t=e.onBeforeLeave,n=e.onBeforeHide;t&&ne(t),n&&n()},doUpdateShow:w,handleNegativeClick:function(){var t=e.onNegativeClick;t?Promise.resolve(t()).then((function(e){!1!==e&&w(!1)})):w(!1)},handlePositiveClick:function(){var t=e.onPositiveClick;t?Promise.resolve(t()).then((function(e){!1!==e&&w(!1)})):w(!1)},handleCloseClick:function(){var t=e.onClose;t?Promise.resolve(t()).then((function(e){!1!==e&&w(!1)})):w(!1)},cssVars:l?void 0:k,themeClass:null==P?void 0:P.themeClass,onRender:null==P?void 0:P.onRender}},render:function(){var e=this,t=this.mergedClsPrefix;return _(Re,{to:this.to,show:this.show},{default:function(){var n;null===(n=e.onRender)||void 0===n||n.call(e);var o=e.unstableShowMask;return Ce(_("div",{role:"none",ref:"containerRef",class:["".concat(t,"-modal-container"),e.themeClass,e.namespace],style:e.cssVars},_(Fn,Object.assign({style:e.overlayStyle},e.$attrs,{ref:"bodyWrapper",displayDirective:e.displayDirective,show:e.show,preset:e.preset,autoFocus:e.autoFocus,trapFocus:e.trapFocus,draggable:e.draggable,blockScroll:e.blockScroll},e.presetProps,{onEsc:e.handleEsc,onClose:e.handleCloseClick,onNegativeClick:e.handleNegativeClick,onPositiveClick:e.handlePositiveClick,onBeforeLeave:e.handleBeforeLeave,onAfterEnter:e.onAfterEnter,onAfterLeave:e.handleAfterLeave,onClickoutside:o?void 0:e.handleClickoutside,renderMask:o?function(){var n;return _(Pe,{name:"fade-in-transition",key:"mask",appear:null!==(n=e.internalAppear)&&void 0!==n?n:e.isMounted},{default:function(){return e.show?_("div",{"aria-hidden":!0,ref:"containerRef",class:"".concat(t,"-modal-mask"),onClick:e.handleClickoutside}):null}})}:void 0}),e.$slots)),[[Le,{zIndex:e.zIndex,enabled:e.show}]])}})}});function En(){var e=M(Ue,null);return null===e&&Ae("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),e}var jn={success:_(fe,null),error:_(he,null),warning:_(pe,null),info:_(ge,null)},Rn=F({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup:function(e,t){var n=t.slots;function o(t,n,o,i){var r=e.gapDegree,a=e.viewBoxWidth,s=50,l=50+e.strokeWidth/2,c="M ".concat(l,",").concat(l," m ").concat(0,",").concat(50,"\n      a ").concat(s,",").concat(s," 0 1 1 ").concat(0,",").concat(-100,"\n      a ").concat(s,",").concat(s," 0 1 1 ").concat(-0,",").concat(100),u=2*Math.PI*s;return{pathString:c,pathStyle:{stroke:"rail"===i?o:"object"===w(e.fillColor)?"url(#gradient)":o,strokeDasharray:"".concat(t/100*(u-r),"px ").concat(8*a,"px"),strokeDashoffset:"-".concat(r/2,"px"),transformOrigin:n?"center":void 0,transform:n?"rotate(".concat(n,"deg)"):void 0}}}return function(){var t,i,r,a=e.fillColor,s=e.railColor,l=e.strokeWidth,c=e.offsetDegree,u=e.status,d=e.percentage,h=e.showIndicator,p=e.indicatorTextColor,f=e.unit,g=e.gapOffsetDegree,v=e.clsPrefix,y=o(100,0,s,"rail"),m=y.pathString,b=y.pathStyle,x=o(d,c,a,"fill"),C=x.pathString,k=x.pathStyle,P=100+l;return _("div",{class:"".concat(v,"-progress-content"),role:"none"},_("div",{class:"".concat(v,"-progress-graph"),"aria-hidden":!0},_("div",{class:"".concat(v,"-progress-graph-circle"),style:{transform:g?"rotate(".concat(g,"deg)"):void 0}},_("svg",{viewBox:"0 0 ".concat(P," ").concat(P)},(t="object"===w(e.fillColor),i=t?e.fillColor.stops[0]:"",r=t?e.fillColor.stops[1]:"",t&&_("defs",null,_("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},_("stop",{offset:"0%","stop-color":i}),_("stop",{offset:"100%","stop-color":r})))),_("g",null,_("path",{class:"".concat(v,"-progress-graph-circle-rail"),d:m,"stroke-width":l,"stroke-linecap":"round",fill:"none",style:b})),_("g",null,_("path",{class:["".concat(v,"-progress-graph-circle-fill"),0===d&&"".concat(v,"-progress-graph-circle-fill--empty")],d:C,"stroke-width":l,"stroke-linecap":"round",fill:"none",style:k}))))),h?_("div",null,n.default?_("div",{class:"".concat(v,"-progress-custom-content"),role:"none"},n.default()):"default"!==u?_("div",{class:"".concat(v,"-progress-icon"),"aria-hidden":!0},_(ae,{clsPrefix:v},{default:function(){return jn[u]}})):_("div",{class:"".concat(v,"-progress-text"),style:{color:p},role:"none"},_("span",{class:"".concat(v,"-progress-text__percentage")},d),_("span",{class:"".concat(v,"-progress-text__unit")},f))):null)}}}),Ln={success:_(fe,null),error:_(he,null),warning:_(pe,null),info:_(ge,null)},zn=F({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup:function(e,t){var n=t.slots,o=S((function(){return Ge(e.height)})),i=S((function(){var t,n;return"object"===w(e.fillColor)?"linear-gradient(to right, ".concat(null===(t=e.fillColor)||void 0===t?void 0:t.stops[0]," , ").concat(null===(n=e.fillColor)||void 0===n?void 0:n.stops[1],")"):e.fillColor})),r=S((function(){return void 0!==e.railBorderRadius?Ge(e.railBorderRadius):void 0!==e.height?Ge(e.height,{c:.5}):""})),a=S((function(){return void 0!==e.fillBorderRadius?Ge(e.fillBorderRadius):void 0!==e.railBorderRadius?Ge(e.railBorderRadius):void 0!==e.height?Ge(e.height,{c:.5}):""}));return function(){var t=e.indicatorPlacement,s=e.railColor,l=e.railStyle,c=e.percentage,u=e.unit,d=e.indicatorTextColor,h=e.status,p=e.showIndicator,f=e.processing,g=e.clsPrefix;return _("div",{class:"".concat(g,"-progress-content"),role:"none"},_("div",{class:"".concat(g,"-progress-graph"),"aria-hidden":!0},_("div",{class:["".concat(g,"-progress-graph-line"),x({},"".concat(g,"-progress-graph-line--indicator-").concat(t),!0)]},_("div",{class:"".concat(g,"-progress-graph-line-rail"),style:[{backgroundColor:s,height:o.value,borderRadius:r.value},l]},_("div",{class:["".concat(g,"-progress-graph-line-fill"),f&&"".concat(g,"-progress-graph-line-fill--processing")],style:{maxWidth:"".concat(e.percentage,"%"),background:i.value,height:o.value,lineHeight:o.value,borderRadius:a.value}},"inside"===t?_("div",{class:"".concat(g,"-progress-graph-line-indicator"),style:{color:d}},n.default?n.default():"".concat(c).concat(u)):null)))),p&&"outside"===t?_("div",null,n.default?_("div",{class:"".concat(g,"-progress-custom-content"),style:{color:d},role:"none"},n.default()):"default"===h?_("div",{role:"none",class:"".concat(g,"-progress-icon ").concat(g,"-progress-icon--as-text"),style:{color:d}},c,u):_("div",{class:"".concat(g,"-progress-icon"),"aria-hidden":!0},_(ae,{clsPrefix:g},{default:function(){return Ln[h]}}))):null)}}});function Tn(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;return"m ".concat(n/2," ").concat(n/2-e," a ").concat(e," ").concat(e," 0 1 1 0 ").concat(2*e," a ").concat(e," ").concat(e," 0 1 1 0 -").concat(2*e)}var Nn=F({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:function(){return[]}},railColor:{type:Array,default:function(){return[]}},railStyle:{type:Array,default:function(){return[]}}},setup:function(e,t){var n=t.slots,o=S((function(){var t=e.percentage.map((function(t,n){return"".concat(Math.PI*t/100*(e.viewBoxWidth/2-e.strokeWidth/2*(1+2*n)-e.circleGap*n)*2,", ").concat(8*e.viewBoxWidth)}));return t}));return function(){var t=e.viewBoxWidth,i=e.strokeWidth,r=e.circleGap,a=e.showIndicator,s=e.fillColor,l=e.railColor,c=e.railStyle,u=e.percentage,d=e.clsPrefix;return _("div",{class:"".concat(d,"-progress-content"),role:"none"},_("div",{class:"".concat(d,"-progress-graph"),"aria-hidden":!0},_("div",{class:"".concat(d,"-progress-graph-circle")},_("svg",{viewBox:"0 0 ".concat(t," ").concat(t)},_("defs",null,u.map((function(t,n){return function(t,n){var o=e.fillColor[n],i="object"===w(o)?o.stops[0]:"",r="object"===w(o)?o.stops[1]:"";return"object"===w(e.fillColor[n])&&_("linearGradient",{id:"gradient-".concat(n),x1:"100%",y1:"0%",x2:"0%",y2:"100%"},_("stop",{offset:"0%","stop-color":i}),_("stop",{offset:"100%","stop-color":r}))}(0,n)}))),u.map((function(e,n){return _("g",{key:n},_("path",{class:"".concat(d,"-progress-graph-circle-rail"),d:Tn(t/2-i/2*(1+2*n)-r*n,i,t),"stroke-width":i,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:l[n]},c[n]]}),_("path",{class:["".concat(d,"-progress-graph-circle-fill"),0===e&&"".concat(d,"-progress-graph-circle-fill--empty")],d:Tn(t/2-i/2*(1+2*n)-r*n,i,t),"stroke-width":i,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:o.value[n],strokeDashoffset:0,stroke:"object"===w(s[n])?"url(#gradient-".concat(n,")"):s[n]}}))}))))),a&&n.default?_("div",null,_("div",{class:"".concat(d,"-progress-text")},n.default())):null)}}}),Wn=B([j("progress",{display:"inline-block"},[j("progress-icon","\n color: var(--n-icon-color);\n transition: color .3s var(--n-bezier);\n "),N("line","\n width: 100%;\n display: block;\n ",[j("progress-content","\n display: flex;\n align-items: center;\n ",[j("progress-graph",{flex:1})]),j("progress-custom-content",{marginLeft:"14px"}),j("progress-icon","\n width: 30px;\n padding-left: 14px;\n height: var(--n-icon-size-line);\n line-height: var(--n-icon-size-line);\n font-size: var(--n-icon-size-line);\n ",[N("as-text","\n color: var(--n-text-color-line-outer);\n text-align: center;\n width: 40px;\n font-size: var(--n-font-size);\n padding-left: 4px;\n transition: color .3s var(--n-bezier);\n ")])]),N("circle, dashboard",{width:"120px"},[j("progress-custom-content","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n "),j("progress-text","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: inherit;\n font-size: var(--n-font-size-circle);\n color: var(--n-text-color-circle);\n font-weight: var(--n-font-weight-circle);\n transition: color .3s var(--n-bezier);\n white-space: nowrap;\n "),j("progress-icon","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: var(--n-icon-color);\n font-size: var(--n-icon-size-circle);\n ")]),N("multiple-circle","\n width: 200px;\n color: inherit;\n ",[j("progress-text","\n font-weight: var(--n-font-weight-circle);\n color: var(--n-text-color-circle);\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n ")]),j("progress-content",{position:"relative"}),j("progress-graph",{position:"relative"},[j("progress-graph-circle",[B("svg",{verticalAlign:"bottom"}),j("progress-graph-circle-fill","\n stroke: var(--n-fill-color);\n transition:\n opacity .3s var(--n-bezier),\n stroke .3s var(--n-bezier),\n stroke-dasharray .3s var(--n-bezier);\n ",[N("empty",{opacity:0})]),j("progress-graph-circle-rail","\n transition: stroke .3s var(--n-bezier);\n overflow: hidden;\n stroke: var(--n-rail-color);\n ")]),j("progress-graph-line",[N("indicator-inside",[j("progress-graph-line-rail","\n height: 16px;\n line-height: 16px;\n border-radius: 10px;\n ",[j("progress-graph-line-fill","\n height: inherit;\n border-radius: 10px;\n "),j("progress-graph-line-indicator","\n background: #0000;\n white-space: nowrap;\n text-align: right;\n margin-left: 14px;\n margin-right: 14px;\n height: inherit;\n font-size: 12px;\n color: var(--n-text-color-line-inner);\n transition: color .3s var(--n-bezier);\n ")])]),N("indicator-inside-label","\n height: 16px;\n display: flex;\n align-items: center;\n ",[j("progress-graph-line-rail","\n flex: 1;\n transition: background-color .3s var(--n-bezier);\n "),j("progress-graph-line-indicator","\n background: var(--n-fill-color);\n font-size: 12px;\n transform: translateZ(0);\n display: flex;\n vertical-align: middle;\n height: 16px;\n line-height: 16px;\n padding: 0 10px;\n border-radius: 10px;\n position: absolute;\n white-space: nowrap;\n color: var(--n-text-color-line-inner);\n transition:\n right .2s var(--n-bezier),\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n ")]),j("progress-graph-line-rail","\n position: relative;\n overflow: hidden;\n height: var(--n-rail-height);\n border-radius: 5px;\n background-color: var(--n-rail-color);\n transition: background-color .3s var(--n-bezier);\n ",[j("progress-graph-line-fill","\n background: var(--n-fill-color);\n position: relative;\n border-radius: 5px;\n height: inherit;\n width: 100%;\n max-width: 0%;\n transition:\n background-color .3s var(--n-bezier),\n max-width .2s var(--n-bezier);\n ",[N("processing",[B("&::after",'\n content: "";\n background-image: var(--n-line-bg-processing);\n animation: progress-processing-animation 2s var(--n-bezier) infinite;\n ')])])])])])]),B("@keyframes progress-processing-animation","\n 0% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 100%;\n opacity: 1;\n }\n 66% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n 100% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n ")]),An=Object.assign(Object.assign({},Z.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),Un=F({name:"Progress",props:An,setup:function(e){var t=S((function(){return e.indicatorPlacement||e.indicatorPosition})),n=S((function(){return e.gapDegree||0===e.gapDegree?e.gapDegree:"dashboard"===e.type?75:void 0})),o=K(e),i=o.mergedClsPrefixRef,r=o.inlineThemeDisabled,a=Z("Progress","-progress",Wn,Ve,e,i),s=S((function(){var t=e.status,n=a.value,o=n.common.cubicBezierEaseInOut,i=n.self,r=i.fontSize,s=i.fontSizeCircle,l=i.railColor,c=i.railHeight,u=i.iconSizeCircle,d=i.iconSizeLine,h=i.textColorCircle,p=i.textColorLineInner,f=i.textColorLineOuter,g=i.lineBgProcessing,v=i.fontWeightCircle,y=i[Q("iconColor",t)];return{"--n-bezier":o,"--n-fill-color":i[Q("fillColor",t)],"--n-font-size":r,"--n-font-size-circle":s,"--n-font-weight-circle":v,"--n-icon-color":y,"--n-icon-size-circle":u,"--n-icon-size-line":d,"--n-line-bg-processing":g,"--n-rail-color":l,"--n-rail-height":c,"--n-text-color-circle":h,"--n-text-color-line-inner":p,"--n-text-color-line-outer":f}})),l=r?te("progress",S((function(){return e.status[0]})),s,e):void 0;return{mergedClsPrefix:i,mergedIndicatorPlacement:t,gapDeg:n,cssVars:r?void 0:s,themeClass:null==l?void 0:l.themeClass,onRender:null==l?void 0:l.onRender}},render:function(){var e=this.type,t=this.cssVars,n=this.indicatorTextColor,o=this.showIndicator,i=this.status,r=this.railColor,a=this.railStyle,s=this.color,l=this.percentage,c=this.viewBoxWidth,u=this.strokeWidth,d=this.mergedIndicatorPlacement,h=this.unit,p=this.borderRadius,f=this.fillBorderRadius,g=this.height,v=this.processing,y=this.circleGap,m=this.mergedClsPrefix,b=this.gapDeg,x=this.gapOffsetDegree,C=this.themeClass,w=this.$slots,k=this.onRender;return null==k||k(),_("div",{class:[C,"".concat(m,"-progress"),"".concat(m,"-progress--").concat(e),"".concat(m,"-progress--").concat(i)],style:t,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":l,role:"circle"===e||"line"===e||"dashboard"===e?"progressbar":"none"},"circle"===e||"dashboard"===e?_(Rn,{clsPrefix:m,status:i,showIndicator:o,indicatorTextColor:n,railColor:r,fillColor:s,railStyle:a,offsetDegree:this.offsetDegree,percentage:l,viewBoxWidth:c,strokeWidth:u,gapDegree:void 0===b?"dashboard"===e?75:0:b,gapOffsetDegree:x,unit:h},w):"line"===e?_(zn,{clsPrefix:m,status:i,showIndicator:o,indicatorTextColor:n,railColor:r,fillColor:s,railStyle:a,percentage:l,processing:v,indicatorPlacement:d,unit:h,fillBorderRadius:f,railBorderRadius:p,height:g},w):"multiple-circle"===e?_(Nn,{clsPrefix:m,strokeWidth:u,railColor:r,fillColor:s,railStyle:a,viewBoxWidth:c,percentage:l,showIndicator:o,circleGap:y},w):null)}}),Gn=I("n-upload"),Vn=B([j("upload","width: 100%;",[N("dragger-inside",[j("upload-trigger","\n display: block;\n ")]),N("drag-over",[j("upload-dragger","\n border: var(--n-dragger-border-hover);\n ")])]),j("upload-dragger","\n cursor: pointer;\n box-sizing: border-box;\n width: 100%;\n text-align: center;\n border-radius: var(--n-border-radius);\n padding: 24px;\n opacity: 1;\n transition:\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n background-color: var(--n-dragger-color);\n border: var(--n-dragger-border);\n ",[B("&:hover","\n border: var(--n-dragger-border-hover);\n "),N("disabled","\n cursor: not-allowed;\n ")]),j("upload-trigger","\n display: inline-block;\n box-sizing: border-box;\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[B("+",[j("upload-file-list","margin-top: 8px;")]),N("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n "),N("image-card","\n width: 96px;\n height: 96px;\n ",[j("base-icon","\n font-size: 24px;\n "),j("upload-dragger","\n padding: 0;\n height: 100%;\n width: 100%;\n display: flex;\n align-items: center;\n justify-content: center;\n ")])]),j("upload-file-list","\n line-height: var(--n-line-height);\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[B("a, img","outline: none;"),N("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n ",[j("upload-file","cursor: not-allowed;")]),N("grid","\n display: grid;\n grid-template-columns: repeat(auto-fill, 96px);\n grid-gap: 8px;\n margin-top: 0;\n "),j("upload-file","\n display: block;\n box-sizing: border-box;\n cursor: default;\n padding: 0px 12px 0 6px;\n transition: background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n ",[He(),j("progress",[He({foldPadding:!0})]),B("&:hover","\n background-color: var(--n-item-color-hover);\n ",[j("upload-file-info",[A("action","\n opacity: 1;\n ")])]),N("image-type","\n border-radius: var(--n-border-radius);\n text-decoration: underline;\n text-decoration-color: #0000;\n ",[j("upload-file-info","\n padding-top: 0px;\n padding-bottom: 0px;\n width: 100%;\n height: 100%;\n display: flex;\n justify-content: space-between;\n align-items: center;\n padding: 6px 0;\n ",[j("progress","\n padding: 2px 0;\n margin-bottom: 0;\n "),A("name","\n padding: 0 8px;\n "),A("thumbnail","\n width: 32px;\n height: 32px;\n font-size: 28px;\n display: flex;\n justify-content: center;\n align-items: center;\n ",[B("img","\n width: 100%;\n ")])])]),N("text-type",[j("progress","\n box-sizing: border-box;\n padding-bottom: 6px;\n margin-bottom: 6px;\n ")]),N("image-card-type","\n position: relative;\n width: 96px;\n height: 96px;\n border: var(--n-item-border-image-card);\n border-radius: var(--n-border-radius);\n padding: 0;\n display: flex;\n align-items: center;\n justify-content: center;\n transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n overflow: hidden;\n ",[j("progress","\n position: absolute;\n left: 8px;\n bottom: 8px;\n right: 8px;\n width: unset;\n "),j("upload-file-info","\n padding: 0;\n width: 100%;\n height: 100%;\n ",[A("thumbnail","\n width: 100%;\n height: 100%;\n display: flex;\n flex-direction: column;\n align-items: center;\n justify-content: center;\n font-size: 36px;\n ",[B("img","\n width: 100%;\n ")])]),B("&::before",'\n position: absolute;\n z-index: 1;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n opacity: 0;\n transition: opacity .2s var(--n-bezier);\n content: "";\n '),B("&:hover",[B("&::before","opacity: 1;"),j("upload-file-info",[A("thumbnail","opacity: .12;")])])]),N("error-status",[B("&:hover","\n background-color: var(--n-item-color-hover-error);\n "),j("upload-file-info",[A("name","color: var(--n-item-text-color-error);"),A("thumbnail","color: var(--n-item-text-color-error);")]),N("image-card-type","\n border: var(--n-item-border-image-card-error);\n ")]),N("with-url","\n cursor: pointer;\n ",[j("upload-file-info",[A("name","\n color: var(--n-item-text-color-success);\n text-decoration-color: var(--n-item-text-color-success);\n ",[B("a","\n text-decoration: underline;\n ")])])]),j("upload-file-info","\n position: relative;\n padding-top: 6px;\n padding-bottom: 6px;\n display: flex;\n flex-wrap: nowrap;\n ",[A("thumbnail","\n font-size: 18px;\n opacity: 1;\n transition: opacity .2s var(--n-bezier);\n color: var(--n-item-icon-color);\n ",[j("base-icon","\n margin-right: 2px;\n vertical-align: middle;\n transition: color .3s var(--n-bezier);\n ")]),A("action","\n padding-top: inherit;\n padding-bottom: inherit;\n position: absolute;\n right: 0;\n top: 0;\n bottom: 0;\n width: 80px;\n display: flex;\n align-items: center;\n transition: opacity .2s var(--n-bezier);\n justify-content: flex-end;\n opacity: 0;\n ",[j("button",[B("&:not(:last-child)",{marginRight:"4px"}),j("base-icon",[B("svg",[U()])])]),N("image-type","\n position: relative;\n max-width: 80px;\n width: auto;\n "),N("image-card-type","\n z-index: 2;\n position: absolute;\n width: 100%;\n height: 100%;\n left: 0;\n right: 0;\n bottom: 0;\n top: 0;\n display: flex;\n justify-content: center;\n align-items: center;\n ")]),A("name","\n color: var(--n-item-text-color);\n flex: 1;\n display: flex;\n justify-content: center;\n text-overflow: ellipsis;\n overflow: hidden;\n flex-direction: column;\n text-decoration-color: #0000;\n font-size: var(--n-font-size);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier); \n ",[B("a","\n color: inherit;\n text-decoration: underline;\n ")])])])]),j("upload-file-input","\n display: none;\n width: 0;\n height: 0;\n opacity: 0;\n ")]),Hn="__UPLOAD_DRAGGER__",Xn=F(x(x({name:"UploadDragger"},Hn,!0),"setup",(function(e,t){var n=t.slots,o=M(Gn,null);return o||Ae("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),function(){var e=o.mergedClsPrefixRef.value,t=o.mergedDisabledRef.value,i=o.maxReachedRef.value;return _("div",{class:["".concat(e,"-upload-dragger"),(t||i)&&"".concat(e,"-upload-dragger--disabled")]},n)}}))),Yn=_("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},_("g",{fill:"none"},_("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),qn=_("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},_("g",{fill:"none"},_("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),Kn=F({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup:function(){return{mergedTheme:M(Gn).mergedThemeRef}},render:function(){var e=this;return _(V,null,{default:function(){return e.show?_(Un,{type:"line",showIndicator:!1,percentage:e.percentage,status:e.status,height:2,theme:e.mergedTheme.peers.Progress,themeOverrides:e.mergedTheme.peerOverrides.Progress}):null}})}}),Zn=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(qr){r(qr)}}function s(e){try{l(o.throw(e))}catch(qr){r(qr)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function $n(e){return e.includes("image/")}function Jn(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split("/"),t=e[e.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(t)||[""])[0]}var Qn=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,eo=function(e){if(e.type)return $n(e.type);var t=Jn(e.name||"");if(Qn.test(t))return!0;var n=e.thumbnailUrl||e.url||"",o=Jn(n);return!(!/^data:image\//.test(n)&&!Qn.test(o))};var to=Mt&&window.FileReader&&window.File;function no(e){return e.isFile}function oo(e){var t=e.id,n=e.name,o=e.percentage,i=e.status,r=e.url,a=e.file,s=e.thumbnailUrl,l=e.type,c=e.fullPath,u=e.batchId;return{id:t,name:n,percentage:null!=o?o:null,status:i,url:null!=r?r:null,file:null!=a?a:null,thumbnailUrl:null!=s?s:null,type:null!=l?l:null,fullPath:null!=c?c:null,batchId:null!=u?u:null}}var io=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(qr){r(qr)}}function s(e){try{l(o.throw(e))}catch(qr){r(qr)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))},ro={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},ao=F({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup:function(e){var t=this,n=M(Gn),o=c(null),i=c(""),r=S((function(){var t=e.file;return"finished"===t.status?"success":"error"===t.status?"error":"info"})),a=S((function(){if("error"===e.file.status)return"error"})),s=S((function(){return"uploading"===e.file.status})),l=S((function(){if(!n.showCancelButtonRef.value)return!1;var t=e.file;return["uploading","pending","error"].includes(t.status)})),u=S((function(){if(!n.showRemoveButtonRef.value)return!1;var t=e.file;return["finished"].includes(t.status)})),d=S((function(){if(!n.showDownloadButtonRef.value)return!1;var t=e.file;return["finished"].includes(t.status)})),h=S((function(){if(!n.showRetryButtonRef.value)return!1;var t=e.file;return["error"].includes(t.status)})),p=q((function(){return i.value||e.file.thumbnailUrl||e.file.url})),f=S((function(){if(!n.showPreviewButtonRef.value)return!1;var t=e.file.status,o=e.listType;return["finished"].includes(t)&&p.value&&"image-card"===o}));function g(t){var o=n.xhrMap,i=n.doChange,r=n.onRemoveRef.value,a=n.mergedFileListRef.value;Promise.resolve(!r||r({file:Object.assign({},t),fileList:a,index:e.index})).then((function(e){if(!1!==e){var n=Object.assign({},t,{status:"removed"});o.delete(t.id),i(n,void 0,{remove:!0})}}))}return Ye((function(){io(t,void 0,void 0,b().mark((function t(){var o;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("image"===(o=e.listType)||"image-card"===o){t.next=3;break}return t.abrupt("return");case 3:if(!n.shouldUseThumbnailUrlRef.value(e.file)){t.next=7;break}return t.next=6,n.getFileThumbnailUrlResolver(e.file);case 6:i.value=t.sent;case 7:case"end":return t.stop()}}),t)})))})),{mergedTheme:n.mergedThemeRef,progressStatus:r,buttonType:a,showProgress:s,disabled:n.mergedDisabledRef,showCancelButton:l,showRemoveButton:u,showDownloadButton:d,showRetryButton:h,showPreviewButton:f,mergedThumbnailUrl:p,shouldUseThumbnailUrl:n.shouldUseThumbnailUrlRef,renderIcon:n.renderIconRef,imageRef:o,handleRemoveOrCancelClick:function(t){t.preventDefault();var o=e.file;["finished","pending","error"].includes(o.status)?g(o):["uploading"].includes(o.status)?function(e){var t=n.xhrMap.get(e.id);null==t||t.abort(),g(Object.assign({},e))}(o):me("upload","The button clicked type is unknown.")},handleDownloadClick:function(t){var o,i;t.preventDefault(),o=e.file,i=n.onDownloadRef.value,Promise.resolve(!i||i(Object.assign({},o))).then((function(e){!1!==e&&Et(o.url,o.name)}))},handleRetryClick:function(){return io(this,void 0,void 0,b().mark((function t(){var o;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=n.onRetryRef.value)){t.next=7;break}return t.next=4,o({file:e.file});case 4:if(!1!==t.sent){t.next=7;break}return t.abrupt("return");case 7:n.submit(e.file.id);case 8:case"end":return t.stop()}}),t)})))},handlePreviewClick:function(t){var i=n.onPreviewRef.value;if(i)i(e.file,{event:t});else if("image-card"===e.listType){var r=o.value;if(!r)return;r.click()}}}},render:function(){var e,t=this,n=this.clsPrefix,o=this.mergedTheme,i=this.listType,r=this.file,a=this.renderIcon,s="image"===i;e=s||"image-card"===i?this.shouldUseThumbnailUrl(r)&&this.mergedThumbnailUrl?_("a",{rel:"noopener noreferer",target:"_blank",href:r.url||void 0,class:"".concat(n,"-upload-file-info__thumbnail"),onClick:this.handlePreviewClick},"image-card"===i?_(Dt,{src:this.mergedThumbnailUrl||void 0,previewSrc:r.url||void 0,alt:r.name,ref:"imageRef"}):_("img",{src:this.mergedThumbnailUrl||void 0,alt:r.name})):_("span",{class:"".concat(n,"-upload-file-info__thumbnail")},a?a(r):eo(r)?_(ae,{clsPrefix:n},{default:Yn}):_(ae,{clsPrefix:n},{default:qn})):_("span",{class:"".concat(n,"-upload-file-info__thumbnail")},a?a(r):_(ae,{clsPrefix:n},{default:function(){return _(on,null)}}));var l=_(Kn,{show:this.showProgress,percentage:r.percentage||0,status:this.progressStatus}),c="text"===i||"image"===i;return _("div",{class:["".concat(n,"-upload-file"),"".concat(n,"-upload-file--").concat(this.progressStatus,"-status"),r.url&&"error"!==r.status&&"image-card"!==i&&"".concat(n,"-upload-file--with-url"),"".concat(n,"-upload-file--").concat(i,"-type")]},_("div",{class:"".concat(n,"-upload-file-info")},e,_("div",{class:"".concat(n,"-upload-file-info__name")},c&&(r.url&&"error"!==r.status?_("a",{rel:"noopener noreferer",target:"_blank",href:r.url||void 0,onClick:this.handlePreviewClick},r.name):_("span",{onClick:this.handlePreviewClick},r.name)),s&&l),_("div",{class:["".concat(n,"-upload-file-info__action"),"".concat(n,"-upload-file-info__action--").concat(i,"-type")]},this.showPreviewButton?_(bn,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:o.peers.Button,themeOverrides:o.peerOverrides.Button,builtinThemeOverrides:ro},{icon:function(){return _(ae,{clsPrefix:n},{default:function(){return _(an,null)}})}}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&_(bn,{key:"cancelOrTrash",theme:o.peers.Button,themeOverrides:o.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:ro,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:function(){return _(X,null,{default:function(){return t.showRemoveButton?_(ae,{clsPrefix:n,key:"trash"},{default:function(){return _(ln,null)}}):_(ae,{clsPrefix:n,key:"cancel"},{default:function(){return _(rn,null)}})}})}}),this.showRetryButton&&!this.disabled&&_(bn,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:o.peers.Button,themeOverrides:o.peerOverrides.Button,builtinThemeOverrides:ro},{icon:function(){return _(ae,{clsPrefix:n},{default:function(){return _(sn,null)}})}}),this.showDownloadButton?_(bn,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:o.peers.Button,themeOverrides:o.peerOverrides.Button,builtinThemeOverrides:ro},{icon:function(){return _(ae,{clsPrefix:n},{default:function(){return _(Bt,null)}})}}):null)),!s&&l)}}),so=F({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup:function(e,t){var n=t.slots,o=M(Gn,null);o||Ae("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");var i=o.mergedClsPrefixRef,r=o.mergedDisabledRef,a=o.maxReachedRef,s=o.listTypeRef,l=o.dragOverRef,c=o.openOpenFileDialog,u=o.draggerInsideRef,d=o.handleFileAddition,h=o.mergedDirectoryDndRef,p=o.triggerClassRef,f=o.triggerStyleRef,g=S((function(){return"image-card"===s.value}));function y(){r.value||a.value||c()}function m(e){e.preventDefault(),l.value=!0}function x(e){e.preventDefault(),l.value=!0}function C(e){e.preventDefault(),l.value=!1}function w(e){var t;if(e.preventDefault(),!u.value||r.value||a.value)l.value=!1;else{var n=null===(t=e.dataTransfer)||void 0===t?void 0:t.items;(null==n?void 0:n.length)?function(e,t){return Zn(this,void 0,void 0,b().mark((function n(){var o,i;return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=function(e){return Zn(this,void 0,void 0,b().mark((function n(){var r,a,s;return b().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:r=v(e),n.prev=1,s=b().mark((function e(){var n,r,s,l,c;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.value){e.next=3;break}return e.abrupt("return",1);case 3:if(!t||!n.isDirectory){e.next=21;break}r=n.createReader(),s=[],e.prev=6;case 7:return e.next=9,new Promise((function(e,t){r.readEntries(e,t)}));case 9:l=e.sent,s=s.concat(l);case 11:if(l.length>0){e.next=7;break}case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(6),Xe("upload","error happens when handling directory upload",e.t0);case 17:return e.next=19,i(s);case 19:e.next=32;break;case 21:if(!no(n)){e.next=32;break}return e.prev=22,e.next=25,new Promise((function(e,t){n.file(e,t)}));case 25:c=e.sent,o.push({file:c,entry:n,source:"dnd"}),e.next=32;break;case 29:e.prev=29,e.t1=e.catch(22),Xe("upload","error happens when handling file upload",e.t1);case 32:case"end":return e.stop()}}),e,null,[[6,14],[22,29]])})),r.s();case 4:if((a=r.n()).done){n.next=10;break}return n.delegateYield(s(),"t0",6);case 6:if(!n.t0){n.next=8;break}return n.abrupt("continue",8);case 8:n.next=4;break;case 10:n.next=15;break;case 12:n.prev=12,n.t1=n.catch(1),r.e(n.t1);case 15:return n.prev=15,r.f(),n.finish(15);case 18:case"end":return n.stop()}}),n,null,[[1,12,15,18]])})))},o=[],n.next=4,i(e);case 4:return n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)})))}(Array.from(n).map((function(e){return e.webkitGetAsEntry()})),h.value).then((function(e){d(e)})).finally((function(){l.value=!1})):l.value=!1}}return function(){var t,o=i.value;return e.abstract?null===(t=n.default)||void 0===t?void 0:t.call(n,{handleClick:y,handleDrop:w,handleDragOver:m,handleDragEnter:x,handleDragLeave:C}):_("div",{class:["".concat(o,"-upload-trigger"),(r.value||a.value)&&"".concat(o,"-upload-trigger--disabled"),g.value&&"".concat(o,"-upload-trigger--image-card"),p.value],style:f.value,onClick:y,onDrop:w,onDragover:m,onDragenter:x,onDragleave:C},g.value?_(Xn,null,{default:function(){return le(n.default,(function(){return[_(ae,{clsPrefix:o},{default:function(){return _(nn,null)}})]}))}}):n)}}}),lo=F({name:"UploadFileList",setup:function(e,t){var n=t.slots,o=M(Gn,null);o||Ae("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");var i=o.abstractRef,r=o.mergedClsPrefixRef,a=o.listTypeRef,s=o.mergedFileListRef,l=o.fileListClassRef,c=o.fileListStyleRef,u=o.cssVarsRef,d=o.themeClassRef,h=o.maxReachedRef,p=o.showTriggerRef,f=o.imageGroupPropsRef,g=S((function(){return"image-card"===a.value})),v=function(){return s.value.map((function(e,t){return _(ao,{clsPrefix:r.value,key:e.id,file:e,index:t,listType:a.value})}))};return function(){var e=r.value,t=i.value;return _("div",{class:["".concat(e,"-upload-file-list"),g.value&&"".concat(e,"-upload-file-list--grid"),t?null==d?void 0:d.value:void 0,l.value],style:[t&&u?u.value:"",c.value]},g.value?_(jt,Object.assign({},f.value),{default:v}):_(V,{group:!0},{default:v}),p.value&&!h.value&&g.value&&_(so,null,n))}}}),co=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(qr){r(qr)}}function s(e){try{l(o.throw(e))}catch(qr){r(qr)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function uo(e,t,n){var o=function(e,t,n){var o=e.doChange,i=e.xhrMap,r=0;function a(n){var a,s=Object.assign({},t,{status:"error",percentage:r});i.delete(t.id),s=oo((null===(a=e.onError)||void 0===a?void 0:a.call(e,{file:s,event:n}))||s),o(s,n)}return{handleXHRLoad:function(s){var l;if(e.isErrorState){if(e.isErrorState(n))return void a(s)}else if(n.status<200||n.status>=300)return void a(s);var c=Object.assign({},t,{status:"finished",percentage:r});i.delete(t.id),c=oo((null===(l=e.onFinish)||void 0===l?void 0:l.call(e,{file:c,event:s}))||c),o(c,s)},handleXHRError:a,handleXHRAbort:function(e){var n=Object.assign({},t,{status:"removed",file:null,percentage:r});i.delete(t.id),o(n,e)},handleXHRProgress:function(e){var n=Object.assign({},t,{status:"uploading"});if(e.lengthComputable){var i=Math.ceil(e.loaded/e.total*100);n.percentage=i,r=i}o(n,e)}}}(e,t,n);n.onabort=o.handleXHRAbort,n.onerror=o.handleXHRError,n.onload=o.handleXHRLoad,n.upload&&(n.upload.onprogress=o.handleXHRProgress)}function ho(e,t){return"function"==typeof e?e({file:t}):e||{}}function po(e,t,n,o){var i=o.method,r=o.action,a=o.withCredentials,s=o.responseType,l=o.headers,c=o.data,u=new XMLHttpRequest;u.responseType=s,e.xhrMap.set(n.id,u),u.withCredentials=a;var d=new FormData;if(function(e,t,n){var o=ho(t,n);o&&Object.keys(o).forEach((function(t){e.append(t,o[t])}))}(d,c,n),null!==n.file&&d.append(t,n.file),uo(e,n,u),void 0!==r){u.open(i.toUpperCase(),r),function(e,t,n){var o=ho(t,n);o&&Object.keys(o).forEach((function(t){e.setRequestHeader(t,o[t])}))}(u,l,n),u.send(d);var h=Object.assign({},n,{status:"uploading"});e.doChange(h)}}var fo=Object.assign(Object.assign({},Z.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:function(){return[]}},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:function(e){return!!to&&eo(e)}},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),go=F({name:"Upload",props:fo,setup:function(e){e.abstract&&"image-card"===e.listType&&Ae("upload","when the list-type is image-card, abstract is not supported.");var t=K(e),n=t.mergedClsPrefixRef,o=t.inlineThemeDisabled,i=Z("Upload","-upload",Vn,Ze,e,n),r=tn(e),a=c(e.defaultFileList),s=L(e,"fileList"),l=c(null),u={value:!1},d=c(!1),h=new Map,p=$e(s,a),f=S((function(){return p.value.map(oo)})),v=S((function(){var t=e.max;return void 0!==t&&f.value.length>=t}));function y(){var e;null===(e=l.value)||void 0===e||e.click()}var m=S((function(){return e.multiple||e.directory})),x=function(t,n){var o,i,r,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{append:!1,remove:!1},l=s.append,c=s.remove,u=Array.from(f.value),d=u.findIndex((function(e){return e.id===t.id}));if(l||c||~d){l?u.push(t):c?u.splice(d,1):u.splice(d,1,t);var h=e.onChange;h&&h({file:t,fileList:u,event:n}),o=u,i=e["onUpdate:fileList"],r=e.onUpdateFileList,i&&ne(i,o),r&&ne(r,o),a.value=o}};function C(t,n){var o=this;if(t&&0!==t.length){var i=e.onBeforeUpload;t=m.value?t:[t[0]];var r=e.max,a=e.accept;t=t.filter((function(e){var t=e.file;return"dnd"!==e.source||!(null==a?void 0:a.trim())||function(e,t,n){return e=e.toLowerCase(),t=t.toLocaleLowerCase(),(n=n.toLocaleLowerCase()).split(",").map((function(e){return e.trim()})).filter(Boolean).some((function(n){if(n.startsWith(".")){if(e.endsWith(n))return!0}else{if(!n.includes("/"))return!0;var o=g(t.split("/"),2),i=o[0],r=o[1],a=g(n.split("/"),2),s=a[0],l=a[1];if(("*"===s||i&&s&&s===i)&&("*"===l||r&&l&&l===r))return!0}return!1}))}(t.name,t.type,a)})),r&&(t=t.slice(0,r-f.value.length));var s=Je();Promise.all(t.map((function(e){return co(o,[e],void 0,(function(e){var t=e.file,n=e.entry;return b().mark((function e(){var o,r;return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={id:Je(),batchId:s,name:t.name,status:"pending",percentage:0,file:t,url:null,type:t.type,thumbnailUrl:null,fullPath:null!==(o=null==n?void 0:n.fullPath)&&void 0!==o?o:"/".concat(t.webkitRelativePath||t.name)},e.t0=!i,e.t0){e.next=7;break}return e.next=5,i({file:r,fileList:f.value});case 5:e.t1=e.sent,e.t0=!1!==e.t1;case 7:if(!e.t0){e.next=9;break}return e.abrupt("return",r);case 9:return e.abrupt("return",null);case 10:case"end":return e.stop()}}),e)}))()}))}))).then((function(e){return co(o,void 0,void 0,b().mark((function t(){var o;return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=Promise.resolve(),e.forEach((function(e){o=o.then(z).then((function(){e&&x(e,n,{append:!0})}))})),t.next=4,o;case 4:case"end":return t.stop()}}),t)})))})).then((function(){e.defaultUpload&&w()}))}}function w(t){var n=e.method,o=e.action,i=e.withCredentials,r=e.headers,a=e.data,s=e.name,l=void 0!==t?f.value.filter((function(e){return e.id===t})):f.value,c=void 0!==t;l.forEach((function(t){var l=t.status;("pending"===l||"error"===l&&c)&&(e.customRequest?function(e){var t=e.inst,n=e.file,o=e.data,i=e.headers,r=e.withCredentials,a=e.action,s=e.customRequest,l=e.inst.doChange,c=0;s({file:n,data:o,headers:i,withCredentials:r,action:a,onProgress:function(e){var t=Object.assign({},n,{status:"uploading"}),o=e.percent;t.percentage=o,c=o,l(t)},onFinish:function(){var e,o=Object.assign({},n,{status:"finished",percentage:c});o=oo((null===(e=t.onFinish)||void 0===e?void 0:e.call(t,{file:o}))||o),l(o)},onError:function(){var e,o=Object.assign({},n,{status:"error",percentage:c});o=oo((null===(e=t.onError)||void 0===e?void 0:e.call(t,{file:o}))||o),l(o)}})}({inst:{doChange:x,xhrMap:h,onFinish:e.onFinish,onError:e.onError},file:t,action:o,withCredentials:i,headers:r,data:a,customRequest:e.customRequest}):po({doChange:x,xhrMap:h,onFinish:e.onFinish,onError:e.onError,isErrorState:e.isErrorState},s,t,{method:n,action:o,withCredentials:i,responseType:e.responseType,headers:r,data:a}))}))}var k=S((function(){var e=i.value,t=e.common.cubicBezierEaseInOut,n=e.self,o=n.draggerColor,r=n.draggerBorder,a=n.draggerBorderHover,s=n.itemColorHover,l=n.itemColorHoverError,c=n.itemTextColorError,u=n.itemTextColorSuccess,d=n.itemTextColor,h=n.itemIconColor,p=n.itemDisabledOpacity,f=n.lineHeight;return{"--n-bezier":t,"--n-border-radius":n.borderRadius,"--n-dragger-border":r,"--n-dragger-border-hover":a,"--n-dragger-color":o,"--n-font-size":n.fontSize,"--n-item-color-hover":s,"--n-item-color-hover-error":l,"--n-item-disabled-opacity":p,"--n-item-icon-color":h,"--n-item-text-color":d,"--n-item-text-color-error":c,"--n-item-text-color-success":u,"--n-line-height":f,"--n-item-border-image-card-error":n.itemBorderImageCardError,"--n-item-border-image-card":n.itemBorderImageCard}})),P=o?te("upload",void 0,k,e):void 0;O(Gn,{mergedClsPrefixRef:n,mergedThemeRef:i,showCancelButtonRef:L(e,"showCancelButton"),showDownloadButtonRef:L(e,"showDownloadButton"),showRemoveButtonRef:L(e,"showRemoveButton"),showRetryButtonRef:L(e,"showRetryButton"),onRemoveRef:L(e,"onRemove"),onDownloadRef:L(e,"onDownload"),mergedFileListRef:f,triggerClassRef:L(e,"triggerClass"),triggerStyleRef:L(e,"triggerStyle"),shouldUseThumbnailUrlRef:L(e,"shouldUseThumbnailUrl"),renderIconRef:L(e,"renderIcon"),xhrMap:h,submit:w,doChange:x,showPreviewButtonRef:L(e,"showPreviewButton"),onPreviewRef:L(e,"onPreview"),getFileThumbnailUrlResolver:function(t){var n;if(t.thumbnailUrl)return t.thumbnailUrl;var o=e.createThumbnailUrl;return o?null!==(n=o(t.file,t))&&void 0!==n?n:t.url||"":t.url?t.url:t.file?function(e){return Zn(this,void 0,void 0,b().mark((function t(){return b().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.type&&$n(e.type)?t(window.URL.createObjectURL(e)):t("")}));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))}(t.file):""},listTypeRef:L(e,"listType"),dragOverRef:d,openOpenFileDialog:y,draggerInsideRef:u,handleFileAddition:C,mergedDisabledRef:r.mergedDisabledRef,maxReachedRef:v,fileListClassRef:L(e,"fileListClass"),fileListStyleRef:L(e,"fileListStyle"),abstractRef:L(e,"abstract"),acceptRef:L(e,"accept"),cssVarsRef:o?void 0:k,themeClassRef:null==P?void 0:P.themeClass,onRender:null==P?void 0:P.onRender,showTriggerRef:L(e,"showTrigger"),imageGroupPropsRef:L(e,"imageGroupProps"),mergedDirectoryDndRef:S((function(){var t;return null!==(t=e.directoryDnd)&&void 0!==t?t:e.directory})),onRetryRef:L(e,"onRetry")});var M={clear:function(){a.value=[]},submit:w,openOpenFileDialog:y};return Object.assign({mergedClsPrefix:n,draggerInsideRef:u,inputElRef:l,mergedTheme:i,dragOver:d,mergedMultiple:m,cssVars:o?void 0:k,themeClass:null==P?void 0:P.themeClass,onRender:null==P?void 0:P.onRender,handleFileInputChange:function(e){var t=e.target;C(t.files?Array.from(t.files).map((function(e){return{file:e,entry:null,source:"input"}})):null,e),t.value=""}},M)},render:function(){var e,t,n=this.draggerInsideRef,o=this.mergedClsPrefix,i=this.$slots,r=this.directory,a=this.onRender;if(i.default&&!this.abstract){var s=i.default()[0];(null===(e=null==s?void 0:s.type)||void 0===e?void 0:e[Hn])&&(n.value=!0)}var l=_("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:"".concat(o,"-upload-file-input"),accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:r||void 0,directory:r||void 0}));return this.abstract?_(Ke,null,null===(t=i.default)||void 0===t?void 0:t.call(i),_(qe,{to:"body"},l)):(null==a||a(),_("div",{class:["".concat(o,"-upload"),n.value&&"".concat(o,"-upload--dragger-inside"),this.dragOver&&"".concat(o,"-upload--drag-over"),this.themeClass],style:this.cssVars},l,this.showTrigger&&"image-card"!==this.listType&&_(so,null,i),this.showFileList&&_(lo,null,i)))}}),vo=Object.defineProperty,yo=function(e,t,n){return function(e,t,n){return t in e?vo(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n}(e,"symbol"!=w(t)?t+"":t,n)},mo=Symbol("map"),bo=Symbol("isLoaded"),xo=Symbol("isInitialized"),Co=Symbol("componentId"),wo=Symbol("sourceId"),ko=Symbol("sourceLayerRegistry"),Po=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function So(e,t,n,o){return function(i){return n.emit(o,{type:i.type,map:t,component:e,event:i})}}var Mo=function(e){return e.TOP_LEFT="top-left",e.TOP_RIGHT="top-right",e.BOTTOM_LEFT="bottom-left",e.BOTTOM_RIGHT="bottom-right",e}(Mo||{}),Io=Object.values(Mo),Oo=new Map,Fo=Symbol("default");var _o=F({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:function(e){return e in Mo}},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Object}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup:function(e,t){var n=Qe(et()),o=tt(),i=tt(),r=c(!1),a=c(!1),s=new Map,l=function(e,t){var n,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Fo,i=Oo.get(o);return i||(i=rt({isLoaded:!1,isMounted:!1,language:null}),Oo.set(o,i)),i.isLoaded=(null==(n=t.value)?void 0:n.loaded())||!1,i.isMounted=!1,i.component=e,i.map=t.value,i}(n,i,e.mapKey);function u(){l.isMounted=!0;for(var c=f(f({},e),{},{style:e.mapStyle,container:o.value}),u=0,d=Object.keys(c);u<d.length;u++){var h=d[u];void 0===c[h]&&delete c[h]}if(i.value=Qe(new nt.Map(c)),l.map=i.value,r.value=!0,s.set("__load",(function(){return a.value=!0,l.isLoaded=!0})),i.value.on("load",s.get("__load")),s.set("__moveend",(function(){return t.emit("update:center",i.value.getCenter())})),i.value.on("moveend",s.get("__moveend")),s.set("__zoomend",(function(){return t.emit("update:zoom",i.value.getZoom())})),i.value.on("zoomend",s.get("__zoomend")),s.set("__pitchend",(function(){return t.emit("update:pitch",i.value.getPitch())})),i.value.on("pitchend",s.get("__pitchend")),s.set("__rotateend",(function(){return t.emit("update:bearing",i.value.getBearing())})),i.value.on("rotateend",s.get("__rotateend")),n.vnode.props){var p,y=v(Po);try{for(y.s();!(p=y.n()).done;){var m=p.value;if(n.vnode.props["onMap:"+m]){var b="map:".concat(m),x=So(n,i.value,t,b);s.set(m,x),i.value.on(m,x)}}}catch(C){y.e(C)}finally{y.f()}}i.value.getCanvas().addEventListener("webglcontextlost",g)}function d(){return p.apply(this,arguments)}function p(){return p=h(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l.isMounted=!1,l.isLoaded=!1,a.value=!1,i.value&&(i.value.getCanvas().removeEventListener("webglcontextlost",g),r.value=!1,s.forEach((function(e,t){i.value.off(t.startsWith("__")?t.substring(2):t,e)})),i.value.remove());case 1:case"end":return e.stop()}}),e)}))),p.apply(this,arguments)}function g(){d(),z(u)}return O(mo,i),O(bo,a),O(xo,r),O(Co,n.uid),O(wo,""),P((function(){return e.bearing}),(function(e){var t;e&&(null==(t=i.value)||t.setBearing(e))})),P((function(){return e.bounds}),(function(t){var n;t&&(null==(n=i.value)||n.fitBounds(t,e.fitBoundsOptions))})),P((function(){return e.center}),(function(e){var t,n,o=null==(t=i.value)?void 0:t.getCenter();e&&o&&!function(e,t){var n=nt.LngLat.convert(e),o=nt.LngLat.convert(t);return n.lng===o.lng&&n.lat===o.lat}(e,o)&&(null==(n=i.value)||n.setCenter(e))})),P((function(){return e.maxBounds}),(function(e){var t;e&&(null==(t=i.value)||t.setMaxBounds(e))})),P((function(){return e.maxPitch}),(function(e){var t;e&&(null==(t=i.value)||t.setMaxPitch(e))})),P((function(){return e.maxZoom}),(function(e){var t;e&&(null==(t=i.value)||t.setMaxZoom(e))})),P((function(){return e.minPitch}),(function(e){var t;e&&(null==(t=i.value)||t.setMinPitch(e))})),P((function(){return e.minZoom}),(function(e){var t;e&&(null==(t=i.value)||t.setMinZoom(e))})),P((function(){return e.pitch}),(function(e){var t;e&&(null==(t=i.value)||t.setPitch(e))})),P((function(){return e.renderWorldCopies}),(function(e){var t;e&&(null==(t=i.value)||t.setRenderWorldCopies(e))})),P((function(){return e.mapStyle}),(function(e){var t;e&&(null==(t=i.value)||t.setStyle(e))})),P((function(){return e.transformRequest}),(function(e){var t;e&&(null==(t=i.value)||t.setTransformRequest(e))})),P((function(){return e.zoom}),(function(e){var t;e&&(null==(t=i.value)||t.setZoom(e))})),P((function(){return e.zoom}),(function(e){var t;e&&(null==(t=i.value)||t.setZoom(e))})),k(u),m(d),t.expose({map:i}),function(){return[_("div",{ref:o,style:{height:e.height,width:e.width}}),r.value&&t.slots.default?t.slots.default({}):void 0]}},render:function(){return null}});function Do(e,t){var n=M(mo),o=M(xo),i=tt();return i.value=e(),function(e,t,n){P(e,(function(e){var o,i;e&&-1===Io.indexOf(e)||(null!=(o=t.value)&&o.hasControl(n)&&t.value.removeControl(n),null==(i=t.value)||i.addControl(n,e))}),{immediate:!0})}((function(){return t.position}),n,i.value),m((function(){var e;return o.value&&(null==(e=n.value)?void 0:e.removeControl(i.value))})),{control:i,map:n}}var Bo=function(){return u((function e(t,n){l(this,e),yo(this,"container"),this.isAdded=t,this.container=document.createElement("div"),this.setClasses(n)}),[{key:"getDefaultPosition",value:function(){return Mo.TOP_LEFT}},{key:"onAdd",value:function(){var e=this;return z((function(){return e.isAdded.value=!0})),this.container}},{key:"onRemove",value:function(){this.isAdded.value=!1,this.container.remove()}},{key:"setClasses",value:function(e){this.container.className=e}}])}(),Eo=F({name:"MglCustomControl",props:{position:{type:String,validator:function(e){return-1!==Io.indexOf(e)}},class:{type:String,default:"maplibregl-ctrl maplibregl-ctrl-group"}},slots:Object,setup:function(e,t){var n=t.slots,o=c(!1),i=Do((function(){return new Bo(o,e.class)}),e).control;return P((function(){return e.class}),(function(){return i.value.setClasses(e.class)})),function(){var e;return o.value?_(qe,{to:i.value.container},null==(e=n.default)?void 0:e.call(n,{})):ot("custom-component")}},render:function(){return null}}),jo=F({name:"MglFullscreenControl",props:{position:{type:String,validator:function(e){return-1!==Io.indexOf(e)}},container:{type:Object,default:null}},setup:function(e){var t=Do((function(){return new nt.FullscreenControl({container:e.container||void 0})}),e),n=t.control,o=t.map;function i(){z((function(){var e;return null==(e=o.value)?void 0:e.resize()}))}n.value.on("fullscreenstart",i),n.value.on("fullscreenend",i),m((function(){n.value.off("fullscreenstart",i),n.value.off("fullscreenend",i)}))},render:function(){return null}}),Ro=F({name:"MglGeolocateControl",props:{position:{type:String,default:Mo.TOP_RIGHT,validator:function(e){return-1!==Io.indexOf(e)}},positionOptions:{type:Object,default:function(){return{enableHighAccuracy:!1,timeout:6e3}}},fitBoundsOptions:{type:Object,default:function(){return{maxZoom:15}}},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},emits:["trackuserlocationstart","trackuserlocationend","userlocationlostfocus","userlocationfocus","geolocate","error","outofmaxbounds"],setup:function(e,t){var n=Do((function(){return new nt.GeolocateControl({positionOptions:e.positionOptions,fitBoundsOptions:e.fitBoundsOptions,trackUserLocation:e.trackUserLocation,showAccuracyCircle:e.showAccuracyCircle,showUserLocation:e.showUserLocation})}),e).control;function o(e){var o=function(n){t.emit(e,n)};n.value.on(e,o),m((function(){n.value.off(e,o)}))}o("trackuserlocationstart"),o("trackuserlocationend"),o("userlocationlostfocus"),o("userlocationfocus"),o("geolocate"),o("error"),o("outofmaxbounds")},render:function(){return null}}),Lo=F({name:"MglNavigationControl",props:{position:{type:String,validator:function(e){return-1!==Io.indexOf(e)}},showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:Boolean},setup:function(e){Do((function(){return new nt.NavigationControl({showCompass:e.showCompass,showZoom:e.showZoom,visualizePitch:e.visualizePitch})}),e)},render:function(){return null}}),zo=function(e){return e.IMPERIAL="imperial",e.METRIC="metric",e.NAUTICAL="nautical",e}(zo||{}),To=Object.values(zo),No=F({name:"MglScaleControl",props:{position:{type:String,validator:function(e){return-1!==Io.indexOf(e)}},maxWidth:{type:Number,default:100},unit:{type:String,default:"metric",validator:function(e){return-1!==To.indexOf(e)}}},setup:function(e){Do((function(){return new nt.ScaleControl({maxWidth:e.maxWidth,unit:e.unit})}),e)},render:function(){return null}}),Wo=function(){return u((function e(){l(this,e),yo(this,"unmountHandlers",new Map)}),[{key:"registerUnmountHandler",value:function(e,t){this.unmountHandlers.set(e,t)}},{key:"unregisterUnmountHandler",value:function(e){this.unmountHandlers.delete(e)}},{key:"unmount",value:function(){this.unmountHandlers.forEach((function(e){return e()}))}}])}(),Ao=function(){function e(){l(this,e)}return u(e,null,[{key:"genSourceOpts",value:function(e){for(var t=f({},e),n=0,o=Object.keys(t);n<o.length;n++){var i=o[n];(void 0===t[i]||"sourceId"===i)&&delete t[i]}return t}},{key:"getSourceRef",value:function(t,n){var o="string"==typeof n,i=String(t)+(o?n:""),r=e.REFS.get(i);return r||(r=c(o?null:void 0),e.REFS.set(i,r)),r}}])}();yo(Ao,"REFS",new Map);var Uo=Ao;var Go=F({name:"MglGeoJsonSource",props:{sourceId:{type:String,required:!0},data:{type:[Object,String],required:!0},maxzoom:Number,attribution:String,buffer:Number,tolerance:Number,cluster:Boolean,clusterRadius:Number,clusterMaxZoom:Number,clusterMinPoints:Number,clusterProperties:Object,lineMetrics:Boolean,generateId:Boolean,promoteId:[Object,String],filter:[Array,String,Object]},slots:Object,setup:function(e,t){var n=t.slots,o=M(Co),i=Uo.getSourceRef(o,e.sourceId),r=new Wo,a=f(f({},e),{},{type:"geojson"});return O(wo,e.sourceId),O(ko,r),function(e,t,n){var o=M(mo),i=M(bo);function r(){i.value&&(o.value.addSource(t.sourceId,Uo.genSourceOpts(t)),e.value=o.value.getSource(t.sourceId))}P(i,r,{immediate:!0}),o.value.on("style.load",r),m((function(){i.value&&(n.unmount(),o.value.removeSource(t.sourceId)),o.value.off("style.load",r)}))}(i,a,r),P([it(e.data)?e.data:function(){return e.data},i],(function(e){var t=g(e,2),n=t[0],o=t[1];null==o||o.setData(n||{type:"FeatureCollection",features:[]})}),{immediate:!0}),function(){return[ot("GeoJSON Source"),i.value&&n.default?n.default({}):void 0]}}}),Vo=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function Ho(){return{layerId:{type:String,required:!0},source:String,metadata:[Object,Array,String,Number],sourceLayer:String,minzoom:Number,maxzoom:Number,filter:Object,before:String,layout:Object,paint:Object}}function Xo(e,t){var n=M(mo),o=M(bo),i=M(ko);function r(){o.value&&(t&&function(e,t,n){if(n.props){var o,i=v(Vo);try{for(i.s();!(o=i.n()).done;){var r=o.value,a="on"+r.charAt(0).toUpperCase()+r.substr(1);n.props[a]&&e.off(r,t,n.props[a])}}catch(s){i.e(s)}finally{i.f()}}}(n.value,e,t.vnode),n.value.getLayer(e)&&n.value.removeLayer(e))}i.registerUnmountHandler(e,r),m((function(){i.unregisterUnmountHandler(e),r()}))}function Yo(e,t){var n=M(wo);if(n||t.source){var o=et(),i=M(mo),r=M(bo),a=M(Co),s=Uo.getSourceRef(a,t.source||n);return Xo(t.layerId,o),P((function(){return t.minzoom}),(function(){return i.value.setLayerZoomRange(t.layerId,t.minzoom||0,t.maxzoom||24)})),P((function(){return t.maxzoom}),(function(){return i.value.setLayerZoomRange(t.layerId,t.minzoom||0,t.maxzoom||24)})),P((function(){return t.layout}),(function(e){if(e)for(var n=0,o=Object.entries(e);n<o.length;n++){var r=g(o[n],2),a=r[0],s=r[1];i.value.setLayoutProperty(t.layerId,a,s)}}),{deep:!0}),P((function(){return t.paint}),(function(e){if(e)for(var n=0,o=Object.entries(e);n<o.length;n++){var r=g(o[n],2),a=r[0],s=r[1];i.value.setPaintProperty(t.layerId,a,s)}}),{deep:!0}),P((function(){return t.filter}),(function(e){return i.value.setFilter(t.layerId,e)}),{deep:!0}),P([r,s],(function(r){var a=g(r,2),s=a[0],l=a[1];s&&(l||void 0===l)&&(i.value.addLayer(function(e,t,n,o){for(var i={id:e,type:t,source:n.source||o,metadata:n.metadata,minzoom:n.minzoom,maxzoom:n.maxzoom,"source-layer":n.sourceLayer,filter:n.filter,paint:n.paint,layout:n.layout},r=0,a=Object.keys(i);r<a.length;r++){var s=a[r];void 0===i[s]&&delete i[s]}return i}(t.layerId,e,t,n),t.before||void 0),function(e,t,n){if(n.props)for(var o=0,i=Vo;o<i.length;o++){var r=i[o],a="on"+r.charAt(0).toUpperCase()+r.substr(1);n.props[a]&&e.on(r,t,n.props[a])}}(i.value,t.layerId,o.vnode))}),{immediate:!0}),function(){return ot("".concat(e," Layer"))}}}F({name:"MglBackgroundLayer",props:{layerId:{type:String,required:!0},metadata:[Object,Array,String,Number],minzoom:Number,maxzoom:Number,before:String,layout:Object,paint:Object},emits:[].concat(Vo),setup:function(e){var t=M(mo),n=M(bo);return Xo(e.layerId),P((function(){return e.layout}),(function(n){if(n)for(var o=0,i=Object.entries(n);o<i.length;o++){var r=g(i[o],2),a=r[0],s=r[1];t.value.setLayoutProperty(e.layerId,a,s)}})),P((function(){return e.paint}),(function(n){if(n)for(var o=0,i=Object.entries(n);o<i.length;o++){var r=g(i[o],2),a=r[0],s=r[1];t.value.setPaintProperty(e.layerId,a,s)}})),P(n,(function(n){n&&t.value.addLayer({id:e.layerId,type:"background",metadata:e.metadata,minzoom:e.minzoom,maxzoom:e.maxzoom,layout:e.layout,paint:e.paint},e.before||void 0)}),{immediate:!0}),function(){return ot("Background Layer")}}}),F({name:"MglCircleLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("circle",e)}}),F({name:"MglFillLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("fill",e)}}),F({name:"MglFillExtrusionLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("fill-extrusion",e)}}),F({name:"MglHeatmapLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("heatmap",e)}}),F({name:"MglHillshadeLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("hillshade",e)}});var qo,Ko=F({name:"MglLineLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("line",e)}});function Zo(){return Zo=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)({}).hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Zo.apply(null,arguments)}F({name:"MglRasterLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("raster",e)}}),F({name:"MglSymbolLayer",props:f({},Ho()),emits:[].concat(Vo),setup:function(e){return Yo("symbol",e)}}),function(e){e.Commit="commit",e.Provisional="provisional",e.Finish="finish"}(qo||(qo={}));var $o="selected",Jo="midPoint",Qo="selectionPoint",ei="edited",ti="closingPoint",ni="snappingPoint";function oi(e){return Boolean(e&&"object"==w(e)&&null!==e&&!Array.isArray(e))}function ii(e){return!!function(e){return"number"==typeof e&&!isNaN(new Date(e).valueOf())}(e)}var ri;!function(e){e.Drawing="drawing",e.Select="select",e.Static="static",e.Render="render"}(ri||(ri={}));var ai=function(){return u((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];l(this,e),this._state="unregistered",this._styles={},this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=ri.Drawing,this.mode="base",n||this.updateOptions(t)}),[{key:"state",get:function(){return this._state},set:function(e){throw new Error("Please use the modes lifecycle methods")}},{key:"styles",get:function(){return this._styles},set:function(e){if("object"!=w(e))throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}},{key:"registerBehaviors",value:function(e){}},{key:"updateOptions",value:function(e){null!=e&&e.styles&&(this.styles=Zo({},this._styles,e.styles)),null!=e&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),null!=e&&e.validation&&(this.validate=e&&e.validation),null!=e&&e.projection&&(this.projection=e.projection)}},{key:"setDrawing",value:function(){if("started"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}},{key:"setStarted",value:function(){if("stopped"!==this._state&&"registered"!==this._state&&"drawing"!==this._state&&"selecting"!==this._state)throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}},{key:"setStopped",value:function(){if("started"!==this._state)throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}},{key:"register",value:function(e){if("unregistered"!==this._state)throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}},{key:"validateFeature",value:function(e){return this.performFeatureValidation(e)}},{key:"performFeatureValidation",value:function(e){if("unregistered"===this._state)throw new Error("Mode must be registered");var t=function(e,t){var n;if(oi(e))if(null==e.id)n="Feature has no id";else if("string"!=typeof e.id&&"number"!=typeof e.id)n="Feature must be string or number as per GeoJSON spec";else if(t(e.id))if(oi(e.geometry))if(oi(e.properties))if("string"==typeof e.geometry.type&&["Polygon","LineString","Point"].includes(e.geometry.type))if(Array.isArray(e.geometry.coordinates)){if(!e.properties.mode||"string"!=typeof e.properties.mode)return{valid:!1,reason:"Feature does not have a valid mode property"}}else n="Feature coordinates is not an array";else n="Feature is not Point, LineString or Polygon";else n="Feature has no properties";else n="Feature has no geometry";else n="Feature must match the id strategy (default is UUID4)";else n="Feature is not object";return n?{valid:!1,reason:n}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){var n=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Provisional});return{valid:t.valid&&n.valid,reason:n.reason}}return{valid:t.valid,reason:t.reason}}},{key:"validateModeFeature",value:function(e,t){var n=this.performFeatureValidation(e);return n.valid?e.properties.mode!==this.mode?{valid:!1,reason:"Feature mode property does not match the mode being added to"}:t(e):{valid:!1,reason:n.reason}}},{key:"onFinish",value:function(e,t){}},{key:"onDeselect",value:function(e){}},{key:"onSelect",value:function(e){}},{key:"onKeyDown",value:function(e){}},{key:"onKeyUp",value:function(e){}},{key:"onMouseMove",value:function(e){}},{key:"onClick",value:function(e){}},{key:"onDragStart",value:function(e,t){}},{key:"onDrag",value:function(e,t){}},{key:"onDragEnd",value:function(e,t){}},{key:"getHexColorStylingValue",value:function(e,t,n){return this.getStylingValue(e,t,n)}},{key:"getNumericStylingValue",value:function(e,t,n){return this.getStylingValue(e,t,n)}},{key:"getStylingValue",value:function(e,t,n){return void 0===e?t:"function"==typeof e?e(n):e}}])}(),si=function(e){function t(){var e;l(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=o(this,t,[].concat(i))).type=ri.Select,e}return a(t,e),u(t)}(ai);function li(e,t){var n=function(e){return e*Math.PI/180},o=n(e[1]),i=n(e[0]),r=n(t[1]),a=r-o,s=n(t[0])-i,l=Math.sin(a/2)*Math.sin(a/2)+Math.cos(o)*Math.cos(r)*Math.sin(s/2)*Math.sin(s/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}var ci=6371008.8;function ui(e){return e%360*Math.PI/180}function di(e){return e/6371.0088}function hi(e){return e%(2*Math.PI)*180/Math.PI}function pi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,n=Math.pow(10,t);return Math.round(e*n)/n}var fi=57.29577951308232,gi=.017453292519943295,vi=6378137,yi=function(e,t){return{x:0===e?0:e*gi*vi,y:0===t?0:Math.log(Math.tan(Math.PI/4+t*gi/2))*vi}},mi=function(e,t){return{lng:0===e?0:fi*(e/vi),lat:0===t?0:(2*Math.atan(Math.exp(t/vi))-Math.PI/2)*fi}};function bi(e,t,n){var o=ui(e[0]),i=ui(e[1]),r=ui(n),a=di(t),s=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(r));return[hi(o+Math.atan2(Math.sin(r)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(s))),hi(s)]}function xi(e){for(var t=e.center,n=e.radiusKilometers,o=e.coordinatePrecision,i=e.steps?e.steps:64,r=[],a=0;a<i;a++){var s=bi(t,n,-360*a/i);r.push([pi(s[0],o),pi(s[1],o)])}return r.push(r[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}}}function Ci(e){var t;if("Polygon"===e.geometry.type)t=e.geometry.coordinates;else{if("LineString"!==e.geometry.type)throw new Error("Self intersects only accepts Polygons and LineStrings");t=[e.geometry.coordinates]}for(var n=[],o=0;o<t.length;o++)for(var i=0;i<t[o].length-1;i++)for(var r=0;r<t.length;r++)for(var a=0;a<t[r].length-1;a++)l(o,i,r,a);return n.length>0;function s(e){return e<0||e>1}function l(e,o,i,r){var a,l,c=t[e][o],u=t[e][o+1],d=t[i][r],h=t[i][r+1],p=function(e,t,n,o){if(wi(e,n)||wi(e,o)||wi(t,n)||wi(o,n))return null;var i=e[0],r=e[1],a=t[0],s=t[1],l=n[0],c=n[1],u=o[0],d=o[1],h=(i-a)*(c-d)-(r-s)*(l-u);return 0===h?null:[((i*s-r*a)*(l-u)-(i-a)*(l*d-c*u))/h,((i*s-r*a)*(c-d)-(r-s)*(l*d-c*u))/h]}(c,u,d,h);null!==p&&(a=u[0]!==c[0]?(p[0]-c[0])/(u[0]-c[0]):(p[1]-c[1])/(u[1]-c[1]),l=h[0]!==d[0]?(p[0]-d[0])/(h[0]-d[0]):(p[1]-d[1])/(h[1]-d[1]),s(a)||s(l)||(p.toString(),n.push(p)))}}function wi(e,t){return e[0]===t[0]&&e[1]===t[1]}function ki(e,t){return 2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&1/0!==e[0]&&1/0!==e[1]&&(o=e[0])>=-180&&o<=180&&(n=e[1])>=-90&&n<=90&&Pi(e[0])<=t&&Pi(e[1])<=t;var n,o}function Pi(e){for(var t=1,n=0;Math.round(e*t)/t!==e;)t*=10,n++;return n}function Si(e,t){return"Polygon"!==e.geometry.type?{valid:!1,reason:"Feature is not a Polygon"}:1!==e.geometry.coordinates.length?{valid:!1,reason:"Feature has holes"}:e.geometry.coordinates[0].length<4?{valid:!1,reason:"Feature has less than 4 coordinates"}:e.geometry.coordinates[0].every((function(e){return ki(e,t)}))?(n=e.geometry.coordinates[0][0])[0]!==(o=e.geometry.coordinates[0][e.geometry.coordinates[0].length-1])[0]||n[1]!==o[1]?{valid:!1,reason:"Feature coordinates are not closed"}:{valid:!0}:{valid:!1,reason:"Feature has invalid coordinates"};var n,o}function Mi(e,t){var n=Si(e,t);return n.valid?Ci(e)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:n}var Ii={cancel:"Escape",finish:"Enter"},Oi={start:"crosshair"},Fi=function(e){function n(e){var t;return l(this,n),(t=o(this,n,[e,!0])).mode="circle",t.center=void 0,t.clickCount=0,t.currentCircleId=void 0,t.keyEvents=Ii,t.cursors=Oi,t.startingRadiusKilometers=1e-5,t.cursorMovedAfterInitialCursorDown=!1,t.updateOptions(e),t}return a(n,e),u(n,[{key:"updateOptions",value:function(e){t(n,"updateOptions",this,3)([e]),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents)),null!=e&&e.startingRadiusKilometers&&(this.startingRadiusKilometers=e.startingRadiusKilometers)}},{key:"close",value:function(){if(void 0!==this.currentCircleId){var e=this.currentCircleId;if(this.validate&&e){var t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.start)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onClick",value:function(e){if(0===this.clickCount){this.center=[e.lng,e.lat];var t=xi({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),n=g(this.store.create([{geometry:t.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers}}]),1)[0];this.currentCircleId=n,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else 1===this.clickCount&&this.center&&void 0!==this.currentCircleId&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(e),this.close()}},{key:"onMouseMove",value:function(e){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(e)}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}},{key:"onDragStart",value:function(){}},{key:"onDrag",value:function(){}},{key:"onDragEnd",value:function(){}},{key:"cleanUp",value:function(){var e=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e])}catch(e){}}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===e.type&&"Polygon"===e.geometry.type&&e.properties.mode===this.mode?(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t):t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return Mi(e,t.coordinatePrecision)}))}},{key:"updateCircle",value:function(e){if(1===this.clickCount&&this.center&&this.currentCircleId){var t,n=li(this.center,[e.lng,e.lat]);if("web-mercator"===this.projection){var o=function(e,t){var n=1e3*li(e,t);if(0===n)return 1;var o=yi(e[0],e[1]),i=o.x,r=o.y,a=yi(t[0],t[1]),s=a.x,l=a.y;return Math.sqrt(Math.pow(s-i,2)+Math.pow(l-r,2))/n}(this.center,[e.lng,e.lat]);t=function(e){for(var t=e.coordinatePrecision,n=e.steps?e.steps:64,o=1e3*e.radiusKilometers,i=g(e.center,2),r=i[0],a=i[1],s=yi(r,a),l=s.x,c=s.y,u=[],d=0;d<n;d++){var h=360*d/n*Math.PI/180,p=o*Math.cos(h),f=o*Math.sin(h),v=mi(l+p,c+f),y=v.lng,m=v.lat;u.push([pi(y,t),pi(m,t)])}return u.push(u[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[u]},properties:{}}}({center:this.center,radiusKilometers:n*o,coordinatePrecision:this.coordinatePrecision})}else{if("globe"!==this.projection)throw new Error("Invalid projection");t=xi({center:this.center,radiusKilometers:n,coordinatePrecision:this.coordinatePrecision})}if(this.validate&&!this.validate({type:"Feature",id:this.currentCircleId,geometry:t.geometry,properties:{radiusKilometers:n}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Provisional}).valid)return;this.store.updateGeometry([{id:this.currentCircleId,geometry:t.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:n}])}}}])}(ai),_i=function(e,t){var n=e.x,o=e.y,i=t.x-n,r=t.y-o;return Math.sqrt(r*r+i*i)};function Di(e){var t=function(e){for(var t=e.coordinates[0],n=0,o=0;o<t.length-1;o++){var i=g(t[o],2),r=i[0],a=i[1],s=g(t[o+1],2);n+=(s[0]-r)*(s[1]+a)}return n<0}(e);if(!t)return{type:"Polygon",coordinates:[e.coordinates[0].reverse()]}}var Bi={cancel:"Escape",finish:"Enter"},Ei={start:"crosshair",close:"pointer"},ji=function(n){function i(e){var t;return l(this,i),(t=o(this,i,[e,!0])).mode="freehand",t.startingClick=!1,t.currentId=void 0,t.closingPointId=void 0,t.minDistance=20,t.keyEvents=Bi,t.cursors=Ei,t.preventPointsNearClose=!0,t.autoClose=!1,t.autoCloseTimeout=500,t.hasLeftStartingPoint=!1,t.preventNewFeature=!1,t.updateOptions(e),t}return a(i,n),u(i,[{key:"updateOptions",value:function(e){t(i,"updateOptions",this,3)([e]),null!=e&&e.minDistance&&(this.minDistance=e.minDistance),void 0!==(null==e?void 0:e.preventPointsNearClose)&&(this.preventPointsNearClose=e.preventPointsNearClose),void 0!==(null==e?void 0:e.autoClose)&&(this.autoClose=e.autoClose),null!=e&&e.autoCloseTimeout&&(this.autoCloseTimeout=e.autoCloseTimeout),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents)),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors))}},{key:"close",value:function(){if(void 0!==this.currentId){if(this.currentId){var e=Di(this.store.getGeometryCopy(this.currentId));e&&this.store.updateGeometry([{id:this.currentId,geometry:e}])}var t=this.currentId;if(this.validate&&t){var n=this.store.getGeometryCopy(t);if(!this.validate({type:"Feature",id:t,geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Finish}).valid)return}this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.hasLeftStartingPoint=!1,"drawing"===this.state&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.start)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onMouseMove",value:function(t){var n=this;if(void 0!==this.currentId&&!1!==this.startingClick){var o=this.store.getGeometryCopy(this.currentId),i=o.coordinates[0].length-2,r=g(o.coordinates[0][i],2),a=r[0],s=r[1],l=this.project(a,s),c=l.x,u=l.y,d=_i({x:c,y:u},{x:t.containerX,y:t.containerY}),h=g(o.coordinates[0][0],2),p=h[0],f=h[1],v=this.project(p,f),y=v.x,m=v.y;if(_i({x:y,y:m},{x:t.containerX,y:t.containerY})<this.pointerDistance){if(this.autoClose&&this.hasLeftStartingPoint&&(this.preventNewFeature=!0,setTimeout((function(){n.preventNewFeature=!1}),this.autoCloseTimeout),this.close()),this.setCursor(this.cursors.close),this.preventPointsNearClose)return}else this.hasLeftStartingPoint=!0,this.setCursor(this.cursors.start);if(!(d<this.minDistance)){o.coordinates[0].pop();var b={type:"Polygon",coordinates:[[].concat(e(o.coordinates[0]),[[t.lng,t.lat],o.coordinates[0][0]])]};this.validate&&!this.validate({type:"Feature",id:this.currentId,geometry:b,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Provisional}).valid||this.store.updateGeometry([{id:this.currentId,geometry:b}])}}}},{key:"onClick",value:function(e){if(!this.preventNewFeature){if(!1===this.startingClick){var t=g(this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode}},{geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:x({mode:this.mode},ti,!0)}]),2),n=t[0],o=t[1];return this.currentId=n,this.closingPointId=o,this.startingClick=!0,void this.setDrawing()}this.close()}}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&!0===this.startingClick&&this.close()}},{key:"onDragStart",value:function(){}},{key:"onDrag",value:function(){}},{key:"onDragEnd",value:function(){}},{key:"cleanUp",value:function(){var e=this.currentId,t=this.closingPointId;this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e]),void 0!==t&&this.store.delete([t])}catch(e){}}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===e.type&&"Polygon"===e.geometry.type&&e.properties.mode===this.mode?(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t):"Feature"===e.type&&"Point"===e.geometry.type&&e.properties.mode===this.mode?(t.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,e),t.zIndex=40,t):t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return Si(e,t.coordinatePrecision)}))}}])}(ai),Ri=u((function e(t){var n=t.store,o=t.mode,i=t.project,r=t.unproject,a=t.pointerDistance,s=t.coordinatePrecision,c=t.projection;l(this,e),this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=n,this.mode=o,this.project=i,this.unproject=r,this.pointerDistance=a,this.coordinatePrecision=s,this.projection=c}));function Li(e){var t=e.unproject,n=e.point,o=e.pointerDistance/2,i=n.x,r=n.y;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[t(i-o,r-o),t(i+o,r-o),t(i+o,r+o),t(i-o,r+o),t(i-o,r-o)].map((function(e){return[e.lng,e.lat]}))]}}}var zi=function(e){function t(e){return l(this,t),o(this,t,[e])}return a(t,e),u(t,[{key:"create",value:function(e){var t=e.containerX,n=e.containerY;return Li({unproject:this.unproject,point:{x:t,y:n},pointerDistance:this.pointerDistance})}}])}(Ri),Ti=function(e){function t(e){return l(this,t),o(this,t,[e])}return a(t,e),u(t,[{key:"measure",value:function(e,t){var n=this.project(t[0],t[1]),o=n.x,i=n.y;return _i({x:o,y:i},{x:e.containerX,y:e.containerY})}}])}(Ri),Ni=function(e){function t(e,n,i){var r;return l(this,t),(r=o(this,t,[e])).config=void 0,r.pixelDistance=void 0,r.clickBoundingBox=void 0,r.getSnappableCoordinateFirstClick=function(e){return r.getSnappable(e,(function(e){return Boolean(e.properties&&e.properties.mode===r.mode)})).coordinate},r.getSnappableCoordinate=function(e,t){return r.getSnappable(e,(function(e){return Boolean(e.properties&&e.properties.mode===r.mode&&e.id!==t)})).coordinate},r.config=e,r.pixelDistance=n,r.clickBoundingBox=i,r}return a(t,e),u(t,[{key:"getSnappable",value:function(e,t){var n=this,o=this.clickBoundingBox.create(e),i=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return i.forEach((function(t){var o;if("Polygon"===t.geometry.type)o=t.geometry.coordinates[0];else{if("LineString"!==t.geometry.type)return;o=t.geometry.coordinates}o.forEach((function(o,i){var a=n.pixelDistance.measure(e,o);a<r.minDist&&a<n.pointerDistance&&(r.coordinate=o,r.minDist=a,r.featureId=t.id,r.featureCoordinateIndex=i)}))})),r}}])}(Ri);function Wi(e,t,n){var o=ui(e[0]),i=ui(e[1]),r=ui(n),a=di(t),s=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(r));return[hi(o+Math.atan2(Math.sin(r)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(s))),hi(s)]}function Ai(e,t){var n=ui(e[0]),o=ui(t[0]),i=ui(e[1]),r=ui(t[1]),a=Math.sin(o-n)*Math.cos(r),s=Math.cos(i)*Math.sin(r)-Math.sin(i)*Math.cos(r)*Math.cos(o-n);return hi(Math.atan2(a,s))}function Ui(e,t,n){for(var o,i,r,a=[],s=e.length,l=0,c=0;c<e.length&&!(t>=l&&c===e.length-1);c++){if(l>t&&0===a.length){if(!(o=t-l))return a.push(e[c]),a;i=Ai(e[c],e[c-1])-180,r=Wi(e[c],o,i),a.push(r)}if(l>=n)return(o=n-l)?(i=Ai(e[c],e[c-1])-180,r=Wi(e[c],o,i),a.push(r),a):(a.push(e[c]),a);if(l>=t&&a.push(e[c]),c===e.length-1)return a;l+=li(e[c],e[c+1])}if(l<t&&e.length===s)throw new Error("Start position is beyond line");var u=e[e.length-1];return[u,u]}function Gi(e){return e*(Math.PI/180)}function Vi(e){return e*(180/Math.PI)}var Hi=function(e){function t(e){var n;return l(this,t),(n=o(this,t,[e])).config=void 0,n.config=e,n}return a(t,e),u(t,[{key:"generateInsertionCoordinates",value:function(e,t,n){for(var o=[e,t],i=0,r=0;r<o.length-1;r++)i+=li(o[0],o[1]);if(i<=n)return o;var a=i/n-1;Number.isInteger(a)||(a=Math.floor(a)+1);for(var s=[],l=0;l<a;l++){var c=Ui(o,n*l,n*(l+1));s.push(c)}for(var u=[],d=0;d<s.length;d++)u.push(s[d][1]);return this.limitCoordinates(u)}},{key:"generateInsertionGeodesicCoordinates",value:function(e,t,n){var o=li(e,t),i=function(e,t,n){var o=[],i=Gi(e[1]),r=Gi(e[0]),a=Gi(t[1]),s=Gi(t[0]);n+=1;var l=2*Math.asin(Math.sqrt(Math.pow(Math.sin((a-i)/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin((s-r)/2),2)));if(0===l||isNaN(l))return o;for(var c=0;c<=n;c++){var u=c/n,d=Math.sin((1-u)*l)/Math.sin(l),h=Math.sin(u*l)/Math.sin(l),p=d*Math.cos(i)*Math.cos(r)+h*Math.cos(a)*Math.cos(s),f=d*Math.cos(i)*Math.sin(r)+h*Math.cos(a)*Math.sin(s),g=d*Math.sin(i)+h*Math.sin(a);if(!(isNaN(p)||isNaN(f)||isNaN(g))){var v=Math.atan2(g,Math.sqrt(Math.pow(p,2)+Math.pow(f,2))),y=Math.atan2(f,p);isNaN(v)||isNaN(y)||o.push([Vi(y),Vi(v)])}}return o.slice(1,-1)}(e,t,Math.floor(o/n));return this.limitCoordinates(i)}},{key:"limitCoordinates",value:function(e){var t=this;return e.map((function(e){return[pi(e[0],t.config.coordinatePrecision),pi(e[1],t.config.coordinatePrecision)]}))}}])}(Ri);function Xi(e,t){return e[0]===t[0]&&e[1]===t[1]}function Yi(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2)+Math.pow(e[2],2))}function qi(e,t){var n=function(e,t){var n=g(e,3),o=n[0],i=n[1],r=n[2],a=g(t,3);return o*a[0]+i*a[1]+r*a[2]}(e,t)/(Yi(e)*Yi(t));return Math.acos(Math.min(Math.max(n,-1),1))}function Ki(e){var t=ui(e[1]),n=ui(e[0]);return[Math.cos(t)*Math.cos(n),Math.cos(t)*Math.sin(n),Math.sin(t)]}function Zi(e){var t=g(e,3),n=t[0],o=t[1],i=t[2],r=hi(Math.asin(i));return[hi(Math.atan2(o,n)),r]}function $i(e,t,n){var o,i=Ki(e),r=Ki(t),a=g(Ki(n),3),s=a[0],l=a[1],c=a[2],u=function(e,t){var n=g(e,3),o=n[0],i=n[1],r=n[2],a=g(t,3),s=a[0],l=a[1],c=a[2];return[i*c-r*l,r*s-o*c,o*l-i*s]}(i,r),d=g(u,3),h=d[0],p=d[1],f=d[2],v=p*c-f*l,y=f*s-h*c,m=h*l-p*s,b=m*p-y*f,x=v*f-m*h,C=y*h-v*p,w=1/Math.sqrt(Math.pow(b,2)+Math.pow(x,2)+Math.pow(C,2)),k=[b*w,x*w,C*w],P=[-1*b*w,-1*x*w,-1*C*w],S=qi(i,r),M=qi(i,k),I=qi(r,k),O=qi(i,P),F=qi(r,P);return qi(i,o=M<O&&M<F||I<O&&I<F?k:P)>S||qi(r,o)>S?li(Zi(o),Zi(i))<=li(Zi(o),Zi(r))?[Zi(i),!0,!1]:[Zi(r),!1,!0]:[Zi(o),!1,!1]}function Ji(e,t,n){var o=t.x-e.x,i=t.y-e.y,r=Math.max(0,Math.min(1,((n.x-e.x)*o+(n.y-e.y)*i)/(o*o+i*i)));return{x:e.x+r*o,y:e.y+r*i}}var Qi=function(e){function t(e,n,i){var r;return l(this,t),(r=o(this,t,[e])).config=void 0,r.pixelDistance=void 0,r.clickBoundingBox=void 0,r.getSnappableCoordinateFirstClick=function(e){return r.getSnappable(e,(function(e){return Boolean(e.properties&&e.properties.mode===r.mode)})).coordinate},r.getSnappableCoordinate=function(e,t){return r.getSnappable(e,(function(e){return Boolean(e.properties&&e.properties.mode===r.mode&&e.id!==t)})).coordinate},r.config=e,r.pixelDistance=n,r.clickBoundingBox=i,r}return a(t,e),u(t,[{key:"getSnappable",value:function(e,t){var n=this,o=this.clickBoundingBox.create(e),i=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return i.forEach((function(t){var o;if("Polygon"===t.geometry.type)o=t.geometry.coordinates[0];else{if("LineString"!==t.geometry.type)return;o=t.geometry.coordinates}for(var i,a=[],s=0;s<o.length-1;s++)a.push([o[s],o[s+1]]);var l=[e.lng,e.lat];if("web-mercator"===n.config.projection?i=function(e,t){var n,o=[1/0,1/0],i=1/0,r=0,a=v(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,l=s[0],c=s[1],u=void 0,d=1/0,h=yi(l[0],l[1]),p=yi(c[0],c[1]),f=yi(e[0],e[1]);if(l[0]===e[0]&&l[1]===e[1])u=l;else if(c[0]===e[0]&&c[1]===e[1])u=c;else{var g=Ji(h,p,f),y=g.x,m=g.y,b=mi(y,m);u=[b.lng,b.lat]}u&&((d=_i(f,yi(u[0],u[1])))<i&&(o=u,i=d,r=t.indexOf(s)))}}catch(x){a.e(x)}finally{a.f()}return 1/0===i?void 0:{coordinate:o,lineIndex:r,distance:i}}(l,a):"globe"===n.config.projection&&(i=function(e,t){var n,o=[1/0,1/0],i=1/0,r=0,a=v(t);try{for(a.s();!(n=a.n()).done;){var s=n.value,l=s[0],c=s[1],u=void 0,d=1/0;l[0]===e[0]&&l[1]===e[1]?u=l:c[0]===e[0]&&c[1]===e[1]?u=c:u=g($i(l,c,e),1)[0],u&&((d=li(e,u))<i&&(o=u,i=d,r=t.indexOf(s)))}}catch(h){a.e(h)}finally{a.f()}return 1/0===i?void 0:{coordinate:o,distance:i,lineIndex:r}}(l,a)),i){var c=n.pixelDistance.measure(e,i.coordinate);c<r.minDistance&&c<n.pointerDistance&&(r.featureId=t.id,r.coordinate=i.coordinate,r.featureCoordinateIndex=i.lineIndex,r.minDistance=c)}})),r}}])}(Ri),er={cancel:"Escape",finish:"Enter"},tr={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"},nr=function(n){function i(e){var t;return l(this,i),(t=o(this,i,[e,!0])).mode="linestring",t.currentCoordinate=0,t.currentId=void 0,t.closingPointId=void 0,t.keyEvents=er,t.snapping=void 0,t.cursors=tr,t.mouseMove=!1,t.insertCoordinates=void 0,t.lastCommitedCoordinates=void 0,t.snappedPointId=void 0,t.editable=!1,t.editedFeatureId=void 0,t.editedFeatureCoordinateIndex=void 0,t.editedSnapType=void 0,t.editedInsertIndex=void 0,t.editedPointId=void 0,t.coordinateSnapping=void 0,t.insertPoint=void 0,t.lineSnapping=void 0,t.pixelDistance=void 0,t.clickBoundingBox=void 0,t.updateOptions(e),t}return a(i,n),u(i,[{key:"updateOptions",value:function(e){t(i,"updateOptions",this,3)([e]),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors)),null!=e&&e.snapping&&(this.snapping=e.snapping),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents)),null!=e&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}},{key:"close",value:function(){if(void 0!==this.currentId){var t=this.store.getGeometryCopy(this.currentId);t.coordinates.pop(),this.updateGeometries(e(t.coordinates),void 0,qo.Commit);var n=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommitedCoordinates=void 0,"drawing"===this.state&&this.setStarted(),this.onFinish(n,{mode:this.mode,action:"draw"})}}},{key:"updateGeometries",value:function(e,t,n){if(this.currentId){var o={type:"LineString",coordinates:e};if(!this.validate||this.validate({type:"Feature",geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:n}).valid){var i=[{id:this.currentId,geometry:o}];this.closingPointId&&t&&i.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),"commit"===n&&(this.lastCommitedCoordinates=o.coordinates),this.store.updateGeometry(i)}}}},{key:"generateInsertCoordinates",value:function(e,t){if(!this.insertCoordinates||!this.lastCommitedCoordinates)throw new Error("Not able to insert coordinates");if("amount"!==this.insertCoordinates.strategy)throw new Error("Strategy does not exist");var n=li(e,t)/(this.insertCoordinates.value+1),o=[];return"globe"===this.projection?o=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,n):"web-mercator"===this.projection&&(o=this.insertPoint.generateInsertionCoordinates(e,t,n)),o}},{key:"createLine",value:function(e){var t=g(this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode}}]),1)[0];this.lastCommitedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}},{key:"firstUpdateToLine",value:function(t){if(this.currentId){var n=this.store.getGeometryCopy(this.currentId).coordinates,o=g(this.store.create([{geometry:{type:"Point",coordinates:e(t)},properties:{mode:this.mode}}]),1)[0];this.closingPointId=o,this.setCursor(this.cursors.close);var i=[].concat(e(n),[t]);this.updateGeometries(i,void 0,qo.Commit),this.currentCoordinate++}}},{key:"updateToLine",value:function(t,n){if(this.currentId){var o=this.store.getGeometryCopy(this.currentId).coordinates,i=g(this.lastCommitedCoordinates?this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1]:o[o.length-2],2),r=i[0],a=i[1],s=this.project(r,a),l=s.x,c=s.y;if(_i({x:l,y:c},{x:n.x,y:n.y})<this.pointerDistance)this.close();else{this.setCursor(this.cursors.close);var u=[].concat(e(o),[t]);this.updateGeometries(u,o[o.length-1],qo.Commit),this.currentCoordinate++}}}},{key:"registerBehaviors",value:function(e){this.coordinateSnapping=new Ni(e,new Ti(e),new zi(e)),this.insertPoint=new Hi(e),this.clickBoundingBox=new zi(e),this.pixelDistance=new Ti(e),this.lineSnapping=new Qi(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new Ni(e,this.pixelDistance,this.clickBoundingBox)}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.start)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onMouseMove",value:function(t){this.mouseMove=!0,this.setCursor(this.cursors.start);var n=this.snapCoordinate(t);if(n){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:n}}]);else{var o=g(this.store.create([{geometry:{type:"Point",coordinates:n},properties:x({mode:this.mode},ni,!0)}]),1)[0];this.snappedPointId=o}t.lng=n[0],t.lat=n[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);var i=n||[t.lng,t.lat];if(void 0!==this.currentId&&0!==this.currentCoordinate){var r=this.store.getGeometryCopy(this.currentId).coordinates;if(r.pop(),this.closingPointId){var a=g(r[r.length-1],2),s=a[0],l=a[1],c=this.project(s,l),u=c.x,d=c.y;_i({x:u,y:d},{x:t.containerX,y:t.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}var h=[].concat(e(r),[i]);if(this.insertCoordinates&&this.currentId&&this.lastCommitedCoordinates){var p=this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1],f=i;if(!Xi(p,f)){var v=this.generateInsertCoordinates(p,f);h=[].concat(e(this.lastCommitedCoordinates.slice(0,-1)),e(v),[i])}}this.updateGeometries(h,void 0,qo.Provisional)}}},{key:"onRightClick",value:function(e){if(this.editable&&"started"===this.state){var t=this.coordinateSnapping.getSnappable(e,(function(e){return"LineString"===e.geometry.type})),n=t.featureId,o=t.featureCoordinateIndex;if(n&&void 0!==o){var i,r=this.store.getGeometryCopy(n);if("LineString"===r.type&&!((i=r.coordinates).length<=2)){if(i.splice(o,1),this.validate&&!this.validate({id:n,type:"Feature",geometry:r,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:n,geometry:r}])}}}}},{key:"onLeftClick",value:function(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);var t=this.snapCoordinate(e)||[e.lng,e.lat];0===this.currentCoordinate?this.createLine(t):1===this.currentCoordinate&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}},{key:"onClick",value:function(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,"right"===e.button?this.onRightClick(e):"left"===e.button&&this.onLeftClick(e)}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}},{key:"onDragStart",value:function(e,t){if(this.editable){var n;if("started"===this.state){var o=this.lineSnapping.getSnappable(e);o.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,n=o.coordinate);var i=this.coordinateSnapping.getSnappable(e);i.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=i.featureCoordinateIndex,this.editedFeatureId=i.featureId,n=i.coordinate)}if(this.editedFeatureId&&n){if(!this.editedPointId){var r=g(this.store.create([{geometry:{type:"Point",coordinates:n},properties:x({mode:this.mode},ei,!0)}]),1)[0];this.editedPointId=r}this.setCursor(this.cursors.dragStart),t(!1)}}}},{key:"onDrag",value:function(e,t){if(void 0!==this.editedFeatureId&&void 0!==this.editedFeatureCoordinateIndex){var n=this.store.getGeometryCopy(this.editedFeatureId);"coordinate"===this.editedSnapType||"line"===this.editedSnapType&&void 0!==this.editedInsertIndex?n.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:"line"===this.editedSnapType&&void 0===this.editedInsertIndex&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,n.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);var o={type:"LineString",coordinates:n.coordinates};this.validate&&!this.validate({type:"Feature",geometry:o,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:o}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!0}]),t(!0))}}},{key:"onDragEnd",value:function(e,t){void 0!==this.editedFeatureId&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!1}]),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}},{key:"cleanUp",value:function(){var e=this.currentId,t=this.closingPointId,n=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e]),void 0!==n&&this.store.delete([n]),void 0!==t&&this.store.delete([t])}catch(e){}}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if("Feature"===e.type&&"LineString"===e.geometry.type&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if("Feature"===e.type&&"Point"===e.geometry.type&&e.properties.mode===this.mode){var n=e.properties[ti];return t.pointColor=this.getHexColorStylingValue(n?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(n?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(n?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(n?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=40,t}return t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return function(e,t){return"LineString"!==e.geometry.type?{valid:!1,reason:"Feature is not a LineString"}:e.geometry.coordinates.length<2?{valid:!1,reason:"Feature has less than 2 coordinates"}:e.geometry.coordinates.every((function(e){return ki(e,t)}))?{valid:!0}:{valid:!1,reason:"Feature has invalid coordinates"}}(e,t.coordinatePrecision)}))}},{key:"snapCoordinate",value:function(e){var t,n,o;return null!=(t=this.snapping)&&t.toCoordinate&&(o=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),null!=(n=this.snapping)&&n.toCustom&&(o=this.snapping.toCustom(e)),o}}])}(ai);var or={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"},ir=function(e){function n(e){var t;return l(this,n),(t=o(this,n,[e,!0])).mode="point",t.cursors=or,t.editable=!1,t.editedFeatureId=void 0,t.pixelDistance=void 0,t.clickBoundingBox=void 0,t.updateOptions(e),t}return a(n,e),u(n,[{key:"updateOptions",value:function(e){t(n,"updateOptions",this,3)([e]),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors)),null!=e&&e.editable&&(this.editable=e.editable)}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.create)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onClick",value:function(e){if(!this.store)throw new Error("Mode must be registered first");"right"===e.button?this.onRightClick(e):"left"===e.button&&this.onLeftClick(e)}},{key:"onMouseMove",value:function(){}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(){}},{key:"cleanUp",value:function(){this.editedFeatureId=void 0}},{key:"onDragStart",value:function(e,t){if(this.editable){var n=this.getNearestPointFeature(e);this.editedFeatureId=null==n?void 0:n.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}},{key:"onDrag",value:function(e,t){void 0!==this.editedFeatureId&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!0}]),t(!0)))}},{key:"onDragEnd",value:function(e,t){void 0!==this.editedFeatureId&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!1}]),this.editedFeatureId=void 0,t(!0))}},{key:"registerBehaviors",value:function(e){this.pixelDistance=new Ti(e),this.clickBoundingBox=new zi(e)}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if("Feature"===e.type&&"Point"===e.geometry.type&&e.properties.mode===this.mode){var n=Boolean(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(n?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(n?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(n?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(n?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return function(e,t){return"Point"!==e.geometry.type?{valid:!1,reason:"Feature is not a Point"}:ki(e.geometry.coordinates,t)?{valid:!0}:{valid:!1,reason:"Feature has invalid coordinates"}}(e,t.coordinatePrecision)}))}},{key:"onLeftClick",value:function(e){var t={type:"Point",coordinates:[e.lng,e.lat]},n={mode:this.mode};if(!this.validate||this.validate({type:"Feature",geometry:t,properties:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Finish}).valid){var o=g(this.store.create([{geometry:t,properties:n}]),1)[0];this.onFinish(o,{mode:this.mode,action:"draw"})}}},{key:"onRightClick",value:function(e){if(this.editable){var t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}}},{key:"getNearestPointFeature",value:function(e){for(var t,n=this.clickBoundingBox.create(e),o=this.store.search(n),i=1/0,r=0;r<o.length;r++){var a=o[r];if("Point"===a.geometry.type&&a.properties.mode===this.mode){var s=this.pixelDistance.measure(e,a.geometry.coordinates);s>i||s>this.pointerDistance||(i=s,t=a)}}return t}}])}(ai),rr=function(e){function t(e,n){var i;return l(this,t),(i=o(this,t,[e])).config=void 0,i.pixelDistance=void 0,i._startEndPoints=[],i.config=e,i.pixelDistance=n,i}return a(t,e),u(t,[{key:"ids",get:function(){return this._startEndPoints.concat()},set:function(e){}},{key:"create",value:function(e,t){if(this.ids.length)throw new Error("Opening and closing points already created");if(e.length<=3)throw new Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:e[0]},properties:x({mode:t},ti,!0)},{geometry:{type:"Point",coordinates:e[e.length-2]},properties:x({mode:t},ti,!0)}])}},{key:"delete",value:function(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}},{key:"update",value:function(e){if(2!==this.ids.length)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:e[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:e[e.length-3]}}])}},{key:"isClosingPoint",value:function(e){var t=this.store.getGeometryCopy(this.ids[0]),n=this.store.getGeometryCopy(this.ids[1]),o=this.pixelDistance.measure(e,t.coordinates),i=this.pixelDistance.measure(e,n.coordinates);return{isClosing:o<this.pointerDistance,isPreviousClosing:i<this.pointerDistance}}}])}(Ri),ar={cancel:"Escape",finish:"Enter"},sr={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"},lr=function(n){function i(e){var t;return l(this,i),(t=o(this,i,[e,!0])).mode="polygon",t.currentCoordinate=0,t.currentId=void 0,t.keyEvents=ar,t.cursors=sr,t.mouseMove=!1,t.snapping=void 0,t.snappedPointId=void 0,t.editable=!1,t.editedFeatureId=void 0,t.editedFeatureCoordinateIndex=void 0,t.editedSnapType=void 0,t.editedInsertIndex=void 0,t.editedPointId=void 0,t.lineSnapping=void 0,t.coordinateSnapping=void 0,t.pixelDistance=void 0,t.closingPoints=void 0,t.clickBoundingBox=void 0,t.updateOptions(e),t}return a(i,n),u(i,[{key:"updateOptions",value:function(e){t(i,"updateOptions",this,3)([e]),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents)),null!=e&&e.snapping&&(this.snapping=e.snapping),null!=e&&e.editable&&(this.editable=e.editable)}},{key:"close",value:function(){if(void 0!==this.currentId){var t=this.store.getGeometryCopy(this.currentId).coordinates[0];if(!(t.length<5)&&this.updatePolygonGeometry([].concat(e(t.slice(0,-2)),[t[0]]),qo.Finish)){var n=this.currentId;if(this.currentId){var o=Di(this.store.getGeometryCopy(this.currentId));o&&this.store.updateGeometry([{id:this.currentId,geometry:o}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),"drawing"===this.state&&this.setStarted(),this.onFinish(n,{mode:this.mode,action:"draw"})}}}},{key:"registerBehaviors",value:function(e){this.clickBoundingBox=new zi(e),this.pixelDistance=new Ti(e),this.lineSnapping=new Qi(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new Ni(e,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new rr(e,this.pixelDistance)}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.start)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onMouseMove",value:function(t){this.mouseMove=!0,this.setCursor(this.cursors.start);var n=this.snapCoordinate(t);if(n){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:n}}]);else{var o=g(this.store.create([{geometry:{type:"Point",coordinates:n},properties:x({mode:this.mode},ni,!0)}]),1)[0];this.snappedPointId=o}t.lng=n[0],t.lat=n[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);if(void 0!==this.currentId&&0!==this.currentCoordinate){var i,r=this.store.getGeometryCopy(this.currentId).coordinates[0];if(1===this.currentCoordinate){var a=1/Math.pow(10,this.coordinatePrecision-1),s=Math.max(1e-6,a);i=[r[0],[t.lng,t.lat],[t.lng,t.lat-s],r[0]]}else if(2===this.currentCoordinate)i=[r[0],r[1],[t.lng,t.lat],r[0]];else{var l=this.closingPoints.isClosingPoint(t),c=l.isClosing;l.isPreviousClosing||c?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),i=[].concat(e(r.slice(0,-2)),[r[0],r[0]])):i=[].concat(e(r.slice(0,-2)),[[t.lng,t.lat],r[0]])}this.updatePolygonGeometry(i,qo.Provisional)}}},{key:"updatePolygonGeometry",value:function(e,t){if(!this.currentId)return!1;var n={type:"Polygon",coordinates:[e]};return!(this.validate&&!this.validate({type:"Feature",geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:n}]),0))}},{key:"snapCoordinate",value:function(e){var t,n,o,i,r,a;null!=(t=this.snapping)&&t.toLine&&((r=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e))&&(i=r));null!=(n=this.snapping)&&n.toCoordinate&&((a=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e))&&(i=a));return null!=(o=this.snapping)&&o.toCustom&&(i=this.snapping.toCustom(e)),i}},{key:"onRightClick",value:function(e){if(this.editable){var t=this.coordinateSnapping.getSnappable(e,(function(e){return"Polygon"===e.geometry.type})),n=t.featureId,o=t.featureCoordinateIndex;if(n&&void 0!==o){var i,r=this.store.getGeometryCopy(n);"Polygon"===r.type&&((i=r.coordinates[0]).length<=4||("Polygon"!==r.type||0!==o&&o!==i.length-1?i.splice(o,1):(i.shift(),i.pop(),i.push([i[0][0],i[0][1]])),(!this.validate||this.validate({id:n,type:"Feature",geometry:r,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:n,geometry:r}]))))}}}},{key:"onLeftClick",value:function(t){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),0===this.currentCoordinate){var n=this.snapCoordinate(t);n&&(t.lng=n[0],t.lat=n[1]);var o=g(this.store.create([{geometry:{type:"Polygon",coordinates:[[[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat],[t.lng,t.lat]]]},properties:{mode:this.mode}}]),1)[0];this.currentId=o,this.currentCoordinate++,this.setDrawing()}else if(1===this.currentCoordinate&&this.currentId){var i=this.snapCoordinate(t);i&&(t.lng=i[0],t.lat=i[1]);var r=this.store.getGeometryCopy(this.currentId);if(Xi([t.lng,t.lat],r.coordinates[0][0]))return;if(!this.updatePolygonGeometry([r.coordinates[0][0],[t.lng,t.lat],[t.lng,t.lat],r.coordinates[0][0]],qo.Commit))return;this.currentCoordinate++}else if(2===this.currentCoordinate&&this.currentId){var a=this.snapCoordinate(t);a&&(t.lng=a[0],t.lat=a[1]);var s=this.store.getGeometryCopy(this.currentId).coordinates[0];if(Xi([t.lng,t.lat],s[1]))return;if(!this.updatePolygonGeometry([s[0],s[1],[t.lng,t.lat],[t.lng,t.lat],s[0]],qo.Commit))return;2===this.currentCoordinate&&this.closingPoints.create(s,"polygon"),this.currentCoordinate++}else if(this.currentId){var l=this.store.getGeometryCopy(this.currentId).coordinates[0],c=this.closingPoints.isClosingPoint(t),u=c.isClosing;if(c.isPreviousClosing||u)this.close();else{var d=this.snapCoordinate(t);if(d&&(t.lng=d[0],t.lat=d[1]),Xi([t.lng,t.lat],l[this.currentCoordinate-1]))return;var h=function(){return{type:"Feature",geometry:{type:"Polygon",coordinates:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[[[0,0],[0,1],[1,1],[1,0],[0,0]]]},properties:{}}}([[].concat(e(l.slice(0,-1)),[[t.lng,t.lat],l[0]])]);if(!this.updatePolygonGeometry(h.geometry.coordinates[0],qo.Commit))return;this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(h.geometry.coordinates[0])}}}},{key:"onClick",value:function(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,"right"!==e.button?"left"!==e.button||this.onLeftClick(e):this.onRightClick(e)}},{key:"onKeyUp",value:function(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}},{key:"onKeyDown",value:function(){}},{key:"onDragStart",value:function(e,t){if(this.editable){var n;if("started"===this.state){var o=this.lineSnapping.getSnappable(e);o.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=o.featureCoordinateIndex,this.editedFeatureId=o.featureId,n=o.coordinate);var i=this.coordinateSnapping.getSnappable(e);i.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=i.featureCoordinateIndex,this.editedFeatureId=i.featureId,n=i.coordinate)}if(this.editedFeatureId&&n){if(!this.editedPointId){var r=g(this.store.create([{geometry:{type:"Point",coordinates:n},properties:x({mode:this.mode},ei,!0)}]),1)[0];this.editedPointId=r}this.setCursor(this.cursors.dragStart),t(!1)}}}},{key:"onDrag",value:function(e,t){if(void 0!==this.editedFeatureId&&void 0!==this.editedFeatureCoordinateIndex){var n=this.store.getGeometryCopy(this.editedFeatureId),o=n.coordinates[0];"coordinate"===this.editedSnapType||"line"===this.editedSnapType&&void 0!==this.editedInsertIndex?0===this.editedFeatureCoordinateIndex||this.editedFeatureCoordinateIndex===n.coordinates[0].length-1?(o[0]=[e.lng,e.lat],o[o.length-1]=[e.lng,e.lat]):o[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:"line"===this.editedSnapType&&void 0===this.editedInsertIndex&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,n.coordinates[0].splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);var i={type:"Polygon",coordinates:n.coordinates};this.validate&&!this.validate({type:"Feature",geometry:i,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:i}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!0}]),t(!0))}}},{key:"onDragEnd",value:function(e,t){void 0!==this.editedFeatureId&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:ei,value:!1}]),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}},{key:"cleanUp",value:function(){var e=this.currentId,t=this.snappedPointId,n=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,"drawing"===this.state&&this.setStarted();try{void 0!==e&&this.store.delete([e]),void 0!==n&&this.store.delete([n]),void 0!==t&&this.store.delete([t]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(e){}}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode){if("Polygon"===e.geometry.type)return t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if("Point"===e.geometry.type){var n=e.properties[ei],o=n?"editedPoint":e.properties[ti]?"closingPoint":e.properties[ni]?"snappingPoint":void 0;if(!o)return t;var i={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth}};return t.pointWidth=this.getNumericStylingValue(i[o].width,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(i[o].color,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(i[o].outlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(i[o].outlineWidth,2,e),t.zIndex=n?35:30,t}}return t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return Si(e,t.coordinatePrecision)}))}}])}(ai),cr={cancel:"Escape",finish:"Enter"},ur={start:"crosshair"},dr=function(e){function n(e){var t;return l(this,n),(t=o(this,n,[e,!0])).mode="rectangle",t.center=void 0,t.clickCount=0,t.currentRectangleId=void 0,t.keyEvents=cr,t.cursors=ur,t.updateOptions(e),t}return a(n,e),u(n,[{key:"updateOptions",value:function(e){t(n,"updateOptions",this,3)([e]),null!=e&&e.cursors&&(this.cursors=Zo({},this.cursors,e.cursors)),null===(null==e?void 0:e.keyEvents)?this.keyEvents={cancel:null,finish:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents))}},{key:"updateRectangle",value:function(e,t){if(1===this.clickCount&&this.center&&this.currentRectangleId){var n=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],o={type:"Polygon",coordinates:[[n,[e.lng,n[1]],[e.lng,e.lat],[n[0],e.lat],n]]};if(this.validate&&!this.validate({id:this.currentRectangleId,geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid)return;this.store.updateGeometry([{id:this.currentRectangleId,geometry:o}])}}},{key:"close",value:function(){var e=this.currentRectangleId;if(e){var t=Di(this.store.getGeometryCopy(e));t&&this.store.updateGeometry([{id:e,geometry:t}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),void 0!==e&&this.onFinish(e,{mode:this.mode,action:"draw"})}},{key:"start",value:function(){this.setStarted(),this.setCursor(this.cursors.start)}},{key:"stop",value:function(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}},{key:"onClick",value:function(e){if(0===this.clickCount){this.center=[e.lng,e.lat];var t=g(this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode}}]),1)[0];this.currentRectangleId=t,this.clickCount++,this.setDrawing()}else this.updateRectangle(e,qo.Finish),this.close()}},{key:"onMouseMove",value:function(e){this.updateRectangle(e,qo.Provisional)}},{key:"onKeyDown",value:function(){}},{key:"onKeyUp",value:function(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}},{key:"onDragStart",value:function(){}},{key:"onDrag",value:function(){}},{key:"onDragEnd",value:function(){}},{key:"cleanUp",value:function(){var e=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,"drawing"===this.state&&this.setStarted(),void 0!==e&&this.store.delete([e])}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return"Feature"===e.type&&"Polygon"===e.geometry.type&&e.properties.mode===this.mode?(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t):t}},{key:"validateFeature",value:function(e){var t=this;return this.validateModeFeature(e,(function(e){return Mi(e,t.coordinatePrecision)}))}}])}(ai);function hr(e,t){var n=e,o=t,i=ui(n[1]),r=ui(o[1]),a=ui(o[0]-n[0]);a>Math.PI&&(a-=2*Math.PI),a<-Math.PI&&(a+=2*Math.PI);var s=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),l=(hi(Math.atan2(a,s))+360)%360;return l>180?-(360-l):l}function pr(e,t,n){var o=t;t<0&&(o=-Math.abs(o));var i=o/ci,r=e[0]*Math.PI/180,a=ui(e[1]),s=ui(n),l=i*Math.cos(s),c=a+l;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);var u=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(a/2+Math.PI/4)),d=Math.abs(u)>1e-11?l/u:Math.cos(a),h=[(180*(r+i*Math.sin(s)/d)/Math.PI+540)%360-180,180*c/Math.PI];return h[0]+=h[0]-e[0]>180?-360:e[0]-h[0]>180?360:0,h}function fr(e,t,n,o,i){var r=o(e[0],e[1]),a=o(t[0],t[1]),s=i((r.x+a.x)/2,(r.y+a.y)/2),l=s.lng,c=s.lat;return[pi(l,n),pi(c,n)]}function gr(e,t,n){var o=pr(e,1e3*li(e,t)/2,hr(e,t));return[pi(o[0],n),pi(o[1],n)]}function vr(e){for(var t=e.featureCoords,n=e.precision,o=e.unproject,i=e.project,r=e.projection,a=[],s=0;s<t.length-1;s++){var l=void 0;if("web-mercator"===r)l=fr(t[s],t[s+1],n,i,o);else{if("globe"!==r)throw new Error("Invalid projection");l=gr(t[s],t[s+1],n)}a.push(l)}return a}var yr=function(t){function n(e,t){var i;return l(this,n),(i=o(this,n,[e])).config=void 0,i.selectionPointBehavior=void 0,i._midPoints=[],i.config=e,i.selectionPointBehavior=t,i}return a(n,t),u(n,[{key:"ids",get:function(){return this._midPoints.concat()},set:function(e){}},{key:"insert",value:function(t,n){var o=this.store.getGeometryCopy(t),i=this.store.getPropertiesCopy(t),r=i.midPointFeatureId,a=i.midPointSegment,s=this.store.getGeometryCopy(r),l="Polygon"===s.type?s.coordinates[0]:s.coordinates;l.splice(a+1,0,o.coordinates),s.coordinates="Polygon"===s.type?[l]:l,this.store.updateGeometry([{id:r,geometry:s}]),this.store.delete([].concat(e(this._midPoints),e(this.selectionPointBehavior.ids))),this.create(l,r,n),this.selectionPointBehavior.create(l,s.type,r)}},{key:"create",value:function(e,t,n){var o=this;if(!this.store.has(t))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(e,t,n,o,i,r){return vr({featureCoords:e,precision:n,project:o,unproject:i,projection:r}).map((function(e,n){return{geometry:{type:"Point",coordinates:e},properties:t(n)}}))}(e,(function(e){return x(x(x({mode:o.mode},Jo,!0),"midPointSegment",e),"midPointFeatureId",t)}),n,this.config.project,this.config.unproject,this.projection))}},{key:"delete",value:function(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}},{key:"getUpdated",value:function(e){var t=this;if(0!==this._midPoints.length)return vr({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((function(e,n){return{id:t._midPoints[n],geometry:{type:"Point",coordinates:e}}}))}}])}(Ri),mr=function(e){function t(e){var n;return l(this,t),(n=o(this,t,[e]))._selectionPoints=[],n}return a(t,e),u(t,[{key:"ids",get:function(){return this._selectionPoints.concat()},set:function(e){}},{key:"create",value:function(e,t,n){var o=this;this._selectionPoints=this.store.create(function(e,t,n){for(var o=[],i="Polygon"===t?e.length-1:e.length,r=0;r<i;r++)o.push({geometry:{type:"Point",coordinates:e[r]},properties:n(r)});return o}(e,t,(function(e){return{mode:o.mode,selectionPoint:!0,selectionPointFeatureId:n,index:e}})))}},{key:"delete",value:function(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}},{key:"getUpdated",value:function(e){if(0!==this._selectionPoints.length)return this._selectionPoints.map((function(t,n){return{id:t,geometry:{type:"Point",coordinates:e[n]}}}))}},{key:"getOneUpdated",value:function(e,t){if(void 0!==this._selectionPoints[e])return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}}])}(Ri);function br(e,t){for(var n,o,i,r=!1,a=0,s=t.length;a<s;a++)for(var l=t[a],c=0,u=l.length,d=u-1;c<u;d=c++)(o=l[c])[1]>(n=e)[1]!=(i=l[d])[1]>n[1]&&n[0]<(i[0]-o[0])*(n[1]-o[1])/(i[1]-o[1])+o[0]&&(r=!r);return r}var xr=function(e,t,n){var o=function(e){return e*e},i=function(e,t){return o(e.x-t.x)+o(e.y-t.y)};return Math.sqrt(function(e,t,n){var o=i(t,n);if(0===o)return i(e,t);var r=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/o;return r=Math.max(0,Math.min(1,r)),i(e,{x:t.x+r*(n.x-t.x),y:t.y+r*(n.y-t.y)})}(e,t,n))},Cr=function(e){function t(e,n,i){var r;return l(this,t),(r=o(this,t,[e])).config=void 0,r.createClickBoundingBox=void 0,r.pixelDistance=void 0,r.config=e,r.createClickBoundingBox=n,r.pixelDistance=i,r}return a(t,e),u(t,[{key:"find",value:function(e,t){for(var n,o,i,r,a=1/0,s=1/0,l=1/0,c=this.createClickBoundingBox.create(e),u=this.store.search(c),d=0;d<u.length;d++){var h=u[d],p=h.geometry;if("Point"===p.type){if(h.properties.selectionPoint||!t&&h.properties[Jo])continue;var f=this.pixelDistance.measure(e,p.coordinates);h.properties[Jo]&&f<this.pointerDistance&&f<l?(l=f,i=h):!h.properties[Jo]&&f<this.pointerDistance&&f<a&&(a=f,n=h)}else if("LineString"===p.type){if(n)continue;for(var g=0;g<p.coordinates.length-1;g++){var v=p.coordinates[g],y=p.coordinates[g+1],m=xr({x:e.containerX,y:e.containerY},this.project(v[0],v[1]),this.project(y[0],y[1]));m<this.pointerDistance&&m<s&&(s=m,o=h)}}else if("Polygon"===p.type){if(n||o)continue;br([e.lng,e.lat],p.coordinates)&&(r=h)}}return{clickedFeature:n||o||r,clickedMidPoint:i}}}])}(Ri),wr=function(t){function n(e,t,i,r){var a;return l(this,n),(a=o(this,n,[e])).config=void 0,a.featuresAtCursorEvent=void 0,a.selectionPoints=void 0,a.midPoints=void 0,a.draggedFeatureId=null,a.dragPosition=void 0,a.config=e,a.featuresAtCursorEvent=t,a.selectionPoints=i,a.midPoints=r,a}return a(n,t),u(n,[{key:"startDragging",value:function(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}},{key:"stopDragging",value:function(){this.draggedFeatureId=null,this.dragPosition=void 0}},{key:"isDragging",value:function(){return null!==this.draggedFeatureId}},{key:"canDrag",value:function(e,t){var n=this.featuresAtCursorEvent.find(e,!0).clickedFeature;return!(!n||n.id!==t)}},{key:"drag",value:function(t,n){if(this.draggedFeatureId){var o=this.store.getGeometryCopy(this.draggedFeatureId),i=[t.lng,t.lat];if("Polygon"===o.type||"LineString"===o.type){var r,a;if("Polygon"===o.type?a=(r=o.coordinates[0]).length-1:a=(r=o.coordinates).length,!this.dragPosition)return!1;for(var s=0;s<a;s++){var l=r[s],c=void 0,u=void 0;if("web-mercator"===this.config.projection){var d=yi(this.dragPosition[0],this.dragPosition[1]),h=yi(i[0],i[1]),p=yi(l[0],l[1]),f={x:d.x-h.x,y:d.y-h.y},g=p.x-f.x,v=p.y-f.y,y=mi(g,v);c=y.lng,u=y.lat}else{var m=[this.dragPosition[0]-i[0],this.dragPosition[1]-i[1]];c=l[0]-m[0],u=l[1]-m[1]}if(c=pi(c,this.config.coordinatePrecision),u=pi(u,this.config.coordinatePrecision),c>180||c<-180||u>90||u<-90)return!1;r[s]=[c,u]}"Polygon"===o.type&&(r[r.length-1]=[r[0][0],r[0][1]]);var b=this.selectionPoints.getUpdated(r)||[],x=this.midPoints.getUpdated(r)||[];if(n&&!n({type:"Feature",id:this.draggedFeatureId,geometry:o,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:qo.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o}].concat(e(b),e(x))),this.dragPosition=[t.lng,t.lat]}else"Point"===o.type&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:i}}]),this.dragPosition=[t.lng,t.lat])}}}])}(Ri),kr=function(t){function n(e,t,i,r){var a;return l(this,n),(a=o(this,n,[e])).config=void 0,a.pixelDistance=void 0,a.selectionPoints=void 0,a.midPoints=void 0,a.draggedCoordinate={id:null,index:-1},a.config=e,a.pixelDistance=t,a.selectionPoints=i,a.midPoints=r,a}return a(n,t),u(n,[{key:"getClosestCoordinate",value:function(e,t){var n,o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};if("LineString"===t.type)n=t.coordinates;else{if("Polygon"!==t.type)return o;n=t.coordinates[0]}for(var i=0;i<n.length;i++){var r=this.pixelDistance.measure(e,n[i]);if(r<this.pointerDistance&&r<o.dist){var a="Polygon"===t.type&&(i===n.length-1||0===i);o.dist=r,o.index=a?0:i,o.isFirstOrLastPolygonCoord=a}}return o}},{key:"getDraggableIndex",value:function(e,t){var n=this.store.getGeometryCopy(t),o=this.getClosestCoordinate(e,n);return-1===o.index?-1:o.index}},{key:"drag",value:function(t,n,o){if(null===this.draggedCoordinate.id)return!1;var i=this.draggedCoordinate.index,r=this.store.getGeometryCopy(this.draggedCoordinate.id),a="LineString"===r.type?r.coordinates:r.coordinates[0],s=[t.lng,t.lat];if(t.lng>180||t.lng<-180||t.lat>90||t.lat<-90)return!1;if("Polygon"!==r.type||i!==a.length-1&&0!==i)a[i]=s;else{var l=a.length-1;a[0]=s,a[l]=s}var c=this.selectionPoints.getOneUpdated(i,s),u=c?[c]:[],d=this.midPoints.getUpdated(a)||[];return!("Point"!==r.type&&!n&&Ci({geometry:r})||o&&!o({type:"Feature",id:this.draggedCoordinate.id,geometry:r,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:qo.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:r}].concat(u,e(d))),0))}},{key:"isDragging",value:function(){return null!==this.draggedCoordinate.id}},{key:"startDragging",value:function(e,t){this.draggedCoordinate={id:e,index:t}}},{key:"stopDragging",value:function(){this.draggedCoordinate={id:null,index:-1}}}])}(Ri);function Pr(e){var t=0,n=0,o=0;return("Polygon"===e.geometry.type?e.geometry.coordinates[0].slice(0,-1):e.geometry.coordinates).forEach((function(e){t+=e[0],n+=e[1],o++}),!0),[t/o,n/o]}function Sr(e,t){e[0]+=e[0]-t[0]>180?-360:t[0]-e[0]>180?360:0;var n=ci,o=t[1]*Math.PI/180,i=e[1]*Math.PI/180,r=i-o,a=Math.abs(e[0]-t[0])*Math.PI/180;a>Math.PI&&(a-=2*Math.PI);var s=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),l=Math.abs(s)>1e-11?r/s:Math.cos(o);return Math.sqrt(r*r+l*l*a*a)*n}function Mr(e){var t=("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).map((function(e){var t=yi(e[0],e[1]);return[t.x,t.y]}));return"Polygon"===e.geometry.type?function(e){for(var t=0,n=0,o=0,i=e.length,r=0;r<i-1;r++){var a=g(e[r],2),s=a[0],l=a[1],c=g(e[r+1],2),u=c[0],d=c[1],h=s*d-u*l;t+=h,n+=(s+u)*h,o+=(l+d)*h}return{x:n/=6*(t/=2),y:o/=6*t}}(t):function(e){for(var t=e.length,n=0,o=0,i=0;i<t;i++){var r=g(e[i],2);n+=r[0],o+=r[1]}return{x:n/t,y:o/t}}(t)}var Ir=function(t){function n(e,t,i){var r;return l(this,n),(r=o(this,n,[e])).config=void 0,r.selectionPoints=void 0,r.midPoints=void 0,r.lastBearing=void 0,r.config=e,r.selectionPoints=t,r.midPoints=i,r}return a(n,t),u(n,[{key:"reset",value:function(){this.lastBearing=void 0}},{key:"rotate",value:function(t,n,o){var i=this,r=this.store.getGeometryCopy(n);if("Polygon"===r.type||"LineString"===r.type){var a,s=[t.lng,t.lat],l={type:"Feature",geometry:r,properties:{}};if("web-mercator"===this.config.projection){if(a=function(e,t){var n=e.x,o=e.y,i=t.x,r=t.y,a=Math.atan2(r-o,i-n);return(a*=180/Math.PI)>180?a-=360:a<-180&&(a+=360),a}(Mr(l),yi(t.lng,t.lat)),!this.lastBearing)return void(this.lastBearing=a);!function(e,t){if(0===t||360===t||-360===t)return e;var n=.017453292519943295*t,o=("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).map((function(e){var t=g(e,2),n=t[0],o=t[1];return yi(n,o)})),i=o.reduce((function(e,t){return{x:e.x+t.x,y:e.y+t.y}}),{x:0,y:0});i.x/=o.length,i.y/=o.length;var r=o.map((function(e){return{x:i.x+(e.x-i.x)*Math.cos(n)-(e.y-i.y)*Math.sin(n),y:i.y+(e.x-i.x)*Math.sin(n)+(e.y-i.y)*Math.cos(n)}})).map((function(e){var t=e.x,n=e.y;return[mi(t,n).lng,mi(t,n).lat]}));"Polygon"===e.geometry.type?e.geometry.coordinates[0]=r:e.geometry.coordinates=r}(l,-(this.lastBearing-a))}else{if("globe"!==this.config.projection)throw new Error("Unsupported projection");if(a=hr(Pr({geometry:r}),s),!this.lastBearing)return void(this.lastBearing=a+180);!function(e,t){if(0===t||360===t||-360===t)return e;var n=Pr(e);("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).forEach((function(e){var o=hr(n,e)+t,i=Sr(n,e),r=pr(n,i,o);e[0]=r[0],e[1]=r[1]}))}(l,-(this.lastBearing-(a+180)))}var c="Polygon"===r.type?r.coordinates[0]:r.coordinates;c.forEach((function(e){e[0]=pi(e[0],i.coordinatePrecision),e[1]=pi(e[1],i.coordinatePrecision)}));var u=this.midPoints.getUpdated(c)||[],d=this.selectionPoints.getUpdated(c)||[];if(o&&!o({id:n,type:"Feature",geometry:r,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:qo.Provisional}))return!1;this.store.updateGeometry([{id:n,geometry:r}].concat(e(d),e(u))),"web-mercator"===this.projection?this.lastBearing=a:"globe"===this.projection&&(this.lastBearing=a+180)}}}])}(Ri),Or=function(t){function n(e,t,i){var r;return l(this,n),(r=o(this,n,[e])).config=void 0,r.selectionPoints=void 0,r.midPoints=void 0,r.lastDistance=void 0,r.config=e,r.selectionPoints=t,r.midPoints=i,r}return a(n,t),u(n,[{key:"reset",value:function(){this.lastDistance=void 0}},{key:"scale",value:function(t,n,o){var i=this,r=this.store.getGeometryCopy(n);if("Polygon"===r.type||"LineString"===r.type){var a,s=[t.lng,t.lat],l={type:"Feature",geometry:r,properties:{}},c=Mr(l);if("web-mercator"===this.config.projection){var u=yi(t.lng,t.lat);a=_i(c,u)}else{if("globe"!==this.config.projection)throw new Error("Invalid projection");a=li(Pr({geometry:r}),s)}if(this.lastDistance){var d=1-(this.lastDistance-a)/a;if("web-mercator"===this.config.projection){var h=mi(c.x,c.y);!function(e,t,n){if(1===t)return e;var o=("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).map((function(e){var t=g(e,2),n=t[0],o=t[1];return yi(n,o)})),i=yi(n[0],n[1]),r=o.map((function(e){return{x:i.x+(e.x-i.x)*t,y:i.y+(e.y-i.y)*t}})).map((function(e){var t=e.x,n=e.y;return[mi(t,n).lng,mi(t,n).lat]}));"Polygon"===e.geometry.type?e.geometry.coordinates[0]=r:e.geometry.coordinates=r}(l,d,[h.lng,h.lat])}else"globe"===this.config.projection&&function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"xy";1===t||("Polygon"===e.geometry.type?e.geometry.coordinates[0]:e.geometry.coordinates).forEach((function(e){var i=Sr(n,e),r=hr(n,e),a=pr(n,i*t,r);"x"!==o&&"xy"!==o||(e[0]=a[0]),"y"!==o&&"xy"!==o||(e[1]=a[1])}))}(l,d,Pr(l));var p="Polygon"===r.type?r.coordinates[0]:r.coordinates;p.forEach((function(e){e[0]=pi(e[0],i.coordinatePrecision),e[1]=pi(e[1],i.coordinatePrecision)}));var f=this.midPoints.getUpdated(p)||[],v=this.selectionPoints.getUpdated(p)||[];if(o&&!o({id:n,type:"Feature",geometry:r,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:qo.Provisional}))return!1;this.store.updateGeometry([{id:n,geometry:r}].concat(e(v),e(f))),this.lastDistance=a}else this.lastDistance=a}}}])}(Ri),Fr=function(t){function n(e,t,i,r){var a;return l(this,n),(a=o(this,n,[e])).config=void 0,a.pixelDistance=void 0,a.selectionPoints=void 0,a.midPoints=void 0,a.minimumScale=1e-4,a.draggedCoordinate={id:null,index:-1},a.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},a.config=e,a.pixelDistance=t,a.selectionPoints=i,a.midPoints=r,a}return a(n,t),u(n,[{key:"getClosestCoordinate",value:function(e,t){var n,o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};if("LineString"===t.type)n=t.coordinates;else{if("Polygon"!==t.type)return o;n=t.coordinates[0]}for(var i=0;i<n.length;i++){var r=this.pixelDistance.measure(e,n[i]);if(r<this.pointerDistance&&r<o.dist){var a="Polygon"===t.type&&(i===n.length-1||0===i);o.dist=r,o.index=a?0:i,o.isFirstOrLastPolygonCoord=a}}return o}},{key:"isValidDragWebMercator",value:function(e,t,n){switch(e){case 0:if(t<=0||n>=0)return!1;break;case 1:if(n>=0)return!1;break;case 2:if(t>=0||n>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||n<=0)return!1;break;case 5:if(n<=0)return!1;break;case 6:if(t<=0||n<=0)return!1;break;case 7:if(t<=0)return!1}return!0}},{key:"getSelectedFeatureDataWebMercator",value:function(){if(!this.draggedCoordinate.id||-1===this.draggedCoordinate.index)return null;var e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;var t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}},{key:"centerWebMercatorDrag",value:function(e){var t=this.getSelectedFeatureDataWebMercator();if(!t)return null;var n=t.feature,o=t.boundingBox,i=t.updatedCoords,r=t.selectedCoordinate,a=Mr(n);if(!a)return null;var s=yi(r[0],r[1]),l=this.getIndexesWebMercator(o,s).closestBBoxIndex,c=yi(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:i,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:a}),i}},{key:"centerFixedWebMercatorDrag",value:function(e){var t=this.getSelectedFeatureDataWebMercator();if(!t)return null;var n=t.feature,o=t.boundingBox,i=t.updatedCoords,r=t.selectedCoordinate,a=Mr(n);if(!a)return null;var s=yi(r[0],r[1]),l=this.getIndexesWebMercator(o,s).closestBBoxIndex,c=yi(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:i,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:a}),i}},{key:"scaleFixedWebMercator",value:function(e){var t=e.closestBBoxIndex,n=e.webMercatorOrigin,o=e.webMercatorSelected,i=e.webMercatorCursor,r=e.updatedCoords;if(!this.isValidDragWebMercator(t,n.x-i.x,n.y-i.y))return null;var a=_i(n,i)/_i(n,o);return a<0&&(a=this.minimumScale),this.performWebMercatorScale(r,n.x,n.y,a,a),r}},{key:"oppositeFixedWebMercatorDrag",value:function(e){var t=this.getSelectedFeatureDataWebMercator();if(!t)return null;var n=t.boundingBox,o=t.updatedCoords,i=t.selectedCoordinate,r=yi(i[0],i[1]),a=this.getIndexesWebMercator(n,r),s=a.oppositeBboxIndex,l=a.closestBBoxIndex,c={x:n[s][0],y:n[s][1]},u=yi(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:o,webMercatorCursor:u,webMercatorSelected:r,webMercatorOrigin:c}),o}},{key:"oppositeWebMercatorDrag",value:function(e){var t=this.getSelectedFeatureDataWebMercator();if(!t)return null;var n=t.boundingBox,o=t.updatedCoords,i=t.selectedCoordinate,r=yi(i[0],i[1]),a=this.getIndexesWebMercator(n,r),s=a.oppositeBboxIndex,l=a.closestBBoxIndex,c={x:n[s][0],y:n[s][1]},u=yi(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:o,webMercatorCursor:u,webMercatorSelected:r,webMercatorOrigin:c}),o}},{key:"scaleWebMercator",value:function(e){var t=e.closestBBoxIndex,n=e.webMercatorOrigin,o=e.webMercatorSelected,i=e.webMercatorCursor,r=e.updatedCoords,a=n.x-i.x,s=n.y-i.y;if(!this.isValidDragWebMercator(t,a,s))return null;var l=1;0!==a&&1!==t&&5!==t&&(l=1-(n.x-o.x-a)/a);var c=1;return 0!==s&&3!==t&&7!==t&&(c=1-(n.y-o.y-s)/s),this.validateScale(l,c)?(l<0&&(l=this.minimumScale),c<0&&(c=this.minimumScale),this.performWebMercatorScale(r,n.x,n.y,l,c),r):null}},{key:"getFeature",value:function(e){if(null===this.draggedCoordinate.id)return null;var t=this.store.getGeometryCopy(e);return"Polygon"!==t.type&&"LineString"!==t.type?null:{type:"Feature",geometry:t,properties:{}}}},{key:"getNormalisedCoordinates",value:function(e){return"Polygon"===e.type?e.coordinates[0]:e.coordinates}},{key:"validateScale",value:function(e,t){var n=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,o=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return n&&o}},{key:"performWebMercatorScale",value:function(e,t,n,o,i){e.forEach((function(e){var r=yi(e[0],e[1]),a=r.x,s=r.y,l=mi(t+(a-t)*o,n+(s-n)*i),c=l.lng,u=l.lat;e[0]=c,e[1]=u}))}},{key:"getBBoxWebMercator",value:function(e){var t=[1/0,1/0,-1/0,-1/0];(e=e.map((function(e){var t=yi(e[0],e[1]);return[t.x,t.y]}))).forEach((function(e){var n=g(e,2),o=n[0],i=n[1];o<t[0]&&(t[0]=o),i<t[1]&&(t[1]=i),o>t[2]&&(t[2]=o),i>t[3]&&(t[3]=i)}));var n=t[0],o=t[1],i=t[2],r=t[3];return[[n,r],[(n+i)/2,r],[i,r],[i,r+(o-r)/2],[i,o],[(n+i)/2,o],[n,o],[n,r+(o-r)/2]]}},{key:"getIndexesWebMercator",value:function(e,t){for(var n,o=1/0,i=0;i<e.length;i++){var r=_i({x:t.x,y:t.y},{x:e[i][0],y:e[i][1]});r<o&&(n=i,o=r)}if(void 0===n)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[n],closestBBoxIndex:n}}},{key:"isDragging",value:function(){return null!==this.draggedCoordinate.id}},{key:"startDragging",value:function(e,t){this.draggedCoordinate={id:e,index:t}}},{key:"stopDragging",value:function(){this.draggedCoordinate={id:null,index:-1}}},{key:"getDraggableIndex",value:function(e,t){var n=this.store.getGeometryCopy(t),o=this.getClosestCoordinate(e,n);return-1===o.index?-1:o.index}},{key:"drag",value:function(t,n,o){if(!this.draggedCoordinate.id)return!1;var i=this.getFeature(this.draggedCoordinate.id);if(!i)return!1;var r=null;if("center"===n?r=this.centerWebMercatorDrag(t):"opposite"===n?r=this.oppositeWebMercatorDrag(t):"center-fixed"===n?r=this.centerFixedWebMercatorDrag(t):"opposite-fixed"===n&&(r=this.oppositeFixedWebMercatorDrag(t)),!r)return!1;for(var a=0;a<r.length;a++){var s=r[a];if(s[0]=pi(s[0],this.coordinatePrecision),s[1]=pi(s[1],this.coordinatePrecision),!ki(s,this.coordinatePrecision))return!1}var l=this.midPoints.getUpdated(r)||[],c=this.selectionPoints.getUpdated(r)||[],u={type:i.geometry.type,coordinates:"Polygon"===i.geometry.type?[r]:r};return!(o&&!o({id:this.draggedCoordinate.id,type:"Feature",geometry:u,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:qo.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:u}].concat(e(c),e(l))),0))}}])}(Ri),_r={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},Dr={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"},Br=function(n){function i(e){var t;return l(this,i),(t=o(this,i,[e,!0])).mode="select",t.allowManualDeselection=!0,t.dragEventThrottle=5,t.dragEventCount=0,t.selected=[],t.flags={},t.keyEvents=_r,t.cursors=Dr,t.validations={},t.selectionPoints=void 0,t.midPoints=void 0,t.featuresAtMouseEvent=void 0,t.pixelDistance=void 0,t.clickBoundingBox=void 0,t.dragFeature=void 0,t.dragCoordinate=void 0,t.rotateFeature=void 0,t.scaleFeature=void 0,t.dragCoordinateResizeFeature=void 0,t.updateOptions(e),t}return a(i,n),u(i,[{key:"updateOptions",value:function(e){if(t(i,"updateOptions",this,3)([e]),this.cursors=e&&e.cursors?Zo({},this.cursors,e.cursors):Dr,null===(null==e?void 0:e.keyEvents)?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:null!=e&&e.keyEvents&&(this.keyEvents=Zo({},this.keyEvents,e.keyEvents)),void 0!==(null==e?void 0:e.dragEventThrottle)&&(this.dragEventThrottle=e.dragEventThrottle),void 0!==(null==e?void 0:e.allowManualDeselection)&&(this.allowManualDeselection=e.allowManualDeselection),null!=e&&e.flags)for(var n in this.flags=Zo({},this.flags,e.flags),this.validations={},this.flags){var o=this.flags[n].feature;o&&o.validation&&(this.validations[n]=o.validation)}}},{key:"selectFeature",value:function(e){this.select(e,!1)}},{key:"setSelecting",value:function(){if("started"!==this._state)throw new Error("Mode must be started to move to selecting state");this._state="selecting"}},{key:"registerBehaviors",value:function(e){this.pixelDistance=new Ti(e),this.clickBoundingBox=new zi(e),this.featuresAtMouseEvent=new Cr(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new mr(e),this.midPoints=new yr(e,this.selectionPoints),this.rotateFeature=new Ir(e,this.selectionPoints,this.midPoints),this.scaleFeature=new Or(e,this.selectionPoints,this.midPoints),this.dragFeature=new wr(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints),this.dragCoordinate=new kr(e,this.pixelDistance,this.selectionPoints,this.midPoints),this.dragCoordinateResizeFeature=new Fr(e,this.pixelDistance,this.selectionPoints,this.midPoints)}},{key:"deselectFeature",value:function(){this.deselect()}},{key:"deselect",value:function(){var e=this,t=this.selected.filter((function(t){return e.store.has(t)})).map((function(e){return{id:e,property:$o,value:!1}}));this.store.updateProperty(t),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}},{key:"deleteSelected",value:function(){this.store.delete(this.selected),this.selected=[]}},{key:"onRightClick",value:function(t){var n=this;if(this.selectionPoints.ids.length){var o,i=1/0;if(this.selectionPoints.ids.forEach((function(e){var r=n.store.getGeometryCopy(e),a=n.pixelDistance.measure(t,r.coordinates);a<n.pointerDistance&&a<i&&(i=a,o=n.store.getPropertiesCopy(e))})),o){var r=o.selectionPointFeatureId,a=o.index,s=this.store.getPropertiesCopy(r),l=this.flags[s.mode],c=this.validations[s.mode];if(l&&l.feature&&l.feature.coordinates&&l.feature.coordinates.deletable){var u,d=this.store.getGeometryCopy(r);if("Polygon"===d.type){if((u=d.coordinates[0]).length<=4)return}else if("LineString"===d.type&&(u=d.coordinates).length<=2)return;u&&("Polygon"!==d.type||0!==a&&a!==u.length-1?u.splice(a,1):(u.shift(),u.pop(),u.push([u[0][0],u[0][1]])),(!c||c({id:r,type:"Feature",geometry:d,properties:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:qo.Commit}).valid)&&(this.store.delete([].concat(e(this.midPoints.ids),e(this.selectionPoints.ids))),this.store.updateGeometry([{id:r,geometry:d}]),this.selectionPoints.create(u,d.type,r),l&&l.feature&&l.feature.coordinates&&l.feature.coordinates.midpoints&&this.midPoints.create(u,r,this.coordinatePrecision)))}}}}},{key:"select",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.selected[0]!==e){var n=this.store.getPropertiesCopy(e).mode,o=this.flags[n];if(o&&o.feature){var i=this.selected[0];if(i){if(i===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:"selected",value:!0}]),this.onSelect(e);var r=this.store.getGeometryCopy(e),a=r.type,s=r.coordinates;if("LineString"===a||"Polygon"===a){var l="LineString"===a?s:s[0];l&&o&&o.feature.coordinates&&(this.selectionPoints.create(l,a,e),o.feature.coordinates.midpoints&&this.midPoints.create(l,e,this.coordinatePrecision))}}}}},{key:"onLeftClick",value:function(e){var t=this.featuresAtMouseEvent.find(e,this.selected.length>0),n=t.clickedFeature,o=t.clickedMidPoint;if(this.selected.length&&o)this.midPoints.insert(o.id,this.coordinatePrecision);else if(n&&n.id)this.select(n.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}},{key:"start",value:function(){this.setStarted(),this.setSelecting()}},{key:"stop",value:function(){this.cleanUp(),this.setStarted(),this.setStopped()}},{key:"onClick",value:function(e){"right"!==e.button?"left"===e.button&&this.onLeftClick(e):this.onRightClick(e)}},{key:"canScale",value:function(e){return this.keyEvents.scale&&this.keyEvents.scale.every((function(t){return e.heldKeys.includes(t)}))}},{key:"canRotate",value:function(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every((function(t){return e.heldKeys.includes(t)}))}},{key:"preventDefaultKeyEvent",value:function(e){var t=this.canRotate(e),n=this.canScale(e);(t||n)&&e.preventDefault()}},{key:"onKeyDown",value:function(e){this.preventDefaultKeyEvent(e)}},{key:"onKeyUp",value:function(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;this.onDeselect(this.selected[0]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}},{key:"cleanUp",value:function(){this.selected.length&&this.deselect()}},{key:"onDragStart",value:function(e,t){if(this.selected.length){var n=this.store.getPropertiesCopy(this.selected[0]),o=this.flags[n.mode];if(o&&o.feature&&(o.feature.draggable||o.feature.coordinates&&o.feature.coordinates.draggable||o.feature.coordinates&&o.feature.coordinates.resizable)){this.dragEventCount=0;var i=this.selected[0],r=this.dragCoordinate.getDraggableIndex(e,i);return o&&o.feature&&o.feature.coordinates&&(o.feature.coordinates.draggable||o.feature.coordinates.resizable)&&-1!==r?(this.setCursor(this.cursors.dragStart),o.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(i,r):this.dragCoordinate.startDragging(i,r),void t(!1)):o&&o.feature&&o.feature.draggable&&this.dragFeature.canDrag(e,i)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,i),void t(!1)):void 0}}}},{key:"onDrag",value:function(e,t){var n=this.selected[0];if(n){var o=this.store.getPropertiesCopy(n),i=this.flags[o.mode],r=!0===(i&&i.feature&&i.feature.selfIntersectable);if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle!=0){var a=this.validations[o.mode];if(i&&i.feature&&i.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,n,a);if(i&&i.feature&&i.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,n,a);if(this.dragCoordinateResizeFeature.isDragging()&&i.feature&&i.feature.coordinates&&i.feature.coordinates.resizable){if("globe"===this.projection)throw new Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,i.feature.coordinates.resizable,a)}this.dragCoordinate.isDragging()?this.dragCoordinate.drag(e,r,a):this.dragFeature.isDragging()?this.dragFeature.drag(e,a):t(!0)}}}},{key:"onDragEnd",value:function(e,t){this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0)}},{key:"onMouseMove",value:function(e){var t=this;if(this.selected.length){if(!this.dragFeature.isDragging()){var n=!1;this.midPoints.ids.forEach((function(o){if(!n){var i=t.store.getGeometryCopy(o);t.pixelDistance.measure(e,i.coordinates)<t.pointerDistance&&(n=!0)}}));var o=!1;if(this.selectionPoints.ids.forEach((function(i){var r=t.store.getGeometryCopy(i);t.pixelDistance.measure(e,r.coordinates)<t.pointerDistance&&(n=!1,o=!0)})),n)this.setCursor(this.cursors.insertMidpoint);else{var i=this.featuresAtMouseEvent.find(e,!0).clickedFeature;this.setCursor(this.selected.length>0&&(i&&i.id===this.selected[0]||o)?this.cursors.pointerOver:"unset")}}}else this.setCursor("unset")}},{key:"styleFeature",value:function(e){var t=Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&"Point"===e.geometry.type){if(e.properties.selectionPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties.midPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=40,t}else if(e.properties[$o]){if("Polygon"===e.geometry.type)return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if("LineString"===e.geometry.type)return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if("Point"===e.geometry.type)return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=10,t}return t}}])}(si),Er=function(e){function t(){var e;l(this,t);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=o(this,t,[].concat(i))).type=ri.Static,e.mode="static",e}return a(t,e),u(t,[{key:"start",value:function(){}},{key:"stop",value:function(){}},{key:"onKeyUp",value:function(){}},{key:"onKeyDown",value:function(){}},{key:"onClick",value:function(){}},{key:"onDragStart",value:function(){}},{key:"onDrag",value:function(){}},{key:"onDragEnd",value:function(){}},{key:"onMouseMove",value:function(){}},{key:"cleanUp",value:function(){}},{key:"styleFeature",value:function(){return Zo({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}])}(ai);function jr(e,t,n,o,i){for(;o>n;){if(o-n>600){var r=o-n+1,a=t-n+1,s=Math.log(r),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(r-l)/r)*(a-r/2<0?-1:1);jr(e,t,Math.max(n,Math.floor(t-a*l/r+c)),Math.min(o,Math.floor(t+(r-a)*l/r+c)),i)}var u=e[t],d=n,h=o;for(Rr(e,n,t),i(e[o],u)>0&&Rr(e,n,o);d<h;){for(Rr(e,d,h),d++,h--;i(e[d],u)<0;)d++;for(;i(e[h],u)>0;)h--}0===i(e[n],u)?Rr(e,n,h):Rr(e,++h,o),h<=t&&(n=h+1),t<=h&&(o=h-1)}}function Rr(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function Lr(e,t){zr(e,0,e.children.length,t,e)}function zr(e,t,n,o,i){i||(i=Xr([])),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var r=t;r<n;r++){var a=e.children[r];Tr(i,e.leaf?o(a):a)}return i}function Tr(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function Nr(e,t){return e.minX-t.minX}function Wr(e,t){return e.minY-t.minY}function Ar(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function Ur(e){return e.maxX-e.minX+(e.maxY-e.minY)}function Gr(e,t){var n=Math.max(e.minX,t.minX),o=Math.max(e.minY,t.minY),i=Math.min(e.maxX,t.maxX),r=Math.min(e.maxY,t.maxY);return Math.max(0,i-n)*Math.max(0,r-o)}function Vr(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function Hr(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function Xr(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Yr(e,t,n,o,i){for(var r=[t,n];r.length;)if(!((n=r.pop())-(t=r.pop())<=o)){var a=t+Math.ceil((n-t)/o/2)*o;jr(e,a,t,n,i),r.push(t,a,a,n)}}var qr,Kr,Zr,$r=function(){return u((function e(t){l(this,e),this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}),[{key:"search",value:function(e){var t=this.data,n=[];if(!Hr(e,t))return n;for(var o=this.toBBox,i=[];t;){for(var r=0;r<t.children.length;r++){var a=t.children[r],s=t.leaf?o(a):a;Hr(e,s)&&(t.leaf?n.push(a):Vr(e,s)?this._all(a,n):i.push(a))}t=i.pop()}return n}},{key:"collides",value:function(e){var t=this.data;if(Hr(e,t))for(var n=[];t;){for(var o=0;o<t.children.length;o++){var i=t.children[o],r=t.leaf?this.toBBox(i):i;if(Hr(e,r)){if(t.leaf||Vr(e,r))return!0;n.push(i)}}t=n.pop()}return!1}},{key:"load",value:function(e){if(e.length<this._minEntries)for(var t=0;t<e.length;t++)this.insert(e[t]);else{var n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n}}},{key:"insert",value:function(e){this._insert(e,this.data.height-1)}},{key:"clear",value:function(){this.data=Xr([])}},{key:"remove",value:function(e){for(var t,n,o=this.data,i=this.toBBox(e),r=[],a=[],s=!1;o||r.length;){if(o||(o=r.pop(),n=r[r.length-1],t=a.pop(),s=!0),o.leaf){var l=o.children.indexOf(e);-1!==l&&(o.children.splice(l,1),r.push(o),this._condense(r))}s||o.leaf||!Vr(o,i)?n?(t++,o=n.children[t],s=!1):o=null:(r.push(o),a.push(t),t=0,n=o,o=o.children[0])}}},{key:"toBBox",value:function(e){return e}},{key:"compareMinX",value:function(e,t){return e.minX-t.minX}},{key:"compareMinY",value:function(e,t){return e.minY-t.minY}},{key:"_all",value:function(t,n){for(var o=[];t;)t.leaf?n.push.apply(n,e(t.children)):o.push.apply(o,e(t.children)),t=o.pop();return n}},{key:"_build",value:function(e,t,n,o){var i,r=n-t+1,a=this._maxEntries;if(r<=a)return Lr(i=Xr(e.slice(t,n+1)),this.toBBox),i;o||(o=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,o-1))),(i=Xr([])).leaf=!1,i.height=o;var s=Math.ceil(r/a),l=s*Math.ceil(Math.sqrt(a));Yr(e,t,n,l,this.compareMinX);for(var c=t;c<=n;c+=l){var u=Math.min(c+l-1,n);Yr(e,c,u,s,this.compareMinY);for(var d=c;d<=u;d+=s){var h=Math.min(d+s-1,u);i.children.push(this._build(e,d,h,o-1))}}return Lr(i,this.toBBox),i}},{key:"_chooseSubtree",value:function(e,t,n,o){for(;o.push(t),!t.leaf&&o.length-1!==n;){for(var i=void 0,r=1/0,a=1/0,s=0;s<t.children.length;s++){var l=t.children[s],c=Ar(l),u=(d=e,h=l,(Math.max(h.maxX,d.maxX)-Math.min(h.minX,d.minX))*(Math.max(h.maxY,d.maxY)-Math.min(h.minY,d.minY))-c);u<a?(a=u,r=c<r?c:r,i=l):u===a&&c<r&&(r=c,i=l)}t=i||t.children[0]}var d,h;return t}},{key:"_insert",value:function(e,t,n){var o=n?e:this.toBBox(e),i=[],r=this._chooseSubtree(o,this.data,t,i);for(r.children.push(e),Tr(r,o);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(o,i,t)}},{key:"_split",value:function(e,t){var n=e[t],o=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,o);var r=this._chooseSplitIndex(n,i,o),a=Xr(n.children.splice(r,n.children.length-r));a.height=n.height,a.leaf=n.leaf,Lr(n,this.toBBox),Lr(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(n,a)}},{key:"_splitRoot",value:function(e,t){this.data=Xr([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Lr(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,n){for(var o,i=1/0,r=1/0,a=t;a<=n-t;a++){var s=zr(e,0,a,this.toBBox),l=zr(e,a,n,this.toBBox),c=Gr(s,l),u=Ar(s)+Ar(l);c<i?(i=c,o=a,r=u<r?u:r):c===i&&u<r&&(r=u,o=a)}return o||n-t}},{key:"_chooseSplitAxis",value:function(e,t,n){var o=e.leaf?this.compareMinX:Nr,i=e.leaf?this.compareMinY:Wr;this._allDistMargin(e,t,n,o)<this._allDistMargin(e,t,n,i)&&e.children.sort(o)}},{key:"_allDistMargin",value:function(e,t,n,o){e.children.sort(o);for(var i=this.toBBox,r=zr(e,0,t,i),a=zr(e,n-t,n,i),s=Ur(r)+Ur(a),l=t;l<n-t;l++){var c=e.children[l];Tr(r,e.leaf?i(c):c),s+=Ur(r)}for(var u=n-t-1;u>=t;u--){var d=e.children[u];Tr(a,e.leaf?i(d):d),s+=Ur(a)}return s}},{key:"_adjustParentBBoxes",value:function(e,t,n){for(var o=n;o>=0;o--)Tr(t[o],e)}},{key:"_condense",value:function(e){for(var t,n=e.length-1;n>=0;n--)0===e[n].children.length?n>0?(t=e[n-1].children).splice(t.indexOf(e[n]),1):this.clear():Lr(e[n],this.toBBox)}}])}(),Jr=function(){return u((function e(t){l(this,e),this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new $r(t&&t.maxEntries?t.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}),[{key:"setMaps",value:function(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}},{key:"toBBox",value:function(e){var t,n=[],o=[];if("Polygon"===e.geometry.type)t=e.geometry.coordinates[0];else if("LineString"===e.geometry.type)t=e.geometry.coordinates;else{if("Point"!==e.geometry.type)throw new Error("Not a valid feature to turn into a bounding box");t=[e.geometry.coordinates]}for(var i=0;i<t.length;i++)o.push(t[i][1]),n.push(t[i][0]);var r=Math.min.apply(Math,o),a=Math.max.apply(Math,o);return{minX:Math.min.apply(Math,n),minY:r,maxX:Math.max.apply(Math,n),maxY:a}}},{key:"insert",value:function(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");var t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}},{key:"load",value:function(e){var t=this,n=[],o=new Set;e.forEach((function(e){var i=t.toBBox(e);if(t.setMaps(e,i),o.has(String(e.id)))throw new Error("Duplicate feature ID found ".concat(e.id));o.add(String(e.id)),n.push(i)})),this.tree.load(n)}},{key:"update",value:function(e){this.remove(e.id);var t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}},{key:"remove",value:function(e){var t=this.idToNode.get(e);if(!t)throw new Error("".concat(e," not inserted into the spatial index"));this.tree.remove(t)}},{key:"clear",value:function(){this.tree.clear()}},{key:"search",value:function(e){var t=this;return this.tree.search(this.toBBox(e)).map((function(e){return t.nodeToId.get(e)}))}},{key:"collides",value:function(e){return this.tree.collides(this.toBBox(e))}}])}(),Qr={getId:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},isValidId:function(e){return"string"==typeof e&&36===e.length}},ea=function(){return u((function e(t){l(this,e),this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=function(){},this.store={},this.spatialIndex=new Jr,this.tracked=!t||!1!==t.tracked,this.idStrategy=t&&t.idStrategy?t.idStrategy:Qr}),[{key:"clone",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"getId",value:function(){return this.idStrategy.getId()}},{key:"has",value:function(e){return Boolean(this.store[e])}},{key:"load",value:function(e,t){var n=this;if(0===e.length)return[];var o=this.clone(e),i=[],r=[];return o=o.filter((function(e){null==e.id&&(e.id=n.idStrategy.getId());var o=e.id;if(t){var a=t(e);if(!a.valid)return r.push({id:o,valid:!1,reason:a.reason}),!1}if(n.tracked){if(e.properties.createdAt){if(!ii(e.properties.createdAt))return r.push({id:e.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else e.properties.createdAt=+new Date;if(e.properties.updatedAt){if(!ii(e.properties.updatedAt))return r.push({id:e.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else e.properties.updatedAt=+new Date}return n.has(o)?(r.push({id:o,valid:!1,reason:"Feature already exists with this id: ".concat(o)}),!1):(n.store[o]=e,i.push(o),r.push({id:o,valid:!0}),!0)})),this.spatialIndex.load(o),this._onChange(i,"create"),r}},{key:"search",value:function(e,t){var n=this,o=this.spatialIndex.search(e).map((function(e){return n.store[e]}));return this.clone(t?o.filter(t):o)}},{key:"registerOnChange",value:function(e){this._onChange=function(t,n){e(t,n)}}},{key:"getGeometryCopy",value:function(e){var t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get geometry copy"));return this.clone(t.geometry)}},{key:"getPropertiesCopy",value:function(e){var t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get properties copy"));return this.clone(t.properties)}},{key:"updateProperty",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.id,i=e.property,r=e.value,a=t.store[o];if(!a)throw new Error("No feature with this (".concat(o,"), can not update geometry"));n.push(o),a.properties[i]=r,t.tracked&&(a.properties.updatedAt=+new Date)})),this._onChange&&this._onChange(n,"update")}},{key:"updateGeometry",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.id,i=e.geometry;n.push(o);var r=t.store[o];if(!r)throw new Error("No feature with this (".concat(o,"), can not update geometry"));r.geometry=t.clone(i),t.spatialIndex.update(r),t.tracked&&(r.properties.updatedAt=+new Date)})),this._onChange&&this._onChange(n,"update")}},{key:"create",value:function(e){var t=this,n=[];return e.forEach((function(e){var o,i=e.geometry,r=e.properties,a=Zo({},r);t.tracked&&(o=+new Date,r?(a.createdAt="number"==typeof r.createdAt?r.createdAt:o,a.updatedAt="number"==typeof r.updatedAt?r.updatedAt:o):a={createdAt:o,updatedAt:o});var s=t.getId(),l={id:s,type:"Feature",geometry:i,properties:a};t.store[s]=l,t.spatialIndex.insert(l),n.push(s)})),this._onChange&&this._onChange([].concat(n),"create"),n}},{key:"delete",value:function(t){var n=this;t.forEach((function(e){if(!n.store[e])throw new Error("No feature with this id, can not delete");delete n.store[e],n.spatialIndex.remove(e)})),this._onChange&&this._onChange(e(t),"delete")}},{key:"copy",value:function(e){return this.clone(this.store[e])}},{key:"copyAll",value:function(){var e=this;return this.clone(Object.keys(this.store).map((function(t){return e.store[t]})))}},{key:"clear",value:function(){this.store={},this.spatialIndex.clear()}},{key:"size",value:function(){return Object.keys(this.store).length}}])}(),ta=function(){return u((function e(t){var n=this;l(this,e),this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=t.adapter,this._mode=new Er;var o=new Set,i=t.modes.reduce((function(e,t){if(o.has(t.mode))throw new Error("There is already a ".concat(t.mode," mode provided"));return o.add(t.mode),e[t.mode]=t,e}),{}),r=Object.keys(i);if(0===r.length)throw new Error("No modes provided");r.forEach((function(e){if(i[e].type===ri.Select){if(n._instanceSelectMode)throw new Error("only one type of select mode can be provided");n._instanceSelectMode=e}})),this._modes=Zo({},i,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new ea({tracked:!!t.tracked,idStrategy:t.idStrategy?t.idStrategy:void 0});var a=function(e){var t=[],o=n._store.copyAll().filter((function(n){return!e.includes(n.id)||(t.push(n),!1)}));return{changed:t,unchanged:o}},s=function(e,t){n._enabled&&n._eventListeners.finish.forEach((function(n){n(e,t)}))},c=function(e,t){if(n._enabled){n._eventListeners.change.forEach((function(n){n(e,t)}));var o=a(e),i=o.changed,r=o.unchanged;"create"===t?n._adapter.render({created:i,deletedIds:[],unchanged:r,updated:[]},n.getModeStyles()):"update"===t?n._adapter.render({created:[],deletedIds:[],unchanged:r,updated:i},n.getModeStyles()):"delete"===t?n._adapter.render({created:[],deletedIds:e,unchanged:r,updated:[]},n.getModeStyles()):"styling"===t&&n._adapter.render({created:[],deletedIds:[],unchanged:r,updated:[]},n.getModeStyles())}},u=function(e){if(n._enabled){n._eventListeners.select.forEach((function(t){t(e)}));var t=a([e]),o=t.changed,i=t.unchanged;n._adapter.render({created:[],deletedIds:[],unchanged:i,updated:o},n.getModeStyles())}},d=function(e){if(n._enabled){n._eventListeners.deselect.forEach((function(e){e()}));var t=a([e]),o=t.changed,i=t.unchanged;o&&n._adapter.render({created:[],deletedIds:[],unchanged:i,updated:o},n.getModeStyles())}};Object.keys(this._modes).forEach((function(e){n._modes[e].register({mode:e,store:n._store,setCursor:n._adapter.setCursor.bind(n._adapter),project:n._adapter.project.bind(n._adapter),unproject:n._adapter.unproject.bind(n._adapter),setDoubleClickToZoom:n._adapter.setDoubleClickToZoom.bind(n._adapter),onChange:c,onSelect:u,onDeselect:d,onFinish:s,coordinatePrecision:n._adapter.getCoordinatePrecision()})}))}),[{key:"checkEnabled",value:function(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}},{key:"getModeStyles",value:function(){var e=this,t={};return Object.keys(this._modes).forEach((function(n){t[n]=function(t){return e._instanceSelectMode&&t.properties[$o]?e._modes[e._instanceSelectMode].styleFeature.bind(e._modes[e._instanceSelectMode])(t):e._modes[n].styleFeature.bind(e._modes[n])(t)}})),t}},{key:"featuresAtLocation",value:function(e,t){var n=e.lng,o=e.lat,i=t&&void 0!==t.pointerDistance?t.pointerDistance:30,r=!t||void 0===t.ignoreSelectFeatures||t.ignoreSelectFeatures,a=this._adapter.unproject.bind(this._adapter),s=this._adapter.project.bind(this._adapter),l=s(n,o),c=Li({unproject:a,point:l,pointerDistance:i});return this._store.search(c).filter((function(e){if(r&&(e.properties[Jo]||e.properties[Qo]))return!1;if("Point"===e.geometry.type){var t=e.geometry.coordinates,a=s(t[0],t[1]);return _i(l,a)<i}if("LineString"===e.geometry.type){for(var c=e.geometry.coordinates,u=0;u<c.length-1;u++){var d=c[u],h=c[u+1];if(xr(l,s(d[0],d[1]),s(h[0],h[1]))<i)return!0}return!1}return!!br([n,o],e.geometry.coordinates)||void 0}))}},{key:"getSelectMode",value:function(){if(this.checkEnabled(),!this._instanceSelectMode)throw new Error("No select mode defined in instance");return this.getMode()!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}},{key:"setModeStyles",value:function(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=t}},{key:"updateModeOptions",value:function(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(t)}},{key:"getSnapshot",value:function(){return this._store.copyAll()}},{key:"getSnapshotFeature",value:function(e){if(this._store.has(e))return this._store.copy(e)}},{key:"clear",value:function(){this.checkEnabled(),this._adapter.clear()}},{key:"enabled",get:function(){return this._enabled},set:function(e){throw new Error("Enabled is read only")}},{key:"getMode",value:function(){return this._mode.mode}},{key:"setMode",value:function(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}},{key:"removeFeatures",value:function(e){this.checkEnabled(),this._store.delete(e)}},{key:"selectFeature",value:function(e){this.getSelectMode().selectFeature(e)}},{key:"deselectFeature",value:function(e){this.getSelectMode().deselectFeature(e)}},{key:"getFeatureId",value:function(){return this._store.getId()}},{key:"hasFeature",value:function(e){return this._store.has(e)}},{key:"addFeatures",value:function(e){var t=this;return this.checkEnabled(),0===e.length?[]:this._store.load(e,(function(e){if(function(e){return Boolean(e&&"object"==w(e)&&"properties"in e&&"object"==w(e.properties)&&null!==e.properties&&"mode"in e.properties)}(e)){var n=e.properties.mode,o=t._modes[n];if(!o)return{id:e.id,valid:!1,reason:"".concat(n," mode is not in the list of instantiated modes")};var i=o.validateFeature.bind(o)(e);return{id:e.id,valid:i.valid,reason:i.reason?i.reason:i.valid?void 0:"Feature is invalid"}}return{id:e.id,valid:!1,reason:"Mode property does not exist"}}))}},{key:"start",value:function(){var e=this;this._enabled=!0,this._adapter.register({onReady:function(){e._eventListeners.ready.forEach((function(e){e()}))},getState:function(){return e._mode.state},onClick:function(t){e._mode.onClick(t)},onMouseMove:function(t){e._mode.onMouseMove(t)},onKeyDown:function(t){e._mode.onKeyDown(t)},onKeyUp:function(t){e._mode.onKeyUp(t)},onDragStart:function(t,n){e._mode.onDragStart(t,n)},onDrag:function(t,n){e._mode.onDrag(t,n)},onDragEnd:function(t,n){e._mode.onDragEnd(t,n)},onClear:function(){e._mode.cleanUp(),e._store.clear()}})}},{key:"getFeaturesAtLngLat",value:function(e,t){var n=e.lng,o=e.lat;return this.featuresAtLocation({lng:n,lat:o},t)}},{key:"getFeaturesAtPointerEvent",value:function(e,t){var n=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return null===n?[]:this.featuresAtLocation(n,t)}},{key:"stop",value:function(){this._enabled=!1,this._adapter.unregister()}},{key:"on",value:function(e,t){var n=this._eventListeners[e];n.includes(t)||n.push(t)}},{key:"off",value:function(e,t){var n=this._eventListeners[e];n.includes(t)&&n.splice(n.indexOf(t),1)}}])}();function na(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9,n=Math.pow(10,t);return Math.round(e*n)/n}(Kr=qr||(qr={})).Commit="commit",Kr.Provisional="provisional",Kr.Finish="finish",function(e){e.Drawing="drawing",e.Select="select",e.Static="static",e.Render="render"}(Zr||(Zr={}));var oa=u((function e(t){var n=this,o=t.name,i=t.callback,r=t.unregister,a=t.register;l(this,e),this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=o,this.register=function(){n.registered||(n.registered=!0,a(i))},this.unregister=function(){n.register&&(n.registered=!1,r(i))},this.callback=i})),ia=function(){return u((function e(t){l(this,e),this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance="number"==typeof t.minPixelDragDistance?t.minPixelDragDistance:1,this._minPixelDragDistanceSelecting="number"==typeof t.minPixelDragDistanceSelecting?t.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing="number"==typeof t.minPixelDragDistanceDrawing?t.minPixelDragDistanceDrawing:8,this._coordinatePrecision="number"==typeof t.coordinatePrecision?t.coordinatePrecision:9}),[{key:"getButton",value:function(e){return-1===e.button?"neither":0===e.button?"left":1===e.button?"middle":2===e.button?"right":"neither"}},{key:"getMapElementXYPosition",value:function(e){var t=this.getMapEventElement().getBoundingClientRect(),n=t.left,o=t.top;return{containerX:e.clientX-n,containerY:e.clientY-o}}},{key:"getDrawEventFromEvent",value:function(e){var t=this.getLngLatFromEvent(e);if(!t)return null;var n=t.lng,o=t.lat,i=this.getMapElementXYPosition(e),r=i.containerX,a=i.containerY,s=this.getButton(e),l=Array.from(this._heldKeys);return{lng:na(n,this._coordinatePrecision),lat:na(o,this._coordinatePrecision),containerX:r,containerY:a,button:s,heldKeys:l}}},{key:"register",value:function(e){this._currentModeCallbacks=e,this._listeners=this.getAdapterListeners(),this._listeners.forEach((function(e){e.register()}))}},{key:"getCoordinatePrecision",value:function(){return this._coordinatePrecision}},{key:"getAdapterListeners",value:function(){var e=this;return[new oa({name:"pointerdown",callback:function(t){if(e._currentModeCallbacks&&t.isPrimary){var n=e.getDrawEventFromEvent(t);n&&(e._dragState="pre-dragging",e._lastDrawEvent=n)}},register:function(t){e.getMapEventElement().addEventListener("pointerdown",t)},unregister:function(t){e.getMapEventElement().removeEventListener("pointerdown",t)}}),new oa({name:"pointermove",callback:function(t){if(e._currentModeCallbacks&&t.isPrimary){t.preventDefault();var n=e.getDrawEventFromEvent(t);if(n)if("not-dragging"===e._dragState)e._currentModeCallbacks.onMouseMove(n),e._lastDrawEvent=n;else if("pre-dragging"===e._dragState){if(!e._lastDrawEvent)return;var o={x:e._lastDrawEvent.containerX,y:e._lastDrawEvent.containerY},i={x:n.containerX,y:n.containerY},r=e._currentModeCallbacks.getState(),a=function(e,t){var n=t.x-e.x,o=t.y-e.y;return Math.sqrt(o*o+n*n)}(o,i);if("drawing"===r?a<e._minPixelDragDistanceDrawing:"selecting"===r?a<e._minPixelDragDistanceSelecting:a<e._minPixelDragDistance)return;e._dragState="dragging",e._currentModeCallbacks.onDragStart(n,(function(t){e.setDraggability.bind(e)(t)}))}else"dragging"===e._dragState&&e._currentModeCallbacks.onDrag(n,(function(t){e.setDraggability.bind(e)(t)}))}},register:function(t){e.getMapEventElement().addEventListener("pointermove",t)},unregister:function(t){e.getMapEventElement().removeEventListener("pointermove",t)}}),new oa({name:"contextmenu",callback:function(t){e._currentModeCallbacks&&t.preventDefault()},register:function(t){e.getMapEventElement().addEventListener("contextmenu",t)},unregister:function(t){e.getMapEventElement().removeEventListener("contextmenu",t)}}),new oa({name:"pointerup",callback:function(t){if(e._currentModeCallbacks&&t.target===e.getMapEventElement()&&t.isPrimary){var n=e.getDrawEventFromEvent(t);n&&("dragging"===e._dragState?e._currentModeCallbacks.onDragEnd(n,(function(t){e.setDraggability.bind(e)(t)})):"not-dragging"!==e._dragState&&"pre-dragging"!==e._dragState||e._currentModeCallbacks.onClick(n),e._dragState="not-dragging",e.setDraggability(!0))}},register:function(t){e.getMapEventElement().addEventListener("pointerup",t)},unregister:function(t){e.getMapEventElement().removeEventListener("pointerup",t)}}),new oa({name:"keyup",callback:function(t){e._currentModeCallbacks&&(e._heldKeys.delete(t.key),e._currentModeCallbacks.onKeyUp({key:t.key,heldKeys:Array.from(e._heldKeys),preventDefault:function(){return t.preventDefault()}}))},register:function(t){e.getMapEventElement().addEventListener("keyup",t)},unregister:function(t){e.getMapEventElement().removeEventListener("keyup",t)}}),new oa({name:"keydown",callback:function(t){e._currentModeCallbacks&&(e._heldKeys.add(t.key),e._currentModeCallbacks.onKeyDown({key:t.key,heldKeys:Array.from(e._heldKeys),preventDefault:function(){return t.preventDefault()}}))},register:function(t){e.getMapEventElement().addEventListener("keydown",t)},unregister:function(t){e.getMapEventElement().removeEventListener("keydown",t)}})]}},{key:"unregister",value:function(){this._listeners.forEach((function(e){e.unregister()})),this.clear()}}])}(),ra=function(n){function i(e){var t;return l(this,i),(t=o(this,i,[e]))._nextRender=void 0,t._map=void 0,t._container=void 0,t._rendered=!1,t.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},t._map=e.map,t._container=t._map.getContainer(),t}return a(i,n),u(i,[{key:"clearLayers",value:function(){var e=this;this._rendered&&(["point","linestring","polygon"].forEach((function(t){var n="td-".concat(t.toLowerCase());e._map.removeLayer(n),"polygon"===t&&e._map.removeLayer(n+"-outline"),e._map.removeSource(n)})),this._rendered=!1,this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0))}},{key:"_addGeoJSONSource",value:function(e,t){this._map.addSource(e,{type:"geojson",data:{type:"FeatureCollection",features:t},tolerance:0})}},{key:"_addFillLayer",value:function(e){return this._map.addLayer({id:e,source:e,type:"fill",paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})}},{key:"_addFillOutlineLayer",value:function(e){return this._map.addLayer({id:e+"-outline",source:e,type:"line",paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})}},{key:"_addLineLayer",value:function(e){return this._map.addLayer({id:e,source:e,type:"line",paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})}},{key:"_addPointLayer",value:function(e){return this._map.addLayer({id:e,source:e,type:"circle",paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})}},{key:"_addLayer",value:function(e,t){"Point"===t&&this._addPointLayer(e),"LineString"===t&&this._addLineLayer(e),"Polygon"===t&&(this._addFillLayer(e),this._addFillOutlineLayer(e))}},{key:"_addGeoJSONLayer",value:function(e,t){var n="td-".concat(e.toLowerCase());return this._addGeoJSONSource(n,t),this._addLayer(n,e),n}},{key:"_setGeoJSONLayerData",value:function(e,t){var n="td-".concat(e.toLowerCase());return this._map.getSource(n).setData({type:"FeatureCollection",features:t}),n}},{key:"updateChangedIds",value:function(t){var n=this;[].concat(e(t.updated),e(t.created)).forEach((function(e){"Point"===e.geometry.type?n.changedIds.points=!0:"LineString"===e.geometry.type?n.changedIds.linestrings=!0:"Polygon"===e.geometry.type&&(n.changedIds.polygons=!0)})),t.deletedIds.length>0&&(this.changedIds.deletion=!0),0===t.created.length&&0===t.updated.length&&0===t.deletedIds.length&&(this.changedIds.styling=!0)}},{key:"getLngLatFromEvent",value:function(e){var t=this._container.getBoundingClientRect(),n=t.left,o=t.top;return this.unproject(e.clientX-n,e.clientY-o)}},{key:"getMapEventElement",value:function(){return this._map.getCanvas()}},{key:"setDraggability",value:function(e){e?(this._map.dragRotate.enable(),this._map.dragPan.enable()):(this._map.dragRotate.disable(),this._map.dragPan.disable())}},{key:"project",value:function(e,t){var n=this._map.project({lng:e,lat:t});return{x:n.x,y:n.y}}},{key:"unproject",value:function(e,t){var n=this._map.unproject({x:e,y:t});return{lng:n.lng,lat:n.lat}}},{key:"setCursor",value:function(e){var t=this._map.getCanvas();"unset"===e?t.style.removeProperty("cursor"):t.style.cursor=e}},{key:"setDoubleClickToZoom",value:function(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}},{key:"render",value:function(t,n){var o=this;this.updateChangedIds(t),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame((function(){for(var i=[].concat(e(t.created),e(t.updated),e(t.unchanged)),r=[],a=[],s=[],l=0;l<i.length;l++){var c=i[l],u=c.properties,d=n[u.mode](c);"Point"===c.geometry.type?(u.pointColor=d.pointColor,u.pointOutlineColor=d.pointOutlineColor,u.pointOutlineWidth=d.pointOutlineWidth,u.pointWidth=d.pointWidth,r.push(c)):"LineString"===c.geometry.type?(u.lineStringColor=d.lineStringColor,u.lineStringWidth=d.lineStringWidth,a.push(c)):"Polygon"===c.geometry.type&&(u.polygonFillColor=d.polygonFillColor,u.polygonFillOpacity=d.polygonFillOpacity,u.polygonOutlineColor=d.polygonOutlineColor,u.polygonOutlineWidth=d.polygonOutlineWidth,s.push(c))}if(o._rendered){var h,p=o.changedIds.deletion||o.changedIds.styling,f=p||o.changedIds.linestrings,g=p||o.changedIds.polygons;(p||o.changedIds.points)&&(h=o._setGeoJSONLayerData("Point",r)),f&&o._setGeoJSONLayerData("LineString",a),g&&o._setGeoJSONLayerData("Polygon",s),h&&o._map.moveLayer(h)}else{var v=o._addGeoJSONLayer("Point",r);o._addGeoJSONLayer("LineString",a),o._addGeoJSONLayer("Polygon",s),o._rendered=!0,v&&o._map.moveLayer(v)}o.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}}))}},{key:"clear",value:function(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())}},{key:"getCoordinatePrecision",value:function(){return t(i,"getCoordinatePrecision",this,3)([])}},{key:"unregister",value:function(){return t(i,"unregister",this,3)([])}},{key:"register",value:function(e){var n;t(i,"register",this,3)([e]),null!=(n=this._currentModeCallbacks)&&n.onReady&&this._currentModeCallbacks.onReady()}}])}(ia),aa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},sa=F({name:"Backspace",render:function(e,t){return st(),at("svg",aa,t[0]||(t[0]=[lt("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[lt("path",{d:"M20 6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H9l-5-5a1.5 1.5 0 0 1 0-2l5-5z"}),lt("path",{d:"M12 10l4 4m0-4l-4 4"})],-1)]))}}),la={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ca=F({name:"Circle",render:function(e,t){return st(),at("svg",la,t[0]||(t[0]=[lt("circle",{cx:"12",cy:"12",r:"9",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),ua={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},da=F({name:"DeviceFloppy",render:function(e,t){return st(),at("svg",ua,t[0]||(t[0]=[lt("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[lt("path",{d:"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"}),lt("circle",{cx:"12",cy:"14",r:"2"}),lt("path",{d:"M14 4v4H8V4"})],-1)]))}}),ha={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},pa=F({name:"HandFinger",render:function(e,t){return st(),at("svg",ha,t[0]||(t[0]=[ct('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 1 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7A69.74 69.74 0 0 1 7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path></g>',1)]))}}),fa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ga=F({name:"HandMove",render:function(e,t){return st(),at("svg",fa,t[0]||(t[0]=[ct('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 0 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7L7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path><path d="M2.541 5.594a13.487 13.487 0 0 1 2.46-1.427"></path><path d="M14 3.458a13.44 13.44 0 0 1 3.685 1.612"></path></g>',1)]))}}),va={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ya=F({name:"Line",render:function(e,t){return st(),at("svg",va,t[0]||(t[0]=[lt("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[lt("circle",{cx:"6",cy:"18",r:"2"}),lt("circle",{cx:"18",cy:"6",r:"2"}),lt("path",{d:"M7.5 16.5l9-9"})],-1)]))}}),ma={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ba=F({name:"MapPin",render:function(e,t){return st(),at("svg",ma,t[0]||(t[0]=[lt("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[lt("circle",{cx:"12",cy:"11",r:"3"}),lt("path",{d:"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"})],-1)]))}}),xa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ca=F({name:"PlayerRecord",render:function(e,t){return st(),at("svg",xa,t[0]||(t[0]=[lt("circle",{cx:"12",cy:"12",r:"7",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),wa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ka=F({name:"Polygon",render:function(e,t){return st(),at("svg",wa,t[0]||(t[0]=[ct('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="2"></circle><circle cx="19" cy="8" r="2"></circle><circle cx="5" cy="11" r="2"></circle><circle cx="15" cy="19" r="2"></circle><path d="M6.5 9.5l3.5-3"></path><path d="M14 5.5L17 7"></path><path d="M18.5 10L16 17"></path><path d="M13.5 17.5l-7-5"></path></g>',1)]))}}),Pa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Sa=F({name:"Square",render:function(e,t){return st(),at("svg",Pa,t[0]||(t[0]=[lt("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),Ma={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ia=F({name:"Upload",render:function(e,t){return st(),at("svg",Ma,t[0]||(t[0]=[lt("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[lt("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),lt("path",{d:"M7 9l5-5l5 5"}),lt("path",{d:"M12 4v12"})],-1)]))}}),Oa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Fa=F({name:"Vector",render:function(e,t){return st(),at("svg",Oa,t[0]||(t[0]=[ct('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="17" width="4" height="4" rx="1"></rect><rect x="3" y="17" width="4" height="4" rx="1"></rect><path d="M5 7v10"></path><path d="M19 7v10"></path><path d="M7 5h10"></path><path d="M7 19h10"></path></g>',1)]))}}),_a={size:[String,Number],color:String,tag:String},Da=Symbol("IconConfigInjection"),Ba=F({name:"Icon",props:_a,setup:function(e,t){var n=t.slots,o=M(Da,null),i=S((function(){var t,n=null!==(t=e.size)&&void 0!==t?t:null==o?void 0:o.size;if(void 0!==n)return"number"==typeof n||/^\d+$/.test(n)?"".concat(n,"px"):n})),r=S((function(){var t=e.color;return void 0===t?o?o.color:void 0:t})),a=S((function(){var t,n=e.tag;return void 0===n?null!==(t=null==o?void 0:o.tag)&&void 0!==t?t:"span":n}));return y((function(){ut()})),function(){return _(a.value,{class:"xicon",style:{color:r.value,fontSize:i.value}},[dt(n,"default")])}}});function Ea(){return ht.fromPromise(new Promise((function(e,t){navigator.geolocation.getCurrentPosition(e,t)})),(function(e){return e}))}function ja(e,t,n){var o=new Blob([e],{type:t}),i=document.createElement("a");i.download=n,i.href=URL.createObjectURL(o),i.dataset.downloadurl=[t,i.download,i.href].join(":"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i),setTimeout((function(){URL.revokeObjectURL(i.href)}),1500)}var Ra={class:"flex-col justify-center items-center gap-4 w-full"},La={class:"flex justify-end gap-4"},za=F({__name:"TextFileUploaderDialog",props:pt({multiple:{type:Boolean},icon:{},prompt:{},types:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:pt(["update:value","confirm"],["update:show"]),setup:function(e,t){var n=t.emit,o=En(),i=e,r=n,a=ft(e,"show"),s=[],l=function(){r("confirm",s),a.value=!1},c=function(e){var t,n,r,a;return!!i.types.includes(null!==(t=null===(n=e.file.file)||void 0===n?void 0:n.type)&&void 0!==t?t:"")||(o.error("Unsupported file type ".concat(null!==(r=null===(a=e.file.file)||void 0===a?void 0:a.type)&&void 0!==r?r:"unknown",". Supported types: ['").concat(i.types.join("', '"),"']")),!1)};return function(e,t){return st(),gt(yt(Bn),{show:a.value,"onUpdate:show":t[2]||(t[2]=function(e){return a.value=e}),preset:"dialog",title:"Dialog"},{header:vt((function(){return t[3]||(t[3]=[bt(" File Upload ")])})),default:vt((function(){var e;return[lt("div",Ra,[mt(yt(go),{multiple:null!==(e=i.multiple)&&void 0!==e&&e,onChange:t[0]||(t[0]=function(e){return function(e){s=[];var t,n=v(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,l=a.file;if(l)if(i.types.includes(l.type)){var c=new FileReader;c.onload=function(t){var n;null!==(n=t.target)&&void 0!==n&&n.result&&s.push(t.target.result),s.length===e.length&&r("update:value",s)},c.readAsText(l)}else o.warning("Skipped file ".concat(a.name," due to unsupported type ").concat(l.type))}}catch(u){n.e(u)}finally{n.f()}}(e.fileList)}),onBeforeUpload:c},{default:vt((function(){return[mt(yt(Xn),null,{default:vt((function(){var e;return[mt(yt(Ba),{size:36,name:"upload",class:"opacity-50"},{default:vt((function(){var e;return[(st(),gt(xt(null!==(e=i.icon)&&void 0!==e?e:yt(Ia))))]})),_:1}),lt("div",null,Ct(null!==(e=i.prompt)&&void 0!==e?e:"Drag and drop a file here or click to upload"),1)]})),_:1})]})),_:1},8,["multiple"])])]})),action:vt((function(){return[lt("div",La,[mt(yt(bn),{onClick:t[1]||(t[1]=function(e){return a.value=!1})},{default:vt((function(){return t[4]||(t[4]=[bt("Cancel")])})),_:1}),mt(yt(bn),{type:"primary",onClick:l},{default:vt((function(){return t[5]||(t[5]=[bt("Upload")])})),_:1})])]})),_:1},8,["show"])}}}),Ta=["title","onClick"],Na=["title"];n("default",F({__name:"TrackerView",setup:function(e){c([0,0]);var t=c(7),n="https://api.maptiler.com/maps/basic-v2/style.json?key=".concat("dCeXFrS9lgSF8hm5C6nm"),o=c({latitude:0,longitude:0}),i=c(null),r=c(null),a=c("select"),s=c(!1),l=c([]),u=c(!1),d=En(),p=S((function(){return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:l.value.map((function(e){return[e.longitude,e.latitude]}))}}]}})),f=[{mode:new dr,name:"TerraDraw: Rectangle",icon:Fa},{mode:new ir,name:"TerraDraw: Point",icon:ba},{mode:new lr,name:"TerraDraw: Polygon",icon:ka},{mode:new Fi,name:"TerraDraw: Circle",icon:ca},{mode:new nr,name:"TerraDraw: Line String",icon:ya},{mode:new Br({allowManualDeselection:!0,flags:{point:{feature:{draggable:!0}},polygon:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},linestring:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},freehand:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},circle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},rectangle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}}}}),name:"TerraDraw: Select",icon:pa},{mode:new ji,name:"TerraDraw: Free Hand",icon:ga}],g=void 0;function v(e){i.value=e.map,r.value=new ta({adapter:new ra({map:i.value}),modes:f.map((function(e){return e.mode}))}),r.value.start()}function y(){s.value=!s.value,s.value?g=window.setInterval(h(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ea().map((function(e){return{latitude:e.coords.latitude,longitude:e.coords.longitude}}));case 2:e.sent.match((function(e){return l.value.push(e)}),(function(){window.clearInterval(g),s.value=!1,d.error("Fail to record the path")}));case 4:case"end":return e.stop()}}),e)}))),1e3):(window.clearInterval(g),s.value=!1,St("stored-path",JSON.parse(JSON.stringify(l.value))))}function m(){return x.apply(this,arguments)}function x(){return(x=h(b().mark((function e(){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ja(JSON.stringify(p.value),"application/json","tracked-path-export");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=c(function(){var e=h(b().mark((function e(t){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());function w(){new Promise(function(){var e=h(b().mark((function e(t,n){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C.value=function(){var e=h(b().mark((function e(o){return b().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:0===o.length?n(new Error("No file selected")):t(o);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u.value=!0;case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()).then((function(e){l.value=JSON.parse(e[0]).features[0].geometry.coordinates.map((function(e){return{latitude:e[1],longitude:e[0]}})),St("stored-path",JSON.parse(JSON.stringify(l.value)))})).catch((function(e){d.error(e)}))}return k((function(){var e;Ea().map((function(e){o.value.latitude=e.coords.latitude,o.value.longitude=e.coords.longitude})),wt().then((function(){return kt("stored-path").then((function(e){return e.map((function(e){e&&0!==e.length&&(l.value=JSON.parse(JSON.stringify(e)),console.info("Recovered the tracked path from store"))}))}))})),null===(e=r.value)||void 0===e||e.start()})),function(e,i){return st(),at(Ke,null,[mt(yt(Ft),{class:"map-layout","content-style":"padding: 0;"},{default:vt((function(){return[mt(yt(_o),{"map-style":n,center:[o.value.longitude,o.value.latitude],zoom:t.value,height:"100%","onMap:load":v},{default:vt((function(){return[mt(yt(Lo),{position:"top-left"}),mt(yt(Ro),{position:"top-left","track-user-location":!0}),mt(yt(jo),{position:"top-left"}),mt(yt(No),{position:"bottom-left"}),mt(yt(Eo),{position:"top-right"},{default:vt((function(){return[(st(),at(Ke,null,Pt(f,(function(e){return lt("button",{key:e.name,class:Oe(["!flex justify-center items-center",e.mode.mode===a.value?"!bg-blue-200 rounded-sm transition-colors":""]),title:e.name,onClick:function(){var t,n,o;(console.log("activeDrawMethod",a.value),a.value===e.mode.mode)?(null===(t=r.value)||void 0===t||t.setMode("select"),a.value="select"):(a.value=e.mode.mode,null===(n=r.value)||void 0===n||n.start(),null===(o=r.value)||void 0===o||o.setMode(e.mode.mode))}},[mt(yt(Ba),{size:20},{default:vt((function(){return[(st(),gt(xt(e.icon),{class:"stroke-stone-800 text-stone-800"}))]})),_:2},1024)],10,Ta)})),64))]})),_:1}),mt(yt(Eo),{position:"top-right"},{default:vt((function(){return[lt("button",{class:Oe(["!flex justify-center items-center transition-all hover:rounded-sm",s.value?"hover:!bg-red-700 hover:stroke-white hover:text-white stroke-red-700 fill-red-600 text-red-700":"stroke-sky-800 fill-sky-700 text-sky-800"]),title:s.value?"Recording…":"Track Recorder",onClick:y},[mt(yt(Ba),{size:20},{default:vt((function(){return[(st(),gt(xt(s.value?yt(Sa):yt(Ca)),{size:s.value?16:20,class:"stroke-inherit text-inherit"},null,8,["size"]))]})),_:1})],10,Na),l.value.length>0&&!s.value?(st(),at("button",{key:0,class:"stroke-red-700 text-red-700 hover:!bg-red-700 hover:stroke-white hover:text-white hover:rounded-sm transition-all !flex justify-center items-center",onClick:i[0]||(i[0]=function(e){return l.value=[]})},[mt(yt(Ba),{size:20},{default:vt((function(){return[mt(yt(sa),{class:"stroke-inherit text-inherit",style:{transform:"translateX(-1.3px)"},size:"20"})]})),_:1})])):ot("",!0),l.value.length>0&&!s.value?(st(),at("button",{key:1,class:"!flex justify-center items-center",onClick:m},[mt(yt(Ba),{size:20},{default:vt((function(){return[mt(yt(da),{class:"stroke-stone-800 text-stone-800",size:"20"})]})),_:1})])):ot("",!0),0!==l.value.length||s.value?ot("",!0):(st(),at("button",{key:2,class:"!flex justify-center items-center",onClick:w},[mt(yt(Ba),{size:20},{default:vt((function(){return[mt(yt(Ia),{class:"stroke-stone-800 text-stone-800",size:"20"})]})),_:1})]))]})),_:1}),mt(yt(Go),{"source-id":"geojson",data:p.value},{default:vt((function(){return[mt(yt(Ko),{"layer-id":"geojson",layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":5,"line-dasharray":[5,2],"line-color":"#008800","line-opacity":.8}})]})),_:1},8,["data"])]})),_:1},8,["center","zoom"])]})),_:1}),mt(za,{show:u.value,"onUpdate:show":i[1]||(i[1]=function(e){return u.value=e}),types:["application/json","text/plain"],onConfirm:yt(C)},null,8,["show","onConfirm"])],64)}}}))}}}))}();
