import{i as uo,r as It,a as j,o as Pe,h as ho,b as Rt,c as he,d as kt,e as ni,w as N,f as D,g as K,j as jt,p as ce,k as _,l as g,m as Tt,n as E,q as rn,s as M,u as sn,t as G,v as Re,x as po,y as R,z as Ci,A as O,B as go,C as it,N as ri,D as an,E as fo,F as ln,G as mo,H as at,I as ye,J as dn,K as yo,L as B,M as ft,O as lt,P as Be,Q as vo,R as cn,S as un,T as ue,U as Le,V as Xt,W as hn,X as pn,Y as gn,Z as si,_ as ai,$ as li,a0 as Mt,a1 as fn,a2 as mn,a3 as bo,a4 as yn,a5 as vn,a6 as Kt,a7 as bn,a8 as Cn,a9 as Co,aa as xi,ab as xn,ac as Yt,ad as Ft,ae as xo,af as wn,ag as Pn,ah as Sn,ai as In,aj as kn,ak as Mn,al as Fn,am as _n,an as Dn,ao as On,ap as Bn,aq as dt,ar as En,as as ze,at as Rn,au as wi,av as Pi,aw as jn,ax as wo,ay as qt,az as Tn,aA as Ln,aB as Si,aC as Ii,aD as Po,aE as Zt,aF as je,aG as Ee,aH as zn,aI as $n,aJ as re,aK as te,aL as Y,aM as Lt,aN as Nn,aO as Wn,aP as Un,aQ as ki,aR as An,aS as _t,aT as oe,aU as A,aV as q,aW as Wt,aX as Jt,aY as Gn,aZ as Hn,a_ as Vn,a$ as Xn,b0 as Mi}from"./index-DHMZR15e.js";import{i as He,c as Fi,a as Kn,N as So,b as Yn,d as qn,D as Zn,e as Jn,f as Qn}from"./Image-DV2WrsZP.js";const Qe=j(null);function _i(i){if(i.clientX>0||i.clientY>0)Qe.value={x:i.clientX,y:i.clientY};else{const{target:e}=i;if(e instanceof Element){const{left:t,top:o,width:n,height:r}=e.getBoundingClientRect();t>0||o>0?Qe.value={x:t+n/2,y:o+r/2}:Qe.value={x:0,y:0}}else Qe.value=null}}let mt=0,Di=!0;function er(){if(!uo)return It(j(null));mt===0&&Pe("click",document,_i,!0);const i=()=>{mt+=1};return Di&&(Di=ho())?(Rt(i),he(()=>{mt-=1,mt===0&&kt("click",document,_i,!0)})):i(),It(Qe)}const tr=j(void 0);let yt=0;function Oi(){tr.value=Date.now()}let Bi=!0;function ir(i){if(!uo)return It(j(!1));const e=j(!1);let t=null;function o(){t!==null&&window.clearTimeout(t)}function n(){o(),e.value=!0,t=window.setTimeout(()=>{e.value=!1},i)}yt===0&&Pe("click",window,Oi,!0);const r=()=>{yt+=1,Pe("click",window,n,!0)};return Bi&&(Bi=ho())?(Rt(r),he(()=>{yt-=1,yt===0&&kt("click",window,Oi,!0),kt("click",window,n,!0),o()})):r(),It(e)}const di=j(!1);function Ei(){di.value=!0}function Ri(){di.value=!1}let Ze=0;function or(){return He&&(Rt(()=>{Ze||(window.addEventListener("compositionstart",Ei),window.addEventListener("compositionend",Ri)),Ze++}),he(()=>{Ze<=1?(window.removeEventListener("compositionstart",Ei),window.removeEventListener("compositionend",Ri),Ze=0):Ze--})),di}let $e=0,ji="",Ti="",Li="",zi="";const $i=j("0px");function nr(i){if(typeof document>"u")return;const e=document.documentElement;let t,o=!1;const n=()=>{e.style.marginRight=ji,e.style.overflow=Ti,e.style.overflowX=Li,e.style.overflowY=zi,$i.value="0px"};ni(()=>{t=N(i,r=>{if(r){if(!$e){const s=window.innerWidth-e.offsetWidth;s>0&&(ji=e.style.marginRight,e.style.marginRight="".concat(s,"px"),$i.value="".concat(s,"px")),Ti=e.style.overflow,Li=e.style.overflowX,zi=e.style.overflowY,e.style.overflow="hidden",e.style.overflowX="hidden",e.style.overflowY="hidden"}o=!0,$e++}else $e--,$e||n(),o=!1},{immediate:!0})}),he(()=>{t==null||t(),o&&($e--,$e||n(),o=!1)})}const rr=new WeakSet;function sr(i){return!rr.has(i)}const Ni=jt("n-form-item");function Io(i,{defaultSize:e="medium",mergedSize:t,mergedDisabled:o}={}){const n=K(Ni,null);ce(Ni,null);const r=D(t?()=>t(n):()=>{const{size:l}=i;if(l)return l;if(n){const{mergedSize:c}=n;if(c.value!==void 0)return c.value}return e}),s=D(o?()=>o(n):()=>{const{disabled:l}=i;return l!==void 0?l:n?n.disabled.value:!1}),a=D(()=>{const{status:l}=i;return l||(n==null?void 0:n.mergedValidationStatus.value)});return he(()=>{n&&n.restoreValidation()}),{mergedSizeRef:r,mergedDisabledRef:s,mergedStatusRef:a,nTriggerFormBlur(){n&&n.handleContentBlur()},nTriggerFormChange(){n&&n.handleContentChange()},nTriggerFormFocus(){n&&n.handleContentFocus()},nTriggerFormInput(){n&&n.handleContentInput()}}}const ar=_({name:"Add",render(){return g("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},g("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),lr=Tt("attach",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),dr=Tt("cancel",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),cr=_({name:"Eye",render(){return g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),g("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),ur=Tt("retry",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),g("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),hr=Tt("trash",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),{cubicBezierEaseInOut:we}=rn;function pr({duration:i=".2s",delay:e=".1s"}={}){return[E("&.fade-in-width-expand-transition-leave-from, &.fade-in-width-expand-transition-enter-to",{opacity:1}),E("&.fade-in-width-expand-transition-leave-to, &.fade-in-width-expand-transition-enter-from","\n opacity: 0!important;\n margin-left: 0!important;\n margin-right: 0!important;\n "),E("&.fade-in-width-expand-transition-leave-active","\n overflow: hidden;\n transition:\n opacity ".concat(i," ").concat(we,",\n max-width ").concat(i," ").concat(we," ").concat(e,",\n margin-left ").concat(i," ").concat(we," ").concat(e,",\n margin-right ").concat(i," ").concat(we," ").concat(e,";\n ")),E("&.fade-in-width-expand-transition-enter-active","\n overflow: hidden;\n transition:\n opacity ".concat(i," ").concat(we," ").concat(e,",\n max-width ").concat(i," ").concat(we,",\n margin-left ").concat(i," ").concat(we,",\n margin-right ").concat(i," ").concat(we,";\n "))]}const gr=M("base-wave","\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n"),fr=_({name:"BaseWave",props:{clsPrefix:{type:String,required:!0}},setup(i){sn("-base-wave",gr,G(i,"clsPrefix"));const e=j(null),t=j(!1);let o=null;return he(()=>{o!==null&&window.clearTimeout(o)}),{active:t,selfRef:e,play(){o!==null&&(window.clearTimeout(o),t.value=!1,o=null),Re(()=>{var n;(n=e.value)===null||n===void 0||n.offsetHeight,t.value=!0,o=window.setTimeout(()=>{t.value=!1,o=null},1e3)})}}},render(){const{clsPrefix:i}=this;return g("div",{ref:"selfRef","aria-hidden":!0,class:["".concat(i,"-base-wave"),this.active&&"".concat(i,"-base-wave--active")]})}}),mr=He&&"chrome"in window;He&&navigator.userAgent.includes("Firefox");const yr=He&&navigator.userAgent.includes("Safari")&&!mr;function _e(i){return po(i,[255,255,255,.16])}function vt(i){return po(i,[0,0,0,.12])}const vr=jt("n-button-group"),br=E([M("button","\n margin: 0;\n font-weight: var(--n-font-weight);\n line-height: 1;\n font-family: inherit;\n padding: var(--n-padding);\n height: var(--n-height);\n font-size: var(--n-font-size);\n border-radius: var(--n-border-radius);\n color: var(--n-text-color);\n background-color: var(--n-color);\n width: var(--n-width);\n white-space: nowrap;\n outline: none;\n position: relative;\n z-index: auto;\n border: none;\n display: inline-flex;\n flex-wrap: nowrap;\n flex-shrink: 0;\n align-items: center;\n justify-content: center;\n user-select: none;\n -webkit-user-select: none;\n text-align: center;\n cursor: pointer;\n text-decoration: none;\n transition:\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n ",[R("color",[O("border",{borderColor:"var(--n-border-color)"}),R("disabled",[O("border",{borderColor:"var(--n-border-color-disabled)"})]),Ci("disabled",[E("&:focus",[O("state-border",{borderColor:"var(--n-border-color-focus)"})]),E("&:hover",[O("state-border",{borderColor:"var(--n-border-color-hover)"})]),E("&:active",[O("state-border",{borderColor:"var(--n-border-color-pressed)"})]),R("pressed",[O("state-border",{borderColor:"var(--n-border-color-pressed)"})])])]),R("disabled",{backgroundColor:"var(--n-color-disabled)",color:"var(--n-text-color-disabled)"},[O("border",{border:"var(--n-border-disabled)"})]),Ci("disabled",[E("&:focus",{backgroundColor:"var(--n-color-focus)",color:"var(--n-text-color-focus)"},[O("state-border",{border:"var(--n-border-focus)"})]),E("&:hover",{backgroundColor:"var(--n-color-hover)",color:"var(--n-text-color-hover)"},[O("state-border",{border:"var(--n-border-hover)"})]),E("&:active",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[O("state-border",{border:"var(--n-border-pressed)"})]),R("pressed",{backgroundColor:"var(--n-color-pressed)",color:"var(--n-text-color-pressed)"},[O("state-border",{border:"var(--n-border-pressed)"})])]),R("loading","cursor: wait;"),M("base-wave","\n pointer-events: none;\n top: 0;\n right: 0;\n bottom: 0;\n left: 0;\n animation-iteration-count: 1;\n animation-duration: var(--n-ripple-duration);\n animation-timing-function: var(--n-bezier-ease-out), var(--n-bezier-ease-out);\n ",[R("active",{zIndex:1,animationName:"button-wave-spread, button-wave-opacity"})]),He&&"MozBoxSizing"in document.createElement("div").style?E("&::moz-focus-inner",{border:0}):null,O("border, state-border","\n position: absolute;\n left: 0;\n top: 0;\n right: 0;\n bottom: 0;\n border-radius: inherit;\n transition: border-color .3s var(--n-bezier);\n pointer-events: none;\n "),O("border",{border:"var(--n-border)"}),O("state-border",{border:"var(--n-border)",borderColor:"#0000",zIndex:1}),O("icon","\n margin: var(--n-icon-margin);\n margin-left: 0;\n height: var(--n-icon-size);\n width: var(--n-icon-size);\n max-width: var(--n-icon-size);\n font-size: var(--n-icon-size);\n position: relative;\n flex-shrink: 0;\n ",[M("icon-slot","\n height: var(--n-icon-size);\n width: var(--n-icon-size);\n position: absolute;\n left: 0;\n top: 50%;\n transform: translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n ",[go({top:"50%",originalTransform:"translateY(-50%)"})]),pr()]),O("content","\n display: flex;\n align-items: center;\n flex-wrap: nowrap;\n min-width: 0;\n ",[E("~",[O("icon",{margin:"var(--n-icon-margin)",marginRight:0})])]),R("block","\n display: flex;\n width: 100%;\n "),R("dashed",[O("border, state-border",{borderStyle:"dashed !important"})]),R("disabled",{cursor:"not-allowed",opacity:"var(--n-opacity-disabled)"})]),E("@keyframes button-wave-spread",{from:{boxShadow:"0 0 0.5px 0 var(--n-ripple-color)"},to:{boxShadow:"0 0 0.5px 4.5px var(--n-ripple-color)"}}),E("@keyframes button-wave-opacity",{from:{opacity:"var(--n-wave-opacity)"},to:{opacity:0}})]),Cr=Object.assign(Object.assign({},ye.props),{color:String,textColor:String,text:Boolean,block:Boolean,loading:Boolean,disabled:Boolean,circle:Boolean,size:String,ghost:Boolean,round:Boolean,secondary:Boolean,tertiary:Boolean,quaternary:Boolean,strong:Boolean,focusable:{type:Boolean,default:!0},keyboard:{type:Boolean,default:!0},tag:{type:String,default:"button"},type:{type:String,default:"default"},dashed:Boolean,renderIcon:Function,iconPlacement:{type:String,default:"left"},attrType:{type:String,default:"button"},bordered:{type:Boolean,default:!0},onClick:[Function,Array],nativeFocusBehavior:{type:Boolean,default:!yr}}),Se=_({name:"Button",props:Cr,slots:Object,setup(i){const e=j(null),t=j(null),o=j(!1),n=mo(()=>!i.quaternary&&!i.tertiary&&!i.secondary&&!i.text&&(!i.color||i.ghost||i.dashed)&&i.bordered),r=K(vr,{}),{mergedSizeRef:s}=Io({},{defaultSize:"medium",mergedSize:C=>{const{size:y}=i;if(y)return y;const{size:v}=r;if(v)return v;const{mergedSize:f}=C||{};return f?f.value:"medium"}}),a=D(()=>i.focusable&&!i.disabled),l=C=>{var y;a.value||C.preventDefault(),!i.nativeFocusBehavior&&(C.preventDefault(),!i.disabled&&a.value&&((y=e.value)===null||y===void 0||y.focus({preventScroll:!0})))},c=C=>{var y;if(!i.disabled&&!i.loading){const{onClick:v}=i;v&&Be(v,C),i.text||(y=t.value)===null||y===void 0||y.play()}},d=C=>{switch(C.key){case"Enter":if(!i.keyboard)return;o.value=!1}},h=C=>{switch(C.key){case"Enter":if(!i.keyboard||i.loading){C.preventDefault();return}o.value=!0}},u=()=>{o.value=!1},{inlineThemeDisabled:p,mergedClsPrefixRef:m,mergedRtlRef:b}=at(i),S=ye("Button","-button",br,dn,i,m),P=yo("Button",b,m),x=D(()=>{const C=S.value,{common:{cubicBezierEaseInOut:y,cubicBezierEaseOut:v},self:f}=C,{rippleDuration:k,opacityDisabled:w,fontWeight:F,fontWeightStrong:L}=f,$=s.value,{dashed:Z,type:V,ghost:J,text:z,color:T,round:ie,circle:de,textColor:pe,secondary:Ye,tertiary:Te,quaternary:qe,strong:xe}=i,Yo={"--n-font-weight":xe?L:F};let Q={"--n-color":"initial","--n-color-hover":"initial","--n-color-pressed":"initial","--n-color-focus":"initial","--n-color-disabled":"initial","--n-ripple-color":"initial","--n-text-color":"initial","--n-text-color-hover":"initial","--n-text-color-pressed":"initial","--n-text-color-focus":"initial","--n-text-color-disabled":"initial"};const pt=V==="tertiary",bi=V==="default",U=pt?"default":V;if(z){const ee=pe||T;Q={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":"#0000","--n-text-color":ee||f[B("textColorText",U)],"--n-text-color-hover":ee?_e(ee):f[B("textColorTextHover",U)],"--n-text-color-pressed":ee?vt(ee):f[B("textColorTextPressed",U)],"--n-text-color-focus":ee?_e(ee):f[B("textColorTextHover",U)],"--n-text-color-disabled":ee||f[B("textColorTextDisabled",U)]}}else if(J||Z){const ee=pe||T;Q={"--n-color":"#0000","--n-color-hover":"#0000","--n-color-pressed":"#0000","--n-color-focus":"#0000","--n-color-disabled":"#0000","--n-ripple-color":T||f[B("rippleColor",U)],"--n-text-color":ee||f[B("textColorGhost",U)],"--n-text-color-hover":ee?_e(ee):f[B("textColorGhostHover",U)],"--n-text-color-pressed":ee?vt(ee):f[B("textColorGhostPressed",U)],"--n-text-color-focus":ee?_e(ee):f[B("textColorGhostHover",U)],"--n-text-color-disabled":ee||f[B("textColorGhostDisabled",U)]}}else if(Ye){const ee=bi?f.textColor:pt?f.textColorTertiary:f[B("color",U)],ae=T||ee,gt=V!=="default"&&V!=="tertiary";Q={"--n-color":gt?ft(ae,{alpha:Number(f.colorOpacitySecondary)}):f.colorSecondary,"--n-color-hover":gt?ft(ae,{alpha:Number(f.colorOpacitySecondaryHover)}):f.colorSecondaryHover,"--n-color-pressed":gt?ft(ae,{alpha:Number(f.colorOpacitySecondaryPressed)}):f.colorSecondaryPressed,"--n-color-focus":gt?ft(ae,{alpha:Number(f.colorOpacitySecondaryHover)}):f.colorSecondaryHover,"--n-color-disabled":f.colorSecondary,"--n-ripple-color":"#0000","--n-text-color":ae,"--n-text-color-hover":ae,"--n-text-color-pressed":ae,"--n-text-color-focus":ae,"--n-text-color-disabled":ae}}else if(Te||qe){const ee=bi?f.textColor:pt?f.textColorTertiary:f[B("color",U)],ae=T||ee;Te?(Q["--n-color"]=f.colorTertiary,Q["--n-color-hover"]=f.colorTertiaryHover,Q["--n-color-pressed"]=f.colorTertiaryPressed,Q["--n-color-focus"]=f.colorSecondaryHover,Q["--n-color-disabled"]=f.colorTertiary):(Q["--n-color"]=f.colorQuaternary,Q["--n-color-hover"]=f.colorQuaternaryHover,Q["--n-color-pressed"]=f.colorQuaternaryPressed,Q["--n-color-focus"]=f.colorQuaternaryHover,Q["--n-color-disabled"]=f.colorQuaternary),Q["--n-ripple-color"]="#0000",Q["--n-text-color"]=ae,Q["--n-text-color-hover"]=ae,Q["--n-text-color-pressed"]=ae,Q["--n-text-color-focus"]=ae,Q["--n-text-color-disabled"]=ae}else Q={"--n-color":T||f[B("color",U)],"--n-color-hover":T?_e(T):f[B("colorHover",U)],"--n-color-pressed":T?vt(T):f[B("colorPressed",U)],"--n-color-focus":T?_e(T):f[B("colorFocus",U)],"--n-color-disabled":T||f[B("colorDisabled",U)],"--n-ripple-color":T||f[B("rippleColor",U)],"--n-text-color":pe||(T?f.textColorPrimary:pt?f.textColorTertiary:f[B("textColor",U)]),"--n-text-color-hover":pe||(T?f.textColorHoverPrimary:f[B("textColorHover",U)]),"--n-text-color-pressed":pe||(T?f.textColorPressedPrimary:f[B("textColorPressed",U)]),"--n-text-color-focus":pe||(T?f.textColorFocusPrimary:f[B("textColorFocus",U)]),"--n-text-color-disabled":pe||(T?f.textColorDisabledPrimary:f[B("textColorDisabled",U)])};let $t={"--n-border":"initial","--n-border-hover":"initial","--n-border-pressed":"initial","--n-border-focus":"initial","--n-border-disabled":"initial"};z?$t={"--n-border":"none","--n-border-hover":"none","--n-border-pressed":"none","--n-border-focus":"none","--n-border-disabled":"none"}:$t={"--n-border":f[B("border",U)],"--n-border-hover":f[B("borderHover",U)],"--n-border-pressed":f[B("borderPressed",U)],"--n-border-focus":f[B("borderFocus",U)],"--n-border-disabled":f[B("borderDisabled",U)]};const{[B("height",$)]:Nt,[B("fontSize",$)]:qo,[B("padding",$)]:Zo,[B("paddingRound",$)]:Jo,[B("iconSize",$)]:Qo,[B("borderRadius",$)]:en,[B("iconMargin",$)]:tn,waveOpacity:on}=f,nn={"--n-width":de&&!z?Nt:"initial","--n-height":z?"initial":Nt,"--n-font-size":qo,"--n-padding":de||z?"initial":ie?Jo:Zo,"--n-icon-size":Qo,"--n-icon-margin":tn,"--n-border-radius":z?"initial":de||ie?Nt:en};return Object.assign(Object.assign(Object.assign(Object.assign({"--n-bezier":y,"--n-bezier-ease-out":v,"--n-ripple-duration":k,"--n-opacity-disabled":w,"--n-wave-opacity":on},Yo),Q),$t),nn)}),I=p?lt("button",D(()=>{let C="";const{dashed:y,type:v,ghost:f,text:k,color:w,round:F,circle:L,textColor:$,secondary:Z,tertiary:V,quaternary:J,strong:z}=i;y&&(C+="a"),f&&(C+="b"),k&&(C+="c"),F&&(C+="d"),L&&(C+="e"),Z&&(C+="f"),V&&(C+="g"),J&&(C+="h"),z&&(C+="i"),w&&(C+="j".concat(Fi(w))),$&&(C+="k".concat(Fi($)));const{value:T}=s;return C+="l".concat(T[0]),C+="m".concat(v[0]),C}),x,i):void 0;return{selfElRef:e,waveElRef:t,mergedClsPrefix:m,mergedFocusable:a,mergedSize:s,showBorder:n,enterPressed:o,rtlEnabled:P,handleMousedown:l,handleKeydown:h,handleBlur:u,handleKeyup:d,handleClick:c,customColorCssVars:D(()=>{const{color:C}=i;if(!C)return null;const y=_e(C);return{"--n-border-color":C,"--n-border-color-hover":y,"--n-border-color-pressed":vt(C),"--n-border-color-focus":y,"--n-border-color-disabled":C}}),cssVars:p?void 0:x,themeClass:I==null?void 0:I.themeClass,onRender:I==null?void 0:I.onRender}},render(){const{mergedClsPrefix:i,tag:e,onRender:t}=this;t==null||t();const o=it(this.$slots.default,n=>n&&g("span",{class:"".concat(i,"-button__content")},n));return g(e,{ref:"selfElRef",class:[this.themeClass,"".concat(i,"-button"),"".concat(i,"-button--").concat(this.type,"-type"),"".concat(i,"-button--").concat(this.mergedSize,"-type"),this.rtlEnabled&&"".concat(i,"-button--rtl"),this.disabled&&"".concat(i,"-button--disabled"),this.block&&"".concat(i,"-button--block"),this.enterPressed&&"".concat(i,"-button--pressed"),!this.text&&this.dashed&&"".concat(i,"-button--dashed"),this.color&&"".concat(i,"-button--color"),this.secondary&&"".concat(i,"-button--secondary"),this.loading&&"".concat(i,"-button--loading"),this.ghost&&"".concat(i,"-button--ghost")],tabindex:this.mergedFocusable?0:-1,type:this.attrType,style:this.cssVars,disabled:this.disabled,onClick:this.handleClick,onBlur:this.handleBlur,onMousedown:this.handleMousedown,onKeyup:this.handleKeyup,onKeydown:this.handleKeydown},this.iconPlacement==="right"&&o,g(ri,{width:!0},{default:()=>it(this.$slots.icon,n=>(this.loading||this.renderIcon||n)&&g("span",{class:"".concat(i,"-button__icon"),style:{margin:an(this.$slots.default)?"0":""}},g(fo,null,{default:()=>this.loading?g(ln,{clsPrefix:i,key:"loading",class:"".concat(i,"-icon-slot"),strokeWidth:20}):g("div",{key:"icon",class:"".concat(i,"-icon-slot"),role:"none"},this.renderIcon?this.renderIcon():n)})))}),this.iconPlacement==="left"&&o,this.text?null:g(fr,{ref:"waveElRef",clsPrefix:i}),this.showBorder?g("div",{"aria-hidden":!0,class:"".concat(i,"-button__border"),style:this.customColorCssVars}):null,this.showBorder?g("div",{"aria-hidden":!0,class:"".concat(i,"-button__state-border"),style:this.customColorCssVars}):null)}}),xr=jt("n-dialog-provider"),ci={icon:Function,type:{type:String,default:"default"},title:[String,Function],closable:{type:Boolean,default:!0},negativeText:String,positiveText:String,positiveButtonProps:Object,negativeButtonProps:Object,content:[String,Function],action:Function,showIcon:{type:Boolean,default:!0},loading:Boolean,bordered:Boolean,iconPlacement:String,titleClass:[String,Array],titleStyle:[String,Object],contentClass:[String,Array],contentStyle:[String,Object],actionClass:[String,Array],actionStyle:[String,Object],onPositiveClick:Function,onNegativeClick:Function,onClose:Function},wr=vo(ci),Pr=E([M("dialog","\n --n-icon-margin: var(--n-icon-margin-top) var(--n-icon-margin-right) var(--n-icon-margin-bottom) var(--n-icon-margin-left);\n word-break: break-word;\n line-height: var(--n-line-height);\n position: relative;\n background: var(--n-color);\n color: var(--n-text-color);\n box-sizing: border-box;\n margin: auto;\n border-radius: var(--n-border-radius);\n padding: var(--n-padding);\n transition: \n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n ",[O("icon",{color:"var(--n-icon-color)"}),R("bordered",{border:"var(--n-border)"}),R("icon-top",[O("close",{margin:"var(--n-close-margin)"}),O("icon",{margin:"var(--n-icon-margin)"}),O("content",{textAlign:"center"}),O("title",{justifyContent:"center"}),O("action",{justifyContent:"center"})]),R("icon-left",[O("icon",{margin:"var(--n-icon-margin)"}),R("closable",[O("title","\n padding-right: calc(var(--n-close-size) + 6px);\n ")])]),O("close","\n position: absolute;\n right: 0;\n top: 0;\n margin: var(--n-close-margin);\n transition:\n background-color .3s var(--n-bezier),\n color .3s var(--n-bezier);\n z-index: 1;\n "),O("content","\n font-size: var(--n-font-size);\n margin: var(--n-content-margin);\n position: relative;\n word-break: break-word;\n ",[R("last","margin-bottom: 0;")]),O("action","\n display: flex;\n justify-content: flex-end;\n ",[E("> *:not(:last-child)","\n margin-right: var(--n-action-space);\n ")]),O("icon","\n font-size: var(--n-icon-size);\n transition: color .3s var(--n-bezier);\n "),O("title","\n transition: color .3s var(--n-bezier);\n display: flex;\n align-items: center;\n font-size: var(--n-title-font-size);\n font-weight: var(--n-title-font-weight);\n color: var(--n-title-text-color);\n "),M("dialog-icon-container","\n display: flex;\n justify-content: center;\n ")]),cn(M("dialog","\n width: 446px;\n max-width: calc(100vw - 32px);\n ")),M("dialog",[un("\n width: 446px;\n max-width: calc(100vw - 32px);\n ")])]),Sr={default:()=>g(Mt,null),info:()=>g(Mt,null),success:()=>g(li,null),warning:()=>g(ai,null),error:()=>g(si,null)},Ir=_({name:"Dialog",alias:["NimbusConfirmCard","Confirm"],props:Object.assign(Object.assign({},ye.props),ci),slots:Object,setup(i){const{mergedComponentPropsRef:e,mergedClsPrefixRef:t,inlineThemeDisabled:o,mergedRtlRef:n}=at(i),r=yo("Dialog",n,t),s=D(()=>{var p,m;const{iconPlacement:b}=i;return b||((m=(p=e==null?void 0:e.value)===null||p===void 0?void 0:p.Dialog)===null||m===void 0?void 0:m.iconPlacement)||"left"});function a(p){const{onPositiveClick:m}=i;m&&m(p)}function l(p){const{onNegativeClick:m}=i;m&&m(p)}function c(){const{onClose:p}=i;p&&p()}const d=ye("Dialog","-dialog",Pr,pn,i,t),h=D(()=>{const{type:p}=i,m=s.value,{common:{cubicBezierEaseInOut:b},self:{fontSize:S,lineHeight:P,border:x,titleTextColor:I,textColor:C,color:y,closeBorderRadius:v,closeColorHover:f,closeColorPressed:k,closeIconColor:w,closeIconColorHover:F,closeIconColorPressed:L,closeIconSize:$,borderRadius:Z,titleFontWeight:V,titleFontSize:J,padding:z,iconSize:T,actionSpace:ie,contentMargin:de,closeSize:pe,[m==="top"?"iconMarginIconTop":"iconMargin"]:Ye,[m==="top"?"closeMarginIconTop":"closeMargin"]:Te,[B("iconColor",p)]:qe}}=d.value,xe=gn(Ye);return{"--n-font-size":S,"--n-icon-color":qe,"--n-bezier":b,"--n-close-margin":Te,"--n-icon-margin-top":xe.top,"--n-icon-margin-right":xe.right,"--n-icon-margin-bottom":xe.bottom,"--n-icon-margin-left":xe.left,"--n-icon-size":T,"--n-close-size":pe,"--n-close-icon-size":$,"--n-close-border-radius":v,"--n-close-color-hover":f,"--n-close-color-pressed":k,"--n-close-icon-color":w,"--n-close-icon-color-hover":F,"--n-close-icon-color-pressed":L,"--n-color":y,"--n-text-color":C,"--n-border-radius":Z,"--n-padding":z,"--n-line-height":P,"--n-border":x,"--n-content-margin":de,"--n-title-font-size":J,"--n-title-font-weight":V,"--n-title-text-color":I,"--n-action-space":ie}}),u=o?lt("dialog",D(()=>"".concat(i.type[0]).concat(s.value[0])),h,i):void 0;return{mergedClsPrefix:t,rtlEnabled:r,mergedIconPlacement:s,mergedTheme:d,handlePositiveClick:a,handleNegativeClick:l,handleCloseClick:c,cssVars:o?void 0:h,themeClass:u==null?void 0:u.themeClass,onRender:u==null?void 0:u.onRender}},render(){var i;const{bordered:e,mergedIconPlacement:t,cssVars:o,closable:n,showIcon:r,title:s,content:a,action:l,negativeText:c,positiveText:d,positiveButtonProps:h,negativeButtonProps:u,handlePositiveClick:p,handleNegativeClick:m,mergedTheme:b,loading:S,type:P,mergedClsPrefix:x}=this;(i=this.onRender)===null||i===void 0||i.call(this);const I=r?g(ue,{clsPrefix:x,class:"".concat(x,"-dialog__icon")},{default:()=>it(this.$slots.icon,y=>y||(this.icon?Le(this.icon):Sr[this.type]()))}):null,C=it(this.$slots.action,y=>y||d||c||l?g("div",{class:["".concat(x,"-dialog__action"),this.actionClass],style:this.actionStyle},y||(l?[Le(l)]:[this.negativeText&&g(Se,Object.assign({theme:b.peers.Button,themeOverrides:b.peerOverrides.Button,ghost:!0,size:"small",onClick:m},u),{default:()=>Le(this.negativeText)}),this.positiveText&&g(Se,Object.assign({theme:b.peers.Button,themeOverrides:b.peerOverrides.Button,size:"small",type:P==="default"?"primary":P,disabled:S,loading:S,onClick:p},h),{default:()=>Le(this.positiveText)})])):null);return g("div",{class:["".concat(x,"-dialog"),this.themeClass,this.closable&&"".concat(x,"-dialog--closable"),"".concat(x,"-dialog--icon-").concat(t),e&&"".concat(x,"-dialog--bordered"),this.rtlEnabled&&"".concat(x,"-dialog--rtl")],style:o,role:"dialog"},n?it(this.$slots.close,y=>{const v=["".concat(x,"-dialog__close"),this.rtlEnabled&&"".concat(x,"-dialog--rtl")];return y?g("div",{class:v},y):g(hn,{clsPrefix:x,class:v,onClick:this.handleCloseClick})}):null,r&&t==="top"?g("div",{class:"".concat(x,"-dialog-icon-container")},I):null,g("div",{class:["".concat(x,"-dialog__title"),this.titleClass],style:this.titleStyle},r&&t==="left"?I:null,Xt(this.$slots.header,()=>[Le(s)])),g("div",{class:["".concat(x,"-dialog__content"),C?"":"".concat(x,"-dialog__content--last"),this.contentClass],style:this.contentStyle},Xt(this.$slots.default,()=>[Le(a)])),C)}}),Qt="n-draggable";function kr(i,e){let t;const o=D(()=>i.value!==!1),n=D(()=>o.value?Qt:""),r=D(()=>{const l=i.value;return l===!0||l===!1?!0:l?l.bounds!=="none":!0});function s(l){const c=l.querySelector(".".concat(Qt));if(!c||!n.value)return;let d=0,h=0,u=0,p=0,m=0,b=0,S;function P(C){C.preventDefault(),S=C;const{x:y,y:v,right:f,bottom:k}=l.getBoundingClientRect();h=y,p=v,d=window.innerWidth-f,u=window.innerHeight-k;const{left:w,top:F}=l.style;m=+F.slice(0,-2),b=+w.slice(0,-2)}function x(C){if(!S)return;const{clientX:y,clientY:v}=S;let f=C.clientX-y,k=C.clientY-v;r.value&&(f>d?f=d:-f>h&&(f=-h),k>u?k=u:-k>p&&(k=-p));const w=f+b,F=k+m;l.style.top="".concat(F,"px"),l.style.left="".concat(w,"px")}function I(){S=void 0,e.onEnd(l)}Pe("mousedown",c,P),Pe("mousemove",window,x),Pe("mouseup",window,I),t=()=>{kt("mousedown",c,P),Pe("mousemove",window,x),Pe("mouseup",window,I)}}function a(){t&&(t(),t=void 0)}return fn(a),{stopDrag:a,startDrag:s,draggableRef:o,draggableClassRef:n}}const ui=Object.assign(Object.assign({},Kn),ci),Mr=vo(ui),Fr=_({name:"ModalBody",inheritAttrs:!1,slots:Object,props:Object.assign(Object.assign({show:{type:Boolean,required:!0},preset:String,displayDirective:{type:String,required:!0},trapFocus:{type:Boolean,default:!0},autoFocus:{type:Boolean,default:!0},blockScroll:Boolean,draggable:{type:[Boolean,Object],default:!1}},ui),{renderMask:Function,onClickoutside:Function,onBeforeLeave:{type:Function,required:!0},onAfterLeave:{type:Function,required:!0},onPositiveClick:{type:Function,required:!0},onNegativeClick:{type:Function,required:!0},onClose:{type:Function,required:!0},onAfterEnter:Function,onEsc:Function}),setup(i){const e=j(null),t=j(null),o=j(i.show),n=j(null),r=j(null),s=K(xo);let a=null;N(G(i,"show"),k=>{k&&(a=s.getMousePosition())},{immediate:!0});const{stopDrag:l,startDrag:c,draggableRef:d,draggableClassRef:h}=kr(G(i,"draggable"),{onEnd:k=>{b(k)}}),u=D(()=>Ft([i.titleClass,h.value])),p=D(()=>Ft([i.headerClass,h.value]));N(G(i,"show"),k=>{k&&(o.value=!0)}),nr(D(()=>i.blockScroll&&o.value));function m(){if(s.transformOriginRef.value==="center")return"";const{value:k}=n,{value:w}=r;if(k===null||w===null)return"";if(t.value){const F=t.value.containerScrollTop;return"".concat(k,"px ").concat(w+F,"px")}return""}function b(k){if(s.transformOriginRef.value==="center"||!a||!t.value)return;const w=t.value.containerScrollTop,{offsetLeft:F,offsetTop:L}=k,$=a.y,Z=a.x;n.value=-(F-Z),r.value=-(L-$-w),k.style.transformOrigin=m()}function S(k){Re(()=>{b(k)})}function P(k){k.style.transformOrigin=m(),i.onBeforeLeave()}function x(k){const w=k;d.value&&c(w),i.onAfterEnter&&i.onAfterEnter(w)}function I(){o.value=!1,n.value=null,r.value=null,l(),i.onAfterLeave()}function C(){const{onClose:k}=i;k&&k()}function y(){i.onNegativeClick()}function v(){i.onPositiveClick()}const f=j(null);return N(f,k=>{k&&Re(()=>{const w=k.el;w&&e.value!==w&&(e.value=w)})}),ce(wn,e),ce(Pn,null),ce(Sn,null),{mergedTheme:s.mergedThemeRef,appear:s.appearRef,isMounted:s.isMountedRef,mergedClsPrefix:s.mergedClsPrefixRef,bodyRef:e,scrollbarRef:t,draggableClass:h,displayed:o,childNodeRef:f,cardHeaderClass:p,dialogTitleClass:u,handlePositiveClick:v,handleNegativeClick:y,handleCloseClick:C,handleAfterEnter:x,handleAfterLeave:I,handleBeforeLeave:P,handleEnter:S}},render(){const{$slots:i,$attrs:e,handleEnter:t,handleAfterEnter:o,handleAfterLeave:n,handleBeforeLeave:r,preset:s,mergedClsPrefix:a}=this;let l=null;if(!s){if(l=mn("default",i.default,{draggableClass:this.draggableClass}),!l){bo("modal","default slot is empty");return}l=yn(l),l.props=vn({class:"".concat(a,"-modal")},e,l.props||{})}return this.displayDirective==="show"||this.displayed||this.show?Kt(g("div",{role:"none",class:"".concat(a,"-modal-body-wrapper")},g(bn,{ref:"scrollbarRef",theme:this.mergedTheme.peers.Scrollbar,themeOverrides:this.mergedTheme.peerOverrides.Scrollbar,contentClass:"".concat(a,"-modal-scroll-content")},{default:()=>{var c;return[(c=this.renderMask)===null||c===void 0?void 0:c.call(this),g(Cn,{disabled:!this.trapFocus,active:this.show,onEsc:this.onEsc,autoFocus:this.autoFocus},{default:()=>{var d;return g(Co,{name:"fade-in-scale-up-transition",appear:(d=this.appear)!==null&&d!==void 0?d:this.isMounted,onEnter:t,onAfterEnter:o,onAfterLeave:n,onBeforeLeave:r},{default:()=>{const h=[[xi,this.show]],{onClickoutside:u}=this;return u&&h.push([xn,this.onClickoutside,void 0,{capture:!0}]),Kt(this.preset==="confirm"||this.preset==="dialog"?g(Ir,Object.assign({},this.$attrs,{class:["".concat(a,"-modal"),this.$attrs.class],ref:"bodyRef",theme:this.mergedTheme.peers.Dialog,themeOverrides:this.mergedTheme.peerOverrides.Dialog},Yt(this.$props,wr),{titleClass:this.dialogTitleClass,"aria-modal":"true"}),i):this.preset==="card"?g(So,Object.assign({},this.$attrs,{ref:"bodyRef",class:["".concat(a,"-modal"),this.$attrs.class],theme:this.mergedTheme.peers.Card,themeOverrides:this.mergedTheme.peerOverrides.Card},Yt(this.$props,Yn),{headerClass:this.cardHeaderClass,"aria-modal":"true",role:"dialog"}),i):this.childNodeRef=l,h)}})}})]}})),[[xi,this.displayDirective==="if"||this.displayed||this.show]]):null}}),_r=E([M("modal-container","\n position: fixed;\n left: 0;\n top: 0;\n height: 0;\n width: 0;\n display: flex;\n "),M("modal-mask","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n background-color: rgba(0, 0, 0, .4);\n ",[In({enterDuration:".25s",leaveDuration:".25s",enterCubicBezier:"var(--n-bezier-ease-out)",leaveCubicBezier:"var(--n-bezier-ease-out)"})]),M("modal-body-wrapper","\n position: fixed;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n overflow: visible;\n ",[M("modal-scroll-content","\n min-height: 100%;\n display: flex;\n position: relative;\n ")]),M("modal","\n position: relative;\n align-self: center;\n color: var(--n-text-color);\n margin: auto;\n box-shadow: var(--n-box-shadow);\n ",[kn({duration:".25s",enterScale:".5"}),E(".".concat(Qt),"\n cursor: move;\n user-select: none;\n ")])]),Dr=Object.assign(Object.assign(Object.assign(Object.assign({},ye.props),{show:Boolean,unstableShowMask:{type:Boolean,default:!0},maskClosable:{type:Boolean,default:!0},preset:String,to:[String,Object],displayDirective:{type:String,default:"if"},transformOrigin:{type:String,default:"mouse"},zIndex:Number,autoFocus:{type:Boolean,default:!0},trapFocus:{type:Boolean,default:!0},closeOnEsc:{type:Boolean,default:!0},blockScroll:{type:Boolean,default:!0}}),ui),{draggable:[Boolean,Object],onEsc:Function,"onUpdate:show":[Function,Array],onUpdateShow:[Function,Array],onAfterEnter:Function,onBeforeLeave:Function,onAfterLeave:Function,onClose:Function,onPositiveClick:Function,onNegativeClick:Function,onMaskClick:Function,internalDialog:Boolean,internalModal:Boolean,internalAppear:{type:Boolean,default:void 0},overlayStyle:[String,Object],onBeforeHide:Function,onAfterHide:Function,onHide:Function}),Or=_({name:"Modal",inheritAttrs:!1,props:Dr,slots:Object,setup(i){const e=j(null),{mergedClsPrefixRef:t,namespaceRef:o,inlineThemeDisabled:n}=at(i),r=ye("Modal","-modal",_r,Dn,i,t),s=ir(64),a=er(),l=_n(),c=i.internalDialog?K(xr,null):null,d=i.internalModal?K(Bn,null):null,h=or();function u(v){const{onUpdateShow:f,"onUpdate:show":k,onHide:w}=i;f&&Be(f,v),k&&Be(k,v),w&&!v&&w(v)}function p(){const{onClose:v}=i;v?Promise.resolve(v()).then(f=>{f!==!1&&u(!1)}):u(!1)}function m(){const{onPositiveClick:v}=i;v?Promise.resolve(v()).then(f=>{f!==!1&&u(!1)}):u(!1)}function b(){const{onNegativeClick:v}=i;v?Promise.resolve(v()).then(f=>{f!==!1&&u(!1)}):u(!1)}function S(){const{onBeforeLeave:v,onBeforeHide:f}=i;v&&Be(v),f&&f()}function P(){const{onAfterLeave:v,onAfterHide:f}=i;v&&Be(v),f&&f()}function x(v){var f;const{onMaskClick:k}=i;k&&k(v),i.maskClosable&&!((f=e.value)===null||f===void 0)&&f.contains(On(v))&&u(!1)}function I(v){var f;(f=i.onEsc)===null||f===void 0||f.call(i),i.show&&i.closeOnEsc&&sr(v)&&(h.value||u(!1))}ce(xo,{getMousePosition:()=>{const v=c||d;if(v){const{clickedRef:f,clickedPositionRef:k}=v;if(f.value&&k.value)return k.value}return s.value?a.value:null},mergedClsPrefixRef:t,mergedThemeRef:r,isMountedRef:l,appearRef:G(i,"internalAppear"),transformOriginRef:G(i,"transformOrigin")});const C=D(()=>{const{common:{cubicBezierEaseOut:v},self:{boxShadow:f,color:k,textColor:w}}=r.value;return{"--n-bezier-ease-out":v,"--n-box-shadow":f,"--n-color":k,"--n-text-color":w}}),y=n?lt("theme-class",void 0,C,i):void 0;return{mergedClsPrefix:t,namespace:o,isMounted:l,containerRef:e,presetProps:D(()=>Yt(i,Mr)),handleEsc:I,handleAfterLeave:P,handleClickoutside:x,handleBeforeLeave:S,doUpdateShow:u,handleNegativeClick:b,handlePositiveClick:m,handleCloseClick:p,cssVars:n?void 0:C,themeClass:y==null?void 0:y.themeClass,onRender:y==null?void 0:y.onRender}},render(){const{mergedClsPrefix:i}=this;return g(Mn,{to:this.to,show:this.show},{default:()=>{var e;(e=this.onRender)===null||e===void 0||e.call(this);const{unstableShowMask:t}=this;return Kt(g("div",{role:"none",ref:"containerRef",class:["".concat(i,"-modal-container"),this.themeClass,this.namespace],style:this.cssVars},g(Fr,Object.assign({style:this.overlayStyle},this.$attrs,{ref:"bodyWrapper",displayDirective:this.displayDirective,show:this.show,preset:this.preset,autoFocus:this.autoFocus,trapFocus:this.trapFocus,draggable:this.draggable,blockScroll:this.blockScroll},this.presetProps,{onEsc:this.handleEsc,onClose:this.handleCloseClick,onNegativeClick:this.handleNegativeClick,onPositiveClick:this.handlePositiveClick,onBeforeLeave:this.handleBeforeLeave,onAfterEnter:this.onAfterEnter,onAfterLeave:this.handleAfterLeave,onClickoutside:t?void 0:this.handleClickoutside,renderMask:t?()=>{var o;return g(Co,{name:"fade-in-transition",key:"mask",appear:(o=this.internalAppear)!==null&&o!==void 0?o:this.isMounted},{default:()=>this.show?g("div",{"aria-hidden":!0,ref:"containerRef",class:"".concat(i,"-modal-mask"),onClick:this.handleClickoutside}):null})}:void 0}),this.$slots)),[[Fn,{zIndex:this.zIndex,enabled:this.show}]])}})}});function ko(){const i=K(En,null);return i===null&&dt("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),i}const Br={success:g(li,null),error:g(si,null),warning:g(ai,null),info:g(Mt,null)},Er=_({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(i,{slots:e}){function t(n,r,s,a){const{gapDegree:l,viewBoxWidth:c,strokeWidth:d}=i,h=50,u=0,p=h,m=0,b=2*h,S=50+d/2,P="M ".concat(S,",").concat(S," m ").concat(u,",").concat(p,"\n      a ").concat(h,",").concat(h," 0 1 1 ").concat(m,",-100\n      a ").concat(h,",").concat(h," 0 1 1 0,").concat(b),x=Math.PI*2*h,I={stroke:a==="rail"?s:typeof i.fillColor=="object"?"url(#gradient)":s,strokeDasharray:"".concat(n/100*(x-l),"px ").concat(c*8,"px"),strokeDashoffset:"-".concat(l/2,"px"),transformOrigin:r?"center":void 0,transform:r?"rotate(".concat(r,"deg)"):void 0};return{pathString:P,pathStyle:I}}const o=()=>{const n=typeof i.fillColor=="object",r=n?i.fillColor.stops[0]:"",s=n?i.fillColor.stops[1]:"";return n&&g("defs",null,g("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},g("stop",{offset:"0%","stop-color":r}),g("stop",{offset:"100%","stop-color":s})))};return()=>{const{fillColor:n,railColor:r,strokeWidth:s,offsetDegree:a,status:l,percentage:c,showIndicator:d,indicatorTextColor:h,unit:u,gapOffsetDegree:p,clsPrefix:m}=i,{pathString:b,pathStyle:S}=t(100,0,r,"rail"),{pathString:P,pathStyle:x}=t(c,a,n,"fill"),I=100+s;return g("div",{class:"".concat(m,"-progress-content"),role:"none"},g("div",{class:"".concat(m,"-progress-graph"),"aria-hidden":!0},g("div",{class:"".concat(m,"-progress-graph-circle"),style:{transform:p?"rotate(".concat(p,"deg)"):void 0}},g("svg",{viewBox:"0 0 ".concat(I," ").concat(I)},o(),g("g",null,g("path",{class:"".concat(m,"-progress-graph-circle-rail"),d:b,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:S})),g("g",null,g("path",{class:["".concat(m,"-progress-graph-circle-fill"),c===0&&"".concat(m,"-progress-graph-circle-fill--empty")],d:P,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:x}))))),d?g("div",null,e.default?g("div",{class:"".concat(m,"-progress-custom-content"),role:"none"},e.default()):l!=="default"?g("div",{class:"".concat(m,"-progress-icon"),"aria-hidden":!0},g(ue,{clsPrefix:m},{default:()=>Br[l]})):g("div",{class:"".concat(m,"-progress-text"),style:{color:h},role:"none"},g("span",{class:"".concat(m,"-progress-text__percentage")},c),g("span",{class:"".concat(m,"-progress-text__unit")},u))):null)}}}),Rr={success:g(li,null),error:g(si,null),warning:g(ai,null),info:g(Mt,null)},jr=_({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(i,{slots:e}){const t=D(()=>ze(i.height)),o=D(()=>{var s,a;return typeof i.fillColor=="object"?"linear-gradient(to right, ".concat((s=i.fillColor)===null||s===void 0?void 0:s.stops[0]," , ").concat((a=i.fillColor)===null||a===void 0?void 0:a.stops[1],")"):i.fillColor}),n=D(()=>i.railBorderRadius!==void 0?ze(i.railBorderRadius):i.height!==void 0?ze(i.height,{c:.5}):""),r=D(()=>i.fillBorderRadius!==void 0?ze(i.fillBorderRadius):i.railBorderRadius!==void 0?ze(i.railBorderRadius):i.height!==void 0?ze(i.height,{c:.5}):"");return()=>{const{indicatorPlacement:s,railColor:a,railStyle:l,percentage:c,unit:d,indicatorTextColor:h,status:u,showIndicator:p,processing:m,clsPrefix:b}=i;return g("div",{class:"".concat(b,"-progress-content"),role:"none"},g("div",{class:"".concat(b,"-progress-graph"),"aria-hidden":!0},g("div",{class:["".concat(b,"-progress-graph-line"),{["".concat(b,"-progress-graph-line--indicator-").concat(s)]:!0}]},g("div",{class:"".concat(b,"-progress-graph-line-rail"),style:[{backgroundColor:a,height:t.value,borderRadius:n.value},l]},g("div",{class:["".concat(b,"-progress-graph-line-fill"),m&&"".concat(b,"-progress-graph-line-fill--processing")],style:{maxWidth:"".concat(i.percentage,"%"),background:o.value,height:t.value,lineHeight:t.value,borderRadius:r.value}},s==="inside"?g("div",{class:"".concat(b,"-progress-graph-line-indicator"),style:{color:h}},e.default?e.default():"".concat(c).concat(d)):null)))),p&&s==="outside"?g("div",null,e.default?g("div",{class:"".concat(b,"-progress-custom-content"),style:{color:h},role:"none"},e.default()):u==="default"?g("div",{role:"none",class:"".concat(b,"-progress-icon ").concat(b,"-progress-icon--as-text"),style:{color:h}},c,d):g("div",{class:"".concat(b,"-progress-icon"),"aria-hidden":!0},g(ue,{clsPrefix:b},{default:()=>Rr[u]}))):null)}}});function Wi(i,e,t=100){return"m ".concat(t/2," ").concat(t/2-i," a ").concat(i," ").concat(i," 0 1 1 0 ").concat(2*i," a ").concat(i," ").concat(i," 0 1 1 0 -").concat(2*i)}const Tr=_({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(i,{slots:e}){const t=D(()=>i.percentage.map((r,s)=>"".concat(Math.PI*r/100*(i.viewBoxWidth/2-i.strokeWidth/2*(1+2*s)-i.circleGap*s)*2,", ").concat(i.viewBoxWidth*8))),o=(n,r)=>{const s=i.fillColor[r],a=typeof s=="object"?s.stops[0]:"",l=typeof s=="object"?s.stops[1]:"";return typeof i.fillColor[r]=="object"&&g("linearGradient",{id:"gradient-".concat(r),x1:"100%",y1:"0%",x2:"0%",y2:"100%"},g("stop",{offset:"0%","stop-color":a}),g("stop",{offset:"100%","stop-color":l}))};return()=>{const{viewBoxWidth:n,strokeWidth:r,circleGap:s,showIndicator:a,fillColor:l,railColor:c,railStyle:d,percentage:h,clsPrefix:u}=i;return g("div",{class:"".concat(u,"-progress-content"),role:"none"},g("div",{class:"".concat(u,"-progress-graph"),"aria-hidden":!0},g("div",{class:"".concat(u,"-progress-graph-circle")},g("svg",{viewBox:"0 0 ".concat(n," ").concat(n)},g("defs",null,h.map((p,m)=>o(p,m))),h.map((p,m)=>g("g",{key:m},g("path",{class:"".concat(u,"-progress-graph-circle-rail"),d:Wi(n/2-r/2*(1+2*m)-s*m,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:c[m]},d[m]]}),g("path",{class:["".concat(u,"-progress-graph-circle-fill"),p===0&&"".concat(u,"-progress-graph-circle-fill--empty")],d:Wi(n/2-r/2*(1+2*m)-s*m,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:t.value[m],strokeDashoffset:0,stroke:typeof l[m]=="object"?"url(#gradient-".concat(m,")"):l[m]}})))))),a&&e.default?g("div",null,g("div",{class:"".concat(u,"-progress-text")},e.default())):null)}}}),Lr=E([M("progress",{display:"inline-block"},[M("progress-icon","\n color: var(--n-icon-color);\n transition: color .3s var(--n-bezier);\n "),R("line","\n width: 100%;\n display: block;\n ",[M("progress-content","\n display: flex;\n align-items: center;\n ",[M("progress-graph",{flex:1})]),M("progress-custom-content",{marginLeft:"14px"}),M("progress-icon","\n width: 30px;\n padding-left: 14px;\n height: var(--n-icon-size-line);\n line-height: var(--n-icon-size-line);\n font-size: var(--n-icon-size-line);\n ",[R("as-text","\n color: var(--n-text-color-line-outer);\n text-align: center;\n width: 40px;\n font-size: var(--n-font-size);\n padding-left: 4px;\n transition: color .3s var(--n-bezier);\n ")])]),R("circle, dashboard",{width:"120px"},[M("progress-custom-content","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n "),M("progress-text","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: inherit;\n font-size: var(--n-font-size-circle);\n color: var(--n-text-color-circle);\n font-weight: var(--n-font-weight-circle);\n transition: color .3s var(--n-bezier);\n white-space: nowrap;\n "),M("progress-icon","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: var(--n-icon-color);\n font-size: var(--n-icon-size-circle);\n ")]),R("multiple-circle","\n width: 200px;\n color: inherit;\n ",[M("progress-text","\n font-weight: var(--n-font-weight-circle);\n color: var(--n-text-color-circle);\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n ")]),M("progress-content",{position:"relative"}),M("progress-graph",{position:"relative"},[M("progress-graph-circle",[E("svg",{verticalAlign:"bottom"}),M("progress-graph-circle-fill","\n stroke: var(--n-fill-color);\n transition:\n opacity .3s var(--n-bezier),\n stroke .3s var(--n-bezier),\n stroke-dasharray .3s var(--n-bezier);\n ",[R("empty",{opacity:0})]),M("progress-graph-circle-rail","\n transition: stroke .3s var(--n-bezier);\n overflow: hidden;\n stroke: var(--n-rail-color);\n ")]),M("progress-graph-line",[R("indicator-inside",[M("progress-graph-line-rail","\n height: 16px;\n line-height: 16px;\n border-radius: 10px;\n ",[M("progress-graph-line-fill","\n height: inherit;\n border-radius: 10px;\n "),M("progress-graph-line-indicator","\n background: #0000;\n white-space: nowrap;\n text-align: right;\n margin-left: 14px;\n margin-right: 14px;\n height: inherit;\n font-size: 12px;\n color: var(--n-text-color-line-inner);\n transition: color .3s var(--n-bezier);\n ")])]),R("indicator-inside-label","\n height: 16px;\n display: flex;\n align-items: center;\n ",[M("progress-graph-line-rail","\n flex: 1;\n transition: background-color .3s var(--n-bezier);\n "),M("progress-graph-line-indicator","\n background: var(--n-fill-color);\n font-size: 12px;\n transform: translateZ(0);\n display: flex;\n vertical-align: middle;\n height: 16px;\n line-height: 16px;\n padding: 0 10px;\n border-radius: 10px;\n position: absolute;\n white-space: nowrap;\n color: var(--n-text-color-line-inner);\n transition:\n right .2s var(--n-bezier),\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n ")]),M("progress-graph-line-rail","\n position: relative;\n overflow: hidden;\n height: var(--n-rail-height);\n border-radius: 5px;\n background-color: var(--n-rail-color);\n transition: background-color .3s var(--n-bezier);\n ",[M("progress-graph-line-fill","\n background: var(--n-fill-color);\n position: relative;\n border-radius: 5px;\n height: inherit;\n width: 100%;\n max-width: 0%;\n transition:\n background-color .3s var(--n-bezier),\n max-width .2s var(--n-bezier);\n ",[R("processing",[E("&::after",'\n content: "";\n background-image: var(--n-line-bg-processing);\n animation: progress-processing-animation 2s var(--n-bezier) infinite;\n ')])])])])])]),E("@keyframes progress-processing-animation","\n 0% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 100%;\n opacity: 1;\n }\n 66% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n 100% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n ")]),zr=Object.assign(Object.assign({},ye.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),$r=_({name:"Progress",props:zr,setup(i){const e=D(()=>i.indicatorPlacement||i.indicatorPosition),t=D(()=>{if(i.gapDegree||i.gapDegree===0)return i.gapDegree;if(i.type==="dashboard")return 75}),{mergedClsPrefixRef:o,inlineThemeDisabled:n}=at(i),r=ye("Progress","-progress",Lr,Rn,i,o),s=D(()=>{const{status:l}=i,{common:{cubicBezierEaseInOut:c},self:{fontSize:d,fontSizeCircle:h,railColor:u,railHeight:p,iconSizeCircle:m,iconSizeLine:b,textColorCircle:S,textColorLineInner:P,textColorLineOuter:x,lineBgProcessing:I,fontWeightCircle:C,[B("iconColor",l)]:y,[B("fillColor",l)]:v}}=r.value;return{"--n-bezier":c,"--n-fill-color":v,"--n-font-size":d,"--n-font-size-circle":h,"--n-font-weight-circle":C,"--n-icon-color":y,"--n-icon-size-circle":m,"--n-icon-size-line":b,"--n-line-bg-processing":I,"--n-rail-color":u,"--n-rail-height":p,"--n-text-color-circle":S,"--n-text-color-line-inner":P,"--n-text-color-line-outer":x}}),a=n?lt("progress",D(()=>i.status[0]),s,i):void 0;return{mergedClsPrefix:o,mergedIndicatorPlacement:e,gapDeg:t,cssVars:n?void 0:s,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender}},render(){const{type:i,cssVars:e,indicatorTextColor:t,showIndicator:o,status:n,railColor:r,railStyle:s,color:a,percentage:l,viewBoxWidth:c,strokeWidth:d,mergedIndicatorPlacement:h,unit:u,borderRadius:p,fillBorderRadius:m,height:b,processing:S,circleGap:P,mergedClsPrefix:x,gapDeg:I,gapOffsetDegree:C,themeClass:y,$slots:v,onRender:f}=this;return f==null||f(),g("div",{class:[y,"".concat(x,"-progress"),"".concat(x,"-progress--").concat(i),"".concat(x,"-progress--").concat(n)],style:e,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":l,role:i==="circle"||i==="line"||i==="dashboard"?"progressbar":"none"},i==="circle"||i==="dashboard"?g(Er,{clsPrefix:x,status:n,showIndicator:o,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,offsetDegree:this.offsetDegree,percentage:l,viewBoxWidth:c,strokeWidth:d,gapDegree:I===void 0?i==="dashboard"?75:0:I,gapOffsetDegree:C,unit:u},v):i==="line"?g(jr,{clsPrefix:x,status:n,showIndicator:o,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,percentage:l,processing:S,indicatorPlacement:h,unit:u,fillBorderRadius:m,railBorderRadius:p,height:b},v):i==="multiple-circle"?g(Tr,{clsPrefix:x,strokeWidth:d,railColor:r,fillColor:a,railStyle:s,viewBoxWidth:c,percentage:l,showIndicator:o,circleGap:P},v):null)}}),Ve=jt("n-upload"),Nr=E([M("upload","width: 100%;",[R("dragger-inside",[M("upload-trigger","\n display: block;\n ")]),R("drag-over",[M("upload-dragger","\n border: var(--n-dragger-border-hover);\n ")])]),M("upload-dragger","\n cursor: pointer;\n box-sizing: border-box;\n width: 100%;\n text-align: center;\n border-radius: var(--n-border-radius);\n padding: 24px;\n opacity: 1;\n transition:\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n background-color: var(--n-dragger-color);\n border: var(--n-dragger-border);\n ",[E("&:hover","\n border: var(--n-dragger-border-hover);\n "),R("disabled","\n cursor: not-allowed;\n ")]),M("upload-trigger","\n display: inline-block;\n box-sizing: border-box;\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[E("+",[M("upload-file-list","margin-top: 8px;")]),R("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n "),R("image-card","\n width: 96px;\n height: 96px;\n ",[M("base-icon","\n font-size: 24px;\n "),M("upload-dragger","\n padding: 0;\n height: 100%;\n width: 100%;\n display: flex;\n align-items: center;\n justify-content: center;\n ")])]),M("upload-file-list","\n line-height: var(--n-line-height);\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[E("a, img","outline: none;"),R("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n ",[M("upload-file","cursor: not-allowed;")]),R("grid","\n display: grid;\n grid-template-columns: repeat(auto-fill, 96px);\n grid-gap: 8px;\n margin-top: 0;\n "),M("upload-file","\n display: block;\n box-sizing: border-box;\n cursor: default;\n padding: 0px 12px 0 6px;\n transition: background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n ",[wi(),M("progress",[wi({foldPadding:!0})]),E("&:hover","\n background-color: var(--n-item-color-hover);\n ",[M("upload-file-info",[O("action","\n opacity: 1;\n ")])]),R("image-type","\n border-radius: var(--n-border-radius);\n text-decoration: underline;\n text-decoration-color: #0000;\n ",[M("upload-file-info","\n padding-top: 0px;\n padding-bottom: 0px;\n width: 100%;\n height: 100%;\n display: flex;\n justify-content: space-between;\n align-items: center;\n padding: 6px 0;\n ",[M("progress","\n padding: 2px 0;\n margin-bottom: 0;\n "),O("name","\n padding: 0 8px;\n "),O("thumbnail","\n width: 32px;\n height: 32px;\n font-size: 28px;\n display: flex;\n justify-content: center;\n align-items: center;\n ",[E("img","\n width: 100%;\n ")])])]),R("text-type",[M("progress","\n box-sizing: border-box;\n padding-bottom: 6px;\n margin-bottom: 6px;\n ")]),R("image-card-type","\n position: relative;\n width: 96px;\n height: 96px;\n border: var(--n-item-border-image-card);\n border-radius: var(--n-border-radius);\n padding: 0;\n display: flex;\n align-items: center;\n justify-content: center;\n transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n overflow: hidden;\n ",[M("progress","\n position: absolute;\n left: 8px;\n bottom: 8px;\n right: 8px;\n width: unset;\n "),M("upload-file-info","\n padding: 0;\n width: 100%;\n height: 100%;\n ",[O("thumbnail","\n width: 100%;\n height: 100%;\n display: flex;\n flex-direction: column;\n align-items: center;\n justify-content: center;\n font-size: 36px;\n ",[E("img","\n width: 100%;\n ")])]),E("&::before",'\n position: absolute;\n z-index: 1;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n opacity: 0;\n transition: opacity .2s var(--n-bezier);\n content: "";\n '),E("&:hover",[E("&::before","opacity: 1;"),M("upload-file-info",[O("thumbnail","opacity: .12;")])])]),R("error-status",[E("&:hover","\n background-color: var(--n-item-color-hover-error);\n "),M("upload-file-info",[O("name","color: var(--n-item-text-color-error);"),O("thumbnail","color: var(--n-item-text-color-error);")]),R("image-card-type","\n border: var(--n-item-border-image-card-error);\n ")]),R("with-url","\n cursor: pointer;\n ",[M("upload-file-info",[O("name","\n color: var(--n-item-text-color-success);\n text-decoration-color: var(--n-item-text-color-success);\n ",[E("a","\n text-decoration: underline;\n ")])])]),M("upload-file-info","\n position: relative;\n padding-top: 6px;\n padding-bottom: 6px;\n display: flex;\n flex-wrap: nowrap;\n ",[O("thumbnail","\n font-size: 18px;\n opacity: 1;\n transition: opacity .2s var(--n-bezier);\n color: var(--n-item-icon-color);\n ",[M("base-icon","\n margin-right: 2px;\n vertical-align: middle;\n transition: color .3s var(--n-bezier);\n ")]),O("action","\n padding-top: inherit;\n padding-bottom: inherit;\n position: absolute;\n right: 0;\n top: 0;\n bottom: 0;\n width: 80px;\n display: flex;\n align-items: center;\n transition: opacity .2s var(--n-bezier);\n justify-content: flex-end;\n opacity: 0;\n ",[M("button",[E("&:not(:last-child)",{marginRight:"4px"}),M("base-icon",[E("svg",[go()])])]),R("image-type","\n position: relative;\n max-width: 80px;\n width: auto;\n "),R("image-card-type","\n z-index: 2;\n position: absolute;\n width: 100%;\n height: 100%;\n left: 0;\n right: 0;\n bottom: 0;\n top: 0;\n display: flex;\n justify-content: center;\n align-items: center;\n ")]),O("name","\n color: var(--n-item-text-color);\n flex: 1;\n display: flex;\n justify-content: center;\n text-overflow: ellipsis;\n overflow: hidden;\n flex-direction: column;\n text-decoration-color: #0000;\n font-size: var(--n-font-size);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier); \n ",[E("a","\n color: inherit;\n text-decoration: underline;\n ")])])])]),M("upload-file-input","\n display: none;\n width: 0;\n height: 0;\n opacity: 0;\n ")]),Mo="__UPLOAD_DRAGGER__",Fo=_({name:"UploadDragger",[Mo]:!0,setup(i,{slots:e}){const t=K(Ve,null);return t||dt("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:o},mergedDisabledRef:{value:n},maxReachedRef:{value:r}}=t;return g("div",{class:["".concat(o,"-upload-dragger"),(n||r)&&"".concat(o,"-upload-dragger--disabled")]},e)}}}),Wr=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),Ur=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),Ar=_({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:K(Ve).mergedThemeRef}},render(){return g(ri,null,{default:()=>this.show?g($r,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null})}});var ei=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(d){try{c(o.next(d))}catch(h){s(h)}}function l(d){try{c(o.throw(d))}catch(h){s(h)}}function c(d){d.done?r(d.value):n(d.value).then(a,l)}c((o=o.apply(i,e||[])).next())})};function _o(i){return i.includes("image/")}function Ui(i=""){const e=i.split("/"),o=e[e.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(o)||[""])[0]}const Ai=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,Do=i=>{if(i.type)return _o(i.type);const e=Ui(i.name||"");if(Ai.test(e))return!0;const t=i.thumbnailUrl||i.url||"",o=Ui(t);return!!(/^data:image\//.test(t)||Ai.test(o))};function Gr(i){return ei(this,void 0,void 0,function*(){return yield new Promise(e=>{if(!i.type||!_o(i.type)){e("");return}e(window.URL.createObjectURL(i))})})}const Hr=He&&window.FileReader&&window.File;function Vr(i){return i.isDirectory}function Xr(i){return i.isFile}function Kr(i,e){return ei(this,void 0,void 0,function*(){const t=[];function o(n){return ei(this,void 0,void 0,function*(){for(const r of n)if(r){if(e&&Vr(r)){const s=r.createReader();let a=[],l;try{do l=yield new Promise((c,d)=>{s.readEntries(c,d)}),a=a.concat(l);while(l.length>0)}catch(c){Pi("upload","error happens when handling directory upload",c)}yield o(a)}else if(Xr(r))try{const s=yield new Promise((a,l)=>{r.file(a,l)});t.push({file:s,entry:r,source:"dnd"})}catch(s){Pi("upload","error happens when handling file upload",s)}}})}return yield o(i),t})}function ot(i){const{id:e,name:t,percentage:o,status:n,url:r,file:s,thumbnailUrl:a,type:l,fullPath:c,batchId:d}=i;return{id:e,name:t,percentage:o!=null?o:null,status:n,url:r!=null?r:null,file:s!=null?s:null,thumbnailUrl:a!=null?a:null,type:l!=null?l:null,fullPath:c!=null?c:null,batchId:d!=null?d:null}}function Yr(i,e,t){return i=i.toLowerCase(),e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase(),t.split(",").map(n=>n.trim()).filter(Boolean).some(n=>{if(n.startsWith(".")){if(i.endsWith(n))return!0}else if(n.includes("/")){const[r,s]=e.split("/"),[a,l]=n.split("/");if((a==="*"||r&&a&&a===r)&&(l==="*"||s&&l&&l===s))return!0}else return!0;return!1})}var Gi=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(d){try{c(o.next(d))}catch(h){s(h)}}function l(d){try{c(o.throw(d))}catch(h){s(h)}}function c(d){d.done?r(d.value):n(d.value).then(a,l)}c((o=o.apply(i,e||[])).next())})};const bt={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},qr=_({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup(i){const e=K(Ve),t=j(null),o=j(""),n=D(()=>{const{file:y}=i;return y.status==="finished"?"success":y.status==="error"?"error":"info"}),r=D(()=>{const{file:y}=i;if(y.status==="error")return"error"}),s=D(()=>{const{file:y}=i;return y.status==="uploading"}),a=D(()=>{if(!e.showCancelButtonRef.value)return!1;const{file:y}=i;return["uploading","pending","error"].includes(y.status)}),l=D(()=>{if(!e.showRemoveButtonRef.value)return!1;const{file:y}=i;return["finished"].includes(y.status)}),c=D(()=>{if(!e.showDownloadButtonRef.value)return!1;const{file:y}=i;return["finished"].includes(y.status)}),d=D(()=>{if(!e.showRetryButtonRef.value)return!1;const{file:y}=i;return["error"].includes(y.status)}),h=mo(()=>o.value||i.file.thumbnailUrl||i.file.url),u=D(()=>{if(!e.showPreviewButtonRef.value)return!1;const{file:{status:y},listType:v}=i;return["finished"].includes(y)&&h.value&&v==="image-card"});function p(){return Gi(this,void 0,void 0,function*(){const y=e.onRetryRef.value;y&&(yield y({file:i.file}))===!1||e.submit(i.file.id)})}function m(y){y.preventDefault();const{file:v}=i;["finished","pending","error"].includes(v.status)?S(v):["uploading"].includes(v.status)?x(v):bo("upload","The button clicked type is unknown.")}function b(y){y.preventDefault(),P(i.file)}function S(y){const{xhrMap:v,doChange:f,onRemoveRef:{value:k},mergedFileListRef:{value:w}}=e;Promise.resolve(k?k({file:Object.assign({},y),fileList:w,index:i.index}):!0).then(F=>{if(F===!1)return;const L=Object.assign({},y,{status:"removed"});v.delete(y.id),f(L,void 0,{remove:!0})})}function P(y){const{onDownloadRef:{value:v}}=e;Promise.resolve(v?v(Object.assign({},y)):!0).then(f=>{f!==!1&&Jn(y.url,y.name)})}function x(y){const{xhrMap:v}=e,f=v.get(y.id);f==null||f.abort(),S(Object.assign({},y))}function I(y){const{onPreviewRef:{value:v}}=e;if(v)v(i.file,{event:y});else if(i.listType==="image-card"){const{value:f}=t;if(!f)return;f.click()}}const C=()=>Gi(this,void 0,void 0,function*(){const{listType:y}=i;y!=="image"&&y!=="image-card"||e.shouldUseThumbnailUrlRef.value(i.file)&&(o.value=yield e.getFileThumbnailUrlResolver(i.file))});return jn(()=>{C()}),{mergedTheme:e.mergedThemeRef,progressStatus:n,buttonType:r,showProgress:s,disabled:e.mergedDisabledRef,showCancelButton:a,showRemoveButton:l,showDownloadButton:c,showRetryButton:d,showPreviewButton:u,mergedThumbnailUrl:h,shouldUseThumbnailUrl:e.shouldUseThumbnailUrlRef,renderIcon:e.renderIconRef,imageRef:t,handleRemoveOrCancelClick:m,handleDownloadClick:b,handleRetryClick:p,handlePreviewClick:I}},render(){const{clsPrefix:i,mergedTheme:e,listType:t,file:o,renderIcon:n}=this;let r;const s=t==="image";s||t==="image-card"?r=!this.shouldUseThumbnailUrl(o)||!this.mergedThumbnailUrl?g("span",{class:"".concat(i,"-upload-file-info__thumbnail")},n?n(o):Do(o)?g(ue,{clsPrefix:i},{default:Wr}):g(ue,{clsPrefix:i},{default:Ur})):g("a",{rel:"noopener noreferer",target:"_blank",href:o.url||void 0,class:"".concat(i,"-upload-file-info__thumbnail"),onClick:this.handlePreviewClick},t==="image-card"?g(qn,{src:this.mergedThumbnailUrl||void 0,previewSrc:o.url||void 0,alt:o.name,ref:"imageRef"}):g("img",{src:this.mergedThumbnailUrl||void 0,alt:o.name})):r=g("span",{class:"".concat(i,"-upload-file-info__thumbnail")},n?n(o):g(ue,{clsPrefix:i},{default:()=>g(lr,null)}));const l=g(Ar,{show:this.showProgress,percentage:o.percentage||0,status:this.progressStatus}),c=t==="text"||t==="image";return g("div",{class:["".concat(i,"-upload-file"),"".concat(i,"-upload-file--").concat(this.progressStatus,"-status"),o.url&&o.status!=="error"&&t!=="image-card"&&"".concat(i,"-upload-file--with-url"),"".concat(i,"-upload-file--").concat(t,"-type")]},g("div",{class:"".concat(i,"-upload-file-info")},r,g("div",{class:"".concat(i,"-upload-file-info__name")},c&&(o.url&&o.status!=="error"?g("a",{rel:"noopener noreferer",target:"_blank",href:o.url||void 0,onClick:this.handlePreviewClick},o.name):g("span",{onClick:this.handlePreviewClick},o.name)),s&&l),g("div",{class:["".concat(i,"-upload-file-info__action"),"".concat(i,"-upload-file-info__action--").concat(t,"-type")]},this.showPreviewButton?g(Se,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:bt},{icon:()=>g(ue,{clsPrefix:i},{default:()=>g(cr,null)})}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&g(Se,{key:"cancelOrTrash",theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:bt,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:()=>g(fo,null,{default:()=>this.showRemoveButton?g(ue,{clsPrefix:i,key:"trash"},{default:()=>g(hr,null)}):g(ue,{clsPrefix:i,key:"cancel"},{default:()=>g(dr,null)})})}),this.showRetryButton&&!this.disabled&&g(Se,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:bt},{icon:()=>g(ue,{clsPrefix:i},{default:()=>g(ur,null)})}),this.showDownloadButton?g(Se,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:bt},{icon:()=>g(ue,{clsPrefix:i},{default:()=>g(Zn,null)})}):null)),!s&&l)}}),Oo=_({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup(i,{slots:e}){const t=K(Ve,null);t||dt("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef:o,mergedDisabledRef:n,maxReachedRef:r,listTypeRef:s,dragOverRef:a,openOpenFileDialog:l,draggerInsideRef:c,handleFileAddition:d,mergedDirectoryDndRef:h,triggerClassRef:u,triggerStyleRef:p}=t,m=D(()=>s.value==="image-card");function b(){n.value||r.value||l()}function S(C){C.preventDefault(),a.value=!0}function P(C){C.preventDefault(),a.value=!0}function x(C){C.preventDefault(),a.value=!1}function I(C){var y;if(C.preventDefault(),!c.value||n.value||r.value){a.value=!1;return}const v=(y=C.dataTransfer)===null||y===void 0?void 0:y.items;v!=null&&v.length?Kr(Array.from(v).map(f=>f.webkitGetAsEntry()),h.value).then(f=>{d(f)}).finally(()=>{a.value=!1}):a.value=!1}return()=>{var C;const{value:y}=o;return i.abstract?(C=e.default)===null||C===void 0?void 0:C.call(e,{handleClick:b,handleDrop:I,handleDragOver:S,handleDragEnter:P,handleDragLeave:x}):g("div",{class:["".concat(y,"-upload-trigger"),(n.value||r.value)&&"".concat(y,"-upload-trigger--disabled"),m.value&&"".concat(y,"-upload-trigger--image-card"),u.value],style:p.value,onClick:b,onDrop:I,onDragover:S,onDragenter:P,onDragleave:x},m.value?g(Fo,null,{default:()=>Xt(e.default,()=>[g(ue,{clsPrefix:y},{default:()=>g(ar,null)})])}):e)}}}),Zr=_({name:"UploadFileList",setup(i,{slots:e}){const t=K(Ve,null);t||dt("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef:o,mergedClsPrefixRef:n,listTypeRef:r,mergedFileListRef:s,fileListClassRef:a,fileListStyleRef:l,cssVarsRef:c,themeClassRef:d,maxReachedRef:h,showTriggerRef:u,imageGroupPropsRef:p}=t,m=D(()=>r.value==="image-card"),b=()=>s.value.map((P,x)=>g(qr,{clsPrefix:n.value,key:P.id,file:P,index:x,listType:r.value})),S=()=>m.value?g(Qn,Object.assign({},p.value),{default:b}):g(ri,{group:!0},{default:b});return()=>{const{value:P}=n,{value:x}=o;return g("div",{class:["".concat(P,"-upload-file-list"),m.value&&"".concat(P,"-upload-file-list--grid"),x?d==null?void 0:d.value:void 0,a.value],style:[x&&c?c.value:"",l.value]},S(),u.value&&!h.value&&m.value&&g(Oo,null,e))}}});var Hi=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(d){try{c(o.next(d))}catch(h){s(h)}}function l(d){try{c(o.throw(d))}catch(h){s(h)}}function c(d){d.done?r(d.value):n(d.value).then(a,l)}c((o=o.apply(i,e||[])).next())})};function Jr(i,e,t){const{doChange:o,xhrMap:n}=i;let r=0;function s(l){var c;let d=Object.assign({},e,{status:"error",percentage:r});n.delete(e.id),d=ot(((c=i.onError)===null||c===void 0?void 0:c.call(i,{file:d,event:l}))||d),o(d,l)}function a(l){var c;if(i.isErrorState){if(i.isErrorState(t)){s(l);return}}else if(t.status<200||t.status>=300){s(l);return}let d=Object.assign({},e,{status:"finished",percentage:r});n.delete(e.id),d=ot(((c=i.onFinish)===null||c===void 0?void 0:c.call(i,{file:d,event:l}))||d),o(d,l)}return{handleXHRLoad:a,handleXHRError:s,handleXHRAbort(l){const c=Object.assign({},e,{status:"removed",file:null,percentage:r});n.delete(e.id),o(c,l)},handleXHRProgress(l){const c=Object.assign({},e,{status:"uploading"});if(l.lengthComputable){const d=Math.ceil(l.loaded/l.total*100);c.percentage=d,r=d}o(c,l)}}}function Qr(i){const{inst:e,file:t,data:o,headers:n,withCredentials:r,action:s,customRequest:a}=i,{doChange:l}=i.inst;let c=0;a({file:t,data:o,headers:n,withCredentials:r,action:s,onProgress(d){const h=Object.assign({},t,{status:"uploading"}),u=d.percent;h.percentage=u,c=u,l(h)},onFinish(){var d;let h=Object.assign({},t,{status:"finished",percentage:c});h=ot(((d=e.onFinish)===null||d===void 0?void 0:d.call(e,{file:h}))||h),l(h)},onError(){var d;let h=Object.assign({},t,{status:"error",percentage:c});h=ot(((d=e.onError)===null||d===void 0?void 0:d.call(e,{file:h}))||h),l(h)}})}function es(i,e,t){const o=Jr(i,e,t);t.onabort=o.handleXHRAbort,t.onerror=o.handleXHRError,t.onload=o.handleXHRLoad,t.upload&&(t.upload.onprogress=o.handleXHRProgress)}function Bo(i,e){return typeof i=="function"?i({file:e}):i||{}}function ts(i,e,t){const o=Bo(e,t);o&&Object.keys(o).forEach(n=>{i.setRequestHeader(n,o[n])})}function is(i,e,t){const o=Bo(e,t);o&&Object.keys(o).forEach(n=>{i.append(n,o[n])})}function os(i,e,t,{method:o,action:n,withCredentials:r,responseType:s,headers:a,data:l}){const c=new XMLHttpRequest;c.responseType=s,i.xhrMap.set(t.id,c),c.withCredentials=r;const d=new FormData;if(is(d,l,t),t.file!==null&&d.append(e,t.file),es(i,t,c),n!==void 0){c.open(o.toUpperCase(),n),ts(c,a,t),c.send(d);const h=Object.assign({},t,{status:"uploading"});i.doChange(h)}}const ns=Object.assign(Object.assign({},ye.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:()=>[]},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:i=>Hr?Do(i):!1},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),rs=_({name:"Upload",props:ns,setup(i){i.abstract&&i.listType==="image-card"&&dt("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=at(i),o=ye("Upload","-upload",Nr,Tn,i,e),n=Io(i),r=j(i.defaultFileList),s=G(i,"fileList"),a=j(null),l={value:!1},c=j(!1),d=new Map,h=Ln(s,r),u=D(()=>h.value.map(ot)),p=D(()=>{const{max:w}=i;return w!==void 0?u.value.length>=w:!1});function m(){var w;(w=a.value)===null||w===void 0||w.click()}function b(w){const F=w.target;I(F.files?Array.from(F.files).map(L=>({file:L,entry:null,source:"input"})):null,w),F.value=""}function S(w){const{"onUpdate:fileList":F,onUpdateFileList:L}=i;F&&Be(F,w),L&&Be(L,w),r.value=w}const P=D(()=>i.multiple||i.directory),x=(w,F,L={append:!1,remove:!1})=>{const{append:$,remove:Z}=L,V=Array.from(u.value),J=V.findIndex(z=>z.id===w.id);if($||Z||~J){$?V.push(w):Z?V.splice(J,1):V.splice(J,1,w);const{onChange:z}=i;z&&z({file:w,fileList:V,event:F}),S(V)}};function I(w,F){if(!w||w.length===0)return;const{onBeforeUpload:L}=i;w=P.value?w:[w[0]];const{max:$,accept:Z}=i;w=w.filter(({file:J,source:z})=>z==="dnd"&&(Z!=null&&Z.trim())?Yr(J.name,J.type,Z):!0),$&&(w=w.slice(0,$-u.value.length));const V=Si();Promise.all(w.map(J=>Hi(this,[J],void 0,function*({file:z,entry:T}){var ie;const de={id:Si(),batchId:V,name:z.name,status:"pending",percentage:0,file:z,url:null,type:z.type,thumbnailUrl:null,fullPath:(ie=T==null?void 0:T.fullPath)!==null&&ie!==void 0?ie:"/".concat(z.webkitRelativePath||z.name)};return!L||(yield L({file:de,fileList:u.value}))!==!1?de:null}))).then(J=>Hi(this,void 0,void 0,function*(){let z=Promise.resolve();J.forEach(T=>{z=z.then(Re).then(()=>{T&&x(T,F,{append:!0})})}),yield z})).then(()=>{i.defaultUpload&&C()})}function C(w){const{method:F,action:L,withCredentials:$,headers:Z,data:V,name:J}=i,z=w!==void 0?u.value.filter(ie=>ie.id===w):u.value,T=w!==void 0;z.forEach(ie=>{const{status:de}=ie;(de==="pending"||de==="error"&&T)&&(i.customRequest?Qr({inst:{doChange:x,xhrMap:d,onFinish:i.onFinish,onError:i.onError},file:ie,action:L,withCredentials:$,headers:Z,data:V,customRequest:i.customRequest}):os({doChange:x,xhrMap:d,onFinish:i.onFinish,onError:i.onError,isErrorState:i.isErrorState},J,ie,{method:F,action:L,withCredentials:$,responseType:i.responseType,headers:Z,data:V}))})}function y(w){var F;if(w.thumbnailUrl)return w.thumbnailUrl;const{createThumbnailUrl:L}=i;return L?(F=L(w.file,w))!==null&&F!==void 0?F:w.url||"":w.url?w.url:w.file?Gr(w.file):""}const v=D(()=>{const{common:{cubicBezierEaseInOut:w},self:{draggerColor:F,draggerBorder:L,draggerBorderHover:$,itemColorHover:Z,itemColorHoverError:V,itemTextColorError:J,itemTextColorSuccess:z,itemTextColor:T,itemIconColor:ie,itemDisabledOpacity:de,lineHeight:pe,borderRadius:Ye,fontSize:Te,itemBorderImageCardError:qe,itemBorderImageCard:xe}}=o.value;return{"--n-bezier":w,"--n-border-radius":Ye,"--n-dragger-border":L,"--n-dragger-border-hover":$,"--n-dragger-color":F,"--n-font-size":Te,"--n-item-color-hover":Z,"--n-item-color-hover-error":V,"--n-item-disabled-opacity":de,"--n-item-icon-color":ie,"--n-item-text-color":T,"--n-item-text-color-error":J,"--n-item-text-color-success":z,"--n-line-height":pe,"--n-item-border-image-card-error":qe,"--n-item-border-image-card":xe}}),f=t?lt("upload",void 0,v,i):void 0;ce(Ve,{mergedClsPrefixRef:e,mergedThemeRef:o,showCancelButtonRef:G(i,"showCancelButton"),showDownloadButtonRef:G(i,"showDownloadButton"),showRemoveButtonRef:G(i,"showRemoveButton"),showRetryButtonRef:G(i,"showRetryButton"),onRemoveRef:G(i,"onRemove"),onDownloadRef:G(i,"onDownload"),mergedFileListRef:u,triggerClassRef:G(i,"triggerClass"),triggerStyleRef:G(i,"triggerStyle"),shouldUseThumbnailUrlRef:G(i,"shouldUseThumbnailUrl"),renderIconRef:G(i,"renderIcon"),xhrMap:d,submit:C,doChange:x,showPreviewButtonRef:G(i,"showPreviewButton"),onPreviewRef:G(i,"onPreview"),getFileThumbnailUrlResolver:y,listTypeRef:G(i,"listType"),dragOverRef:c,openOpenFileDialog:m,draggerInsideRef:l,handleFileAddition:I,mergedDisabledRef:n.mergedDisabledRef,maxReachedRef:p,fileListClassRef:G(i,"fileListClass"),fileListStyleRef:G(i,"fileListStyle"),abstractRef:G(i,"abstract"),acceptRef:G(i,"accept"),cssVarsRef:t?void 0:v,themeClassRef:f==null?void 0:f.themeClass,onRender:f==null?void 0:f.onRender,showTriggerRef:G(i,"showTrigger"),imageGroupPropsRef:G(i,"imageGroupProps"),mergedDirectoryDndRef:D(()=>{var w;return(w=i.directoryDnd)!==null&&w!==void 0?w:i.directory}),onRetryRef:G(i,"onRetry")});const k={clear:()=>{r.value=[]},submit:C,openOpenFileDialog:m};return Object.assign({mergedClsPrefix:e,draggerInsideRef:l,inputElRef:a,mergedTheme:o,dragOver:c,mergedMultiple:P,cssVars:t?void 0:v,themeClass:f==null?void 0:f.themeClass,onRender:f==null?void 0:f.onRender,handleFileInputChange:b},k)},render(){var i,e;const{draggerInsideRef:t,mergedClsPrefix:o,$slots:n,directory:r,onRender:s}=this;if(n.default&&!this.abstract){const l=n.default()[0];!((i=l==null?void 0:l.type)===null||i===void 0)&&i[Mo]&&(t.value=!0)}const a=g("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:"".concat(o,"-upload-file-input"),accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:r||void 0,directory:r||void 0}));return this.abstract?g(qt,null,(e=n.default)===null||e===void 0?void 0:e.call(n),g(wo,{to:"body"},a)):(s==null||s(),g("div",{class:["".concat(o,"-upload"),t.value&&"".concat(o,"-upload--dragger-inside"),this.dragOver&&"".concat(o,"-upload--drag-over"),this.themeClass],style:this.cssVars},a,this.showTrigger&&this.listType!=="image-card"&&g(Oo,null,n),this.showFileList&&g(Zr,null,n)))}});/*!
* @indoorequal/vue-maplibre-gl v8.2.2
* (c) 2025 Franois de Metz <francois@2metz.fr>
* @license MIT
*/var ss=Object.defineProperty,as=(i,e,t)=>e in i?ss(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,hi=(i,e,t)=>as(i,typeof e!="symbol"?e+"":e,t);const ls=Symbol("map"),Xe=ls,ct=Symbol("isLoaded"),ds=Symbol("isInitialized"),Eo=ds,pi=Symbol("componentId"),gi=Symbol("sourceId"),Ro=Symbol("sourceLayerRegistry"),cs=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function us(i,e,t,o){return n=>t.emit(o,{type:n.type,map:e,component:i,event:n})}function hs(i,e){const t=je.LngLat.convert(i),o=je.LngLat.convert(e);return t.lng===o.lng&&t.lat===o.lat}var ut=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(ut||{});const Ke=Object.values(ut),Vi=new Map,ps=Symbol("default");function gs(i,e,t=ps){var o;let n=Vi.get(t);return n||(n=$n({isLoaded:!1,isMounted:!1,language:null}),Vi.set(t,n)),n.isLoaded=((o=e.value)==null?void 0:o.loaded())||!1,n.isMounted=!1,n.component=i,n.map=e.value,n}const fs=_({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:i=>i in ut},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Object}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup(i,e){const t=Ii(Po()),o=Zt(),n=Zt(),r=j(!1),s=j(!1),a=new Map,l=gs(t,n,i.mapKey);ce(Xe,n),ce(ct,s),ce(Eo,r),ce(pi,t.uid),ce(gi,""),N(()=>i.bearing,u=>{var p;u&&((p=n.value)==null||p.setBearing(u))}),N(()=>i.bounds,u=>{var p;u&&((p=n.value)==null||p.fitBounds(u,i.fitBoundsOptions))}),N(()=>i.center,u=>{var p,m;const b=(p=n.value)==null?void 0:p.getCenter();u&&b&&!hs(u,b)&&((m=n.value)==null||m.setCenter(u))}),N(()=>i.maxBounds,u=>{var p;u&&((p=n.value)==null||p.setMaxBounds(u))}),N(()=>i.maxPitch,u=>{var p;u&&((p=n.value)==null||p.setMaxPitch(u))}),N(()=>i.maxZoom,u=>{var p;u&&((p=n.value)==null||p.setMaxZoom(u))}),N(()=>i.minPitch,u=>{var p;u&&((p=n.value)==null||p.setMinPitch(u))}),N(()=>i.minZoom,u=>{var p;u&&((p=n.value)==null||p.setMinZoom(u))}),N(()=>i.pitch,u=>{var p;u&&((p=n.value)==null||p.setPitch(u))}),N(()=>i.renderWorldCopies,u=>{var p;u&&((p=n.value)==null||p.setRenderWorldCopies(u))}),N(()=>i.mapStyle,u=>{var p;u&&((p=n.value)==null||p.setStyle(u))}),N(()=>i.transformRequest,u=>{var p;u&&((p=n.value)==null||p.setTransformRequest(u))}),N(()=>i.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))}),N(()=>i.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))});function c(){l.isMounted=!0;const u={...i,style:i.mapStyle,container:o.value};for(const p of Object.keys(u))u[p]===void 0&&delete u[p];if(n.value=Ii(new je.Map(u)),l.map=n.value,r.value=!0,a.set("__load",()=>(s.value=!0,l.isLoaded=!0)),n.value.on("load",a.get("__load")),a.set("__moveend",()=>e.emit("update:center",n.value.getCenter())),n.value.on("moveend",a.get("__moveend")),a.set("__zoomend",()=>e.emit("update:zoom",n.value.getZoom())),n.value.on("zoomend",a.get("__zoomend")),a.set("__pitchend",()=>e.emit("update:pitch",n.value.getPitch())),n.value.on("pitchend",a.get("__pitchend")),a.set("__rotateend",()=>e.emit("update:bearing",n.value.getBearing())),n.value.on("rotateend",a.get("__rotateend")),t.vnode.props){for(const p of cs)if(t.vnode.props["onMap:"+p]){const m="map:".concat(p),b=us(t,n.value,e,m);a.set(p,b),n.value.on(p,b)}}n.value.getCanvas().addEventListener("webglcontextlost",h)}async function d(){l.isMounted=!1,l.isLoaded=!1,s.value=!1,n.value&&(n.value.getCanvas().removeEventListener("webglcontextlost",h),r.value=!1,a.forEach((u,p)=>{n.value.off(p.startsWith("__")?p.substring(2):p,u)}),n.value.remove())}function h(){d(),Re(c)}return ni(c),he(d),e.expose({map:n}),()=>[g("div",{ref:o,style:{height:i.height,width:i.width}}),r.value&&e.slots.default?e.slots.default({}):void 0]},render(){return null}});function ms(i,e,t){N(i,o=>{var n,r;o&&Ke.indexOf(o)===-1||((n=e.value)!=null&&n.hasControl(t)&&e.value.removeControl(t),(r=e.value)==null||r.addControl(t,o))},{immediate:!0})}function ht(i,e){const t=K(Xe),o=K(Eo),n=Zt();return n.value=i(),ms(()=>e.position,t,n.value),he(()=>{var r;return o.value&&((r=t.value)==null?void 0:r.removeControl(n.value))}),{control:n,map:t}}let ys=class{constructor(e,t){hi(this,"container"),this.isAdded=e,this.container=document.createElement("div"),this.setClasses(t)}getDefaultPosition(){return ut.TOP_LEFT}onAdd(){return Re(()=>this.isAdded.value=!0),this.container}onRemove(){this.isAdded.value=!1,this.container.remove()}setClasses(e){this.container.className=e}};const Xi=_({name:"MglCustomControl",props:{position:{type:String,validator:i=>Ke.indexOf(i)!==-1},class:{type:String,default:"maplibregl-ctrl maplibregl-ctrl-group"}},slots:Object,setup(i,{slots:e}){const t=j(!1),{control:o}=ht(()=>new ys(t,i.class),i);return N(()=>i.class,()=>o.value.setClasses(i.class)),()=>{var n;return t.value?g(wo,{to:o.value.container},(n=e.default)==null?void 0:n.call(e,{})):Ee("custom-component")}},render(){return null}}),vs=_({name:"MglFullscreenControl",props:{position:{type:String,validator:i=>Ke.indexOf(i)!==-1},container:{type:Object,default:null}},setup(i){const{control:e,map:t}=ht(()=>new je.FullscreenControl({container:i.container||void 0}),i);function o(){Re(()=>{var n;return(n=t.value)==null?void 0:n.resize()})}e.value.on("fullscreenstart",o),e.value.on("fullscreenend",o),he(()=>{e.value.off("fullscreenstart",o),e.value.off("fullscreenend",o)})},render(){return null}}),bs=_({name:"MglGeolocateControl",props:{position:{type:String,default:ut.TOP_RIGHT,validator:i=>Ke.indexOf(i)!==-1},positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},emits:["trackuserlocationstart","trackuserlocationend","userlocationlostfocus","userlocationfocus","geolocate","error","outofmaxbounds"],setup(i,e){const{control:t}=ht(()=>new je.GeolocateControl({positionOptions:i.positionOptions,fitBoundsOptions:i.fitBoundsOptions,trackUserLocation:i.trackUserLocation,showAccuracyCircle:i.showAccuracyCircle,showUserLocation:i.showUserLocation}),i);function o(n){const r=s=>{e.emit(n,s)};t.value.on(n,r),he(()=>{t.value.off(n,r)})}o("trackuserlocationstart"),o("trackuserlocationend"),o("userlocationlostfocus"),o("userlocationfocus"),o("geolocate"),o("error"),o("outofmaxbounds")},render(){return null}}),Cs=_({name:"MglNavigationControl",props:{position:{type:String,validator:i=>Ke.indexOf(i)!==-1},showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:Boolean},setup(i){ht(()=>new je.NavigationControl({showCompass:i.showCompass,showZoom:i.showZoom,visualizePitch:i.visualizePitch}),i)},render(){return null}});var jo=(i=>(i.IMPERIAL="imperial",i.METRIC="metric",i.NAUTICAL="nautical",i))(jo||{});const xs=Object.values(jo),ws=_({name:"MglScaleControl",props:{position:{type:String,validator:i=>Ke.indexOf(i)!==-1},maxWidth:{type:Number,default:100},unit:{type:String,default:"metric",validator:i=>xs.indexOf(i)!==-1}},setup(i){ht(()=>new je.ScaleControl({maxWidth:i.maxWidth,unit:i.unit}),i)},render(){return null}});let Ps=class{constructor(){hi(this,"unmountHandlers",new Map)}registerUnmountHandler(e,t){this.unmountHandlers.set(e,t)}unregisterUnmountHandler(e){this.unmountHandlers.delete(e)}unmount(){this.unmountHandlers.forEach(e=>e())}};const To=class ti{static genSourceOpts(e){const t={...e};for(const o of Object.keys(t))(t[o]===void 0||o==="sourceId")&&delete t[o];return t}static getSourceRef(e,t){const o=typeof t=="string",n=String(e)+(o?t:"");let r=ti.REFS.get(n);return r||(r=j(o?null:void 0),ti.REFS.set(n,r)),r}};hi(To,"REFS",new Map);let fi=To;function Ss(i,e,t){const o=K(Xe),n=K(ct);function r(){n.value&&(o.value.addSource(e.sourceId,fi.genSourceOpts(e)),i.value=o.value.getSource(e.sourceId))}return N(n,r,{immediate:!0}),o.value.on("style.load",r),he(()=>{n.value&&(t.unmount(),o.value.removeSource(e.sourceId)),o.value.off("style.load",r)})}const Is=_({name:"MglGeoJsonSource",props:{sourceId:{type:String,required:!0},data:{type:[Object,String],required:!0},maxzoom:Number,attribution:String,buffer:Number,tolerance:Number,cluster:Boolean,clusterRadius:Number,clusterMaxZoom:Number,clusterMinPoints:Number,clusterProperties:Object,lineMetrics:Boolean,generateId:Boolean,promoteId:[Object,String],filter:[Array,String,Object]},slots:Object,setup(i,{slots:e}){const t=K(pi),o=fi.getSourceRef(t,i.sourceId),n=new Ps,r={...i,type:"geojson"};return ce(gi,i.sourceId),ce(Ro,n),Ss(o,r,n),N([zn(i.data)?i.data:()=>i.data,o],([s,a])=>{a==null||a.setData(s||{type:"FeatureCollection",features:[]})},{immediate:!0}),()=>[Ee("GeoJSON Source"),o.value&&e.default?e.default({}):void 0]}}),me=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function ke(){return{layerId:{type:String,required:!0},source:String,metadata:[Object,Array,String,Number],sourceLayer:String,minzoom:Number,maxzoom:Number,filter:Object,before:String,layout:Object,paint:Object}}function ks(i,e,t,o){const n={id:i,type:e,source:t.source||o,metadata:t.metadata,minzoom:t.minzoom,maxzoom:t.maxzoom,"source-layer":t.sourceLayer,filter:t.filter,paint:t.paint,layout:t.layout};for(const r of Object.keys(n))n[r]===void 0&&delete n[r];return n}function Ms(i,e,t){if(t.props)for(const o of me){const n="on"+o.charAt(0).toUpperCase()+o.substr(1);t.props[n]&&i.on(o,e,t.props[n])}}function Fs(i,e,t){if(t.props)for(const o of me){const n="on"+o.charAt(0).toUpperCase()+o.substr(1);t.props[n]&&i.off(o,e,t.props[n])}}function Lo(i,e){const t=K(Xe),o=K(ct),n=K(Ro);function r(){o.value&&(e&&Fs(t.value,i,e.vnode),t.value.getLayer(i)&&t.value.removeLayer(i))}n.registerUnmountHandler(i,r),he(()=>{n.unregisterUnmountHandler(i),r()})}_({name:"MglBackgroundLayer",props:{layerId:{type:String,required:!0},metadata:[Object,Array,String,Number],minzoom:Number,maxzoom:Number,before:String,layout:Object,paint:Object},emits:[...me],setup(i){const e=K(Xe),t=K(ct);return Lo(i.layerId),N(()=>i.layout,o=>{if(o)for(const[n,r]of Object.entries(o))e.value.setLayoutProperty(i.layerId,n,r)}),N(()=>i.paint,o=>{if(o)for(const[n,r]of Object.entries(o))e.value.setPaintProperty(i.layerId,n,r)}),N(t,o=>{o&&e.value.addLayer({id:i.layerId,type:"background",metadata:i.metadata,minzoom:i.minzoom,maxzoom:i.maxzoom,layout:i.layout,paint:i.paint},i.before||void 0)},{immediate:!0}),()=>Ee("Background Layer")}});function Me(i,e){const t=K(gi);if(!t&&!e.source)return;const o=Po(),n=K(Xe),r=K(ct),s=K(pi),a=fi.getSourceRef(s,e.source||t);return Lo(e.layerId,o),N(()=>e.minzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),N(()=>e.maxzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),N(()=>e.layout,l=>{if(l)for(const[c,d]of Object.entries(l))n.value.setLayoutProperty(e.layerId,c,d)},{deep:!0}),N(()=>e.paint,l=>{if(l)for(const[c,d]of Object.entries(l))n.value.setPaintProperty(e.layerId,c,d)},{deep:!0}),N(()=>e.filter,l=>n.value.setFilter(e.layerId,l),{deep:!0}),N([r,a],([l,c])=>{l&&(c||c===void 0)&&(n.value.addLayer(ks(e.layerId,i,e,t),e.before||void 0),Ms(n.value,e.layerId,o.vnode))},{immediate:!0}),()=>Ee("".concat(i," Layer"))}_({name:"MglCircleLayer",props:{...ke()},emits:[...me],setup(i){return Me("circle",i)}});_({name:"MglFillLayer",props:{...ke()},emits:[...me],setup(i){return Me("fill",i)}});_({name:"MglFillExtrusionLayer",props:{...ke()},emits:[...me],setup(i){return Me("fill-extrusion",i)}});_({name:"MglHeatmapLayer",props:{...ke()},emits:[...me],setup(i){return Me("heatmap",i)}});_({name:"MglHillshadeLayer",props:{...ke()},emits:[...me],setup(i){return Me("hillshade",i)}});const _s=_({name:"MglLineLayer",props:{...ke()},emits:[...me],setup(i){return Me("line",i)}});_({name:"MglRasterLayer",props:{...ke()},emits:[...me],setup(i){return Me("raster",i)}});_({name:"MglSymbolLayer",props:{...ke()},emits:[...me],setup(i){return Me("symbol",i)}});function H(){return H=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)({}).hasOwnProperty.call(t,o)&&(i[o]=t[o])}return i},H.apply(null,arguments)}var W;(function(i){i.Commit="commit",i.Provisional="provisional",i.Finish="finish"})(W||(W={}));const be={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT:"selectionPoint"},ve="edited",nt="closingPoint",ii="snappingPoint";function Ut(i){return!!(i&&typeof i=="object"&&i!==null&&!Array.isArray(i))}function Ki(i){return!!function(e){return typeof e=="number"&&!isNaN(new Date(e).valueOf())}(i)}const Ds="Feature mode property does not match the mode being added to";var Ge;(function(i){i.Drawing="drawing",i.Select="select",i.Static="static",i.Render="render"})(Ge||(Ge={}));class Fe{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,t=!1){this._state="unregistered",this._styles={},this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=Ge.Drawing,this.mode="base",t||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=H({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const t=function(o,n){let r;if(Ut(o))if(o.id==null)r="Feature has no id";else if(typeof o.id!="string"&&typeof o.id!="number")r="Feature must be string or number as per GeoJSON spec";else if(n(o.id))if(Ut(o.geometry))if(Ut(o.properties))if(typeof o.geometry.type=="string"&&["Polygon","LineString","Point"].includes(o.geometry.type))if(Array.isArray(o.geometry.coordinates)){if(!o.properties.mode||typeof o.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else r="Feature coordinates is not an array";else r="Feature is not Point, LineString or Polygon";else r="Feature has no properties";else r="Feature has no geometry";else r="Feature must match the id strategy (default is UUID4)";else r="Feature is not object";return r?{valid:!1,reason:r}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){const o=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Provisional});return{valid:t.valid&&o.valid,reason:o.reason}}return{valid:t.valid,reason:t.reason}}validateModeFeature(e,t){const o=this.performFeatureValidation(e);return o.valid?e.properties.mode!==this.mode?{valid:!1,reason:Ds}:t(e):{valid:!1,reason:o.reason}}onFinish(e,t){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,t){}onDrag(e,t){}onDragEnd(e,t){}getHexColorStylingValue(e,t,o){return this.getStylingValue(e,t,o)}getNumericStylingValue(e,t,o){return this.getStylingValue(e,t,o)}getStylingValue(e,t,o){return e===void 0?t:typeof e=="function"?e(o):e}}class Os extends Fe{constructor(...e){super(...e),this.type=Ge.Select}}function fe(i,e){const t=c=>c*Math.PI/180,o=t(i[1]),n=t(i[0]),r=t(e[1]),s=r-o,a=t(e[0])-n,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}const zo=63710088e-1;function se(i){return i%360*Math.PI/180}function $o(i){return i/6371.0088}function Ie(i){return i%(2*Math.PI)*180/Math.PI}function ne(i,e=9){const t=Math.pow(10,e);return Math.round(i*t)/t}const Yi=57.29577951308232,qi=.017453292519943295,Dt=6378137,X=(i,e)=>({x:i===0?0:i*qi*Dt,y:e===0?0:Math.log(Math.tan(Math.PI/4+e*qi/2))*Dt}),Ce=(i,e)=>({lng:i===0?0:Yi*(i/Dt),lat:e===0?0:(2*Math.atan(Math.exp(e/Dt))-Math.PI/2)*Yi});function Bs(i,e,t){const o=se(i[0]),n=se(i[1]),r=se(t),s=$o(e),a=Math.asin(Math.sin(n)*Math.cos(s)+Math.cos(n)*Math.sin(s)*Math.cos(r));return[Ie(o+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(n),Math.cos(s)-Math.sin(n)*Math.sin(a))),Ie(a)]}function Zi(i){const{center:e,radiusKilometers:t,coordinatePrecision:o}=i,n=i.steps?i.steps:64,r=[];for(let s=0;s<n;s++){const a=Bs(e,t,-360*s/n);r.push([ne(a[0],o),ne(a[1],o)])}return r.push(r[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}}}function No(i){let e;if(i.geometry.type==="Polygon")e=i.geometry.coordinates;else{if(i.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e=[i.geometry.coordinates]}const t=[];for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length-1;s++)for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length-1;l++)n(r,s,a,l);return t.length>0;function o(r){return r<0||r>1}function n(r,s,a,l){const c=e[r][s],d=e[r][s+1],h=e[a][l],u=e[a][l+1],p=function(S,P,x,I){if(Ct(S,x)||Ct(S,I)||Ct(P,x)||Ct(I,x))return null;const C=S[0],y=S[1],v=P[0],f=P[1],k=x[0],w=x[1],F=I[0],L=I[1],$=(C-v)*(w-L)-(y-f)*(k-F);return $===0?null:[((C*f-y*v)*(k-F)-(C-v)*(k*L-w*F))/$,((C*f-y*v)*(w-L)-(y-f)*(k*L-w*F))/$]}(c,d,h,u);if(p===null)return;let m,b;m=d[0]!==c[0]?(p[0]-c[0])/(d[0]-c[0]):(p[1]-c[1])/(d[1]-c[1]),b=u[0]!==h[0]?(p[0]-h[0])/(u[0]-h[0]):(p[1]-h[1])/(u[1]-h[1]),o(m)||o(b)||(p.toString(),t.push(p))}}function Ct(i,e){return i[0]===e[0]&&i[1]===e[1]}function zt(i,e){return i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"&&i[0]!==1/0&&i[1]!==1/0&&(o=i[0])>=-180&&o<=180&&(t=i[1])>=-90&&t<=90&&Ji(i[0])<=e&&Ji(i[1])<=e;var t,o}function Ji(i){let e=1,t=0;for(;Math.round(i*e)/e!==i;)e*=10,t++;return t}const Es="Feature has holes",Rs="Feature has less than 4 coordinates",js="Feature has invalid coordinates",Ts="Feature coordinates are not closed";function mi(i,e){return i.geometry.type!=="Polygon"?{valid:!1,reason:"Feature is not a Polygon"}:i.geometry.coordinates.length!==1?{valid:!1,reason:Es}:i.geometry.coordinates[0].length<4?{valid:!1,reason:Rs}:i.geometry.coordinates[0].every(n=>zt(n,e))?(t=i.geometry.coordinates[0][0])[0]!==(o=i.geometry.coordinates[0][i.geometry.coordinates[0].length-1])[0]||t[1]!==o[1]?{valid:!1,reason:Ts}:{valid:!0}:{valid:!1,reason:js};var t,o}function Wo(i,e){const t=mi(i,e);return t.valid?No(i)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:t}const Ls={cancel:"Escape",finish:"Enter"},zs={start:"crosshair"};class $s extends Fe{constructor(e){super(e,!0),this.mode="circle",this.center=void 0,this.clickCount=0,this.currentCircleId=void 0,this.keyEvents=Ls,this.cursors=zs,this.startingRadiusKilometers=1e-5,this.cursorMovedAfterInitialCursorDown=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents)),e!=null&&e.startingRadiusKilometers&&(this.startingRadiusKilometers=e.startingRadiusKilometers)}close(){if(this.currentCircleId===void 0)return;const e=this.currentCircleId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(this.clickCount===0){this.center=[e.lng,e.lat];const t=Zi({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),[o]=this.store.create([{geometry:t.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers}}]);this.currentCircleId=o,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else this.clickCount===1&&this.center&&this.currentCircleId!==void 0&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(e),this.close()}onMouseMove(e){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(e)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e])}catch(t){}}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10),t}validateFeature(e){return this.validateModeFeature(e,t=>Wo(t,this.coordinatePrecision))}updateCircle(e){if(this.clickCount===1&&this.center&&this.currentCircleId){const t=fe(this.center,[e.lng,e.lat]);let o;if(this.projection==="web-mercator"){const n=function(r,s){const a=1e3*fe(r,s);if(a===0)return 1;const{x:l,y:c}=X(r[0],r[1]),{x:d,y:h}=X(s[0],s[1]);return Math.sqrt(Math.pow(d-l,2)+Math.pow(h-c,2))/a}(this.center,[e.lng,e.lat]);o=function(r){const{center:s,radiusKilometers:a,coordinatePrecision:l}=r,c=r.steps?r.steps:64,d=1e3*a,[h,u]=s,{x:p,y:m}=X(h,u),b=[];for(let S=0;S<c;S++){const P=360*S/c*Math.PI/180,x=d*Math.cos(P),I=d*Math.sin(P),[C,y]=[p+x,m+I],{lng:v,lat:f}=Ce(C,y);b.push([ne(v,l),ne(f,l)])}return b.push(b[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[b]},properties:{}}}({center:this.center,radiusKilometers:t*n,coordinatePrecision:this.coordinatePrecision})}else{if(this.projection!=="globe")throw new Error("Invalid projection");o=Zi({center:this.center,radiusKilometers:t,coordinatePrecision:this.coordinatePrecision})}if(this.validate&&!this.validate({type:"Feature",id:this.currentCircleId,geometry:o.geometry,properties:{radiusKilometers:t}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Provisional}).valid)return;this.store.updateGeometry([{id:this.currentCircleId,geometry:o.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:t}])}}}const ge=(i,e)=>{const{x:t,y:o}=i,{x:n,y:r}=e,s=n-t,a=r-o;return Math.sqrt(a*a+s*s)};function yi(i){if(!function(t){const o=t.coordinates[0];let n=0;for(let r=0;r<o.length-1;r++){const[s,a]=o[r],[l,c]=o[r+1];n+=(l-s)*(c+a)}return n<0}(i))return{type:"Polygon",coordinates:[i.coordinates[0].reverse()]}}const Ns={cancel:"Escape",finish:"Enter"},Ws={start:"crosshair",close:"pointer"};class Us extends Fe{constructor(e){super(e,!0),this.mode="freehand",this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.minDistance=20,this.keyEvents=Ns,this.cursors=Ws,this.preventPointsNearClose=!0,this.autoClose=!1,this.autoCloseTimeout=500,this.hasLeftStartingPoint=!1,this.preventNewFeature=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.minDistance&&(this.minDistance=e.minDistance),(e==null?void 0:e.preventPointsNearClose)!==void 0&&(this.preventPointsNearClose=e.preventPointsNearClose),(e==null?void 0:e.autoClose)!==void 0&&(this.autoClose=e.autoClose),e!=null&&e.autoCloseTimeout&&(this.autoCloseTimeout=e.autoCloseTimeout),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents)),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors))}close(){if(this.currentId===void 0)return;if(this.currentId){const t=yi(this.store.getGeometryCopy(this.currentId));t&&this.store.updateGeometry([{id:this.currentId,geometry:t}])}const e=this.currentId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Finish}).valid)return}this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.hasLeftStartingPoint=!1,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){if(this.currentId===void 0||this.startingClick===!1)return;const t=this.store.getGeometryCopy(this.currentId),o=t.coordinates[0].length-2,[n,r]=t.coordinates[0][o],{x:s,y:a}=this.project(n,r),l=ge({x:s,y:a},{x:e.containerX,y:e.containerY}),[c,d]=t.coordinates[0][0],{x:h,y:u}=this.project(c,d);if(ge({x:h,y:u},{x:e.containerX,y:e.containerY})<this.pointerDistance){if(this.autoClose&&this.hasLeftStartingPoint&&(this.preventNewFeature=!0,setTimeout(()=>{this.preventNewFeature=!1},this.autoCloseTimeout),this.close()),this.setCursor(this.cursors.close),this.preventPointsNearClose)return}else this.hasLeftStartingPoint=!0,this.setCursor(this.cursors.start);if(l<this.minDistance)return;t.coordinates[0].pop();const p={type:"Polygon",coordinates:[[...t.coordinates[0],[e.lng,e.lat],t.coordinates[0][0]]]};this.validate&&!this.validate({type:"Feature",id:this.currentId,geometry:p,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Provisional}).valid||this.store.updateGeometry([{id:this.currentId,geometry:p}])}onClick(e){if(!this.preventNewFeature){if(this.startingClick===!1){const[t,o]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode}},{geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:{mode:this.mode,[nt]:!0}}]);return this.currentId=t,this.closingPointId=o,this.startingClick=!0,void this.setDrawing()}this.close()}}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.startingClick===!0&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentId,t=this.closingPointId;this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),t!==void 0&&this.store.delete([t])}catch(o){}}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode?(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t):(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode&&(t.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,e),t.zIndex=40),t)}validateFeature(e){return this.validateModeFeature(e,t=>mi(t,this.coordinatePrecision))}}class le{constructor({store:e,mode:t,project:o,unproject:n,pointerDistance:r,coordinatePrecision:s,projection:a}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=t,this.project=o,this.unproject=n,this.pointerDistance=r,this.coordinatePrecision=s,this.projection=a}}function Uo({unproject:i,point:e,pointerDistance:t}){const o=t/2,{x:n,y:r}=e;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[i(n-o,r-o),i(n+o,r-o),i(n+o,r+o),i(n-o,r+o),i(n-o,r-o)].map(s=>[s.lng,s.lat])]}}}class rt extends le{constructor(e){super(e)}create(e){const{containerX:t,containerY:o}=e;return Uo({unproject:this.unproject,point:{x:t,y:o},pointerDistance:this.pointerDistance})}}class st extends le{constructor(e){super(e)}measure(e,t){const{x:o,y:n}=this.project(t[0],t[1]);return ge({x:o,y:n},{x:e.containerX,y:e.containerY})}}class oi extends le{constructor(e,t,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>this.getSnappable(n,r=>!!(r.properties&&r.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(n,r)=>this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode&&s.id!==r)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=o}getSnappable(e,t){const o=this.clickBoundingBox.create(e),n=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}a.forEach((l,c)=>{const d=this.pixelDistance.measure(e,l);d<r.minDist&&d<this.pointerDistance&&(r.coordinate=l,r.minDist=d,r.featureId=s.id,r.featureCoordinateIndex=c)})}),r}}function Qi(i,e,t){const o=se(i[0]),n=se(i[1]),r=se(t),s=$o(e),a=Math.asin(Math.sin(n)*Math.cos(s)+Math.cos(n)*Math.sin(s)*Math.cos(r));return[Ie(o+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(n),Math.cos(s)-Math.sin(n)*Math.sin(a))),Ie(a)]}function eo(i,e){const t=se(i[0]),o=se(e[0]),n=se(i[1]),r=se(e[1]),s=Math.sin(o-t)*Math.cos(r),a=Math.cos(n)*Math.sin(r)-Math.sin(n)*Math.cos(r)*Math.cos(o-t);return Ie(Math.atan2(s,a))}function As({x:i,y:e},{x:t,y:o}){let n=Math.atan2(o-e,t-i);return n*=180/Math.PI,n>180?n-=360:n<-180&&(n+=360),n}function Gs(i,e,t){const o=[],n=i.length;let r,s,a,l=0;for(let d=0;d<i.length&&!(e>=l&&d===i.length-1);d++){if(l>e&&o.length===0){if(r=e-l,!r)return o.push(i[d]),o;s=eo(i[d],i[d-1])-180,a=Qi(i[d],r,s),o.push(a)}if(l>=t)return r=t-l,r?(s=eo(i[d],i[d-1])-180,a=Qi(i[d],r,s),o.push(a),o):(o.push(i[d]),o);if(l>=e&&o.push(i[d]),d===i.length-1)return o;l+=fe(i[d],i[d+1])}if(l<e&&i.length===n)throw new Error("Start position is beyond line");const c=i[i.length-1];return[c,c]}function xt(i){return i*(Math.PI/180)}function to(i){return i*(180/Math.PI)}class Hs extends le{constructor(e){super(e),this.config=void 0,this.config=e}generateInsertionCoordinates(e,t,o){const n=[e,t];let r=0;for(let c=0;c<n.length-1;c++)r+=fe(n[0],n[1]);if(r<=o)return n;let s=r/o-1;Number.isInteger(s)||(s=Math.floor(s)+1);const a=[];for(let c=0;c<s;c++){const d=Gs(n,o*c,o*(c+1));a.push(d)}const l=[];for(let c=0;c<a.length;c++)l.push(a[c][1]);return this.limitCoordinates(l)}generateInsertionGeodesicCoordinates(e,t,o){const n=fe(e,t),r=function(s,a,l){const c=[],d=xt(s[1]),h=xt(s[0]),u=xt(a[1]),p=xt(a[0]);l+=1;const m=2*Math.asin(Math.sqrt(Math.sin((u-d)/2)**2+Math.cos(d)*Math.cos(u)*Math.sin((p-h)/2)**2));if(m===0||isNaN(m))return c;for(let b=0;b<=l;b++){const S=b/l,P=Math.sin((1-S)*m)/Math.sin(m),x=Math.sin(S*m)/Math.sin(m),I=P*Math.cos(d)*Math.cos(h)+x*Math.cos(u)*Math.cos(p),C=P*Math.cos(d)*Math.sin(h)+x*Math.cos(u)*Math.sin(p),y=P*Math.sin(d)+x*Math.sin(u);if(isNaN(I)||isNaN(C)||isNaN(y))continue;const v=Math.atan2(y,Math.sqrt(I**2+C**2)),f=Math.atan2(C,I);isNaN(v)||isNaN(f)||c.push([to(f),to(v)])}return c.slice(1,-1)}(e,t,Math.floor(n/o));return this.limitCoordinates(r)}limitCoordinates(e){return e.map(t=>[ne(t[0],this.config.coordinatePrecision),ne(t[1],this.config.coordinatePrecision)])}}function St(i,e){return i[0]===e[0]&&i[1]===e[1]}function Vs(i,e){return i.geometry.type!=="LineString"?{valid:!1,reason:"Feature is not a LineString"}:i.geometry.coordinates.length<2?{valid:!1,reason:"Feature has less than 2 coordinates"}:i.geometry.coordinates.every(t=>zt(t,e))?{valid:!0}:{valid:!1,reason:"Feature has invalid coordinates"}}function io(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)+Math.pow(i[2],2))}function De(i,e){const t=function(o,n){const[r,s,a]=o,[l,c,d]=n;return r*l+s*c+a*d}(i,e)/(io(i)*io(e));return Math.acos(Math.min(Math.max(t,-1),1))}function At(i){const e=se(i[1]),t=se(i[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function Oe(i){const[e,t,o]=i,n=Ie(Math.asin(o));return[Ie(Math.atan2(t,e)),n]}function Xs(i,e,t){const o=At(i),n=At(e),r=At(t),[s,a,l]=r,[c,d,h]=function(L,$){const[Z,V,J]=L,[z,T,ie]=$;return[V*ie-J*T,J*z-Z*ie,Z*T-V*z]}(o,n),u=d*l-h*a,p=h*s-c*l,m=c*a-d*s,b=m*d-p*h,S=u*h-m*c,P=p*c-u*d,x=1/Math.sqrt(Math.pow(b,2)+Math.pow(S,2)+Math.pow(P,2)),I=[b*x,S*x,P*x],C=[-1*b*x,-1*S*x,-1*P*x],y=De(o,n),v=De(o,I),f=De(n,I),k=De(o,C),w=De(n,C);let F;return F=v<k&&v<w||f<k&&f<w?I:C,De(o,F)>y||De(n,F)>y?fe(Oe(F),Oe(o))<=fe(Oe(F),Oe(n))?[Oe(o),!0,!1]:[Oe(n),!1,!0]:[Oe(F),!1,!1]}function Ks(i,e,t){const o=e.x-i.x,n=e.y-i.y,r=Math.max(0,Math.min(1,((t.x-i.x)*o+(t.y-i.y)*n)/(o*o+n*n)));return{x:i.x+r*o,y:i.y+r*n}}class Ao extends le{constructor(e,t,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>this.getSnappable(n,r=>!!(r.properties&&r.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(n,r)=>this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode&&s.id!==r)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=o}getSnappable(e,t){const o=this.clickBoundingBox.create(e),n=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}const l=[];for(let u=0;u<a.length-1;u++)l.push([a[u],a[u+1]]);let c;const d=[e.lng,e.lat];if(this.config.projection==="web-mercator"?c=function(u,p){let m=[1/0,1/0],b=1/0,S=0;for(let P of p){const x=P[0],I=P[1];let C,y=1/0;const v=X(x[0],x[1]),f=X(I[0],I[1]),k=X(u[0],u[1]);if(x[0]===u[0]&&x[1]===u[1])C=x;else if(I[0]===u[0]&&I[1]===u[1])C=I;else{const{x:w,y:F}=Ks(v,f,k),{lng:L,lat:$}=Ce(w,F);C=[L,$]}C&&(y=ge(k,X(C[0],C[1])),y<b&&(m=C,b=y,S=p.indexOf(P)))}return b===1/0?void 0:{coordinate:m,lineIndex:S,distance:b}}(d,l):this.config.projection==="globe"&&(c=function(u,p){let m=[1/0,1/0],b=1/0,S=0;for(let P of p){const x=P[0],I=P[1];let C,y=1/0;x[0]===u[0]&&x[1]===u[1]?C=x:I[0]===u[0]&&I[1]===u[1]?C=I:[C]=Xs(x,I,u),C&&(y=fe(u,C),y<b&&(m=C,b=y,S=p.indexOf(P)))}return b===1/0?void 0:{coordinate:m,distance:b,lineIndex:S}}(d,l)),!c)return;const h=this.pixelDistance.measure(e,c.coordinate);h<r.minDistance&&h<this.pointerDistance&&(r.featureId=s.id,r.coordinate=c.coordinate,r.featureCoordinateIndex=c.lineIndex,r.minDistance=h)}),r}}const Ys={cancel:"Escape",finish:"Enter"},qs={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class Zs extends Fe{constructor(e){super(e,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=Ys,this.snapping=void 0,this.cursors=qs,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommitedCoordinates=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors)),e!=null&&e.snapping&&(this.snapping=e.snapping),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents)),e!=null&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop(),this.updateGeometries([...e.coordinates],void 0,W.Commit);const t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommitedCoordinates=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}updateGeometries(e,t,o){if(!this.currentId)return;const n={type:"LineString",coordinates:e};if(this.validate&&!this.validate({type:"Feature",geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:o}).valid)return;const r=[{id:this.currentId,geometry:n}];this.closingPointId&&t&&r.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),o==="commit"&&(this.lastCommitedCoordinates=n.coordinates),this.store.updateGeometry(r)}generateInsertCoordinates(e,t){if(!this.insertCoordinates||!this.lastCommitedCoordinates)throw new Error("Not able to insert coordinates");if(this.insertCoordinates.strategy!=="amount")throw new Error("Strategy does not exist");const o=fe(e,t)/(this.insertCoordinates.value+1);let n=[];return this.projection==="globe"?n=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,o):this.projection==="web-mercator"&&(n=this.insertPoint.generateInsertionCoordinates(e,t,o)),n}createLine(e){const[t]=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode}}]);this.lastCommitedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(e){if(!this.currentId)return;const t=this.store.getGeometryCopy(this.currentId).coordinates,[o]=this.store.create([{geometry:{type:"Point",coordinates:[...e]},properties:{mode:this.mode}}]);this.closingPointId=o,this.setCursor(this.cursors.close);const n=[...t,e];this.updateGeometries(n,void 0,W.Commit),this.currentCoordinate++}updateToLine(e,t){if(!this.currentId)return;const o=this.store.getGeometryCopy(this.currentId).coordinates,[n,r]=this.lastCommitedCoordinates?this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1]:o[o.length-2],{x:s,y:a}=this.project(n,r);if(ge({x:s,y:a},{x:t.x,y:t.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);const l=[...o,e];this.updateGeometries(l,o[o.length-1],W.Commit),this.currentCoordinate++}registerBehaviors(e){this.coordinateSnapping=new oi(e,new st(e),new rt(e)),this.insertPoint=new Hs(e),this.clickBoundingBox=new rt(e),this.pixelDistance=new st(e),this.lineSnapping=new Ao(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new oi(e,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start);const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[s]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[ii]:!0}}]);this.snappedPointId=s}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const o=t||[e.lng,e.lat];if(this.currentId===void 0||this.currentCoordinate===0)return;const n=this.store.getGeometryCopy(this.currentId).coordinates;if(n.pop(),this.closingPointId){const[s,a]=n[n.length-1],{x:l,y:c}=this.project(s,a);ge({x:l,y:c},{x:e.containerX,y:e.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let r=[...n,o];if(this.insertCoordinates&&this.currentId&&this.lastCommitedCoordinates){const s=this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1],a=o;if(!St(s,a)){const l=this.generateInsertCoordinates(s,a);r=[...this.lastCommitedCoordinates.slice(0,-1),...l,o]}}this.updateGeometries(r,void 0,W.Provisional)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:o}=this.coordinateSnapping.getSnappable(e,s=>s.geometry.type==="LineString");if(!t||o===void 0)return;const n=this.store.getGeometryCopy(t);let r;if(n.type==="LineString"&&(r=n.coordinates,!(r.length<=2))){if(r.splice(o,1),this.validate&&!this.validate({id:t,type:"Feature",geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:n}])}}onLeftClick(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const t=this.snapCoordinate(e)||[e.lng,e.lat];this.currentCoordinate===0?this.createLine(t):this.currentCoordinate===1&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}onClick(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"?this.onRightClick(e):e.button==="left"&&this.onLeftClick(e)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(e,t){if(!this.editable)return;let o;if(this.state==="started"){const n=this.lineSnapping.getSnappable(e);n.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=n.featureCoordinateIndex,this.editedFeatureId=n.featureId,o=n.coordinate);const r=this.coordinateSnapping.getSnappable(e);r.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=r.featureCoordinateIndex,this.editedFeatureId=r.featureId,o=r.coordinate)}if(this.editedFeatureId&&o){if(!this.editedPointId){const[n]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,[ve]:!0}}]);this.editedPointId=n}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o=this.store.getGeometryCopy(this.editedFeatureId);this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?o.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const n={type:"LineString",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:n,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:n}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!0}]),t(!0))}onDragEnd(e,t){this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!1}]),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.closingPointId,o=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),o!==void 0&&this.store.delete([o]),t!==void 0&&this.store.delete([t])}catch(n){}}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const o=e.properties[nt];return t.pointColor=this.getHexColorStylingValue(o?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(o?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(o?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(o?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=40,t}return t}validateFeature(e){return this.validateModeFeature(e,t=>Vs(t,this.coordinatePrecision))}snapCoordinate(e){var t,o;let n;return(t=this.snapping)!=null&&t.toCoordinate&&(n=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),(o=this.snapping)!=null&&o.toCustom&&(n=this.snapping.toCustom(e)),n}}const Js="Feature is not a Point",Qs="Feature has invalid coordinates";function ea(i,e){return i.geometry.type!=="Point"?{valid:!1,reason:Js}:zt(i.geometry.coordinates,e)?{valid:!0}:{valid:!1,reason:Qs}}const ta={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"};class ia extends Fe{constructor(e){super(e,!0),this.mode="point",this.cursors=ta,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors)),e!=null&&e.editable&&(this.editable=e.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(!this.store)throw new Error("Mode must be registered first");e.button==="right"?this.onRightClick(e):e.button==="left"&&this.onLeftClick(e)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(e,t){if(this.editable){const o=this.getNearestPointFeature(e);this.editedFeatureId=o==null?void 0:o.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}onDrag(e,t){this.editedFeatureId!==void 0&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!0}]),t(!0)))}onDragEnd(e,t){this.editedFeatureId!==void 0&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!1}]),this.editedFeatureId=void 0,t(!0))}registerBehaviors(e){this.pixelDistance=new st(e),this.clickBoundingBox=new rt(e)}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const o=!!(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(o?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(o?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(o?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(o?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}validateFeature(e){return this.validateModeFeature(e,t=>ea(t,this.coordinatePrecision))}onLeftClick(e){const t={type:"Point",coordinates:[e.lng,e.lat]},o={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:t,properties:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Finish}).valid)return;const[n]=this.store.create([{geometry:t,properties:o}]);this.onFinish(n,{mode:this.mode,action:"draw"})}onRightClick(e){if(!this.editable)return;const t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}getNearestPointFeature(e){const t=this.clickBoundingBox.create(e),o=this.store.search(t);let n,r=1/0;for(let s=0;s<o.length;s++){const a=o[s];if(a.geometry.type!=="Point"||a.properties.mode!==this.mode)continue;const l=this.pixelDistance.measure(e,a.geometry.coordinates);l>r||l>this.pointerDistance||(r=l,n=a)}return n}}class oa extends le{constructor(e,t){super(e),this.config=void 0,this.pixelDistance=void 0,this._startEndPoints=[],this.config=e,this.pixelDistance=t}get ids(){return this._startEndPoints.concat()}set ids(e){}create(e,t){if(this.ids.length)throw new Error("Opening and closing points already created");if(e.length<=3)throw new Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:e[0]},properties:{mode:t,[nt]:!0}},{geometry:{type:"Point",coordinates:e[e.length-2]},properties:{mode:t,[nt]:!0}}])}delete(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}update(e){if(this.ids.length!==2)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:e[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:e[e.length-3]}}])}isClosingPoint(e){const t=this.store.getGeometryCopy(this.ids[0]),o=this.store.getGeometryCopy(this.ids[1]),n=this.pixelDistance.measure(e,t.coordinates),r=this.pixelDistance.measure(e,o.coordinates);return{isClosing:n<this.pointerDistance,isPreviousClosing:r<this.pointerDistance}}}const na={cancel:"Escape",finish:"Enter"},ra={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class sa extends Fe{constructor(e){super(e,!0),this.mode="polygon",this.currentCoordinate=0,this.currentId=void 0,this.keyEvents=na,this.cursors=ra,this.mouseMove=!1,this.snapping=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.lineSnapping=void 0,this.coordinateSnapping=void 0,this.pixelDistance=void 0,this.closingPoints=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents)),e!=null&&e.snapping&&(this.snapping=e.snapping),e!=null&&e.editable&&(this.editable=e.editable)}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId).coordinates[0];if(e.length<5||!this.updatePolygonGeometry([...e.slice(0,-2),e[0]],W.Finish))return;const t=this.currentId;if(this.currentId){const o=yi(this.store.getGeometryCopy(this.currentId));o&&this.store.updateGeometry([{id:this.currentId,geometry:o}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}registerBehaviors(e){this.clickBoundingBox=new rt(e),this.pixelDistance=new st(e),this.lineSnapping=new Ao(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new oi(e,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new oa(e,this.pixelDistance)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start);const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[r]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[ii]:!0}}]);this.snappedPointId=r}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);if(this.currentId===void 0||this.currentCoordinate===0)return;const o=this.store.getGeometryCopy(this.currentId).coordinates[0];let n;if(this.currentCoordinate===1){const r=1/Math.pow(10,this.coordinatePrecision-1),s=Math.max(1e-6,r);n=[o[0],[e.lng,e.lat],[e.lng,e.lat-s],o[0]]}else if(this.currentCoordinate===2)n=[o[0],o[1],[e.lng,e.lat],o[0]];else{const{isClosing:r,isPreviousClosing:s}=this.closingPoints.isClosingPoint(e);s||r?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),n=[...o.slice(0,-2),o[0],o[0]]):n=[...o.slice(0,-2),[e.lng,e.lat],o[0]]}this.updatePolygonGeometry(n,W.Provisional)}updatePolygonGeometry(e,t){if(!this.currentId)return!1;const o={type:"Polygon",coordinates:[e]};return!(this.validate&&!this.validate({type:"Feature",geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:o}]),0))}snapCoordinate(e){var t,o,n;let r;if((t=this.snapping)!=null&&t.toLine){let s;s=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}if((o=this.snapping)!=null&&o.toCoordinate){let s;s=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}return(n=this.snapping)!=null&&n.toCustom&&(r=this.snapping.toCustom(e)),r}onRightClick(e){if(!this.editable)return;const{featureId:t,featureCoordinateIndex:o}=this.coordinateSnapping.getSnappable(e,s=>s.geometry.type==="Polygon");if(!t||o===void 0)return;const n=this.store.getGeometryCopy(t);let r;n.type==="Polygon"&&(r=n.coordinates[0],r.length<=4||(n.type!=="Polygon"||o!==0&&o!==r.length-1?r.splice(o,1):(r.shift(),r.pop(),r.push([r[0][0],r[0][1]])),(!this.validate||this.validate({id:t,type:"Feature",geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:n}]))))}onLeftClick(e){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.currentCoordinate===0){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const[o]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode}}]);this.currentId=o,this.currentCoordinate++,this.setDrawing()}else if(this.currentCoordinate===1&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const o=this.store.getGeometryCopy(this.currentId);if(St([e.lng,e.lat],o.coordinates[0][0])||!this.updatePolygonGeometry([o.coordinates[0][0],[e.lng,e.lat],[e.lng,e.lat],o.coordinates[0][0]],W.Commit))return;this.currentCoordinate++}else if(this.currentCoordinate===2&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const o=this.store.getGeometryCopy(this.currentId).coordinates[0];if(St([e.lng,e.lat],o[1])||!this.updatePolygonGeometry([o[0],o[1],[e.lng,e.lat],[e.lng,e.lat],o[0]],W.Commit))return;this.currentCoordinate===2&&this.closingPoints.create(o,"polygon"),this.currentCoordinate++}else if(this.currentId){const t=this.store.getGeometryCopy(this.currentId).coordinates[0],{isClosing:o,isPreviousClosing:n}=this.closingPoints.isClosingPoint(e);if(n||o)this.close();else{const r=this.snapCoordinate(e);if(r&&(e.lng=r[0],e.lat=r[1]),St([e.lng,e.lat],t[this.currentCoordinate-1]))return;const s=function(a=[[[0,0],[0,1],[1,1],[1,0],[0,0]]]){return{type:"Feature",geometry:{type:"Polygon",coordinates:a},properties:{}}}([[...t.slice(0,-1),[e.lng,e.lat],t[0]]]);if(!this.updatePolygonGeometry(s.geometry.coordinates[0],W.Commit))return;this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(s.geometry.coordinates[0])}}}onClick(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button!=="right"?e.button!=="left"||this.onLeftClick(e):this.onRightClick(e)}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onKeyDown(){}onDragStart(e,t){if(!this.editable)return;let o;if(this.state==="started"){const n=this.lineSnapping.getSnappable(e);n.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=n.featureCoordinateIndex,this.editedFeatureId=n.featureId,o=n.coordinate);const r=this.coordinateSnapping.getSnappable(e);r.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=r.featureCoordinateIndex,this.editedFeatureId=r.featureId,o=r.coordinate)}if(this.editedFeatureId&&o){if(!this.editedPointId){const[n]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,[ve]:!0}}]);this.editedPointId=n}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o=this.store.getGeometryCopy(this.editedFeatureId),n=o.coordinates[0];this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?this.editedFeatureCoordinateIndex===0||this.editedFeatureCoordinateIndex===o.coordinates[0].length-1?(n[0]=[e.lng,e.lat],n[n.length-1]=[e.lng,e.lat]):n[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates[0].splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const r={type:"Polygon",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:r,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:r}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!0}]),t(!0))}onDragEnd(e,t){this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:ve,value:!1}]),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.snappedPointId,o=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),o!==void 0&&this.store.delete([o]),t!==void 0&&this.store.delete([t]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(n){}}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if(e.geometry.type==="Point"){const o=e.properties[ve],n=o?"editedPoint":e.properties[nt]?"closingPoint":e.properties[ii]?"snappingPoint":void 0;if(!n)return t;const r={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth}};return t.pointWidth=this.getNumericStylingValue(r[n].width,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(r[n].color,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(r[n].outlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(r[n].outlineWidth,2,e),t.zIndex=o?35:30,t}}return t}validateFeature(e){return this.validateModeFeature(e,t=>mi(t,this.coordinatePrecision))}}const aa={cancel:"Escape",finish:"Enter"},la={start:"crosshair"};class da extends Fe{constructor(e){super(e,!0),this.mode="rectangle",this.center=void 0,this.clickCount=0,this.currentRectangleId=void 0,this.keyEvents=aa,this.cursors=la,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=H({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents))}updateRectangle(e,t){if(this.clickCount===1&&this.center&&this.currentRectangleId){const o=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],n={type:"Polygon",coordinates:[[o,[e.lng,o[1]],[e.lng,e.lat],[o[0],e.lat],o]]};if(this.validate&&!this.validate({id:this.currentRectangleId,geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid)return;this.store.updateGeometry([{id:this.currentRectangleId,geometry:n}])}}close(){const e=this.currentRectangleId;if(e){const t=yi(this.store.getGeometryCopy(e));t&&this.store.updateGeometry([{id:e,geometry:t}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(this.clickCount===0){this.center=[e.lng,e.lat];const[t]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode}}]);this.currentRectangleId=t,this.clickCount++,this.setDrawing()}else this.updateRectangle(e,W.Finish),this.close()}onMouseMove(e){this.updateRectangle(e,W.Provisional)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.store.delete([e])}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=10),t}validateFeature(e){return this.validateModeFeature(e,t=>Wo(t,this.coordinatePrecision))}}function Ot(i,e){const t=i,o=e,n=se(t[1]),r=se(o[1]);let s=se(o[0]-t[0]);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);const a=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),l=(Ie(Math.atan2(s,a))+360)%360;return l>180?-(360-l):l}function vi(i,e,t){let o=e;e<0&&(o=-Math.abs(o));const n=o/zo,r=i[0]*Math.PI/180,s=se(i[1]),a=se(t),l=n*Math.cos(a);let c=s+l;Math.abs(c)>Math.PI/2&&(c=c>0?Math.PI-c:-Math.PI-c);const d=Math.log(Math.tan(c/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),h=Math.abs(d)>1e-11?l/d:Math.cos(s),u=[(180*(r+n*Math.sin(a)/h)/Math.PI+540)%360-180,180*c/Math.PI];return u[0]+=u[0]-i[0]>180?-360:i[0]-u[0]>180?360:0,u}function ca(i,e,t,o,n){const r=o(i[0],i[1]),s=o(e[0],e[1]),{lng:a,lat:l}=n((r.x+s.x)/2,(r.y+s.y)/2);return[ne(a,t),ne(l,t)]}function ua(i,e,t){const o=vi(i,1e3*fe(i,e)/2,Ot(i,e));return[ne(o[0],t),ne(o[1],t)]}function oo({featureCoords:i,precision:e,unproject:t,project:o,projection:n}){const r=[];for(let s=0;s<i.length-1;s++){let a;if(n==="web-mercator")a=ca(i[s],i[s+1],e,o,t);else{if(n!=="globe")throw new Error("Invalid projection");a=ua(i[s],i[s+1],e)}r.push(a)}return r}class ha extends le{constructor(e,t){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=t}get ids(){return this._midPoints.concat()}set ids(e){}insert(e,t){const o=this.store.getGeometryCopy(e),{midPointFeatureId:n,midPointSegment:r}=this.store.getPropertiesCopy(e),s=this.store.getGeometryCopy(n),a=s.type==="Polygon"?s.coordinates[0]:s.coordinates;a.splice(r+1,0,o.coordinates),s.coordinates=s.type==="Polygon"?[a]:a,this.store.updateGeometry([{id:n,geometry:s}]),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(a,n,t),this.selectionPointBehavior.create(a,s.type,n)}create(e,t,o){if(!this.store.has(t))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(n,r,s,a,l,c){return oo({featureCoords:n,precision:s,project:a,unproject:l,projection:c}).map((d,h)=>({geometry:{type:"Point",coordinates:d},properties:r(h)}))}(e,n=>({mode:this.mode,[be.MID_POINT]:!0,midPointSegment:n,midPointFeatureId:t}),o,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(this._midPoints.length!==0)return oo({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((t,o)=>({id:this._midPoints[o],geometry:{type:"Point",coordinates:t}}))}}class pa extends le{constructor(e){super(e),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,t,o){this._selectionPoints=this.store.create(function(n,r,s){const a=[],l=r==="Polygon"?n.length-1:n.length;for(let c=0;c<l;c++)a.push({geometry:{type:"Point",coordinates:n[c]},properties:s(c)});return a}(e,t,n=>({mode:this.mode,selectionPoint:!0,selectionPointFeatureId:o,index:n})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(this._selectionPoints.length!==0)return this._selectionPoints.map((t,o)=>({id:t,geometry:{type:"Point",coordinates:e[o]}}))}getOneUpdated(e,t){if(this._selectionPoints[e]!==void 0)return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}}function Go(i,e){let t=!1;for(let s=0,a=e.length;s<a;s++){const l=e[s];for(let c=0,d=l.length,h=d-1;c<d;h=c++)(n=l[c])[1]>(o=i)[1]!=(r=l[h])[1]>o[1]&&o[0]<(r[0]-n[0])*(o[1]-n[1])/(r[1]-n[1])+n[0]&&(t=!t)}var o,n,r;return t}const Ho=(i,e,t)=>{const o=r=>r*r,n=(r,s)=>o(r.x-s.x)+o(r.y-s.y);return Math.sqrt(((r,s,a)=>{const l=n(s,a);if(l===0)return n(r,s);let c=((r.x-s.x)*(a.x-s.x)+(r.y-s.y)*(a.y-s.y))/l;return c=Math.max(0,Math.min(1,c)),n(r,{x:s.x+c*(a.x-s.x),y:s.y+c*(a.y-s.y)})})(i,e,t))};class ga extends le{constructor(e,t,o){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=t,this.pixelDistance=o}find(e,t){let o,n,r,s,a=1/0,l=1/0,c=1/0;const d=this.createClickBoundingBox.create(e),h=this.store.search(d);for(let u=0;u<h.length;u++){const p=h[u],m=p.geometry;if(m.type==="Point"){if(p.properties.selectionPoint||!t&&p.properties[be.MID_POINT])continue;const b=this.pixelDistance.measure(e,m.coordinates);p.properties[be.MID_POINT]&&b<this.pointerDistance&&b<c?(c=b,r=p):!p.properties[be.MID_POINT]&&b<this.pointerDistance&&b<a&&(a=b,o=p)}else if(m.type==="LineString"){if(o)continue;for(let b=0;b<m.coordinates.length-1;b++){const S=m.coordinates[b],P=m.coordinates[b+1],x=Ho({x:e.containerX,y:e.containerY},this.project(S[0],S[1]),this.project(P[0],P[1]));x<this.pointerDistance&&x<l&&(l=x,n=p)}}else if(m.type==="Polygon"){if(o||n)continue;Go([e.lng,e.lat],m.coordinates)&&(s=p)}}return{clickedFeature:o||n||s,clickedMidPoint:r}}}class fa extends le{constructor(e,t,o,n){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=t,this.selectionPoints=o,this.midPoints=n}startDragging(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(e,t){const{clickedFeature:o}=this.featuresAtCursorEvent.find(e,!0);return!(!o||o.id!==t)}drag(e,t){if(!this.draggedFeatureId)return;const o=this.store.getGeometryCopy(this.draggedFeatureId),n=[e.lng,e.lat];if(o.type==="Polygon"||o.type==="LineString"){let r,s;if(o.type==="Polygon"?(r=o.coordinates[0],s=r.length-1):(r=o.coordinates,s=r.length),!this.dragPosition)return!1;for(let c=0;c<s;c++){const d=r[c];let h,u;if(this.config.projection==="web-mercator"){const p=X(this.dragPosition[0],this.dragPosition[1]),m=X(n[0],n[1]),b=X(d[0],d[1]),S={x:p.x-m.x,y:p.y-m.y},P=b.x-S.x,x=b.y-S.y,{lng:I,lat:C}=Ce(P,x);h=I,u=C}else{const p=[this.dragPosition[0]-n[0],this.dragPosition[1]-n[1]];h=d[0]-p[0],u=d[1]-p[1]}if(h=ne(h,this.config.coordinatePrecision),u=ne(u,this.config.coordinatePrecision),h>180||h<-180||u>90||u<-90)return!1;r[c]=[h,u]}o.type==="Polygon"&&(r[r.length-1]=[r[0][0],r[0][1]]);const a=this.selectionPoints.getUpdated(r)||[],l=this.midPoints.getUpdated(r)||[];if(t&&!t({type:"Feature",id:this.draggedFeatureId,geometry:o,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:W.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o},...a,...l]),this.dragPosition=[e.lng,e.lat]}else o.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:n}}]),this.dragPosition=[e.lng,e.lat])}}class ma extends le{constructor(e,t,o,n){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=t,this.selectionPoints=o,this.midPoints=n}getClosestCoordinate(e,t){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return o;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<o.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);o.dist=s,o.index=a?0:r,o.isFirstOrLastPolygonCoord=a}}return o}getDraggableIndex(e,t){const o=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,o);return n.index===-1?-1:n.index}drag(e,t,o){if(this.draggedCoordinate.id===null)return!1;const n=this.draggedCoordinate.index,r=this.store.getGeometryCopy(this.draggedCoordinate.id),s=r.type==="LineString"?r.coordinates:r.coordinates[0],a=[e.lng,e.lat];if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(r.type!=="Polygon"||n!==s.length-1&&n!==0)s[n]=a;else{const h=s.length-1;s[0]=a,s[h]=a}const l=this.selectionPoints.getOneUpdated(n,a),c=l?[l]:[],d=this.midPoints.getUpdated(s)||[];return!(r.type!=="Point"&&!t&&No({geometry:r})||o&&!o({type:"Feature",id:this.draggedCoordinate.id,geometry:r,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:W.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:r},...c,...d]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}}function Bt(i){let e=0,t=0,o=0;return(i.geometry.type==="Polygon"?i.geometry.coordinates[0].slice(0,-1):i.geometry.coordinates).forEach(n=>{e+=n[0],t+=n[1],o++},!0),[e/o,t/o]}function Vo(i,e){i[0]+=i[0]-e[0]>180?-360:e[0]-i[0]>180?360:0;const t=zo,o=e[1]*Math.PI/180,n=i[1]*Math.PI/180,r=n-o;let s=Math.abs(i[0]-e[0])*Math.PI/180;s>Math.PI&&(s-=2*Math.PI);const a=Math.log(Math.tan(n/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),l=Math.abs(a)>1e-11?r/a:Math.cos(o);return Math.sqrt(r*r+l*l*s*s)*t}function Et(i){const e=(i.geometry.type==="Polygon"?i.geometry.coordinates[0]:i.geometry.coordinates).map(t=>{const{x:o,y:n}=X(t[0],t[1]);return[o,n]});return i.geometry.type==="Polygon"?function(t){let o=0,n=0,r=0;const s=t.length;for(let a=0;a<s-1;a++){const[l,c]=t[a],[d,h]=t[a+1],u=l*h-d*c;o+=u,n+=(l+d)*u,r+=(c+h)*u}return o/=2,n/=6*o,r/=6*o,{x:n,y:r}}(e):function(t){const o=t.length;let n=0,r=0;for(let s=0;s<o;s++){const[a,l]=t[s];n+=a,r+=l}return{x:n/o,y:r/o}}(e)}class ya extends le{constructor(e,t,o){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.lastBearing=void 0,this.config=e,this.selectionPoints=t,this.midPoints=o}reset(){this.lastBearing=void 0}rotate(e,t,o){const n=this.store.getGeometryCopy(t);if(n.type!=="Polygon"&&n.type!=="LineString")return;const r=[e.lng,e.lat];let s;const a={type:"Feature",geometry:n,properties:{}};if(this.config.projection==="web-mercator"){if(s=As(Et(a),X(e.lng,e.lat)),!this.lastBearing)return void(this.lastBearing=s);((h,u)=>{if(u===0||u===360||u===-360)return h;const p=.017453292519943295*u,m=(h.geometry.type==="Polygon"?h.geometry.coordinates[0]:h.geometry.coordinates).map(([P,x])=>X(P,x)),b=m.reduce((P,x)=>({x:P.x+x.x,y:P.y+x.y}),{x:0,y:0});b.x/=m.length,b.y/=m.length;const S=m.map(P=>({x:b.x+(P.x-b.x)*Math.cos(p)-(P.y-b.y)*Math.sin(p),y:b.y+(P.x-b.x)*Math.sin(p)+(P.y-b.y)*Math.cos(p)})).map(({x:P,y:x})=>[Ce(P,x).lng,Ce(P,x).lat]);h.geometry.type==="Polygon"?h.geometry.coordinates[0]=S:h.geometry.coordinates=S})(a,-(this.lastBearing-s))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(s=Ot(Bt({geometry:n}),r),!this.lastBearing)return void(this.lastBearing=s+180);(function(h,u){if(u===0||u===360||u===-360)return h;const p=Bt(h);(h.geometry.type==="Polygon"?h.geometry.coordinates[0]:h.geometry.coordinates).forEach(m=>{const b=Ot(p,m)+u,S=Vo(p,m),P=vi(p,S,b);m[0]=P[0],m[1]=P[1]})})(a,-(this.lastBearing-(s+180)))}const l=n.type==="Polygon"?n.coordinates[0]:n.coordinates;l.forEach(h=>{h[0]=ne(h[0],this.coordinatePrecision),h[1]=ne(h[1],this.coordinatePrecision)});const c=this.midPoints.getUpdated(l)||[],d=this.selectionPoints.getUpdated(l)||[];if(o&&!o({id:t,type:"Feature",geometry:n,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:W.Provisional}))return!1;this.store.updateGeometry([{id:t,geometry:n},...d,...c]),this.projection==="web-mercator"?this.lastBearing=s:this.projection==="globe"&&(this.lastBearing=s+180)}}class va extends le{constructor(e,t,o){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.lastDistance=void 0,this.config=e,this.selectionPoints=t,this.midPoints=o}reset(){this.lastDistance=void 0}scale(e,t,o){const n=this.store.getGeometryCopy(t);if(n.type!=="Polygon"&&n.type!=="LineString")return;const r=[e.lng,e.lat],s={type:"Feature",geometry:n,properties:{}};let a;const l=Et(s);if(this.config.projection==="web-mercator"){const p=X(e.lng,e.lat);a=ge(l,p)}else{if(this.config.projection!=="globe")throw new Error("Invalid projection");a=fe(Bt({geometry:n}),r)}if(!this.lastDistance)return void(this.lastDistance=a);const c=1-(this.lastDistance-a)/a;if(this.config.projection==="web-mercator"){const{lng:p,lat:m}=Ce(l.x,l.y);(function(b,S,P){if(S===1)return b;const x=(b.geometry.type==="Polygon"?b.geometry.coordinates[0]:b.geometry.coordinates).map(([y,v])=>X(y,v)),I=X(P[0],P[1]),C=x.map(y=>({x:I.x+(y.x-I.x)*S,y:I.y+(y.y-I.y)*S})).map(({x:y,y:v})=>[Ce(y,v).lng,Ce(y,v).lat]);b.geometry.type==="Polygon"?b.geometry.coordinates[0]=C:b.geometry.coordinates=C})(s,c,[p,m])}else this.config.projection==="globe"&&function(p,m,b,S="xy"){m===1||(p.geometry.type==="Polygon"?p.geometry.coordinates[0]:p.geometry.coordinates).forEach(P=>{const x=Vo(b,P),I=Ot(b,P),C=vi(b,x*m,I);S!=="x"&&S!=="xy"||(P[0]=C[0]),S!=="y"&&S!=="xy"||(P[1]=C[1])})}(s,c,Bt(s));const d=n.type==="Polygon"?n.coordinates[0]:n.coordinates;d.forEach(p=>{p[0]=ne(p[0],this.coordinatePrecision),p[1]=ne(p[1],this.coordinatePrecision)});const h=this.midPoints.getUpdated(d)||[],u=this.selectionPoints.getUpdated(d)||[];if(o&&!o({id:t,type:"Feature",geometry:n,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:W.Provisional}))return!1;this.store.updateGeometry([{id:t,geometry:n},...u,...h]),this.lastDistance=a}}class ba extends le{constructor(e,t,o,n){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=t,this.selectionPoints=o,this.midPoints=n}getClosestCoordinate(e,t){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return o;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<o.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);o.dist=s,o.index=a?0:r,o.isFirstOrLastPolygonCoord=a}}return o}isValidDragWebMercator(e,t,o){switch(e){case 0:if(t<=0||o>=0)return!1;break;case 1:if(o>=0)return!1;break;case 2:if(t>=0||o>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||o<=0)return!1;break;case 5:if(o<=0)return!1;break;case 6:if(t<=0||o<=0)return!1;break;case 7:if(t<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;const t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:o,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=Et(o);if(!a)return null;const l=X(s[0],s[1]),{closestBBoxIndex:c}=this.getIndexesWebMercator(n,l),d=X(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:c,updatedCoords:r,webMercatorCursor:d,webMercatorSelected:l,webMercatorOrigin:a}),r}centerFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:o,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=Et(o);if(!a)return null;const l=X(s[0],s[1]),{closestBBoxIndex:c}=this.getIndexesWebMercator(n,l),d=X(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:c,updatedCoords:r,webMercatorCursor:d,webMercatorSelected:l,webMercatorOrigin:a}),r}scaleFixedWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:o,webMercatorCursor:n,updatedCoords:r}){if(!this.isValidDragWebMercator(e,t.x-n.x,t.y-n.y))return null;let s=ge(t,n)/ge(t,o);return s<0&&(s=this.minimumScale),this.performWebMercatorScale(r,t.x,t.y,s,s),r}oppositeFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:o,updatedCoords:n,selectedCoordinate:r}=t,s=X(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(o,s),c={x:o[a][0],y:o[a][1]},d=X(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:d,webMercatorSelected:s,webMercatorOrigin:c}),n}oppositeWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:o,updatedCoords:n,selectedCoordinate:r}=t,s=X(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(o,s),c={x:o[a][0],y:o[a][1]},d=X(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:d,webMercatorSelected:s,webMercatorOrigin:c}),n}scaleWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:o,webMercatorCursor:n,updatedCoords:r}){const s=t.x-n.x,a=t.y-n.y;if(!this.isValidDragWebMercator(e,s,a))return null;let l=1;s!==0&&e!==1&&e!==5&&(l=1-(t.x-o.x-s)/s);let c=1;return a!==0&&e!==3&&e!==7&&(c=1-(t.y-o.y-a)/a),this.validateScale(l,c)?(l<0&&(l=this.minimumScale),c<0&&(c=this.minimumScale),this.performWebMercatorScale(r,t.x,t.y,l,c),r):null}getFeature(e){if(this.draggedCoordinate.id===null)return null;const t=this.store.getGeometryCopy(e);return t.type!=="Polygon"&&t.type!=="LineString"?null:{type:"Feature",geometry:t,properties:{}}}getNormalisedCoordinates(e){return e.type==="Polygon"?e.coordinates[0]:e.coordinates}validateScale(e,t){const o=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,n=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return o&&n}performWebMercatorScale(e,t,o,n,r){e.forEach(s=>{const{x:a,y:l}=X(s[0],s[1]),c=t+(a-t)*n,d=o+(l-o)*r,{lng:h,lat:u}=Ce(c,d);s[0]=h,s[1]=u})}getBBoxWebMercator(e){const t=[1/0,1/0,-1/0,-1/0];(e=e.map(a=>{const{x:l,y:c}=X(a[0],a[1]);return[l,c]})).forEach(([a,l])=>{a<t[0]&&(t[0]=a),l<t[1]&&(t[1]=l),a>t[2]&&(t[2]=a),l>t[3]&&(t[3]=l)});const[o,n,r,s]=t;return[[o,s],[(o+r)/2,s],[r,s],[r,s+(n-s)/2],[r,n],[(o+r)/2,n],[o,n],[o,s+(n-s)/2]]}getIndexesWebMercator(e,t){let o,n=1/0;for(let r=0;r<e.length;r++){const s=ge({x:t.x,y:t.y},{x:e[r][0],y:e[r][1]});s<n&&(o=r,n=s)}if(o===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[o],closestBBoxIndex:o}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,t){const o=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,o);return n.index===-1?-1:n.index}drag(e,t,o){if(!this.draggedCoordinate.id)return!1;const n=this.getFeature(this.draggedCoordinate.id);if(!n)return!1;let r=null;if(t==="center"?r=this.centerWebMercatorDrag(e):t==="opposite"?r=this.oppositeWebMercatorDrag(e):t==="center-fixed"?r=this.centerFixedWebMercatorDrag(e):t==="opposite-fixed"&&(r=this.oppositeFixedWebMercatorDrag(e)),!r)return!1;for(let c=0;c<r.length;c++){const d=r[c];if(d[0]=ne(d[0],this.coordinatePrecision),d[1]=ne(d[1],this.coordinatePrecision),!zt(d,this.coordinatePrecision))return!1}const s=this.midPoints.getUpdated(r)||[],a=this.selectionPoints.getUpdated(r)||[],l={type:n.geometry.type,coordinates:n.geometry.type==="Polygon"?[r]:r};return!(o&&!o({id:this.draggedCoordinate.id,type:"Feature",geometry:l,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:W.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:l},...a,...s]),0))}}const Ca={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},no={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class xa extends Os{constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=Ca,this.cursors=no,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?H({},this.cursors,e.cursors):no,(e==null?void 0:e.keyEvents)===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e!=null&&e.keyEvents&&(this.keyEvents=H({},this.keyEvents,e.keyEvents)),(e==null?void 0:e.dragEventThrottle)!==void 0&&(this.dragEventThrottle=e.dragEventThrottle),(e==null?void 0:e.allowManualDeselection)!==void 0&&(this.allowManualDeselection=e.allowManualDeselection),e!=null&&e.flags){this.flags=H({},this.flags,e.flags),this.validations={};for(const t in this.flags){const o=this.flags[t].feature;o&&o.validation&&(this.validations[t]=o.validation)}}}selectFeature(e){this.select(e,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new st(e),this.clickBoundingBox=new rt(e),this.featuresAtMouseEvent=new ga(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new pa(e),this.midPoints=new ha(e,this.selectionPoints),this.rotateFeature=new ya(e,this.selectionPoints,this.midPoints),this.scaleFeature=new va(e,this.selectionPoints,this.midPoints),this.dragFeature=new fa(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints),this.dragCoordinate=new ma(e,this.pixelDistance,this.selectionPoints,this.midPoints),this.dragCoordinateResizeFeature=new ba(e,this.pixelDistance,this.selectionPoints,this.midPoints)}deselectFeature(){this.deselect()}deselect(){const e=this.selected.filter(t=>this.store.has(t)).map(t=>({id:t,property:be.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){if(!this.selectionPoints.ids.length)return;let t,o=1/0;if(this.selectionPoints.ids.forEach(h=>{const u=this.store.getGeometryCopy(h),p=this.pixelDistance.measure(e,u.coordinates);p<this.pointerDistance&&p<o&&(o=p,t=this.store.getPropertiesCopy(h))}),!t)return;const n=t.selectionPointFeatureId,r=t.index,s=this.store.getPropertiesCopy(n),a=this.flags[s.mode],l=this.validations[s.mode];if(!(a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.deletable))return;const c=this.store.getGeometryCopy(n);let d;if(c.type==="Polygon"){if(d=c.coordinates[0],d.length<=4)return}else if(c.type==="LineString"&&(d=c.coordinates,d.length<=2))return;d&&(c.type!=="Polygon"||r!==0&&r!==d.length-1?d.splice(r,1):(d.shift(),d.pop(),d.push([d[0][0],d[0][1]])),(!l||l({id:n,type:"Feature",geometry:c,properties:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:W.Commit}).valid)&&(this.store.delete([...this.midPoints.ids,...this.selectionPoints.ids]),this.store.updateGeometry([{id:n,geometry:c}]),this.selectionPoints.create(d,c.type,n),a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.midpoints&&this.midPoints.create(d,n,this.coordinatePrecision)))}select(e,t=!0){if(this.selected[0]===e)return;const{mode:o}=this.store.getPropertiesCopy(e),n=this.flags[o];if(!n||!n.feature)return;const r=this.selected[0];if(r){if(r===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:"selected",value:!0}]),this.onSelect(e);const{type:s,coordinates:a}=this.store.getGeometryCopy(e);if(s!=="LineString"&&s!=="Polygon")return;const l=s==="LineString"?a:a[0];l&&n&&n.feature.coordinates&&(this.selectionPoints.create(l,s,e),n.feature.coordinates.midpoints&&this.midPoints.create(l,e,this.coordinatePrecision))}onLeftClick(e){const{clickedFeature:t,clickedMidPoint:o}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&o)this.midPoints.insert(o.id,this.coordinatePrecision);else if(t&&t.id)this.select(t.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){e.button!=="right"?e.button==="left"&&this.onLeftClick(e):this.onRightClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(t=>e.heldKeys.includes(t))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(t=>e.heldKeys.includes(t))}preventDefaultKeyEvent(e){const t=this.canRotate(e),o=this.canScale(e);(t||o)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;this.onDeselect(this.selected[0]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,t){if(!this.selected.length)return;const o=this.store.getPropertiesCopy(this.selected[0]),n=this.flags[o.mode];if(!(n&&n.feature&&(n.feature.draggable||n.feature.coordinates&&n.feature.coordinates.draggable||n.feature.coordinates&&n.feature.coordinates.resizable)))return;this.dragEventCount=0;const r=this.selected[0],s=this.dragCoordinate.getDraggableIndex(e,r);return n&&n.feature&&n.feature.coordinates&&(n.feature.coordinates.draggable||n.feature.coordinates.resizable)&&s!==-1?(this.setCursor(this.cursors.dragStart),n.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(r,s):this.dragCoordinate.startDragging(r,s),void t(!1)):n&&n.feature&&n.feature.draggable&&this.dragFeature.canDrag(e,r)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,r),void t(!1)):void 0}onDrag(e,t){const o=this.selected[0];if(!o)return;const n=this.store.getPropertiesCopy(o),r=this.flags[n.mode],s=(r&&r.feature&&r.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const a=this.validations[n.mode];if(r&&r.feature&&r.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,o,a);if(r&&r.feature&&r.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,o,a);if(this.dragCoordinateResizeFeature.isDragging()&&r.feature&&r.feature.coordinates&&r.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,r.feature.coordinates.resizable,a)}this.dragCoordinate.isDragging()?this.dragCoordinate.drag(e,s,a):this.dragFeature.isDragging()?this.dragFeature.drag(e,a):t(!0)}onDragEnd(e,t){this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0)}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let t=!1;this.midPoints.ids.forEach(r=>{if(t)return;const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!0)});let o=!1;if(this.selectionPoints.ids.forEach(r=>{const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!1,o=!0)}),t)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:n}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(n&&n.id===this.selected[0]||o)?this.cursors.pointerOver:"unset")}styleFeature(e){const t=H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&e.geometry.type==="Point"){if(e.properties.selectionPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties.midPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=40,t}else if(e.properties[be.SELECTED]){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=10,t;if(e.geometry.type==="LineString")return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=10,t;if(e.geometry.type==="Point")return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=10,t}return t}}class wa extends Fe{constructor(...e){super(...e),this.type=Ge.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return H({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}function Xo(i,e,t,o,n){for(;o>t;){if(o-t>600){const l=o-t+1,c=e-t+1,d=Math.log(l),h=.5*Math.exp(2*d/3),u=.5*Math.sqrt(d*h*(l-h)/l)*(c-l/2<0?-1:1);Xo(i,e,Math.max(t,Math.floor(e-c*h/l+u)),Math.min(o,Math.floor(e+(l-c)*h/l+u)),n)}const r=i[e];let s=t,a=o;for(Je(i,t,e),n(i[o],r)>0&&Je(i,t,o);s<a;){for(Je(i,s,a),s++,a--;n(i[s],r)<0;)s++;for(;n(i[a],r)>0;)a--}n(i[t],r)===0?Je(i,t,a):(a++,Je(i,a,o)),a<=e&&(t=a+1),e<=a&&(o=a-1)}}function Je(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}function Ne(i,e){et(i,0,i.children.length,e,i)}function et(i,e,t,o,n){n||(n=Ue([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const s=i.children[r];tt(n,i.leaf?o(s):s)}return n}function tt(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function Pa(i,e){return i.minX-e.minX}function Sa(i,e){return i.minY-e.minY}function Gt(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function wt(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Ia(i,e){const t=Math.max(i.minX,e.minX),o=Math.max(i.minY,e.minY),n=Math.min(i.maxX,e.maxX),r=Math.min(i.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-o)}function Ht(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function Pt(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function Ue(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ro(i,e,t,o,n){const r=[e,t];for(;r.length;){if((t=r.pop())-(e=r.pop())<=o)continue;const s=e+Math.ceil((t-e)/o/2)*o;Xo(i,s,e,t,n),r.push(e,s,s,t)}}class ka{constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(e){let t=this.data;const o=[];if(!Pt(e,t))return o;const n=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){const a=t.children[s],l=t.leaf?n(a):a;Pt(e,l)&&(t.leaf?o.push(a):Ht(e,l)?this._all(a,o):r.push(a))}t=r.pop()}return o}collides(e){let t=this.data;if(Pt(e,t)){const o=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],s=t.leaf?this.toBBox(r):r;if(Pt(e,s)){if(t.leaf||Ht(e,s))return!0;o.push(r)}}t=o.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let o=0;o<e.length;o++)this.insert(e[o]);return}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const o=this.data;this.data=t,t=o}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=Ue([])}remove(e){let t=this.data;const o=this.toBBox(e),n=[],r=[];let s,a,l=!1;for(;t||n.length;){if(t||(t=n.pop(),a=n[n.length-1],s=r.pop(),l=!0),t.leaf){const c=t.children.indexOf(e);c!==-1&&(t.children.splice(c,1),n.push(t),this._condense(n))}l||t.leaf||!Ht(t,o)?a?(s++,t=a.children[s],l=!1):t=null:(n.push(t),r.push(s),s=0,a=t,t=t.children[0])}}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}_all(e,t){const o=[];for(;e;)e.leaf?t.push(...e.children):o.push(...e.children),e=o.pop();return t}_build(e,t,o,n){const r=o-t+1;let s,a=this._maxEntries;if(r<=a)return s=Ue(e.slice(t,o+1)),Ne(s,this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,n-1))),s=Ue([]),s.leaf=!1,s.height=n;const l=Math.ceil(r/a),c=l*Math.ceil(Math.sqrt(a));ro(e,t,o,c,this.compareMinX);for(let d=t;d<=o;d+=c){const h=Math.min(d+c-1,o);ro(e,d,h,l,this.compareMinY);for(let u=d;u<=h;u+=l){const p=Math.min(u+l-1,h);s.children.push(this._build(e,u,p,n-1))}}return Ne(s,this.toBBox),s}_chooseSubtree(e,t,o,n){for(;n.push(t),!t.leaf&&n.length-1!==o;){let a,l=1/0,c=1/0;for(let d=0;d<t.children.length;d++){const h=t.children[d],u=Gt(h),p=(r=e,s=h,(Math.max(s.maxX,r.maxX)-Math.min(s.minX,r.minX))*(Math.max(s.maxY,r.maxY)-Math.min(s.minY,r.minY))-u);p<c?(c=p,l=u<l?u:l,a=h):p===c&&u<l&&(l=u,a=h)}t=a||t.children[0]}var r,s;return t}_insert(e,t,o){const n=o?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),tt(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const o=e[t],n=o.children.length,r=this._minEntries;this._chooseSplitAxis(o,r,n);const s=this._chooseSplitIndex(o,r,n),a=Ue(o.children.splice(s,o.children.length-s));a.height=o.height,a.leaf=o.leaf,Ne(o,this.toBBox),Ne(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(o,a)}_splitRoot(e,t){this.data=Ue([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ne(this.data,this.toBBox)}_chooseSplitIndex(e,t,o){let n,r=1/0,s=1/0;for(let a=t;a<=o-t;a++){const l=et(e,0,a,this.toBBox),c=et(e,a,o,this.toBBox),d=Ia(l,c),h=Gt(l)+Gt(c);d<r?(r=d,n=a,s=h<s?h:s):d===r&&h<s&&(s=h,n=a)}return n||o-t}_chooseSplitAxis(e,t,o){const n=e.leaf?this.compareMinX:Pa,r=e.leaf?this.compareMinY:Sa;this._allDistMargin(e,t,o,n)<this._allDistMargin(e,t,o,r)&&e.children.sort(n)}_allDistMargin(e,t,o,n){e.children.sort(n);const r=this.toBBox,s=et(e,0,t,r),a=et(e,o-t,o,r);let l=wt(s)+wt(a);for(let c=t;c<o-t;c++){const d=e.children[c];tt(s,e.leaf?r(d):d),l+=wt(s)}for(let c=o-t-1;c>=t;c--){const d=e.children[c];tt(a,e.leaf?r(d):d),l+=wt(a)}return l}_adjustParentBBoxes(e,t,o){for(let n=o;n>=0;n--)tt(t[n],e)}_condense(e){for(let t,o=e.length-1;o>=0;o--)e[o].children.length===0?o>0?(t=e[o-1].children,t.splice(t.indexOf(e[o]),1)):this.clear():Ne(e[o],this.toBBox)}}class Ma{constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new ka(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}toBBox(e){const t=[],o=[];let n;if(e.geometry.type==="Polygon")n=e.geometry.coordinates[0];else if(e.geometry.type==="LineString")n=e.geometry.coordinates;else{if(e.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");n=[e.geometry.coordinates]}for(let a=0;a<n.length;a++)o.push(n[a][1]),t.push(n[a][0]);const r=Math.min(...o),s=Math.max(...o);return{minX:Math.min(...t),minY:r,maxX:Math.max(...t),maxY:s}}insert(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}load(e){const t=[],o=new Set;e.forEach(n=>{const r=this.toBBox(n);if(this.setMaps(n,r),o.has(String(n.id)))throw new Error("Duplicate feature ID found ".concat(n.id));o.add(String(n.id)),t.push(r)}),this.tree.load(t)}update(e){this.remove(e.id);const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}remove(e){const t=this.idToNode.get(e);if(!t)throw new Error("".concat(e," not inserted into the spatial index"));this.tree.remove(t)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(t=>this.nodeToId.get(t))}collides(e){return this.tree.collides(this.toBBox(e))}}const Fa={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=16*Math.random()|0;return(i=="x"?e:3&e|8).toString(16)}),isValidId:i=>typeof i=="string"&&i.length===36};class _a{constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new Ma,this.tracked=!e||e.tracked!==!1,this.idStrategy=e&&e.idStrategy?e.idStrategy:Fa}clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,t){if(e.length===0)return[];let o=this.clone(e);const n=[],r=[];return o=o.filter(s=>{s.id==null&&(s.id=this.idStrategy.getId());const a=s.id;if(t){const l=t(s);if(!l.valid)return r.push({id:a,valid:!1,reason:l.reason}),!1}if(this.tracked){if(s.properties.createdAt){if(!Ki(s.properties.createdAt))return r.push({id:s.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else s.properties.createdAt=+new Date;if(s.properties.updatedAt){if(!Ki(s.properties.updatedAt))return r.push({id:s.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else s.properties.updatedAt=+new Date}return this.has(a)?(r.push({id:a,valid:!1,reason:"Feature already exists with this id: ".concat(a)}),!1):(this.store[a]=s,n.push(a),r.push({id:a,valid:!0}),!0)}),this.spatialIndex.load(o),this._onChange(n,"create"),r}search(e,t){const o=this.spatialIndex.search(e).map(n=>this.store[n]);return this.clone(t?o.filter(t):o)}registerOnChange(e){this._onChange=(t,o)=>{e(t,o)}}getGeometryCopy(e){const t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get geometry copy"));return this.clone(t.geometry)}getPropertiesCopy(e){const t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get properties copy"));return this.clone(t.properties)}updateProperty(e){const t=[];e.forEach(({id:o,property:n,value:r})=>{const s=this.store[o];if(!s)throw new Error("No feature with this (".concat(o,"), can not update geometry"));t.push(o),s.properties[n]=r,this.tracked&&(s.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(t,"update")}updateGeometry(e){const t=[];e.forEach(({id:o,geometry:n})=>{t.push(o);const r=this.store[o];if(!r)throw new Error("No feature with this (".concat(o,"), can not update geometry"));r.geometry=this.clone(n),this.spatialIndex.update(r),this.tracked&&(r.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(t,"update")}create(e){const t=[];return e.forEach(({geometry:o,properties:n})=>{let r,s=H({},n);this.tracked&&(r=+new Date,n?(s.createdAt=typeof n.createdAt=="number"?n.createdAt:r,s.updatedAt=typeof n.updatedAt=="number"?n.updatedAt:r):s={createdAt:r,updatedAt:r});const a=this.getId(),l={id:a,type:"Feature",geometry:o,properties:s};this.store[a]=l,this.spatialIndex.insert(l),t.push(a)}),this._onChange&&this._onChange([...t],"create"),t}delete(e){e.forEach(t=>{if(!this.store[t])throw new Error("No feature with this id, can not delete");delete this.store[t],this.spatialIndex.remove(t)}),this._onChange&&this._onChange([...e],"delete")}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}}class Da{constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new wa;const t=new Set,o=e.modes.reduce((d,h)=>{if(t.has(h.mode))throw new Error("There is already a ".concat(h.mode," mode provided"));return t.add(h.mode),d[h.mode]=h,d},{}),n=Object.keys(o);if(n.length===0)throw new Error("No modes provided");n.forEach(d=>{if(o[d].type===Ge.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=d}}),this._modes=H({},o,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new _a({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});const r=d=>{const h=[],u=this._store.copyAll().filter(p=>!d.includes(p.id)||(h.push(p),!1));return{changed:h,unchanged:u}},s=(d,h)=>{this._enabled&&this._eventListeners.finish.forEach(u=>{u(d,h)})},a=(d,h)=>{if(!this._enabled)return;this._eventListeners.change.forEach(m=>{m(d,h)});const{changed:u,unchanged:p}=r(d);h==="create"?this._adapter.render({created:u,deletedIds:[],unchanged:p,updated:[]},this.getModeStyles()):h==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:p,updated:u},this.getModeStyles()):h==="delete"?this._adapter.render({created:[],deletedIds:d,unchanged:p,updated:[]},this.getModeStyles()):h==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:p,updated:[]},this.getModeStyles())},l=d=>{if(!this._enabled)return;this._eventListeners.select.forEach(p=>{p(d)});const{changed:h,unchanged:u}=r([d]);this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())},c=d=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(p=>{p()});const{changed:h,unchanged:u}=r([d]);h&&this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())};Object.keys(this._modes).forEach(d=>{this._modes[d].register({mode:d,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:a,onSelect:l,onDeselect:c,onFinish:s,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const e={};return Object.keys(this._modes).forEach(t=>{e[t]=o=>this._instanceSelectMode&&o.properties[be.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(o):this._modes[t].styleFeature.bind(this._modes[t])(o)}),e}featuresAtLocation({lng:e,lat:t},o){const n=o&&o.pointerDistance!==void 0?o.pointerDistance:30,r=!o||o.ignoreSelectFeatures===void 0||o.ignoreSelectFeatures,s=this._adapter.unproject.bind(this._adapter),a=this._adapter.project.bind(this._adapter),l=a(e,t),c=Uo({unproject:s,point:l,pointerDistance:n});return this._store.search(c).filter(d=>{if(r&&(d.properties[be.MID_POINT]||d.properties[be.SELECTION_POINT]))return!1;if(d.geometry.type==="Point"){const h=d.geometry.coordinates,u=a(h[0],h[1]);return ge(l,u)<n}if(d.geometry.type==="LineString"){const h=d.geometry.coordinates;for(let u=0;u<h.length-1;u++){const p=h[u],m=h[u+1];if(Ho(l,a(p[0],p[1]),a(m[0],m[1]))<n)return!0}return!1}return!!Go([e,t],d.geometry.coordinates)||void 0})}getSelectMode(){if(this.checkEnabled(),!this._instanceSelectMode)throw new Error("No select mode defined in instance");return this.getMode()!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}setModeStyles(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=t}updateModeOptions(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(t)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}setMode(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled(),this._store.delete(e)}selectFeature(e){this.getSelectMode().selectFeature(e)}deselectFeature(e){this.getSelectMode().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}addFeatures(e){return this.checkEnabled(),e.length===0?[]:this._store.load(e,t=>{if(function(o){return!!(o&&typeof o=="object"&&"properties"in o&&typeof o.properties=="object"&&o.properties!==null&&"mode"in o.properties)}(t)){const o=t.properties.mode,n=this._modes[o];if(!n)return{id:t.id,valid:!1,reason:"".concat(o," mode is not in the list of instantiated modes")};const r=n.validateFeature.bind(n)(t);return{id:t.id,valid:r.valid,reason:r.reason?r.reason:r.valid?void 0:"Feature is invalid"}}return{id:t.id,valid:!1,reason:"Mode property does not exist"}})}start(){this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,t)=>{this._mode.onDragStart(e,t)},onDrag:(e,t)=>{this._mode.onDrag(e,t)},onDragEnd:(e,t)=>{this._mode.onDragEnd(e,t)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}})}getFeaturesAtLngLat(e,t){const{lng:o,lat:n}=e;return this.featuresAtLocation({lng:o,lat:n},t)}getFeaturesAtPointerEvent(e,t){const o=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return o===null?[]:this.featuresAtLocation(o,t)}stop(){this._enabled=!1,this._adapter.unregister()}on(e,t){const o=this._eventListeners[e];o.includes(t)||o.push(t)}off(e,t){const o=this._eventListeners[e];o.includes(t)&&o.splice(o.indexOf(t),1)}}var so,Vt,ao;function lo(i,e=9){const t=Math.pow(10,e);return Math.round(i*t)/t}(Vt=so||(so={})).Commit="commit",Vt.Provisional="provisional",Vt.Finish="finish",function(i){i.Drawing="drawing",i.Select="select",i.Static="static",i.Render="render"}(ao||(ao={}));class We{constructor({name:e,callback:t,unregister:o,register:n}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,n(t))},this.unregister=()=>{this.register&&(this.registered=!1,o(t))},this.callback=t}}var Oa=class{constructor(i){this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof i.minPixelDragDistance=="number"?i.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof i.minPixelDragDistanceSelecting=="number"?i.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof i.minPixelDragDistanceDrawing=="number"?i.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof i.coordinatePrecision=="number"?i.coordinatePrecision:9}getButton(i){return i.button===-1?"neither":i.button===0?"left":i.button===1?"middle":i.button===2?"right":"neither"}getMapElementXYPosition(i){const e=this.getMapEventElement(),{left:t,top:o}=e.getBoundingClientRect();return{containerX:i.clientX-t,containerY:i.clientY-o}}getDrawEventFromEvent(i){const e=this.getLngLatFromEvent(i);if(!e)return null;const{lng:t,lat:o}=e,{containerX:n,containerY:r}=this.getMapElementXYPosition(i),s=this.getButton(i),a=Array.from(this._heldKeys);return{lng:lo(t,this._coordinatePrecision),lat:lo(o,this._coordinatePrecision),containerX:n,containerY:r,button:s,heldKeys:a}}register(i){this._currentModeCallbacks=i,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new We({name:"pointerdown",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState="pre-dragging",this._lastDrawEvent=e)},register:i=>{this.getMapEventElement().addEventListener("pointerdown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerdown",i)}}),new We({name:"pointermove",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;i.preventDefault();const e=this.getDrawEventFromEvent(i);if(e)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e),this._lastDrawEvent=e;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const t={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},o={x:e.containerX,y:e.containerY},n=this._currentModeCallbacks.getState(),r=((a,l)=>{const{x:c,y:d}=a,{x:h,y:u}=l,p=h-c,m=u-d;return Math.sqrt(m*m+p*p)})(t,o);let s=!1;if(s=n==="drawing"?r<this._minPixelDragDistanceDrawing:n==="selecting"?r<this._minPixelDragDistanceSelecting:r<this._minPixelDragDistance,s)return;this._dragState="dragging",this._currentModeCallbacks.onDragStart(e,a=>{this.setDraggability.bind(this)(a)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e,t=>{this.setDraggability.bind(this)(t)})},register:i=>{this.getMapEventElement().addEventListener("pointermove",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointermove",i)}}),new We({name:"contextmenu",callback:i=>{this._currentModeCallbacks&&i.preventDefault()},register:i=>{this.getMapEventElement().addEventListener("contextmenu",i)},unregister:i=>{this.getMapEventElement().removeEventListener("contextmenu",i)}}),new We({name:"pointerup",callback:i=>{if(!this._currentModeCallbacks||i.target!==this.getMapEventElement()||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e,t=>{this.setDraggability.bind(this)(t)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||this._currentModeCallbacks.onClick(e),this._dragState="not-dragging",this.setDraggability(!0))},register:i=>{this.getMapEventElement().addEventListener("pointerup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerup",i)}}),new We({name:"keyup",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.delete(i.key),this._currentModeCallbacks.onKeyUp({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keyup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keyup",i)}}),new We({name:"keydown",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.add(i.key),this._currentModeCallbacks.onKeyDown({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keydown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keydown",i)}})]}unregister(){this._listeners.forEach(i=>{i.unregister()}),this.clear()}};class Ba extends Oa{constructor(e){super(e),this._nextRender=void 0,this._map=void 0,this._container=void 0,this._rendered=!1,this.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},this._map=e.map,this._container=this._map.getContainer()}clearLayers(){this._rendered&&(["point","linestring","polygon"].forEach(e=>{const t="td-".concat(e.toLowerCase());this._map.removeLayer(t),e==="polygon"&&this._map.removeLayer(t+"-outline"),this._map.removeSource(t)}),this._rendered=!1,this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0))}_addGeoJSONSource(e,t){this._map.addSource(e,{type:"geojson",data:{type:"FeatureCollection",features:t},tolerance:0})}_addFillLayer(e){return this._map.addLayer({id:e,source:e,type:"fill",paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})}_addFillOutlineLayer(e){return this._map.addLayer({id:e+"-outline",source:e,type:"line",paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})}_addLineLayer(e){return this._map.addLayer({id:e,source:e,type:"line",paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})}_addPointLayer(e){return this._map.addLayer({id:e,source:e,type:"circle",paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})}_addLayer(e,t){t==="Point"&&this._addPointLayer(e),t==="LineString"&&this._addLineLayer(e),t==="Polygon"&&(this._addFillLayer(e),this._addFillOutlineLayer(e))}_addGeoJSONLayer(e,t){const o="td-".concat(e.toLowerCase());return this._addGeoJSONSource(o,t),this._addLayer(o,e),o}_setGeoJSONLayerData(e,t){const o="td-".concat(e.toLowerCase());return this._map.getSource(o).setData({type:"FeatureCollection",features:t}),o}updateChangedIds(e){[...e.updated,...e.created].forEach(t=>{t.geometry.type==="Point"?this.changedIds.points=!0:t.geometry.type==="LineString"?this.changedIds.linestrings=!0:t.geometry.type==="Polygon"&&(this.changedIds.polygons=!0)}),e.deletedIds.length>0&&(this.changedIds.deletion=!0),e.created.length===0&&e.updated.length===0&&e.deletedIds.length===0&&(this.changedIds.styling=!0)}getLngLatFromEvent(e){const{left:t,top:o}=this._container.getBoundingClientRect();return this.unproject(e.clientX-t,e.clientY-o)}getMapEventElement(){return this._map.getCanvas()}setDraggability(e){e?(this._map.dragRotate.enable(),this._map.dragPan.enable()):(this._map.dragRotate.disable(),this._map.dragPan.disable())}project(e,t){const{x:o,y:n}=this._map.project({lng:e,lat:t});return{x:o,y:n}}unproject(e,t){const{lng:o,lat:n}=this._map.unproject({x:e,y:t});return{lng:o,lat:n}}setCursor(e){const t=this._map.getCanvas();e==="unset"?t.style.removeProperty("cursor"):t.style.cursor=e}setDoubleClickToZoom(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}render(e,t){this.updateChangedIds(e),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(()=>{const o=[...e.created,...e.updated,...e.unchanged],n=[],r=[],s=[];for(let a=0;a<o.length;a++){const l=o[a],{properties:c}=l,d=t[c.mode](l);l.geometry.type==="Point"?(c.pointColor=d.pointColor,c.pointOutlineColor=d.pointOutlineColor,c.pointOutlineWidth=d.pointOutlineWidth,c.pointWidth=d.pointWidth,n.push(l)):l.geometry.type==="LineString"?(c.lineStringColor=d.lineStringColor,c.lineStringWidth=d.lineStringWidth,r.push(l)):l.geometry.type==="Polygon"&&(c.polygonFillColor=d.polygonFillColor,c.polygonFillOpacity=d.polygonFillOpacity,c.polygonOutlineColor=d.polygonOutlineColor,c.polygonOutlineWidth=d.polygonOutlineWidth,s.push(l))}if(this._rendered){const a=this.changedIds.deletion||this.changedIds.styling,l=a||this.changedIds.linestrings,c=a||this.changedIds.polygons;let d;(a||this.changedIds.points)&&(d=this._setGeoJSONLayerData("Point",n)),l&&this._setGeoJSONLayerData("LineString",r),c&&this._setGeoJSONLayerData("Polygon",s),d&&this._map.moveLayer(d)}else{const a=this._addGeoJSONLayer("Point",n);this._addGeoJSONLayer("LineString",r),this._addGeoJSONLayer("Polygon",s),this._rendered=!0,a&&this._map.moveLayer(a)}this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers())}getCoordinatePrecision(){return super.getCoordinatePrecision()}unregister(){return super.unregister()}register(e){var t;super.register(e),(t=this._currentModeCallbacks)!=null&&t.onReady&&this._currentModeCallbacks.onReady()}}const Ea={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ra=_({name:"Backspace",render:function(e,t){return te(),re("svg",Ea,t[0]||(t[0]=[Y("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Y("path",{d:"M20 6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H9l-5-5a1.5 1.5 0 0 1 0-2l5-5z"}),Y("path",{d:"M12 10l4 4m0-4l-4 4"})],-1)]))}}),ja={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ta=_({name:"Circle",render:function(e,t){return te(),re("svg",ja,t[0]||(t[0]=[Y("circle",{cx:"12",cy:"12",r:"9",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),La={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},za=_({name:"DeviceFloppy",render:function(e,t){return te(),re("svg",La,t[0]||(t[0]=[Y("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Y("path",{d:"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"}),Y("circle",{cx:"12",cy:"14",r:"2"}),Y("path",{d:"M14 4v4H8V4"})],-1)]))}}),$a={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Na=_({name:"HandFinger",render:function(e,t){return te(),re("svg",$a,t[0]||(t[0]=[Lt('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 1 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7A69.74 69.74 0 0 1 7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path></g>',1)]))}}),Wa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ua=_({name:"HandMove",render:function(e,t){return te(),re("svg",Wa,t[0]||(t[0]=[Lt('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 0 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7L7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path><path d="M2.541 5.594a13.487 13.487 0 0 1 2.46-1.427"></path><path d="M14 3.458a13.44 13.44 0 0 1 3.685 1.612"></path></g>',1)]))}}),Aa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ga=_({name:"Line",render:function(e,t){return te(),re("svg",Aa,t[0]||(t[0]=[Y("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Y("circle",{cx:"6",cy:"18",r:"2"}),Y("circle",{cx:"18",cy:"6",r:"2"}),Y("path",{d:"M7.5 16.5l9-9"})],-1)]))}}),Ha={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Va=_({name:"MapPin",render:function(e,t){return te(),re("svg",Ha,t[0]||(t[0]=[Y("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Y("circle",{cx:"12",cy:"11",r:"3"}),Y("path",{d:"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"})],-1)]))}}),Xa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ka=_({name:"PlayerRecord",render:function(e,t){return te(),re("svg",Xa,t[0]||(t[0]=[Y("circle",{cx:"12",cy:"12",r:"7",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),Ya={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},qa=_({name:"Polygon",render:function(e,t){return te(),re("svg",Ya,t[0]||(t[0]=[Lt('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="2"></circle><circle cx="19" cy="8" r="2"></circle><circle cx="5" cy="11" r="2"></circle><circle cx="15" cy="19" r="2"></circle><path d="M6.5 9.5l3.5-3"></path><path d="M14 5.5L17 7"></path><path d="M18.5 10L16 17"></path><path d="M13.5 17.5l-7-5"></path></g>',1)]))}}),Za={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ja=_({name:"Square",render:function(e,t){return te(),re("svg",Za,t[0]||(t[0]=[Y("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),Qa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ko=_({name:"Upload",render:function(e,t){return te(),re("svg",Qa,t[0]||(t[0]=[Y("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[Y("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),Y("path",{d:"M7 9l5-5l5 5"}),Y("path",{d:"M12 4v12"})],-1)]))}}),el={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},tl=_({name:"Vector",render:function(e,t){return te(),re("svg",el,t[0]||(t[0]=[Lt('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="17" width="4" height="4" rx="1"></rect><rect x="3" y="17" width="4" height="4" rx="1"></rect><path d="M5 7v10"></path><path d="M19 7v10"></path><path d="M7 5h10"></path><path d="M7 19h10"></path></g>',1)]))}}),il={size:[String,Number],color:String,tag:String},ol=Symbol("IconConfigInjection"),nl="span",Ae=_({name:"Icon",props:il,setup(i,{slots:e}){const t=K(ol,null),o=D(()=>{var s;const a=(s=i.size)!==null&&s!==void 0?s:t==null?void 0:t.size;if(a!==void 0)return typeof a=="number"||/^\d+$/.test(a)?"".concat(a,"px"):a}),n=D(()=>{const{color:s}=i;return s===void 0?t?t.color:void 0:s}),r=D(()=>{var s;const{tag:a}=i;return a===void 0?(s=t==null?void 0:t.tag)!==null&&s!==void 0?s:nl:a});return Rt(()=>{Nn()}),()=>g(r.value,{class:"xicon",style:{color:n.value,fontSize:o.value}},[Wn(e,"default")])}});function co(){return Un.fromPromise(new Promise((i,e)=>{navigator.geolocation.getCurrentPosition(i,e)}),i=>i)}function rl(i,e,t){const o=new Blob([i],{type:e}),n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(o),n.dataset.downloadurl=[e,n.download,n.href].join(":"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{URL.revokeObjectURL(n.href)},1500)}const sl={class:"flex-col justify-center items-center gap-4 w-full"},al={class:"flex justify-end gap-4"},ll=_({__name:"TextFileUploaderDialog",props:ki({multiple:{type:Boolean},icon:{},prompt:{},types:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:ki(["update:value","confirm"],["update:show"]),setup(i,{emit:e}){const t=ko(),o=i,n=e,r=An(i,"show");let s=[];const a=d=>{s=[];for(const h of d){const u=h.file;if(u)if(o.types.includes(u.type)){const p=new FileReader;p.onload=m=>{var b;(b=m.target)!=null&&b.result&&s.push(m.target.result),s.length===d.length&&n("update:value",s)},p.readAsText(u)}else t.warning("Skipped file ".concat(h.name," due to unsupported type ").concat(u.type))}},l=()=>{n("confirm",s),r.value=!1},c=d=>{var h,u,p,m;return o.types.includes((u=(h=d.file.file)==null?void 0:h.type)!=null?u:"")?!0:(t.error("Unsupported file type ".concat((m=(p=d.file.file)==null?void 0:p.type)!=null?m:"unknown",". Supported types: ['").concat(o.types.join("', '"),"']")),!1)};return(d,h)=>(te(),_t(A(Or),{show:r.value,"onUpdate:show":h[2]||(h[2]=u=>r.value=u),preset:"dialog",title:"Dialog"},{header:oe(()=>h[3]||(h[3]=[Wt(" File Upload ")])),default:oe(()=>{var u;return[Y("div",sl,[q(A(rs),{multiple:(u=o.multiple)!=null?u:!1,onChange:h[0]||(h[0]=({fileList:p})=>a(p)),onBeforeUpload:c},{default:oe(()=>[q(A(Fo),null,{default:oe(()=>{var p;return[q(A(Ae),{size:36,name:"upload",class:"opacity-50"},{default:oe(()=>{var m;return[(te(),_t(Jt((m=o.icon)!=null?m:A(Ko))))]}),_:1}),Y("div",null,Gn((p=o.prompt)!=null?p:"Drag and drop a file here or click to upload"),1)]}),_:1})]),_:1},8,["multiple"])])]}),action:oe(()=>[Y("div",al,[q(A(Se),{onClick:h[1]||(h[1]=u=>r.value=!1)},{default:oe(()=>h[4]||(h[4]=[Wt("Cancel")])),_:1}),q(A(Se),{type:"primary",onClick:l},{default:oe(()=>h[5]||(h[5]=[Wt("Upload")])),_:1})])]),_:1},8,["show"]))}}),dl=["title","onClick"],cl=["title"],fl=_({__name:"TrackerView",setup(i){j([0,0]);const e=j(7),o="https://api.maptiler.com/maps/basic-v2/style.json?key=".concat("dCeXFrS9lgSF8hm5C6nm"),n=j({latitude:0,longitude:0}),r=j(null),s=j(null),a=j("select"),l=j(!1),c=j([]),d=j(!1),h=ko(),u=D(()=>({type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:c.value.map(y=>[y.longitude,y.latitude])}}]})),p=[{mode:new da,name:"TerraDraw: Rectangle",icon:tl},{mode:new ia,name:"TerraDraw: Point",icon:Va},{mode:new sa,name:"TerraDraw: Polygon",icon:qa},{mode:new $s,name:"TerraDraw: Circle",icon:Ta},{mode:new Zs,name:"TerraDraw: Line String",icon:Ga},{mode:new xa({allowManualDeselection:!0,flags:{point:{feature:{draggable:!0}},polygon:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},linestring:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},freehand:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},circle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},rectangle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}}}}),name:"TerraDraw: Select",icon:Na},{mode:new Us,name:"TerraDraw: Free Hand",icon:Ua}];let m;function b(y){r.value=y.map,s.value=new Da({adapter:new Ba({map:r.value}),modes:p.map(v=>v.mode)}),s.value.start()}function S(){l.value=!l.value,l.value?m=window.setInterval(async()=>{(await co().map(v=>({latitude:v.coords.latitude,longitude:v.coords.longitude}))).match(v=>c.value.push(v),()=>{window.clearInterval(m),l.value=!1,h.error("Fail to record the path")})},1e3):(window.clearInterval(m),l.value=!1,Mi("stored-path",JSON.parse(JSON.stringify(c.value))))}async function P(){rl(JSON.stringify(u.value),"application/json","tracked-path-export")}let x=j(async y=>{});function I(){return new Promise(async(y,v)=>{x.value=async f=>{f.length===0?v(new Error("No file selected")):y(f)},d.value=!0})}function C(){I().then(y=>{c.value=JSON.parse(y[0]).features[0].geometry.coordinates.map(v=>({latitude:v[1],longitude:v[0]})),Mi("stored-path",JSON.parse(JSON.stringify(c.value)))}).catch(y=>{h.error(y)})}return ni(()=>{var y;co().map(v=>{n.value.latitude=v.coords.latitude,n.value.longitude=v.coords.longitude}),Hn().then(()=>Vn("stored-path").then(v=>v.map(f=>{f&&f.length!==0&&(c.value=JSON.parse(JSON.stringify(f)),console.info("Recovered the tracked path from store"))}))),(y=s.value)==null||y.start()}),(y,v)=>(te(),re(qt,null,[q(A(So),{class:"map-layout","content-style":"padding: 0;"},{default:oe(()=>[q(A(fs),{"map-style":o,center:[n.value.longitude,n.value.latitude],zoom:e.value,height:"100%","onMap:load":b},{default:oe(()=>[q(A(Cs),{position:"top-left"}),q(A(bs),{position:"top-left","track-user-location":!0}),q(A(vs),{position:"top-left"}),q(A(ws),{position:"bottom-left"}),q(A(Xi),{position:"top-right"},{default:oe(()=>[(te(),re(qt,null,Xn(p,f=>Y("button",{key:f.name,class:Ft(["!flex justify-center items-center",f.mode.mode===a.value?"!bg-blue-200 rounded-sm transition-colors":""]),title:f.name,onClick:()=>{var k,w,F;console.log("activeDrawMethod",a.value),a.value===f.mode.mode?((k=s.value)==null||k.setMode("select"),a.value="select"):(a.value=f.mode.mode,(w=s.value)==null||w.start(),(F=s.value)==null||F.setMode(f.mode.mode))}},[q(A(Ae),{size:20},{default:oe(()=>[(te(),_t(Jt(f.icon),{class:"stroke-stone-800 text-stone-800"}))]),_:2},1024)],10,dl)),64))]),_:1}),q(A(Xi),{position:"top-right"},{default:oe(()=>[Y("button",{class:Ft(["!flex justify-center items-center transition-all hover:rounded-sm",l.value?"hover:!bg-red-700 hover:stroke-white hover:text-white stroke-red-700 fill-red-600 text-red-700":"stroke-sky-800 fill-sky-700 text-sky-800"]),title:l.value?"Recording":"Track Recorder",onClick:S},[q(A(Ae),{size:20},{default:oe(()=>[(te(),_t(Jt(l.value?A(Ja):A(Ka)),{size:l.value?16:20,class:"stroke-inherit text-inherit"},null,8,["size"]))]),_:1})],10,cl),c.value.length>0&&!l.value?(te(),re("button",{key:0,class:"stroke-red-700 text-red-700 hover:!bg-red-700 hover:stroke-white hover:text-white hover:rounded-sm transition-all !flex justify-center items-center",onClick:v[0]||(v[0]=f=>c.value=[])},[q(A(Ae),{size:20},{default:oe(()=>[q(A(Ra),{class:"stroke-inherit text-inherit",style:{transform:"translateX(-1.3px)"},size:"20"})]),_:1})])):Ee("",!0),c.value.length>0&&!l.value?(te(),re("button",{key:1,class:"!flex justify-center items-center",onClick:P},[q(A(Ae),{size:20},{default:oe(()=>[q(A(za),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):Ee("",!0),c.value.length===0&&!l.value?(te(),re("button",{key:2,class:"!flex justify-center items-center",onClick:C},[q(A(Ae),{size:20},{default:oe(()=>[q(A(Ko),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):Ee("",!0)]),_:1}),q(A(Is),{"source-id":"geojson",data:u.value},{default:oe(()=>[q(A(_s),{"layer-id":"geojson",layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":5,"line-dasharray":[5,2],"line-color":"#008800","line-opacity":.8}})]),_:1},8,["data"])]),_:1},8,["center","zoom"])]),_:1}),q(ll,{show:d.value,"onUpdate:show":v[1]||(v[1]=f=>d.value=f),types:["application/json","text/plain"],onConfirm:A(x)},null,8,["show","onConfirm"])],64))}});export{fl as default};
