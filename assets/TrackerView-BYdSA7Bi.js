var yr=Object.defineProperty;var br=(o,e,t)=>e in o?yr(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var Ce=(o,e,t)=>br(o,typeof e!="symbol"?e+"":e,t);import{d as L,c as re,o as H,a as T,L as wi,h as g,q as xr,g as z,b as F,s as G,i as ne,F as Ge,t as te,k as _o,M as Ro,w as Nt,p as Ie,J as tt,C as Do,T as Ci,m as qo,H as wt,f as rt,y as Re,N as wr,j as Cr,O as Me,Q as Pr,R as Sr,S as Ne,U as Ae,V as He,W as Ct,D as _e,z as X,v as W,x as _,A as Lt,E as po,B as ke,_ as St,u as Eo,X as kr,Y as Ir,n as At,Z as Pi,$ as Mr,a0 as go,a1 as _r,a2 as Ke,a3 as Rr}from"./index-DgK_acdE.js";import{u as fo}from"./vue-i18n-BId0GMkO.js";import{m as Be}from"./index-CKliYMO6.js";import{E as Fo,W as Bo,I as zo,S as Oo,G as Dr,i as Er,L as Fr,e as Br,p as zr,t as Or,C as Tr,B as $r,K as Ve,A as Lr,k as Si,z as ki,H as jr,J as Nr}from"./settings-store-4jHlgYLr.js";import{O as Xt,x as P,y as E,z as j,v as N,N as Ar,P as bt,F as me,Q as et,A as st,C as xe,B as To,R as Ii,D as ce,E as at,o as $o,G as gt,S as Ur,T as Wr,V as Vr,U as Gr,I as Lo,u as Ut,W as mo,K as de,X as Zo,Y as Hr,Z as Xr,t as vo,_ as lt,$ as qe,a0 as Yr,a1 as Kr,J as qr,a2 as Jo,w as Zr,M as Jr,a3 as Qr}from"./Card-BSDjKrHd.js";import{f as yo,N as jo,h as es,g as Ee}from"./light-DWBWu1Bq.js";import{u as No,i as Mi,N as _i,a as ts}from"./create-Enc-J6eD.js";import{N as os,D as is,d as ns,a as rs,u as Ao}from"./use-theme-vars-h7q1GKAV.js";import{t as ro,u as ss}from"./use-locale-BvNAQsQt.js";import{N as Qo,a as as}from"./Suffix-H8yqBNW2.js";import"./vue-router-C3zlooo7.js";function ls(o,e,t){return o===o&&(t!==void 0&&(o=o<=t?o:t),e!==void 0&&(o=o>=e?o:e)),o}function bo(o,e,t){return t===void 0&&(t=e,e=void 0),t!==void 0&&(t=ro(t),t=t===t?t:0),e!==void 0&&(e=ro(e),e=e===e?e:0),ls(ro(o),e,t)}const ds={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},cs=L({name:"Backspace",render:function(e,t){return H(),re("svg",ds,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("path",{d:"M20 6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H9l-5-5a1.5 1.5 0 0 1 0-2l5-5z"}),T("path",{d:"M12 10l4 4m0-4l-4 4"})],-1)]))}}),us={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},hs=L({name:"DeviceFloppy",render:function(e,t){return H(),re("svg",us,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("path",{d:"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"}),T("circle",{cx:"12",cy:"14",r:"2"}),T("path",{d:"M14 4v4H8V4"})],-1)]))}}),ps={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},gs=L({name:"HandFinger",render:function(e,t){return H(),re("svg",ps,t[0]||(t[0]=[wi('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 1 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7A69.74 69.74 0 0 1 7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path></g>',1)]))}}),fs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ms=L({name:"Line",render:function(e,t){return H(),re("svg",fs,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("circle",{cx:"6",cy:"18",r:"2"}),T("circle",{cx:"18",cy:"6",r:"2"}),T("path",{d:"M7.5 16.5l9-9"})],-1)]))}}),vs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ys=L({name:"MapPin",render:function(e,t){return H(),re("svg",vs,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("circle",{cx:"12",cy:"11",r:"3"}),T("path",{d:"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"})],-1)]))}}),bs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},xs=L({name:"PlayerRecord",render:function(e,t){return H(),re("svg",bs,t[0]||(t[0]=[T("circle",{cx:"12",cy:"12",r:"7",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),ws={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Cs=L({name:"Route",render:function(e,t){return H(),re("svg",ws,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("circle",{cx:"6",cy:"19",r:"2"}),T("circle",{cx:"18",cy:"5",r:"2"}),T("path",{d:"M12 19h4.5a3.5 3.5 0 0 0 0-7h-8a3.5 3.5 0 0 1 0-7H12"})],-1)]))}}),Ps={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ss=L({name:"Square",render:function(e,t){return H(),re("svg",Ps,t[0]||(t[0]=[T("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),ks={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Is=L({name:"Trash",render:function(e,t){return H(),re("svg",ks,t[0]||(t[0]=[wi('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16"></path><path d="M10 11v6"></path><path d="M14 11v6"></path><path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2l1-12"></path><path d="M9 7V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v3"></path></g>',1)]))}}),Ms={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ri=L({name:"Upload",render:function(e,t){return H(),re("svg",Ms,t[0]||(t[0]=[T("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[T("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),T("path",{d:"M7 9l5-5l5 5"}),T("path",{d:"M12 4v12"})],-1)]))}}),_s=L({name:"Add",render(){return g("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},g("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),Rs=Xt("attach",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),Ds=Xt("cancel",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),Di=L({name:"Eye",render(){return g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),g("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),Es=L({name:"EyeOff",render(){return g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"}),g("path",{d:"M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z",fill:"currentColor"}),g("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z",fill:"currentColor"}),g("path",{d:"M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z",fill:"currentColor"}),g("path",{d:"M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z",fill:"currentColor"}))}}),Fs=Xt("retry",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),g("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),Bs=Xt("trash",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),zs=P("alert",`
 line-height: var(--n-line-height);
 border-radius: var(--n-border-radius);
 position: relative;
 transition: background-color .3s var(--n-bezier);
 background-color: var(--n-color);
 text-align: start;
 word-break: break-word;
`,[E("border",`
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 transition: border-color .3s var(--n-bezier);
 border: var(--n-border);
 pointer-events: none;
 `),j("closable",[P("alert-body",[E("title",`
 padding-right: 24px;
 `)])]),E("icon",{color:"var(--n-icon-color)"}),P("alert-body",{padding:"var(--n-padding)"},[E("title",{color:"var(--n-title-text-color)"}),E("content",{color:"var(--n-content-text-color)"})]),yo({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),E("icon",`
 position: absolute;
 left: 0;
 top: 0;
 align-items: center;
 justify-content: center;
 display: flex;
 width: var(--n-icon-size);
 height: var(--n-icon-size);
 font-size: var(--n-icon-size);
 margin: var(--n-icon-margin);
 `),E("close",`
 transition:
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 position: absolute;
 right: 0;
 top: 0;
 margin: var(--n-close-margin);
 `),j("show-icon",[P("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),j("right-adjust",[P("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),P("alert-body",`
 border-radius: var(--n-border-radius);
 transition: border-color .3s var(--n-bezier);
 `,[E("title",`
 transition: color .3s var(--n-bezier);
 font-size: 16px;
 line-height: 19px;
 font-weight: var(--n-title-font-weight);
 `,[N("& +",[E("content",{marginTop:"9px"})])]),E("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),E("icon",{transition:"color .3s var(--n-bezier)"})]),Os=Object.assign(Object.assign({},xe.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Ts=L({name:"Alert",inheritAttrs:!1,props:Os,slots:Object,setup(o){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:i,mergedRtlRef:n}=st(o),r=xe("Alert","-alert",zs,Dr,o,e),s=To("Alert",n,e),a=z(()=>{const{common:{cubicBezierEaseInOut:p},self:f}=r.value,{fontSize:y,borderRadius:I,titleFontWeight:M,lineHeight:k,iconSize:R,iconMargin:C,iconMarginRtl:b,closeIconSize:v,closeBorderRadius:x,closeSize:D,closeMargin:S,closeMarginRtl:B,padding:A}=f,{type:U}=o,{left:q,right:oe}=Ii(C);return{"--n-bezier":p,"--n-color":f[ce("color",U)],"--n-close-icon-size":v,"--n-close-border-radius":x,"--n-close-color-hover":f[ce("closeColorHover",U)],"--n-close-color-pressed":f[ce("closeColorPressed",U)],"--n-close-icon-color":f[ce("closeIconColor",U)],"--n-close-icon-color-hover":f[ce("closeIconColorHover",U)],"--n-close-icon-color-pressed":f[ce("closeIconColorPressed",U)],"--n-icon-color":f[ce("iconColor",U)],"--n-border":f[ce("border",U)],"--n-title-text-color":f[ce("titleTextColor",U)],"--n-content-text-color":f[ce("contentTextColor",U)],"--n-line-height":k,"--n-border-radius":I,"--n-font-size":y,"--n-title-font-weight":M,"--n-icon-size":R,"--n-icon-margin":C,"--n-icon-margin-rtl":b,"--n-close-size":D,"--n-close-margin":S,"--n-close-margin-rtl":B,"--n-padding":A,"--n-icon-margin-left":q,"--n-icon-margin-right":oe}}),l=i?at("alert",z(()=>o.type[0]),a,o):void 0,d=F(!0),c=()=>{const{onAfterLeave:p,onAfterHide:f}=o;p&&p(),f&&f()};return{rtlEnabled:s,mergedClsPrefix:e,mergedBordered:t,visible:d,handleCloseClick:()=>{var p;Promise.resolve((p=o.onClose)===null||p===void 0?void 0:p.call(o)).then(f=>{f!==!1&&(d.value=!1)})},handleAfterLeave:()=>{c()},mergedTheme:r,cssVars:i?void 0:a,themeClass:l==null?void 0:l.themeClass,onRender:l==null?void 0:l.onRender}},render(){var o;return(o=this.onRender)===null||o===void 0||o.call(this),g(jo,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:e,$slots:t}=this,i={class:[`${e}-alert`,this.themeClass,this.closable&&`${e}-alert--closable`,this.showIcon&&`${e}-alert--show-icon`,!this.title&&this.closable&&`${e}-alert--right-adjust`,this.rtlEnabled&&`${e}-alert--rtl`],style:this.cssVars,role:"alert"};return this.visible?g("div",Object.assign({},xr(this.$attrs,i)),this.closable&&g(Ar,{clsPrefix:e,class:`${e}-alert__close`,onClick:this.handleCloseClick}),this.bordered&&g("div",{class:`${e}-alert__border`}),this.showIcon&&g("div",{class:`${e}-alert__icon`,"aria-hidden":"true"},bt(t.icon,()=>[g(me,{clsPrefix:e},{default:()=>{switch(this.type){case"success":return g(Oo,null);case"info":return g(zo,null);case"warning":return g(Bo,null);case"error":return g(Fo,null);default:return null}}})])),g("div",{class:[`${e}-alert-body`,this.mergedBordered&&`${e}-alert-body--bordered`]},et(t.header,n=>{const r=n||this.title;return r?g("div",{class:`${e}-alert-body__title`},r):null}),t.default&&g("div",{class:`${e}-alert-body__content`},t))):null}})}}),Ei=$o("n-input"),$s=P("input",`
 max-width: 100%;
 cursor: text;
 line-height: 1.5;
 z-index: auto;
 outline: none;
 box-sizing: border-box;
 position: relative;
 display: inline-flex;
 border-radius: var(--n-border-radius);
 background-color: var(--n-color);
 transition: background-color .3s var(--n-bezier);
 font-size: var(--n-font-size);
 font-weight: var(--n-font-weight);
 --n-padding-vertical: calc((var(--n-height) - 1.5 * var(--n-font-size)) / 2);
`,[E("input, textarea",`
 overflow: hidden;
 flex-grow: 1;
 position: relative;
 `),E("input-el, textarea-el, input-mirror, textarea-mirror, separator, placeholder",`
 box-sizing: border-box;
 font-size: inherit;
 line-height: 1.5;
 font-family: inherit;
 border: none;
 outline: none;
 background-color: #0000;
 text-align: inherit;
 transition:
 -webkit-text-fill-color .3s var(--n-bezier),
 caret-color .3s var(--n-bezier),
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier);
 `),E("input-el, textarea-el",`
 -webkit-appearance: none;
 scrollbar-width: none;
 width: 100%;
 min-width: 0;
 text-decoration-color: var(--n-text-decoration-color);
 color: var(--n-text-color);
 caret-color: var(--n-caret-color);
 background-color: transparent;
 `,[N("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb",`
 width: 0;
 height: 0;
 display: none;
 `),N("&::placeholder",`
 color: #0000;
 -webkit-text-fill-color: transparent !important;
 `),N("&:-webkit-autofill ~",[E("placeholder","display: none;")])]),j("round",[gt("textarea","border-radius: calc(var(--n-height) / 2);")]),E("placeholder",`
 pointer-events: none;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 overflow: hidden;
 color: var(--n-placeholder-color);
 `,[N("span",`
 width: 100%;
 display: inline-block;
 `)]),j("textarea",[E("placeholder","overflow: visible;")]),gt("autosize","width: 100%;"),j("autosize",[E("textarea-el, input-el",`
 position: absolute;
 top: 0;
 left: 0;
 height: 100%;
 `)]),P("input-wrapper",`
 overflow: hidden;
 display: inline-flex;
 flex-grow: 1;
 position: relative;
 padding-left: var(--n-padding-left);
 padding-right: var(--n-padding-right);
 `),E("input-mirror",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre;
 pointer-events: none;
 `),E("input-el",`
 padding: 0;
 height: var(--n-height);
 line-height: var(--n-height);
 `,[N("&[type=password]::-ms-reveal","display: none;"),N("+",[E("placeholder",`
 display: flex;
 align-items: center; 
 `)])]),gt("textarea",[E("placeholder","white-space: nowrap;")]),E("eye",`
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `),j("textarea","width: 100%;",[P("input-word-count",`
 position: absolute;
 right: var(--n-padding-right);
 bottom: var(--n-padding-vertical);
 `),j("resizable",[P("input-wrapper",`
 resize: vertical;
 min-height: var(--n-height);
 `)]),E("textarea-el, textarea-mirror, placeholder",`
 height: 100%;
 padding-left: 0;
 padding-right: 0;
 padding-top: var(--n-padding-vertical);
 padding-bottom: var(--n-padding-vertical);
 word-break: break-word;
 display: inline-block;
 vertical-align: bottom;
 box-sizing: border-box;
 line-height: var(--n-line-height-textarea);
 margin: 0;
 resize: none;
 white-space: pre-wrap;
 scroll-padding-block-end: var(--n-padding-vertical);
 `),E("textarea-mirror",`
 width: 100%;
 pointer-events: none;
 overflow: hidden;
 visibility: hidden;
 position: static;
 white-space: pre-wrap;
 overflow-wrap: break-word;
 `)]),j("pair",[E("input-el, placeholder","text-align: center;"),E("separator",`
 display: flex;
 align-items: center;
 transition: color .3s var(--n-bezier);
 color: var(--n-text-color);
 white-space: nowrap;
 `,[P("icon",`
 color: var(--n-icon-color);
 `),P("base-icon",`
 color: var(--n-icon-color);
 `)])]),j("disabled",`
 cursor: not-allowed;
 background-color: var(--n-color-disabled);
 `,[E("border","border: var(--n-border-disabled);"),E("input-el, textarea-el",`
 cursor: not-allowed;
 color: var(--n-text-color-disabled);
 text-decoration-color: var(--n-text-color-disabled);
 `),E("placeholder","color: var(--n-placeholder-color-disabled);"),E("separator","color: var(--n-text-color-disabled);",[P("icon",`
 color: var(--n-icon-color-disabled);
 `),P("base-icon",`
 color: var(--n-icon-color-disabled);
 `)]),P("input-word-count",`
 color: var(--n-count-text-color-disabled);
 `),E("suffix, prefix","color: var(--n-text-color-disabled);",[P("icon",`
 color: var(--n-icon-color-disabled);
 `),P("internal-icon",`
 color: var(--n-icon-color-disabled);
 `)])]),gt("disabled",[E("eye",`
 color: var(--n-icon-color);
 cursor: pointer;
 `,[N("&:hover",`
 color: var(--n-icon-color-hover);
 `),N("&:active",`
 color: var(--n-icon-color-pressed);
 `)]),N("&:hover",[E("state-border","border: var(--n-border-hover);")]),j("focus","background-color: var(--n-color-focus);",[E("state-border",`
 border: var(--n-border-focus);
 box-shadow: var(--n-box-shadow-focus);
 `)])]),E("border, state-border",`
 box-sizing: border-box;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 pointer-events: none;
 border-radius: inherit;
 border: var(--n-border);
 transition:
 box-shadow .3s var(--n-bezier),
 border-color .3s var(--n-bezier);
 `),E("state-border",`
 border-color: #0000;
 z-index: 1;
 `),E("prefix","margin-right: 4px;"),E("suffix",`
 margin-left: 4px;
 `),E("suffix, prefix",`
 transition: color .3s var(--n-bezier);
 flex-wrap: nowrap;
 flex-shrink: 0;
 line-height: var(--n-height);
 white-space: nowrap;
 display: inline-flex;
 align-items: center;
 justify-content: center;
 color: var(--n-suffix-text-color);
 `,[P("base-loading",`
 font-size: var(--n-icon-size);
 margin: 0 2px;
 color: var(--n-loading-color);
 `),P("base-clear",`
 font-size: var(--n-icon-size);
 `,[E("placeholder",[P("base-icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)])]),N(">",[P("icon",`
 transition: color .3s var(--n-bezier);
 color: var(--n-icon-color);
 font-size: var(--n-icon-size);
 `)]),P("base-icon",`
 font-size: var(--n-icon-size);
 `)]),P("input-word-count",`
 pointer-events: none;
 line-height: 1.5;
 font-size: .85em;
 color: var(--n-count-text-color);
 transition: color .3s var(--n-bezier);
 margin-left: 4px;
 font-variant: tabular-nums;
 `),["warning","error"].map(o=>j(`${o}-status`,[gt("disabled",[P("base-loading",`
 color: var(--n-loading-color-${o})
 `),E("input-el, textarea-el",`
 caret-color: var(--n-caret-color-${o});
 `),E("state-border",`
 border: var(--n-border-${o});
 `),N("&:hover",[E("state-border",`
 border: var(--n-border-hover-${o});
 `)]),N("&:focus",`
 background-color: var(--n-color-focus-${o});
 `,[E("state-border",`
 box-shadow: var(--n-box-shadow-focus-${o});
 border: var(--n-border-focus-${o});
 `)]),j("focus",`
 background-color: var(--n-color-focus-${o});
 `,[E("state-border",`
 box-shadow: var(--n-box-shadow-focus-${o});
 border: var(--n-border-focus-${o});
 `)])])]))]),Ls=P("input",[j("disabled",[E("input-el, textarea-el",`
 -webkit-text-fill-color: var(--n-text-color-disabled);
 `)])]);function js(o){let e=0;for(const t of o)e++;return e}function Ft(o){return o===""||o==null}function Ns(o){const e=F(null);function t(){const{value:r}=o;if(!(r!=null&&r.focus)){n();return}const{selectionStart:s,selectionEnd:a,value:l}=r;if(s==null||a==null){n();return}e.value={start:s,end:a,beforeText:l.slice(0,s),afterText:l.slice(a)}}function i(){var r;const{value:s}=e,{value:a}=o;if(!s||!a)return;const{value:l}=a,{start:d,beforeText:c,afterText:h}=s;let u=l.length;if(l.endsWith(h))u=l.length-h.length;else if(l.startsWith(c))u=c.length;else{const p=c[d-1],f=l.indexOf(p,d-1);f!==-1&&(u=f+1)}(r=a.setSelectionRange)===null||r===void 0||r.call(a,u,u)}function n(){e.value=null}return G(o,n),{recordCursor:t,restoreCursor:i}}const ei=L({name:"InputWordCount",setup(o,{slots:e}){const{mergedValueRef:t,maxlengthRef:i,mergedClsPrefixRef:n,countGraphemesRef:r}=ne(Ei),s=z(()=>{const{value:a}=t;return a===null||Array.isArray(a)?0:(r.value||js)(a)});return()=>{const{value:a}=i,{value:l}=t;return g("span",{class:`${n.value}-input-word-count`},Ur(e.default,{value:l===null||Array.isArray(l)?"":l},()=>[a===void 0?s.value:`${s.value} / ${a}`]))}}}),As=Object.assign(Object.assign({},xe.props),{bordered:{type:Boolean,default:void 0},type:{type:String,default:"text"},placeholder:[Array,String],defaultValue:{type:[String,Array],default:null},value:[String,Array],disabled:{type:Boolean,default:void 0},size:String,rows:{type:[Number,String],default:3},round:Boolean,minlength:[String,Number],maxlength:[String,Number],clearable:Boolean,autosize:{type:[Boolean,Object],default:!1},pair:Boolean,separator:String,readonly:{type:[String,Boolean],default:!1},passivelyActivated:Boolean,showPasswordOn:String,stateful:{type:Boolean,default:!0},autofocus:Boolean,inputProps:Object,resizable:{type:Boolean,default:!0},showCount:Boolean,loading:{type:Boolean,default:void 0},allowInput:Function,renderCount:Function,onMousedown:Function,onKeydown:Function,onKeyup:[Function,Array],onInput:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClick:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],countGraphemes:Function,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],textDecoration:[String,Array],attrSize:{type:Number,default:20},onInputBlur:[Function,Array],onInputFocus:[Function,Array],onDeactivate:[Function,Array],onActivate:[Function,Array],onWrapperFocus:[Function,Array],onWrapperBlur:[Function,Array],internalDeactivateOnEnter:Boolean,internalForceFocus:Boolean,internalLoadingBeforeSuffix:{type:Boolean,default:!0},showPasswordToggle:Boolean}),Us=L({name:"Input",props:As,slots:Object,setup(o){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:i,mergedRtlRef:n}=st(o),r=xe("Input","-input",$s,Er,o,e);Fr&&Gr("-input-safari",Ls,e);const s=F(null),a=F(null),l=F(null),d=F(null),c=F(null),h=F(null),u=F(null),p=Ns(u),f=F(null),{localeRef:y}=ss("Input"),I=F(o.defaultValue),M=te(o,"value"),k=Lo(M,I),R=No(o),{mergedSizeRef:C,mergedDisabledRef:b,mergedStatusRef:v}=R,x=F(!1),D=F(!1),S=F(!1),B=F(!1);let A=null;const U=z(()=>{const{placeholder:m,pair:w}=o;return w?Array.isArray(m)?m:m===void 0?["",""]:[m,m]:m===void 0?[y.value.placeholder]:[m]}),q=z(()=>{const{value:m}=S,{value:w}=k,{value:O}=U;return!m&&(Ft(w)||Array.isArray(w)&&Ft(w[0]))&&O[0]}),oe=z(()=>{const{value:m}=S,{value:w}=k,{value:O}=U;return!m&&O[1]&&(Ft(w)||Array.isArray(w)&&Ft(w[1]))}),Z=Ut(()=>o.internalForceFocus||x.value),Y=Ut(()=>{if(b.value||o.readonly||!o.clearable||!Z.value&&!D.value)return!1;const{value:m}=k,{value:w}=Z;return o.pair?!!(Array.isArray(m)&&(m[0]||m[1]))&&(D.value||w):!!m&&(D.value||w)}),ie=z(()=>{const{showPasswordOn:m}=o;if(m)return m;if(o.showPasswordToggle)return"click"}),ee=F(!1),$=z(()=>{const{textDecoration:m}=o;return m?Array.isArray(m)?m.map(w=>({textDecoration:w})):[{textDecoration:m}]:["",""]}),V=F(void 0),K=()=>{var m,w;if(o.type==="textarea"){const{autosize:O}=o;if(O&&(V.value=(w=(m=f.value)===null||m===void 0?void 0:m.$el)===null||w===void 0?void 0:w.offsetWidth),!a.value||typeof O=="boolean")return;const{paddingTop:Q,paddingBottom:se,lineHeight:J}=window.getComputedStyle(a.value),$e=Number(Q.slice(0,-2)),Le=Number(se.slice(0,-2)),je=Number(J.slice(0,-2)),{value:ht}=l;if(!ht)return;if(O.minRows){const pt=Math.max(O.minRows,1),no=`${$e+Le+je*pt}px`;ht.style.minHeight=no}if(O.maxRows){const pt=`${$e+Le+je*O.maxRows}px`;ht.style.maxHeight=pt}}},fe=z(()=>{const{maxlength:m}=o;return m===void 0?void 0:Number(m)});_o(()=>{const{value:m}=k;Array.isArray(m)||io(m)});const Se=Ro().proxy;function we(m,w){const{onUpdateValue:O,"onUpdate:value":Q,onInput:se}=o,{nTriggerFormInput:J}=R;O&&de(O,m,w),Q&&de(Q,m,w),se&&de(se,m,w),I.value=m,J()}function Xe(m,w){const{onChange:O}=o,{nTriggerFormChange:Q}=R;O&&de(O,m,w),I.value=m,Q()}function qt(m){const{onBlur:w}=o,{nTriggerFormBlur:O}=R;w&&de(w,m),O()}function Zt(m){const{onFocus:w}=o,{nTriggerFormFocus:O}=R;w&&de(w,m),O()}function Jt(m){const{onClear:w}=o;w&&de(w,m)}function Qt(m){const{onInputBlur:w}=o;w&&de(w,m)}function eo(m){const{onInputFocus:w}=o;w&&de(w,m)}function to(){const{onDeactivate:m}=o;m&&de(m)}function tn(){const{onActivate:m}=o;m&&de(m)}function on(m){const{onClick:w}=o;w&&de(w,m)}function nn(m){const{onWrapperFocus:w}=o;w&&de(w,m)}function rn(m){const{onWrapperBlur:w}=o;w&&de(w,m)}function sn(){S.value=!0}function an(m){S.value=!1,m.target===h.value?_t(m,1):_t(m,0)}function _t(m,w=0,O="input"){const Q=m.target.value;if(io(Q),m instanceof InputEvent&&!m.isComposing&&(S.value=!1),o.type==="textarea"){const{value:J}=f;J&&J.syncUnifiedContainer()}if(A=Q,S.value)return;p.recordCursor();const se=ln(Q);if(se)if(!o.pair)O==="input"?we(Q,{source:w}):Xe(Q,{source:w});else{let{value:J}=k;Array.isArray(J)?J=[J[0],J[1]]:J=["",""],J[w]=Q,O==="input"?we(J,{source:w}):Xe(J,{source:w})}Se.$forceUpdate(),se||tt(p.restoreCursor)}function ln(m){const{countGraphemes:w,maxlength:O,minlength:Q}=o;if(w){let J;if(O!==void 0&&(J===void 0&&(J=w(m)),J>Number(O))||Q!==void 0&&(J===void 0&&(J=w(m)),J<Number(O)))return!1}const{allowInput:se}=o;return typeof se=="function"?se(m):!0}function dn(m){Qt(m),m.relatedTarget===s.value&&to(),m.relatedTarget!==null&&(m.relatedTarget===c.value||m.relatedTarget===h.value||m.relatedTarget===a.value)||(B.value=!1),Rt(m,"blur"),u.value=null}function cn(m,w){eo(m),x.value=!0,B.value=!0,tn(),Rt(m,"focus"),w===0?u.value=c.value:w===1?u.value=h.value:w===2&&(u.value=a.value)}function un(m){o.passivelyActivated&&(rn(m),Rt(m,"blur"))}function hn(m){o.passivelyActivated&&(x.value=!0,nn(m),Rt(m,"focus"))}function Rt(m,w){m.relatedTarget!==null&&(m.relatedTarget===c.value||m.relatedTarget===h.value||m.relatedTarget===a.value||m.relatedTarget===s.value)||(w==="focus"?(Zt(m),x.value=!0):w==="blur"&&(qt(m),x.value=!1))}function pn(m,w){_t(m,w,"change")}function gn(m){on(m)}function fn(m){Jt(m),Ho()}function Ho(){o.pair?(we(["",""],{source:"clear"}),Xe(["",""],{source:"clear"})):(we("",{source:"clear"}),Xe("",{source:"clear"}))}function mn(m){const{onMousedown:w}=o;w&&w(m);const{tagName:O}=m.target;if(O!=="INPUT"&&O!=="TEXTAREA"){if(o.resizable){const{value:Q}=s;if(Q){const{left:se,top:J,width:$e,height:Le}=Q.getBoundingClientRect(),je=14;if(se+$e-je<m.clientX&&m.clientX<se+$e&&J+Le-je<m.clientY&&m.clientY<J+Le)return}}m.preventDefault(),x.value||Xo()}}function vn(){var m;D.value=!0,o.type==="textarea"&&((m=f.value)===null||m===void 0||m.handleMouseEnterWrapper())}function yn(){var m;D.value=!1,o.type==="textarea"&&((m=f.value)===null||m===void 0||m.handleMouseLeaveWrapper())}function bn(){b.value||ie.value==="click"&&(ee.value=!ee.value)}function xn(m){if(b.value)return;m.preventDefault();const w=Q=>{Q.preventDefault(),Zo("mouseup",document,w)};if(mo("mouseup",document,w),ie.value!=="mousedown")return;ee.value=!0;const O=()=>{ee.value=!1,Zo("mouseup",document,O)};mo("mouseup",document,O)}function wn(m){o.onKeyup&&de(o.onKeyup,m)}function Cn(m){switch(o.onKeydown&&de(o.onKeydown,m),m.key){case"Escape":oo();break;case"Enter":Pn(m);break}}function Pn(m){var w,O;if(o.passivelyActivated){const{value:Q}=B;if(Q){o.internalDeactivateOnEnter&&oo();return}m.preventDefault(),o.type==="textarea"?(w=a.value)===null||w===void 0||w.focus():(O=c.value)===null||O===void 0||O.focus()}}function oo(){o.passivelyActivated&&(B.value=!1,tt(()=>{var m;(m=s.value)===null||m===void 0||m.focus()}))}function Xo(){var m,w,O;b.value||(o.passivelyActivated?(m=s.value)===null||m===void 0||m.focus():((w=a.value)===null||w===void 0||w.focus(),(O=c.value)===null||O===void 0||O.focus()))}function Sn(){var m;!((m=s.value)===null||m===void 0)&&m.contains(document.activeElement)&&document.activeElement.blur()}function kn(){var m,w;(m=a.value)===null||m===void 0||m.select(),(w=c.value)===null||w===void 0||w.select()}function In(){b.value||(a.value?a.value.focus():c.value&&c.value.focus())}function Mn(){const{value:m}=s;m!=null&&m.contains(document.activeElement)&&m!==document.activeElement&&oo()}function _n(m){if(o.type==="textarea"){const{value:w}=a;w==null||w.scrollTo(m)}else{const{value:w}=c;w==null||w.scrollTo(m)}}function io(m){const{type:w,pair:O,autosize:Q}=o;if(!O&&Q)if(w==="textarea"){const{value:se}=l;se&&(se.textContent=`${m??""}\r
`)}else{const{value:se}=d;se&&(m?se.textContent=m:se.innerHTML="&nbsp;")}}function Rn(){K()}const Yo=F({top:"0"});function Dn(m){var w;const{scrollTop:O}=m.target;Yo.value.top=`${-O}px`,(w=f.value)===null||w===void 0||w.syncUnifiedContainer()}let Dt=null;Nt(()=>{const{autosize:m,type:w}=o;m&&w==="textarea"?Dt=G(k,O=>{!Array.isArray(O)&&O!==A&&io(O)}):Dt==null||Dt()});let Et=null;Nt(()=>{o.type==="textarea"?Et=G(k,m=>{var w;!Array.isArray(m)&&m!==A&&((w=f.value)===null||w===void 0||w.syncUnifiedContainer())}):Et==null||Et()}),Ie(Ei,{mergedValueRef:k,maxlengthRef:fe,mergedClsPrefixRef:e,countGraphemesRef:te(o,"countGraphemes")});const En={wrapperElRef:s,inputElRef:c,textareaElRef:a,isCompositing:S,clear:Ho,focus:Xo,blur:Sn,select:kn,deactivate:Mn,activate:In,scrollTo:_n},Fn=To("Input",n,e),Ko=z(()=>{const{value:m}=C,{common:{cubicBezierEaseInOut:w},self:{color:O,borderRadius:Q,textColor:se,caretColor:J,caretColorError:$e,caretColorWarning:Le,textDecorationColor:je,border:ht,borderDisabled:pt,borderHover:no,borderFocus:Bn,placeholderColor:zn,placeholderColorDisabled:On,lineHeightTextarea:Tn,colorDisabled:$n,colorFocus:Ln,textColorDisabled:jn,boxShadowFocus:Nn,iconSize:An,colorFocusWarning:Un,boxShadowFocusWarning:Wn,borderWarning:Vn,borderFocusWarning:Gn,borderHoverWarning:Hn,colorFocusError:Xn,boxShadowFocusError:Yn,borderError:Kn,borderFocusError:qn,borderHoverError:Zn,clearSize:Jn,clearColor:Qn,clearColorHover:er,clearColorPressed:tr,iconColor:or,iconColorDisabled:ir,suffixTextColor:nr,countTextColor:rr,countTextColorDisabled:sr,iconColorHover:ar,iconColorPressed:lr,loadingColor:dr,loadingColorError:cr,loadingColorWarning:ur,fontWeight:hr,[ce("padding",m)]:pr,[ce("fontSize",m)]:gr,[ce("height",m)]:fr}}=r.value,{left:mr,right:vr}=Ii(pr);return{"--n-bezier":w,"--n-count-text-color":rr,"--n-count-text-color-disabled":sr,"--n-color":O,"--n-font-size":gr,"--n-font-weight":hr,"--n-border-radius":Q,"--n-height":fr,"--n-padding-left":mr,"--n-padding-right":vr,"--n-text-color":se,"--n-caret-color":J,"--n-text-decoration-color":je,"--n-border":ht,"--n-border-disabled":pt,"--n-border-hover":no,"--n-border-focus":Bn,"--n-placeholder-color":zn,"--n-placeholder-color-disabled":On,"--n-icon-size":An,"--n-line-height-textarea":Tn,"--n-color-disabled":$n,"--n-color-focus":Ln,"--n-text-color-disabled":jn,"--n-box-shadow-focus":Nn,"--n-loading-color":dr,"--n-caret-color-warning":Le,"--n-color-focus-warning":Un,"--n-box-shadow-focus-warning":Wn,"--n-border-warning":Vn,"--n-border-focus-warning":Gn,"--n-border-hover-warning":Hn,"--n-loading-color-warning":ur,"--n-caret-color-error":$e,"--n-color-focus-error":Xn,"--n-box-shadow-focus-error":Yn,"--n-border-error":Kn,"--n-border-focus-error":qn,"--n-border-hover-error":Zn,"--n-loading-color-error":cr,"--n-clear-color":Qn,"--n-clear-size":Jn,"--n-clear-color-hover":er,"--n-clear-color-pressed":tr,"--n-icon-color":or,"--n-icon-color-hover":ar,"--n-icon-color-pressed":lr,"--n-icon-color-disabled":ir,"--n-suffix-text-color":nr}}),Ye=i?at("input",z(()=>{const{value:m}=C;return m[0]}),Ko,o):void 0;return Object.assign(Object.assign({},En),{wrapperElRef:s,inputElRef:c,inputMirrorElRef:d,inputEl2Ref:h,textareaElRef:a,textareaMirrorElRef:l,textareaScrollbarInstRef:f,rtlEnabled:Fn,uncontrolledValue:I,mergedValue:k,passwordVisible:ee,mergedPlaceholder:U,showPlaceholder1:q,showPlaceholder2:oe,mergedFocus:Z,isComposing:S,activated:B,showClearButton:Y,mergedSize:C,mergedDisabled:b,textDecorationStyle:$,mergedClsPrefix:e,mergedBordered:t,mergedShowPasswordOn:ie,placeholderStyle:Yo,mergedStatus:v,textAreaScrollContainerWidth:V,handleTextAreaScroll:Dn,handleCompositionStart:sn,handleCompositionEnd:an,handleInput:_t,handleInputBlur:dn,handleInputFocus:cn,handleWrapperBlur:un,handleWrapperFocus:hn,handleMouseEnter:vn,handleMouseLeave:yn,handleMouseDown:mn,handleChange:pn,handleClick:gn,handleClear:fn,handlePasswordToggleClick:bn,handlePasswordToggleMousedown:xn,handleWrapperKeydown:Cn,handleWrapperKeyup:wn,handleTextAreaMirrorResize:Rn,getTextareaScrollContainer:()=>a.value,mergedTheme:r,cssVars:i?void 0:Ko,themeClass:Ye==null?void 0:Ye.themeClass,onRender:Ye==null?void 0:Ye.onRender})},render(){var o,e;const{mergedClsPrefix:t,mergedStatus:i,themeClass:n,type:r,countGraphemes:s,onRender:a}=this,l=this.$slots;return a==null||a(),g("div",{ref:"wrapperElRef",class:[`${t}-input`,n,i&&`${t}-input--${i}-status`,{[`${t}-input--rtl`]:this.rtlEnabled,[`${t}-input--disabled`]:this.mergedDisabled,[`${t}-input--textarea`]:r==="textarea",[`${t}-input--resizable`]:this.resizable&&!this.autosize,[`${t}-input--autosize`]:this.autosize,[`${t}-input--round`]:this.round&&r!=="textarea",[`${t}-input--pair`]:this.pair,[`${t}-input--focus`]:this.mergedFocus,[`${t}-input--stateful`]:this.stateful}],style:this.cssVars,tabindex:!this.mergedDisabled&&this.passivelyActivated&&!this.activated?0:void 0,onFocus:this.handleWrapperFocus,onBlur:this.handleWrapperBlur,onClick:this.handleClick,onMousedown:this.handleMouseDown,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd,onKeyup:this.handleWrapperKeyup,onKeydown:this.handleWrapperKeydown},g("div",{class:`${t}-input-wrapper`},et(l.prefix,d=>d&&g("div",{class:`${t}-input__prefix`},d)),r==="textarea"?g(Wr,{ref:"textareaScrollbarInstRef",class:`${t}-input__textarea`,container:this.getTextareaScrollContainer,triggerDisplayManually:!0,useUnifiedContainer:!0,internalHoistYRail:!0},{default:()=>{var d,c;const{textAreaScrollContainerWidth:h}=this,u={width:this.autosize&&h&&`${h}px`};return g(Ge,null,g("textarea",Object.assign({},this.inputProps,{ref:"textareaElRef",class:[`${t}-input__textarea-el`,(d=this.inputProps)===null||d===void 0?void 0:d.class],autofocus:this.autofocus,rows:Number(this.rows),placeholder:this.placeholder,value:this.mergedValue,disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,readonly:this.readonly,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,style:[this.textDecorationStyle[0],(c=this.inputProps)===null||c===void 0?void 0:c.style,u],onBlur:this.handleInputBlur,onFocus:p=>{this.handleInputFocus(p,2)},onInput:this.handleInput,onChange:this.handleChange,onScroll:this.handleTextAreaScroll})),this.showPlaceholder1?g("div",{class:`${t}-input__placeholder`,style:[this.placeholderStyle,u],key:"placeholder"},this.mergedPlaceholder[0]):null,this.autosize?g(Vr,{onResize:this.handleTextAreaMirrorResize},{default:()=>g("div",{ref:"textareaMirrorElRef",class:`${t}-input__textarea-mirror`,key:"mirror"})}):null)}}):g("div",{class:`${t}-input__input`},g("input",Object.assign({type:r==="password"&&this.mergedShowPasswordOn&&this.passwordVisible?"text":r},this.inputProps,{ref:"inputElRef",class:[`${t}-input__input-el`,(o=this.inputProps)===null||o===void 0?void 0:o.class],style:[this.textDecorationStyle[0],(e=this.inputProps)===null||e===void 0?void 0:e.style],tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[0],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[0]:this.mergedValue,readonly:this.readonly,autofocus:this.autofocus,size:this.attrSize,onBlur:this.handleInputBlur,onFocus:d=>{this.handleInputFocus(d,0)},onInput:d=>{this.handleInput(d,0)},onChange:d=>{this.handleChange(d,0)}})),this.showPlaceholder1?g("div",{class:`${t}-input__placeholder`},g("span",null,this.mergedPlaceholder[0])):null,this.autosize?g("div",{class:`${t}-input__input-mirror`,key:"mirror",ref:"inputMirrorElRef"}," "):null),!this.pair&&et(l.suffix,d=>d||this.clearable||this.showCount||this.mergedShowPasswordOn||this.loading!==void 0?g("div",{class:`${t}-input__suffix`},[et(l["clear-icon-placeholder"],c=>(this.clearable||c)&&g(Qo,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{placeholder:()=>c,icon:()=>{var h,u;return(u=(h=this.$slots)["clear-icon"])===null||u===void 0?void 0:u.call(h)}})),this.internalLoadingBeforeSuffix?null:d,this.loading!==void 0?g(as,{clsPrefix:t,loading:this.loading,showArrow:!1,showClear:!1,style:this.cssVars}):null,this.internalLoadingBeforeSuffix?d:null,this.showCount&&this.type!=="textarea"?g(ei,null,{default:c=>{var h;const{renderCount:u}=this;return u?u(c):(h=l.count)===null||h===void 0?void 0:h.call(l,c)}}):null,this.mergedShowPasswordOn&&this.type==="password"?g("div",{class:`${t}-input__eye`,onMousedown:this.handlePasswordToggleMousedown,onClick:this.handlePasswordToggleClick},this.passwordVisible?bt(l["password-visible-icon"],()=>[g(me,{clsPrefix:t},{default:()=>g(Di,null)})]):bt(l["password-invisible-icon"],()=>[g(me,{clsPrefix:t},{default:()=>g(Es,null)})])):null]):null)),this.pair?g("span",{class:`${t}-input__separator`},bt(l.separator,()=>[this.separator])):null,this.pair?g("div",{class:`${t}-input-wrapper`},g("div",{class:`${t}-input__input`},g("input",{ref:"inputEl2Ref",type:this.type,class:`${t}-input__input-el`,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[1],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[1]:void 0,readonly:this.readonly,style:this.textDecorationStyle[1],onBlur:this.handleInputBlur,onFocus:d=>{this.handleInputFocus(d,1)},onInput:d=>{this.handleInput(d,1)},onChange:d=>{this.handleChange(d,1)}}),this.showPlaceholder2?g("div",{class:`${t}-input__placeholder`},g("span",null,this.mergedPlaceholder[1])):null),et(l.suffix,d=>(this.clearable||d)&&g("div",{class:`${t}-input__suffix`},[this.clearable&&g(Qo,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{icon:()=>{var c;return(c=l["clear-icon"])===null||c===void 0?void 0:c.call(l)},placeholder:()=>{var c;return(c=l["clear-icon-placeholder"])===null||c===void 0?void 0:c.call(l)}}),d]))):null,this.mergedBordered?g("div",{class:`${t}-input__border`}):null,this.mergedBordered?g("div",{class:`${t}-input__state-border`}):null,this.showCount&&r==="textarea"?g(ei,null,{default:d=>{var c;const{renderCount:h}=this;return h?h(d):(c=l.count)===null||c===void 0?void 0:c.call(l,d)}}):null)}}),Ws=$o("n-checkbox-group"),Vs=()=>g("svg",{viewBox:"0 0 64 64",class:"check-icon"},g("path",{d:"M50.42,16.76L22.34,39.45l-8.1-11.46c-1.12-1.58-3.3-1.96-4.88-0.84c-1.58,1.12-1.95,3.3-0.84,4.88l10.26,14.51  c0.56,0.79,1.42,1.31,2.38,1.45c0.16,0.02,0.32,0.03,0.48,0.03c0.8,0,1.57-0.27,2.2-0.78l30.99-25.03c1.5-1.21,1.74-3.42,0.52-4.92  C54.13,15.78,51.93,15.55,50.42,16.76z"})),Gs=()=>g("svg",{viewBox:"0 0 100 100",class:"line-icon"},g("path",{d:"M80.2,55.5H21.4c-2.8,0-5.1-2.5-5.1-5.5l0,0c0-3,2.3-5.5,5.1-5.5h58.7c2.8,0,5.1,2.5,5.1,5.5l0,0C85.2,53.1,82.9,55.5,80.2,55.5z"})),Hs=N([P("checkbox",`
 font-size: var(--n-font-size);
 outline: none;
 cursor: pointer;
 display: inline-flex;
 flex-wrap: nowrap;
 align-items: flex-start;
 word-break: break-word;
 line-height: var(--n-size);
 --n-merged-color-table: var(--n-color-table);
 `,[j("show-label","line-height: var(--n-label-line-height);"),N("&:hover",[P("checkbox-box",[E("border","border: var(--n-border-checked);")])]),N("&:focus:not(:active)",[P("checkbox-box",[E("border",`
 border: var(--n-border-focus);
 box-shadow: var(--n-box-shadow-focus);
 `)])]),j("inside-table",[P("checkbox-box",`
 background-color: var(--n-merged-color-table);
 `)]),j("checked",[P("checkbox-box",`
 background-color: var(--n-color-checked);
 `,[P("checkbox-icon",[N(".check-icon",`
 opacity: 1;
 transform: scale(1);
 `)])])]),j("indeterminate",[P("checkbox-box",[P("checkbox-icon",[N(".check-icon",`
 opacity: 0;
 transform: scale(.5);
 `),N(".line-icon",`
 opacity: 1;
 transform: scale(1);
 `)])])]),j("checked, indeterminate",[N("&:focus:not(:active)",[P("checkbox-box",[E("border",`
 border: var(--n-border-checked);
 box-shadow: var(--n-box-shadow-focus);
 `)])]),P("checkbox-box",`
 background-color: var(--n-color-checked);
 border-left: 0;
 border-top: 0;
 `,[E("border",{border:"var(--n-border-checked)"})])]),j("disabled",{cursor:"not-allowed"},[j("checked",[P("checkbox-box",`
 background-color: var(--n-color-disabled-checked);
 `,[E("border",{border:"var(--n-border-disabled-checked)"}),P("checkbox-icon",[N(".check-icon, .line-icon",{fill:"var(--n-check-mark-color-disabled-checked)"})])])]),P("checkbox-box",`
 background-color: var(--n-color-disabled);
 `,[E("border",`
 border: var(--n-border-disabled);
 `),P("checkbox-icon",[N(".check-icon, .line-icon",`
 fill: var(--n-check-mark-color-disabled);
 `)])]),E("label",`
 color: var(--n-text-color-disabled);
 `)]),P("checkbox-box-wrapper",`
 position: relative;
 width: var(--n-size);
 flex-shrink: 0;
 flex-grow: 0;
 user-select: none;
 -webkit-user-select: none;
 `),P("checkbox-box",`
 position: absolute;
 left: 0;
 top: 50%;
 transform: translateY(-50%);
 height: var(--n-size);
 width: var(--n-size);
 display: inline-block;
 box-sizing: border-box;
 border-radius: var(--n-border-radius);
 background-color: var(--n-color);
 transition: background-color 0.3s var(--n-bezier);
 `,[E("border",`
 transition:
 border-color .3s var(--n-bezier),
 box-shadow .3s var(--n-bezier);
 border-radius: inherit;
 position: absolute;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border: var(--n-border);
 `),P("checkbox-icon",`
 display: flex;
 align-items: center;
 justify-content: center;
 position: absolute;
 left: 1px;
 right: 1px;
 top: 1px;
 bottom: 1px;
 `,[N(".check-icon, .line-icon",`
 width: 100%;
 fill: var(--n-check-mark-color);
 opacity: 0;
 transform: scale(0.5);
 transform-origin: center;
 transition:
 fill 0.3s var(--n-bezier),
 transform 0.3s var(--n-bezier),
 opacity 0.3s var(--n-bezier),
 border-color 0.3s var(--n-bezier);
 `),Mi({left:"1px",top:"1px"})])]),E("label",`
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 user-select: none;
 -webkit-user-select: none;
 padding: var(--n-label-padding);
 font-weight: var(--n-label-font-weight);
 `,[N("&:empty",{display:"none"})])]),Hr(P("checkbox",`
 --n-merged-color-table: var(--n-color-table-modal);
 `)),Xr(P("checkbox",`
 --n-merged-color-table: var(--n-color-table-popover);
 `))]),Xs=Object.assign(Object.assign({},xe.props),{size:String,checked:{type:[Boolean,String,Number],default:void 0},defaultChecked:{type:[Boolean,String,Number],default:!1},value:[String,Number],disabled:{type:Boolean,default:void 0},indeterminate:Boolean,label:String,focusable:{type:Boolean,default:!0},checkedValue:{type:[Boolean,String,Number],default:!0},uncheckedValue:{type:[Boolean,String,Number],default:!1},"onUpdate:checked":[Function,Array],onUpdateChecked:[Function,Array],privateInsideTable:Boolean,onChange:[Function,Array]}),Ys=L({name:"Checkbox",props:Xs,setup(o){const e=ne(Ws,null),t=F(null),{mergedClsPrefixRef:i,inlineThemeDisabled:n,mergedRtlRef:r}=st(o),s=F(o.defaultChecked),a=te(o,"checked"),l=Lo(a,s),d=Ut(()=>{if(e){const v=e.valueSetRef.value;return v&&o.value!==void 0?v.has(o.value):!1}else return l.value===o.checkedValue}),c=No(o,{mergedSize(v){const{size:x}=o;if(x!==void 0)return x;if(e){const{value:D}=e.mergedSizeRef;if(D!==void 0)return D}if(v){const{mergedSize:D}=v;if(D!==void 0)return D.value}return"medium"},mergedDisabled(v){const{disabled:x}=o;if(x!==void 0)return x;if(e){if(e.disabledRef.value)return!0;const{maxRef:{value:D},checkedCountRef:S}=e;if(D!==void 0&&S.value>=D&&!d.value)return!0;const{minRef:{value:B}}=e;if(B!==void 0&&S.value<=B&&d.value)return!0}return v?v.disabled.value:!1}}),{mergedDisabledRef:h,mergedSizeRef:u}=c,p=xe("Checkbox","-checkbox",Hs,Br,o,i);function f(v){if(e&&o.value!==void 0)e.toggleCheckbox(!d.value,o.value);else{const{onChange:x,"onUpdate:checked":D,onUpdateChecked:S}=o,{nTriggerFormInput:B,nTriggerFormChange:A}=c,U=d.value?o.uncheckedValue:o.checkedValue;D&&de(D,U,v),S&&de(S,U,v),x&&de(x,U,v),B(),A(),s.value=U}}function y(v){h.value||f(v)}function I(v){if(!h.value)switch(v.key){case" ":case"Enter":f(v)}}function M(v){switch(v.key){case" ":v.preventDefault()}}const k={focus:()=>{var v;(v=t.value)===null||v===void 0||v.focus()},blur:()=>{var v;(v=t.value)===null||v===void 0||v.blur()}},R=To("Checkbox",r,i),C=z(()=>{const{value:v}=u,{common:{cubicBezierEaseInOut:x},self:{borderRadius:D,color:S,colorChecked:B,colorDisabled:A,colorTableHeader:U,colorTableHeaderModal:q,colorTableHeaderPopover:oe,checkMarkColor:Z,checkMarkColorDisabled:Y,border:ie,borderFocus:ee,borderDisabled:$,borderChecked:V,boxShadowFocus:K,textColor:fe,textColorDisabled:Se,checkMarkColorDisabledChecked:we,colorDisabledChecked:Xe,borderDisabledChecked:qt,labelPadding:Zt,labelLineHeight:Jt,labelFontWeight:Qt,[ce("fontSize",v)]:eo,[ce("size",v)]:to}}=p.value;return{"--n-label-line-height":Jt,"--n-label-font-weight":Qt,"--n-size":to,"--n-bezier":x,"--n-border-radius":D,"--n-border":ie,"--n-border-checked":V,"--n-border-focus":ee,"--n-border-disabled":$,"--n-border-disabled-checked":qt,"--n-box-shadow-focus":K,"--n-color":S,"--n-color-checked":B,"--n-color-table":U,"--n-color-table-modal":q,"--n-color-table-popover":oe,"--n-color-disabled":A,"--n-color-disabled-checked":Xe,"--n-text-color":fe,"--n-text-color-disabled":Se,"--n-check-mark-color":Z,"--n-check-mark-color-disabled":Y,"--n-check-mark-color-disabled-checked":we,"--n-font-size":eo,"--n-label-padding":Zt}}),b=n?at("checkbox",z(()=>u.value[0]),C,o):void 0;return Object.assign(c,k,{rtlEnabled:R,selfRef:t,mergedClsPrefix:i,mergedDisabled:h,renderedChecked:d,mergedTheme:p,labelId:vo(),handleClick:y,handleKeyUp:I,handleKeyDown:M,cssVars:n?void 0:C,themeClass:b==null?void 0:b.themeClass,onRender:b==null?void 0:b.onRender})},render(){var o;const{$slots:e,renderedChecked:t,mergedDisabled:i,indeterminate:n,privateInsideTable:r,cssVars:s,labelId:a,label:l,mergedClsPrefix:d,focusable:c,handleKeyUp:h,handleKeyDown:u,handleClick:p}=this;(o=this.onRender)===null||o===void 0||o.call(this);const f=et(e.default,y=>l||y?g("span",{class:`${d}-checkbox__label`,id:a},l||y):null);return g("div",{ref:"selfRef",class:[`${d}-checkbox`,this.themeClass,this.rtlEnabled&&`${d}-checkbox--rtl`,t&&`${d}-checkbox--checked`,i&&`${d}-checkbox--disabled`,n&&`${d}-checkbox--indeterminate`,r&&`${d}-checkbox--inside-table`,f&&`${d}-checkbox--show-label`],tabindex:i||!c?void 0:0,role:"checkbox","aria-checked":n?"mixed":t,"aria-labelledby":a,style:s,onKeyup:h,onKeydown:u,onClick:p,onMousedown:()=>{mo("selectstart",window,y=>{y.preventDefault()},{once:!0})}},g("div",{class:`${d}-checkbox-box-wrapper`}," ",g("div",{class:`${d}-checkbox-box`},g(_i,null,{default:()=>this.indeterminate?g("div",{key:"indeterminate",class:`${d}-checkbox-icon`},Gs()):g("div",{key:"check",class:`${d}-checkbox-icon`},Vs())}),g("div",{class:`${d}-checkbox-box__border`}))),f)}});function Ks(){const o=ne(zr,null);return o===null&&lt("use-dialog","No outer <n-dialog-provider /> founded."),o}function Fi(){const o=ne(Or,null);return o===null&&lt("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),o}const qs={success:g(Oo,null),error:g(Fo,null),warning:g(Bo,null),info:g(zo,null)},Zs=L({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(o,{slots:e}){function t(n,r,s,a){const{gapDegree:l,viewBoxWidth:d,strokeWidth:c}=o,h=50,u=0,p=h,f=0,y=2*h,I=50+c/2,M=`M ${I},${I} m ${u},${p}
      a ${h},${h} 0 1 1 ${f},${-y}
      a ${h},${h} 0 1 1 ${-f},${y}`,k=Math.PI*2*h,R={stroke:a==="rail"?s:typeof o.fillColor=="object"?"url(#gradient)":s,strokeDasharray:`${n/100*(k-l)}px ${d*8}px`,strokeDashoffset:`-${l/2}px`,transformOrigin:r?"center":void 0,transform:r?`rotate(${r}deg)`:void 0};return{pathString:M,pathStyle:R}}const i=()=>{const n=typeof o.fillColor=="object",r=n?o.fillColor.stops[0]:"",s=n?o.fillColor.stops[1]:"";return n&&g("defs",null,g("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},g("stop",{offset:"0%","stop-color":r}),g("stop",{offset:"100%","stop-color":s})))};return()=>{const{fillColor:n,railColor:r,strokeWidth:s,offsetDegree:a,status:l,percentage:d,showIndicator:c,indicatorTextColor:h,unit:u,gapOffsetDegree:p,clsPrefix:f}=o,{pathString:y,pathStyle:I}=t(100,0,r,"rail"),{pathString:M,pathStyle:k}=t(d,a,n,"fill"),R=100+s;return g("div",{class:`${f}-progress-content`,role:"none"},g("div",{class:`${f}-progress-graph`,"aria-hidden":!0},g("div",{class:`${f}-progress-graph-circle`,style:{transform:p?`rotate(${p}deg)`:void 0}},g("svg",{viewBox:`0 0 ${R} ${R}`},i(),g("g",null,g("path",{class:`${f}-progress-graph-circle-rail`,d:y,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:I})),g("g",null,g("path",{class:[`${f}-progress-graph-circle-fill`,d===0&&`${f}-progress-graph-circle-fill--empty`],d:M,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:k}))))),c?g("div",null,e.default?g("div",{class:`${f}-progress-custom-content`,role:"none"},e.default()):l!=="default"?g("div",{class:`${f}-progress-icon`,"aria-hidden":!0},g(me,{clsPrefix:f},{default:()=>qs[l]})):g("div",{class:`${f}-progress-text`,style:{color:h},role:"none"},g("span",{class:`${f}-progress-text__percentage`},d),g("span",{class:`${f}-progress-text__unit`},u))):null)}}}),Js={success:g(Oo,null),error:g(Fo,null),warning:g(Bo,null),info:g(zo,null)},Qs=L({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(o,{slots:e}){const t=z(()=>qe(o.height)),i=z(()=>{var s,a;return typeof o.fillColor=="object"?`linear-gradient(to right, ${(s=o.fillColor)===null||s===void 0?void 0:s.stops[0]} , ${(a=o.fillColor)===null||a===void 0?void 0:a.stops[1]})`:o.fillColor}),n=z(()=>o.railBorderRadius!==void 0?qe(o.railBorderRadius):o.height!==void 0?qe(o.height,{c:.5}):""),r=z(()=>o.fillBorderRadius!==void 0?qe(o.fillBorderRadius):o.railBorderRadius!==void 0?qe(o.railBorderRadius):o.height!==void 0?qe(o.height,{c:.5}):"");return()=>{const{indicatorPlacement:s,railColor:a,railStyle:l,percentage:d,unit:c,indicatorTextColor:h,status:u,showIndicator:p,processing:f,clsPrefix:y}=o;return g("div",{class:`${y}-progress-content`,role:"none"},g("div",{class:`${y}-progress-graph`,"aria-hidden":!0},g("div",{class:[`${y}-progress-graph-line`,{[`${y}-progress-graph-line--indicator-${s}`]:!0}]},g("div",{class:`${y}-progress-graph-line-rail`,style:[{backgroundColor:a,height:t.value,borderRadius:n.value},l]},g("div",{class:[`${y}-progress-graph-line-fill`,f&&`${y}-progress-graph-line-fill--processing`],style:{maxWidth:`${o.percentage}%`,background:i.value,height:t.value,lineHeight:t.value,borderRadius:r.value}},s==="inside"?g("div",{class:`${y}-progress-graph-line-indicator`,style:{color:h}},e.default?e.default():`${d}${c}`):null)))),p&&s==="outside"?g("div",null,e.default?g("div",{class:`${y}-progress-custom-content`,style:{color:h},role:"none"},e.default()):u==="default"?g("div",{role:"none",class:`${y}-progress-icon ${y}-progress-icon--as-text`,style:{color:h}},d,c):g("div",{class:`${y}-progress-icon`,"aria-hidden":!0},g(me,{clsPrefix:y},{default:()=>Js[u]}))):null)}}});function ti(o,e,t=100){return`m ${t/2} ${t/2-o} a ${o} ${o} 0 1 1 0 ${2*o} a ${o} ${o} 0 1 1 0 -${2*o}`}const ea=L({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(o,{slots:e}){const t=z(()=>o.percentage.map((r,s)=>`${Math.PI*r/100*(o.viewBoxWidth/2-o.strokeWidth/2*(1+2*s)-o.circleGap*s)*2}, ${o.viewBoxWidth*8}`)),i=(n,r)=>{const s=o.fillColor[r],a=typeof s=="object"?s.stops[0]:"",l=typeof s=="object"?s.stops[1]:"";return typeof o.fillColor[r]=="object"&&g("linearGradient",{id:`gradient-${r}`,x1:"100%",y1:"0%",x2:"0%",y2:"100%"},g("stop",{offset:"0%","stop-color":a}),g("stop",{offset:"100%","stop-color":l}))};return()=>{const{viewBoxWidth:n,strokeWidth:r,circleGap:s,showIndicator:a,fillColor:l,railColor:d,railStyle:c,percentage:h,clsPrefix:u}=o;return g("div",{class:`${u}-progress-content`,role:"none"},g("div",{class:`${u}-progress-graph`,"aria-hidden":!0},g("div",{class:`${u}-progress-graph-circle`},g("svg",{viewBox:`0 0 ${n} ${n}`},g("defs",null,h.map((p,f)=>i(p,f))),h.map((p,f)=>g("g",{key:f},g("path",{class:`${u}-progress-graph-circle-rail`,d:ti(n/2-r/2*(1+2*f)-s*f,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:d[f]},c[f]]}),g("path",{class:[`${u}-progress-graph-circle-fill`,p===0&&`${u}-progress-graph-circle-fill--empty`],d:ti(n/2-r/2*(1+2*f)-s*f,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:t.value[f],strokeDashoffset:0,stroke:typeof l[f]=="object"?`url(#gradient-${f})`:l[f]}})))))),a&&e.default?g("div",null,g("div",{class:`${u}-progress-text`},e.default())):null)}}}),ta=N([P("progress",{display:"inline-block"},[P("progress-icon",`
 color: var(--n-icon-color);
 transition: color .3s var(--n-bezier);
 `),j("line",`
 width: 100%;
 display: block;
 `,[P("progress-content",`
 display: flex;
 align-items: center;
 `,[P("progress-graph",{flex:1})]),P("progress-custom-content",{marginLeft:"14px"}),P("progress-icon",`
 width: 30px;
 padding-left: 14px;
 height: var(--n-icon-size-line);
 line-height: var(--n-icon-size-line);
 font-size: var(--n-icon-size-line);
 `,[j("as-text",`
 color: var(--n-text-color-line-outer);
 text-align: center;
 width: 40px;
 font-size: var(--n-font-size);
 padding-left: 4px;
 transition: color .3s var(--n-bezier);
 `)])]),j("circle, dashboard",{width:"120px"},[P("progress-custom-content",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 `),P("progress-text",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: inherit;
 font-size: var(--n-font-size-circle);
 color: var(--n-text-color-circle);
 font-weight: var(--n-font-weight-circle);
 transition: color .3s var(--n-bezier);
 white-space: nowrap;
 `),P("progress-icon",`
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 color: var(--n-icon-color);
 font-size: var(--n-icon-size-circle);
 `)]),j("multiple-circle",`
 width: 200px;
 color: inherit;
 `,[P("progress-text",`
 font-weight: var(--n-font-weight-circle);
 color: var(--n-text-color-circle);
 position: absolute;
 left: 50%;
 top: 50%;
 transform: translateX(-50%) translateY(-50%);
 display: flex;
 align-items: center;
 justify-content: center;
 transition: color .3s var(--n-bezier);
 `)]),P("progress-content",{position:"relative"}),P("progress-graph",{position:"relative"},[P("progress-graph-circle",[N("svg",{verticalAlign:"bottom"}),P("progress-graph-circle-fill",`
 stroke: var(--n-fill-color);
 transition:
 opacity .3s var(--n-bezier),
 stroke .3s var(--n-bezier),
 stroke-dasharray .3s var(--n-bezier);
 `,[j("empty",{opacity:0})]),P("progress-graph-circle-rail",`
 transition: stroke .3s var(--n-bezier);
 overflow: hidden;
 stroke: var(--n-rail-color);
 `)]),P("progress-graph-line",[j("indicator-inside",[P("progress-graph-line-rail",`
 height: 16px;
 line-height: 16px;
 border-radius: 10px;
 `,[P("progress-graph-line-fill",`
 height: inherit;
 border-radius: 10px;
 `),P("progress-graph-line-indicator",`
 background: #0000;
 white-space: nowrap;
 text-align: right;
 margin-left: 14px;
 margin-right: 14px;
 height: inherit;
 font-size: 12px;
 color: var(--n-text-color-line-inner);
 transition: color .3s var(--n-bezier);
 `)])]),j("indicator-inside-label",`
 height: 16px;
 display: flex;
 align-items: center;
 `,[P("progress-graph-line-rail",`
 flex: 1;
 transition: background-color .3s var(--n-bezier);
 `),P("progress-graph-line-indicator",`
 background: var(--n-fill-color);
 font-size: 12px;
 transform: translateZ(0);
 display: flex;
 vertical-align: middle;
 height: 16px;
 line-height: 16px;
 padding: 0 10px;
 border-radius: 10px;
 position: absolute;
 white-space: nowrap;
 color: var(--n-text-color-line-inner);
 transition:
 right .2s var(--n-bezier),
 color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 `)]),P("progress-graph-line-rail",`
 position: relative;
 overflow: hidden;
 height: var(--n-rail-height);
 border-radius: 5px;
 background-color: var(--n-rail-color);
 transition: background-color .3s var(--n-bezier);
 `,[P("progress-graph-line-fill",`
 background: var(--n-fill-color);
 position: relative;
 border-radius: 5px;
 height: inherit;
 width: 100%;
 max-width: 0%;
 transition:
 background-color .3s var(--n-bezier),
 max-width .2s var(--n-bezier);
 `,[j("processing",[N("&::after",`
 content: "";
 background-image: var(--n-line-bg-processing);
 animation: progress-processing-animation 2s var(--n-bezier) infinite;
 `)])])])])])]),N("@keyframes progress-processing-animation",`
 0% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 100%;
 opacity: 1;
 }
 66% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 100% {
 position: absolute;
 left: 0;
 top: 0;
 bottom: 0;
 right: 0;
 opacity: 0;
 }
 `)]),oa=Object.assign(Object.assign({},xe.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),ia=L({name:"Progress",props:oa,setup(o){const e=z(()=>o.indicatorPlacement||o.indicatorPosition),t=z(()=>{if(o.gapDegree||o.gapDegree===0)return o.gapDegree;if(o.type==="dashboard")return 75}),{mergedClsPrefixRef:i,inlineThemeDisabled:n}=st(o),r=xe("Progress","-progress",ta,Tr,o,i),s=z(()=>{const{status:l}=o,{common:{cubicBezierEaseInOut:d},self:{fontSize:c,fontSizeCircle:h,railColor:u,railHeight:p,iconSizeCircle:f,iconSizeLine:y,textColorCircle:I,textColorLineInner:M,textColorLineOuter:k,lineBgProcessing:R,fontWeightCircle:C,[ce("iconColor",l)]:b,[ce("fillColor",l)]:v}}=r.value;return{"--n-bezier":d,"--n-fill-color":v,"--n-font-size":c,"--n-font-size-circle":h,"--n-font-weight-circle":C,"--n-icon-color":b,"--n-icon-size-circle":f,"--n-icon-size-line":y,"--n-line-bg-processing":R,"--n-rail-color":u,"--n-rail-height":p,"--n-text-color-circle":I,"--n-text-color-line-inner":M,"--n-text-color-line-outer":k}}),a=n?at("progress",z(()=>o.status[0]),s,o):void 0;return{mergedClsPrefix:i,mergedIndicatorPlacement:e,gapDeg:t,cssVars:n?void 0:s,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender}},render(){const{type:o,cssVars:e,indicatorTextColor:t,showIndicator:i,status:n,railColor:r,railStyle:s,color:a,percentage:l,viewBoxWidth:d,strokeWidth:c,mergedIndicatorPlacement:h,unit:u,borderRadius:p,fillBorderRadius:f,height:y,processing:I,circleGap:M,mergedClsPrefix:k,gapDeg:R,gapOffsetDegree:C,themeClass:b,$slots:v,onRender:x}=this;return x==null||x(),g("div",{class:[b,`${k}-progress`,`${k}-progress--${o}`,`${k}-progress--${n}`],style:e,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":l,role:o==="circle"||o==="line"||o==="dashboard"?"progressbar":"none"},o==="circle"||o==="dashboard"?g(Zs,{clsPrefix:k,status:n,showIndicator:i,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,offsetDegree:this.offsetDegree,percentage:l,viewBoxWidth:d,strokeWidth:c,gapDegree:R===void 0?o==="dashboard"?75:0:R,gapOffsetDegree:C,unit:u},v):o==="line"?g(Qs,{clsPrefix:k,status:n,showIndicator:i,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,percentage:l,processing:I,indicatorPlacement:h,unit:u,fillBorderRadius:f,railBorderRadius:p,height:y},v):o==="multiple-circle"?g(ea,{clsPrefix:k,strokeWidth:c,railColor:r,fillColor:a,railStyle:s,viewBoxWidth:d,percentage:l,showIndicator:i,circleGap:M},v):null)}}),na=N([N("@keyframes spin-rotate",`
 from {
 transform: rotate(0);
 }
 to {
 transform: rotate(360deg);
 }
 `),P("spin-container",`
 position: relative;
 `,[P("spin-body",`
 position: absolute;
 top: 50%;
 left: 50%;
 transform: translateX(-50%) translateY(-50%);
 `,[Yr()])]),P("spin-body",`
 display: inline-flex;
 align-items: center;
 justify-content: center;
 flex-direction: column;
 `),P("spin",`
 display: inline-flex;
 height: var(--n-size);
 width: var(--n-size);
 font-size: var(--n-size);
 color: var(--n-color);
 `,[j("rotate",`
 animation: spin-rotate 2s linear infinite;
 `)]),P("spin-description",`
 display: inline-block;
 font-size: var(--n-font-size);
 color: var(--n-text-color);
 transition: color .3s var(--n-bezier);
 margin-top: 8px;
 `),P("spin-content",`
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 pointer-events: all;
 `,[j("spinning",`
 user-select: none;
 -webkit-user-select: none;
 pointer-events: none;
 opacity: var(--n-opacity-spinning);
 `)])]),ra={small:20,medium:18,large:16},sa=Object.assign(Object.assign({},xe.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),aa=L({name:"Spin",props:sa,slots:Object,setup(o){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=st(o),i=xe("Spin","-spin",na,$r,o,e),n=z(()=>{const{size:l}=o,{common:{cubicBezierEaseInOut:d},self:c}=i.value,{opacitySpinning:h,color:u,textColor:p}=c,f=typeof l=="number"?Kr(l):c[ce("size",l)];return{"--n-bezier":d,"--n-opacity-spinning":h,"--n-size":f,"--n-color":u,"--n-text-color":p}}),r=t?at("spin",z(()=>{const{size:l}=o;return typeof l=="number"?String(l):l[0]}),n,o):void 0,s=qr(o,["spinning","show"]),a=F(!1);return Nt(l=>{let d;if(s.value){const{delay:c}=o;if(c){d=window.setTimeout(()=>{a.value=!0},c),l(()=>{clearTimeout(d)});return}}a.value=s.value}),{mergedClsPrefix:e,active:a,mergedStrokeWidth:z(()=>{const{strokeWidth:l}=o;if(l!==void 0)return l;const{size:d}=o;return ra[typeof d=="number"?"medium":d]}),cssVars:t?void 0:n,themeClass:r==null?void 0:r.themeClass,onRender:r==null?void 0:r.onRender}},render(){var o,e;const{$slots:t,mergedClsPrefix:i,description:n}=this,r=t.icon&&this.rotate,s=(n||t.description)&&g("div",{class:`${i}-spin-description`},n||((o=t.description)===null||o===void 0?void 0:o.call(t))),a=t.icon?g("div",{class:[`${i}-spin-body`,this.themeClass]},g("div",{class:[`${i}-spin`,r&&`${i}-spin--rotate`],style:t.default?"":this.cssVars},t.icon()),s):g("div",{class:[`${i}-spin-body`,this.themeClass]},g(ts,{clsPrefix:i,style:t.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:`${i}-spin`}),s);return(e=this.onRender)===null||e===void 0||e.call(this),t.default?g("div",{class:[`${i}-spin-container`,this.themeClass],style:this.cssVars},g("div",{class:[`${i}-spin-content`,this.active&&`${i}-spin-content--spinning`,this.contentClass],style:this.contentStyle},t),g(Do,{name:"fade-in-transition"},{default:()=>this.active?a:null})):a}}),dt=$o("n-upload"),la=N([P("upload","width: 100%;",[j("dragger-inside",[P("upload-trigger",`
 display: block;
 `)]),j("drag-over",[P("upload-dragger",`
 border: var(--n-dragger-border-hover);
 `)])]),P("upload-dragger",`
 cursor: pointer;
 box-sizing: border-box;
 width: 100%;
 text-align: center;
 border-radius: var(--n-border-radius);
 padding: 24px;
 opacity: 1;
 transition:
 opacity .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 background-color .3s var(--n-bezier);
 background-color: var(--n-dragger-color);
 border: var(--n-dragger-border);
 `,[N("&:hover",`
 border: var(--n-dragger-border-hover);
 `),j("disabled",`
 cursor: not-allowed;
 `)]),P("upload-trigger",`
 display: inline-block;
 box-sizing: border-box;
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[N("+",[P("upload-file-list","margin-top: 8px;")]),j("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `),j("image-card",`
 width: 96px;
 height: 96px;
 `,[P("base-icon",`
 font-size: 24px;
 `),P("upload-dragger",`
 padding: 0;
 height: 100%;
 width: 100%;
 display: flex;
 align-items: center;
 justify-content: center;
 `)])]),P("upload-file-list",`
 line-height: var(--n-line-height);
 opacity: 1;
 transition: opacity .3s var(--n-bezier);
 `,[N("a, img","outline: none;"),j("disabled",`
 opacity: var(--n-item-disabled-opacity);
 cursor: not-allowed;
 `,[P("upload-file","cursor: not-allowed;")]),j("grid",`
 display: grid;
 grid-template-columns: repeat(auto-fill, 96px);
 grid-gap: 8px;
 margin-top: 0;
 `),P("upload-file",`
 display: block;
 box-sizing: border-box;
 cursor: default;
 padding: 0px 12px 0 6px;
 transition: background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 `,[yo(),P("progress",[yo({foldPadding:!0})]),N("&:hover",`
 background-color: var(--n-item-color-hover);
 `,[P("upload-file-info",[E("action",`
 opacity: 1;
 `)])]),j("image-type",`
 border-radius: var(--n-border-radius);
 text-decoration: underline;
 text-decoration-color: #0000;
 `,[P("upload-file-info",`
 padding-top: 0px;
 padding-bottom: 0px;
 width: 100%;
 height: 100%;
 display: flex;
 justify-content: space-between;
 align-items: center;
 padding: 6px 0;
 `,[P("progress",`
 padding: 2px 0;
 margin-bottom: 0;
 `),E("name",`
 padding: 0 8px;
 `),E("thumbnail",`
 width: 32px;
 height: 32px;
 font-size: 28px;
 display: flex;
 justify-content: center;
 align-items: center;
 `,[N("img",`
 width: 100%;
 `)])])]),j("text-type",[P("progress",`
 box-sizing: border-box;
 padding-bottom: 6px;
 margin-bottom: 6px;
 `)]),j("image-card-type",`
 position: relative;
 width: 96px;
 height: 96px;
 border: var(--n-item-border-image-card);
 border-radius: var(--n-border-radius);
 padding: 0;
 display: flex;
 align-items: center;
 justify-content: center;
 transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);
 border-radius: var(--n-border-radius);
 overflow: hidden;
 `,[P("progress",`
 position: absolute;
 left: 8px;
 bottom: 8px;
 right: 8px;
 width: unset;
 `),P("upload-file-info",`
 padding: 0;
 width: 100%;
 height: 100%;
 `,[E("thumbnail",`
 width: 100%;
 height: 100%;
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 font-size: 36px;
 `,[N("img",`
 width: 100%;
 `)])]),N("&::before",`
 position: absolute;
 z-index: 1;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 border-radius: inherit;
 opacity: 0;
 transition: opacity .2s var(--n-bezier);
 content: "";
 `),N("&:hover",[N("&::before","opacity: 1;"),P("upload-file-info",[E("thumbnail","opacity: .12;")])])]),j("error-status",[N("&:hover",`
 background-color: var(--n-item-color-hover-error);
 `),P("upload-file-info",[E("name","color: var(--n-item-text-color-error);"),E("thumbnail","color: var(--n-item-text-color-error);")]),j("image-card-type",`
 border: var(--n-item-border-image-card-error);
 `)]),j("with-url",`
 cursor: pointer;
 `,[P("upload-file-info",[E("name",`
 color: var(--n-item-text-color-success);
 text-decoration-color: var(--n-item-text-color-success);
 `,[N("a",`
 text-decoration: underline;
 `)])])]),P("upload-file-info",`
 position: relative;
 padding-top: 6px;
 padding-bottom: 6px;
 display: flex;
 flex-wrap: nowrap;
 `,[E("thumbnail",`
 font-size: 18px;
 opacity: 1;
 transition: opacity .2s var(--n-bezier);
 color: var(--n-item-icon-color);
 `,[P("base-icon",`
 margin-right: 2px;
 vertical-align: middle;
 transition: color .3s var(--n-bezier);
 `)]),E("action",`
 padding-top: inherit;
 padding-bottom: inherit;
 position: absolute;
 right: 0;
 top: 0;
 bottom: 0;
 width: 80px;
 display: flex;
 align-items: center;
 transition: opacity .2s var(--n-bezier);
 justify-content: flex-end;
 opacity: 0;
 `,[P("button",[N("&:not(:last-child)",{marginRight:"4px"}),P("base-icon",[N("svg",[Mi()])])]),j("image-type",`
 position: relative;
 max-width: 80px;
 width: auto;
 `),j("image-card-type",`
 z-index: 2;
 position: absolute;
 width: 100%;
 height: 100%;
 left: 0;
 right: 0;
 bottom: 0;
 top: 0;
 display: flex;
 justify-content: center;
 align-items: center;
 `)]),E("name",`
 color: var(--n-item-text-color);
 flex: 1;
 display: flex;
 justify-content: center;
 text-overflow: ellipsis;
 overflow: hidden;
 flex-direction: column;
 text-decoration-color: #0000;
 font-size: var(--n-font-size);
 transition:
 color .3s var(--n-bezier),
 text-decoration-color .3s var(--n-bezier); 
 `,[N("a",`
 color: inherit;
 text-decoration: underline;
 `)])])])]),P("upload-file-input",`
 display: none;
 width: 0;
 height: 0;
 opacity: 0;
 `)]),Bi="__UPLOAD_DRAGGER__",zi=L({name:"UploadDragger",[Bi]:!0,setup(o,{slots:e}){const t=ne(dt,null);return t||lt("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:i},mergedDisabledRef:{value:n},maxReachedRef:{value:r}}=t;return g("div",{class:[`${i}-upload-dragger`,(n||r)&&`${i}-upload-dragger--disabled`]},e)}}}),da=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),ca=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),ua=L({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:ne(dt).mergedThemeRef}},render(){return g(jo,null,{default:()=>this.show?g(ia,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null})}});var xo=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(i.next(c))}catch(h){s(h)}}function l(c){try{d(i.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((i=i.apply(o,e||[])).next())})};function Oi(o){return o.includes("image/")}function oi(o=""){const e=o.split("/"),i=e[e.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(i)||[""])[0]}const ii=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,Ti=o=>{if(o.type)return Oi(o.type);const e=oi(o.name||"");if(ii.test(e))return!0;const t=o.thumbnailUrl||o.url||"",i=oi(t);return!!(/^data:image\//.test(t)||ii.test(i))};function ha(o){return xo(this,void 0,void 0,function*(){return yield new Promise(e=>{if(!o.type||!Oi(o.type)){e("");return}e(window.URL.createObjectURL(o))})})}const pa=es&&window.FileReader&&window.File;function ga(o){return o.isDirectory}function fa(o){return o.isFile}function ma(o,e){return xo(this,void 0,void 0,function*(){const t=[];function i(n){return xo(this,void 0,void 0,function*(){for(const r of n)if(r){if(e&&ga(r)){const s=r.createReader();let a=[],l;try{do l=yield new Promise((d,c)=>{s.readEntries(d,c)}),a=a.concat(l);while(l.length>0)}catch(d){Jo("upload","error happens when handling directory upload",d)}yield i(a)}else if(fa(r))try{const s=yield new Promise((a,l)=>{r.file(a,l)});t.push({file:s,entry:r,source:"dnd"})}catch(s){Jo("upload","error happens when handling file upload",s)}}})}return yield i(o),t})}function Pt(o){const{id:e,name:t,percentage:i,status:n,url:r,file:s,thumbnailUrl:a,type:l,fullPath:d,batchId:c}=o;return{id:e,name:t,percentage:i??null,status:n,url:r??null,file:s??null,thumbnailUrl:a??null,type:l??null,fullPath:d??null,batchId:c??null}}function va(o,e,t){return o=o.toLowerCase(),e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase(),t.split(",").map(n=>n.trim()).filter(Boolean).some(n=>{if(n.startsWith(".")){if(o.endsWith(n))return!0}else if(n.includes("/")){const[r,s]=e.split("/"),[a,l]=n.split("/");if((a==="*"||r&&a&&a===r)&&(l==="*"||s&&l&&l===s))return!0}else return!0;return!1})}var ni=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(i.next(c))}catch(h){s(h)}}function l(c){try{d(i.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((i=i.apply(o,e||[])).next())})};const Bt={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},ya=L({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup(o){const e=ne(dt),t=F(null),i=F(""),n=z(()=>{const{file:b}=o;return b.status==="finished"?"success":b.status==="error"?"error":"info"}),r=z(()=>{const{file:b}=o;if(b.status==="error")return"error"}),s=z(()=>{const{file:b}=o;return b.status==="uploading"}),a=z(()=>{if(!e.showCancelButtonRef.value)return!1;const{file:b}=o;return["uploading","pending","error"].includes(b.status)}),l=z(()=>{if(!e.showRemoveButtonRef.value)return!1;const{file:b}=o;return["finished"].includes(b.status)}),d=z(()=>{if(!e.showDownloadButtonRef.value)return!1;const{file:b}=o;return["finished"].includes(b.status)}),c=z(()=>{if(!e.showRetryButtonRef.value)return!1;const{file:b}=o;return["error"].includes(b.status)}),h=Ut(()=>i.value||o.file.thumbnailUrl||o.file.url),u=z(()=>{if(!e.showPreviewButtonRef.value)return!1;const{file:{status:b},listType:v}=o;return["finished"].includes(b)&&h.value&&v==="image-card"});function p(){return ni(this,void 0,void 0,function*(){const b=e.onRetryRef.value;b&&(yield b({file:o.file}))===!1||e.submit(o.file.id)})}function f(b){b.preventDefault();const{file:v}=o;["finished","pending","error"].includes(v.status)?I(v):["uploading"].includes(v.status)?k(v):Zr("upload","The button clicked type is unknown.")}function y(b){b.preventDefault(),M(o.file)}function I(b){const{xhrMap:v,doChange:x,onRemoveRef:{value:D},mergedFileListRef:{value:S}}=e;Promise.resolve(D?D({file:Object.assign({},b),fileList:S,index:o.index}):!0).then(B=>{if(B===!1)return;const A=Object.assign({},b,{status:"removed"});v.delete(b.id),x(A,void 0,{remove:!0})})}function M(b){const{onDownloadRef:{value:v},customDownloadRef:{value:x}}=e;Promise.resolve(v?v(Object.assign({},b)):!0).then(D=>{D!==!1&&(x?x(Object.assign({},b)):ns(b.url,b.name))})}function k(b){const{xhrMap:v}=e,x=v.get(b.id);x==null||x.abort(),I(Object.assign({},b))}function R(b){const{onPreviewRef:{value:v}}=e;if(v)v(o.file,{event:b});else if(o.listType==="image-card"){const{value:x}=t;if(!x)return;x.click()}}const C=()=>ni(this,void 0,void 0,function*(){const{listType:b}=o;b!=="image"&&b!=="image-card"||e.shouldUseThumbnailUrlRef.value(o.file)&&(i.value=yield e.getFileThumbnailUrlResolver(o.file))});return Nt(()=>{C()}),{mergedTheme:e.mergedThemeRef,progressStatus:n,buttonType:r,showProgress:s,disabled:e.mergedDisabledRef,showCancelButton:a,showRemoveButton:l,showDownloadButton:d,showRetryButton:c,showPreviewButton:u,mergedThumbnailUrl:h,shouldUseThumbnailUrl:e.shouldUseThumbnailUrlRef,renderIcon:e.renderIconRef,imageRef:t,handleRemoveOrCancelClick:f,handleDownloadClick:y,handleRetryClick:p,handlePreviewClick:R}},render(){const{clsPrefix:o,mergedTheme:e,listType:t,file:i,renderIcon:n}=this;let r;const s=t==="image";s||t==="image-card"?r=!this.shouldUseThumbnailUrl(i)||!this.mergedThumbnailUrl?g("span",{class:`${o}-upload-file-info__thumbnail`},n?n(i):Ti(i)?g(me,{clsPrefix:o},{default:da}):g(me,{clsPrefix:o},{default:ca})):g("a",{rel:"noopener noreferer",target:"_blank",href:i.url||void 0,class:`${o}-upload-file-info__thumbnail`,onClick:this.handlePreviewClick},t==="image-card"?g(os,{src:this.mergedThumbnailUrl||void 0,previewSrc:i.url||void 0,alt:i.name,ref:"imageRef"}):g("img",{src:this.mergedThumbnailUrl||void 0,alt:i.name})):r=g("span",{class:`${o}-upload-file-info__thumbnail`},n?n(i):g(me,{clsPrefix:o},{default:()=>g(Rs,null)}));const l=g(ua,{show:this.showProgress,percentage:i.percentage||0,status:this.progressStatus}),d=t==="text"||t==="image";return g("div",{class:[`${o}-upload-file`,`${o}-upload-file--${this.progressStatus}-status`,i.url&&i.status!=="error"&&t!=="image-card"&&`${o}-upload-file--with-url`,`${o}-upload-file--${t}-type`]},g("div",{class:`${o}-upload-file-info`},r,g("div",{class:`${o}-upload-file-info__name`},d&&(i.url&&i.status!=="error"?g("a",{rel:"noopener noreferer",target:"_blank",href:i.url||void 0,onClick:this.handlePreviewClick},i.name):g("span",{onClick:this.handlePreviewClick},i.name)),s&&l),g("div",{class:[`${o}-upload-file-info__action`,`${o}-upload-file-info__action--${t}-type`]},this.showPreviewButton?g(Ve,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Bt},{icon:()=>g(me,{clsPrefix:o},{default:()=>g(Di,null)})}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&g(Ve,{key:"cancelOrTrash",theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:Bt,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:()=>g(_i,null,{default:()=>this.showRemoveButton?g(me,{clsPrefix:o,key:"trash"},{default:()=>g(Bs,null)}):g(me,{clsPrefix:o,key:"cancel"},{default:()=>g(Ds,null)})})}),this.showRetryButton&&!this.disabled&&g(Ve,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Bt},{icon:()=>g(me,{clsPrefix:o},{default:()=>g(Fs,null)})}),this.showDownloadButton?g(Ve,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Bt},{icon:()=>g(me,{clsPrefix:o},{default:()=>g(is,null)})}):null)),!s&&l)}}),$i=L({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup(o,{slots:e}){const t=ne(dt,null);t||lt("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef:i,mergedDisabledRef:n,maxReachedRef:r,listTypeRef:s,dragOverRef:a,openOpenFileDialog:l,draggerInsideRef:d,handleFileAddition:c,mergedDirectoryDndRef:h,triggerClassRef:u,triggerStyleRef:p}=t,f=z(()=>s.value==="image-card");function y(){n.value||r.value||l()}function I(C){C.preventDefault(),a.value=!0}function M(C){C.preventDefault(),a.value=!0}function k(C){C.preventDefault(),a.value=!1}function R(C){var b;if(C.preventDefault(),!d.value||n.value||r.value){a.value=!1;return}const v=(b=C.dataTransfer)===null||b===void 0?void 0:b.items;v!=null&&v.length?ma(Array.from(v).map(x=>x.webkitGetAsEntry()),h.value).then(x=>{c(x)}).finally(()=>{a.value=!1}):a.value=!1}return()=>{var C;const{value:b}=i;return o.abstract?(C=e.default)===null||C===void 0?void 0:C.call(e,{handleClick:y,handleDrop:R,handleDragOver:I,handleDragEnter:M,handleDragLeave:k}):g("div",{class:[`${b}-upload-trigger`,(n.value||r.value)&&`${b}-upload-trigger--disabled`,f.value&&`${b}-upload-trigger--image-card`,u.value],style:p.value,onClick:y,onDrop:R,onDragover:I,onDragenter:M,onDragleave:k},f.value?g(zi,null,{default:()=>bt(e.default,()=>[g(me,{clsPrefix:b},{default:()=>g(_s,null)})])}):e)}}}),ba=L({name:"UploadFileList",setup(o,{slots:e}){const t=ne(dt,null);t||lt("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef:i,mergedClsPrefixRef:n,listTypeRef:r,mergedFileListRef:s,fileListClassRef:a,fileListStyleRef:l,cssVarsRef:d,themeClassRef:c,maxReachedRef:h,showTriggerRef:u,imageGroupPropsRef:p}=t,f=z(()=>r.value==="image-card"),y=()=>s.value.map((M,k)=>g(ya,{clsPrefix:n.value,key:M.id,file:M,index:k,listType:r.value})),I=()=>f.value?g(rs,Object.assign({},p.value),{default:y}):g(jo,{group:!0},{default:y});return()=>{const{value:M}=n,{value:k}=i;return g("div",{class:[`${M}-upload-file-list`,f.value&&`${M}-upload-file-list--grid`,k?c==null?void 0:c.value:void 0,a.value],style:[k&&d?d.value:"",l.value]},I(),u.value&&!h.value&&f.value&&g($i,null,e))}}});var ri=function(o,e,t,i){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(i.next(c))}catch(h){s(h)}}function l(c){try{d(i.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((i=i.apply(o,e||[])).next())})};function xa(o,e,t){const{doChange:i,xhrMap:n}=o;let r=0;function s(l){var d;let c=Object.assign({},e,{status:"error",percentage:r});n.delete(e.id),c=Pt(((d=o.onError)===null||d===void 0?void 0:d.call(o,{file:c,event:l}))||c),i(c,l)}function a(l){var d;if(o.isErrorState){if(o.isErrorState(t)){s(l);return}}else if(t.status<200||t.status>=300){s(l);return}let c=Object.assign({},e,{status:"finished",percentage:r});n.delete(e.id),c=Pt(((d=o.onFinish)===null||d===void 0?void 0:d.call(o,{file:c,event:l}))||c),i(c,l)}return{handleXHRLoad:a,handleXHRError:s,handleXHRAbort(l){const d=Object.assign({},e,{status:"removed",file:null,percentage:r});n.delete(e.id),i(d,l)},handleXHRProgress(l){const d=Object.assign({},e,{status:"uploading"});if(l.lengthComputable){const c=Math.ceil(l.loaded/l.total*100);d.percentage=c,r=c}i(d,l)}}}function wa(o){const{inst:e,file:t,data:i,headers:n,withCredentials:r,action:s,customRequest:a}=o,{doChange:l}=o.inst;let d=0;a({file:t,data:i,headers:n,withCredentials:r,action:s,onProgress(c){const h=Object.assign({},t,{status:"uploading"}),u=c.percent;h.percentage=u,d=u,l(h)},onFinish(){var c;let h=Object.assign({},t,{status:"finished",percentage:d});h=Pt(((c=e.onFinish)===null||c===void 0?void 0:c.call(e,{file:h}))||h),l(h)},onError(){var c;let h=Object.assign({},t,{status:"error",percentage:d});h=Pt(((c=e.onError)===null||c===void 0?void 0:c.call(e,{file:h}))||h),l(h)}})}function Ca(o,e,t){const i=xa(o,e,t);t.onabort=i.handleXHRAbort,t.onerror=i.handleXHRError,t.onload=i.handleXHRLoad,t.upload&&(t.upload.onprogress=i.handleXHRProgress)}function Li(o,e){return typeof o=="function"?o({file:e}):o||{}}function Pa(o,e,t){const i=Li(e,t);i&&Object.keys(i).forEach(n=>{o.setRequestHeader(n,i[n])})}function Sa(o,e,t){const i=Li(e,t);i&&Object.keys(i).forEach(n=>{o.append(n,i[n])})}function ka(o,e,t,{method:i,action:n,withCredentials:r,responseType:s,headers:a,data:l}){const d=new XMLHttpRequest;d.responseType=s,o.xhrMap.set(t.id,d),d.withCredentials=r;const c=new FormData;if(Sa(c,l,t),t.file!==null&&c.append(e,t.file),Ca(o,t,d),n!==void 0){d.open(i.toUpperCase(),n),Pa(d,a,t),d.send(c);const h=Object.assign({},t,{status:"uploading"});o.doChange(h)}}const Ia=Object.assign(Object.assign({},xe.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,customDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:()=>[]},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:o=>pa?Ti(o):!1},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),Ma=L({name:"Upload",props:Ia,setup(o){o.abstract&&o.listType==="image-card"&&lt("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=st(o),i=xe("Upload","-upload",la,Lr,o,e),n=No(o),r=F(o.defaultFileList),s=te(o,"fileList"),a=F(null),l={value:!1},d=F(!1),c=new Map,h=Lo(s,r),u=z(()=>h.value.map(Pt)),p=z(()=>{const{max:S}=o;return S!==void 0?u.value.length>=S:!1});function f(){var S;(S=a.value)===null||S===void 0||S.click()}function y(S){const B=S.target;R(B.files?Array.from(B.files).map(A=>({file:A,entry:null,source:"input"})):null,S),B.value=""}function I(S){const{"onUpdate:fileList":B,onUpdateFileList:A}=o;B&&de(B,S),A&&de(A,S),r.value=S}const M=z(()=>o.multiple||o.directory),k=(S,B,A={append:!1,remove:!1})=>{const{append:U,remove:q}=A,oe=Array.from(u.value),Z=oe.findIndex(Y=>Y.id===S.id);if(U||q||~Z){U?oe.push(S):q?oe.splice(Z,1):oe.splice(Z,1,S);const{onChange:Y}=o;Y&&Y({file:S,fileList:oe,event:B}),I(oe)}};function R(S,B){if(!S||S.length===0)return;const{onBeforeUpload:A}=o;S=M.value?S:[S[0]];const{max:U,accept:q}=o;S=S.filter(({file:Z,source:Y})=>Y==="dnd"&&(q!=null&&q.trim())?va(Z.name,Z.type,q):!0),U&&(S=S.slice(0,U-u.value.length));const oe=vo();Promise.all(S.map(Z=>ri(this,[Z],void 0,function*({file:Y,entry:ie}){var ee;const $={id:vo(),batchId:oe,name:Y.name,status:"pending",percentage:0,file:Y,url:null,type:Y.type,thumbnailUrl:null,fullPath:(ee=ie==null?void 0:ie.fullPath)!==null&&ee!==void 0?ee:`/${Y.webkitRelativePath||Y.name}`};return!A||(yield A({file:$,fileList:u.value}))!==!1?$:null}))).then(Z=>ri(this,void 0,void 0,function*(){let Y=Promise.resolve();Z.forEach(ie=>{Y=Y.then(tt).then(()=>{ie&&k(ie,B,{append:!0})})}),yield Y})).then(()=>{o.defaultUpload&&C()})}function C(S){const{method:B,action:A,withCredentials:U,headers:q,data:oe,name:Z}=o,Y=S!==void 0?u.value.filter(ee=>ee.id===S):u.value,ie=S!==void 0;Y.forEach(ee=>{const{status:$}=ee;($==="pending"||$==="error"&&ie)&&(o.customRequest?wa({inst:{doChange:k,xhrMap:c,onFinish:o.onFinish,onError:o.onError},file:ee,action:A,withCredentials:U,headers:q,data:oe,customRequest:o.customRequest}):ka({doChange:k,xhrMap:c,onFinish:o.onFinish,onError:o.onError,isErrorState:o.isErrorState},Z,ee,{method:B,action:A,withCredentials:U,responseType:o.responseType,headers:q,data:oe}))})}function b(S){var B;if(S.thumbnailUrl)return S.thumbnailUrl;const{createThumbnailUrl:A}=o;return A?(B=A(S.file,S))!==null&&B!==void 0?B:S.url||"":S.url?S.url:S.file?ha(S.file):""}const v=z(()=>{const{common:{cubicBezierEaseInOut:S},self:{draggerColor:B,draggerBorder:A,draggerBorderHover:U,itemColorHover:q,itemColorHoverError:oe,itemTextColorError:Z,itemTextColorSuccess:Y,itemTextColor:ie,itemIconColor:ee,itemDisabledOpacity:$,lineHeight:V,borderRadius:K,fontSize:fe,itemBorderImageCardError:Se,itemBorderImageCard:we}}=i.value;return{"--n-bezier":S,"--n-border-radius":K,"--n-dragger-border":A,"--n-dragger-border-hover":U,"--n-dragger-color":B,"--n-font-size":fe,"--n-item-color-hover":q,"--n-item-color-hover-error":oe,"--n-item-disabled-opacity":$,"--n-item-icon-color":ee,"--n-item-text-color":ie,"--n-item-text-color-error":Z,"--n-item-text-color-success":Y,"--n-line-height":V,"--n-item-border-image-card-error":Se,"--n-item-border-image-card":we}}),x=t?at("upload",void 0,v,o):void 0;Ie(dt,{mergedClsPrefixRef:e,mergedThemeRef:i,showCancelButtonRef:te(o,"showCancelButton"),showDownloadButtonRef:te(o,"showDownloadButton"),showRemoveButtonRef:te(o,"showRemoveButton"),showRetryButtonRef:te(o,"showRetryButton"),onRemoveRef:te(o,"onRemove"),onDownloadRef:te(o,"onDownload"),customDownloadRef:te(o,"customDownload"),mergedFileListRef:u,triggerClassRef:te(o,"triggerClass"),triggerStyleRef:te(o,"triggerStyle"),shouldUseThumbnailUrlRef:te(o,"shouldUseThumbnailUrl"),renderIconRef:te(o,"renderIcon"),xhrMap:c,submit:C,doChange:k,showPreviewButtonRef:te(o,"showPreviewButton"),onPreviewRef:te(o,"onPreview"),getFileThumbnailUrlResolver:b,listTypeRef:te(o,"listType"),dragOverRef:d,openOpenFileDialog:f,draggerInsideRef:l,handleFileAddition:R,mergedDisabledRef:n.mergedDisabledRef,maxReachedRef:p,fileListClassRef:te(o,"fileListClass"),fileListStyleRef:te(o,"fileListStyle"),abstractRef:te(o,"abstract"),acceptRef:te(o,"accept"),cssVarsRef:t?void 0:v,themeClassRef:x==null?void 0:x.themeClass,onRender:x==null?void 0:x.onRender,showTriggerRef:te(o,"showTrigger"),imageGroupPropsRef:te(o,"imageGroupProps"),mergedDirectoryDndRef:z(()=>{var S;return(S=o.directoryDnd)!==null&&S!==void 0?S:o.directory}),onRetryRef:te(o,"onRetry")});const D={clear:()=>{r.value=[]},submit:C,openOpenFileDialog:f};return Object.assign({mergedClsPrefix:e,draggerInsideRef:l,inputElRef:a,mergedTheme:i,dragOver:d,mergedMultiple:M,cssVars:t?void 0:v,themeClass:x==null?void 0:x.themeClass,onRender:x==null?void 0:x.onRender,handleFileInputChange:y},D)},render(){var o,e;const{draggerInsideRef:t,mergedClsPrefix:i,$slots:n,directory:r,onRender:s}=this;if(n.default&&!this.abstract){const l=n.default()[0];!((o=l==null?void 0:l.type)===null||o===void 0)&&o[Bi]&&(t.value=!0)}const a=g("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:`${i}-upload-file-input`,accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:r||void 0,directory:r||void 0}));return this.abstract?g(Ge,null,(e=n.default)===null||e===void 0?void 0:e.call(n),g(Ci,{to:"body"},a)):(s==null||s(),g("div",{class:[`${i}-upload`,t.value&&`${i}-upload--dragger-inside`,this.dragOver&&`${i}-upload--drag-over`,this.themeClass],style:this.cssVars},a,this.showTrigger&&this.listType!=="image-card"&&g($i,null,n),this.showFileList&&g(ba,null,n)))}});/*!
* @indoorequal/vue-maplibre-gl v8.4.2
* (c) 2025 François de Metz <francois@2metz.fr>
* @license MIT
*/const _a=Symbol("map"),ct=_a,kt=Symbol("isLoaded"),Ra=Symbol("isInitialized"),ji=Ra,Uo=Symbol("componentId"),Wo=Symbol("sourceId"),Ni=Symbol("sourceLayerRegistry"),Da=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function Ea(o,e,t,i){return n=>t.emit(i,{type:n.type,map:e,component:o,event:n})}function Fa(o,e){const t=Be.LngLat.convert(o),i=Be.LngLat.convert(e);return t.lng===i.lng&&t.lat===i.lat}var It=(o=>(o.TOP_LEFT="top-left",o.TOP_RIGHT="top-right",o.BOTTOM_LEFT="bottom-left",o.BOTTOM_RIGHT="bottom-right",o))(It||{});const ut=Object.values(It),si=new Map,Ba=Symbol("default");function za(o,e,t=Ba){var n;let i=si.get(t);return i||(i=Cr({isLoaded:!1,isMounted:!1,language:null}),si.set(t,i)),i.isLoaded=((n=e.value)==null?void 0:n.loaded())||!1,i.isMounted=!1,i.component=o,i.map=e.value,i}const Oa=L({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:o=>o in It},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Boolean}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup(o,e){const t=qo(Ro()),i=wt(),n=wt(),r=F(!1),s=F(!1),a=new Map,l=za(t,n,o.mapKey);Ie(ct,n),Ie(kt,s),Ie(ji,r),Ie(Uo,t.uid),Ie(Wo,""),G(()=>o.bearing,u=>{var p;u&&((p=n.value)==null||p.setBearing(u))}),G(()=>o.bounds,u=>{var p;u&&((p=n.value)==null||p.fitBounds(u,o.fitBoundsOptions))}),G(()=>o.center,u=>{var f,y;const p=(f=n.value)==null?void 0:f.getCenter();u&&p&&!Fa(u,p)&&((y=n.value)==null||y.setCenter(u))}),G(()=>o.maxBounds,u=>{var p;u&&((p=n.value)==null||p.setMaxBounds(u))}),G(()=>o.maxPitch,u=>{var p;u&&((p=n.value)==null||p.setMaxPitch(u))}),G(()=>o.maxZoom,u=>{var p;u&&((p=n.value)==null||p.setMaxZoom(u))}),G(()=>o.minPitch,u=>{var p;u&&((p=n.value)==null||p.setMinPitch(u))}),G(()=>o.minZoom,u=>{var p;u&&((p=n.value)==null||p.setMinZoom(u))}),G(()=>o.pitch,u=>{var p;u&&((p=n.value)==null||p.setPitch(u))}),G(()=>o.renderWorldCopies,u=>{var p;u&&((p=n.value)==null||p.setRenderWorldCopies(u))}),G(()=>o.mapStyle,u=>{var p;u&&((p=n.value)==null||p.setStyle(u))}),G(()=>o.transformRequest,u=>{var p;u&&((p=n.value)==null||p.setTransformRequest(u))}),G(()=>o.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))}),G(()=>o.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))});function d(){l.isMounted=!0;const u={...o,style:o.mapStyle,container:i.value};for(const p of Object.keys(u))u[p]===void 0&&delete u[p];if(n.value=qo(new Be.Map(u)),l.map=n.value,r.value=!0,a.set("__load",()=>(s.value=!0,l.isLoaded=!0)),n.value.on("load",a.get("__load")),a.set("__moveend",()=>e.emit("update:center",n.value.getCenter())),n.value.on("moveend",a.get("__moveend")),a.set("__zoomend",()=>e.emit("update:zoom",n.value.getZoom())),n.value.on("zoomend",a.get("__zoomend")),a.set("__pitchend",()=>e.emit("update:pitch",n.value.getPitch())),n.value.on("pitchend",a.get("__pitchend")),a.set("__rotateend",()=>e.emit("update:bearing",n.value.getBearing())),n.value.on("rotateend",a.get("__rotateend")),t.vnode.props){for(const p of Da)if(t.vnode.props["onMap:"+p]){const f=`map:${p}`,y=Ea(t,n.value,e,f);a.set(p,y),n.value.on(p,y)}}n.value.getCanvas().addEventListener("webglcontextlost",h)}async function c(){l.isMounted=!1,l.isLoaded=!1,s.value=!1,n.value&&(n.value.getCanvas().removeEventListener("webglcontextlost",h),r.value=!1,a.forEach((u,p)=>{n.value.off(p.startsWith("__")?p.substring(2):p,u)}),n.value.remove())}function h(){c(),tt(d)}return _o(d),rt(c),e.expose({map:n}),()=>[g("div",{ref:i,style:{height:o.height,width:o.width}}),r.value&&e.slots.default?e.slots.default({}):void 0]},render(){return null}});function Ta(o,e,t){G(o,i=>{var n,r;i&&ut.indexOf(i)===-1||((n=e.value)!=null&&n.hasControl(t)&&e.value.removeControl(t),(r=e.value)==null||r.addControl(t,i))},{immediate:!0})}function Mt(o,e){const t=ne(ct),i=ne(ji),n=wt();return n.value=o(),Ta(()=>e.position,t,n.value),rt(()=>{var r;return i.value&&((r=t.value)==null?void 0:r.removeControl(n.value))}),{control:n,map:t}}class $a{constructor(e,t){Ce(this,"container");this.isAdded=e,this.container=document.createElement("div"),this.setClasses(t)}getDefaultPosition(){return It.TOP_LEFT}onAdd(){return tt(()=>this.isAdded.value=!0),this.container}onRemove(){this.isAdded.value=!1,this.container.remove()}setClasses(e){this.container.className=e}}const so=L({name:"MglCustomControl",props:{position:{type:String,validator:o=>ut.indexOf(o)!==-1},class:{type:String,default:"maplibregl-ctrl maplibregl-ctrl-group"}},slots:Object,setup(o,{slots:e}){const t=F(!1),{control:i}=Mt(()=>new $a(t,o.class),o);return G(()=>o.class,()=>i.value.setClasses(o.class)),()=>{var n;return t.value?g(Ci,{to:i.value.container},(n=e.default)==null?void 0:n.call(e,{})):Re("custom-component")}},render(){return null}}),La=L({name:"MglFullscreenControl",props:{position:{type:String,validator:o=>ut.indexOf(o)!==-1},container:{type:Object,default:null}},setup(o){const{control:e,map:t}=Mt(()=>new Be.FullscreenControl({container:o.container||void 0}),o);function i(){tt(()=>{var n;return(n=t.value)==null?void 0:n.resize()})}e.value.on("fullscreenstart",i),e.value.on("fullscreenend",i),rt(()=>{e.value.off("fullscreenstart",i),e.value.off("fullscreenend",i)})},render(){return null}}),ja=L({name:"MglGeolocateControl",props:{position:{type:String,default:It.TOP_RIGHT,validator:o=>ut.indexOf(o)!==-1},positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},emits:["trackuserlocationstart","trackuserlocationend","userlocationlostfocus","userlocationfocus","geolocate","error","outofmaxbounds"],setup(o,e){const{control:t}=Mt(()=>new Be.GeolocateControl({positionOptions:o.positionOptions,fitBoundsOptions:o.fitBoundsOptions,trackUserLocation:o.trackUserLocation,showAccuracyCircle:o.showAccuracyCircle,showUserLocation:o.showUserLocation}),o);function i(n){const r=s=>{e.emit(n,s)};t.value.on(n,r),rt(()=>{t.value.off(n,r)})}i("trackuserlocationstart"),i("trackuserlocationend"),i("userlocationlostfocus"),i("userlocationfocus"),i("geolocate"),i("error"),i("outofmaxbounds")},render(){return null}}),Na=L({name:"MglNavigationControl",props:{position:{type:String,validator:o=>ut.indexOf(o)!==-1},showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:Boolean},setup(o){Mt(()=>new Be.NavigationControl({showCompass:o.showCompass,showZoom:o.showZoom,visualizePitch:o.visualizePitch}),o)},render(){return null}});var Ai=(o=>(o.IMPERIAL="imperial",o.METRIC="metric",o.NAUTICAL="nautical",o))(Ai||{});const Aa=Object.values(Ai),Ua=L({name:"MglScaleControl",props:{position:{type:String,validator:o=>ut.indexOf(o)!==-1},maxWidth:{type:Number,default:100},unit:{type:String,default:"metric",validator:o=>Aa.indexOf(o)!==-1}},setup(o){Mt(()=>new Be.ScaleControl({maxWidth:o.maxWidth,unit:o.unit}),o)},render(){return null}});class Wa{constructor(){Ce(this,"unmountHandlers",new Map)}registerUnmountHandler(e,t){this.unmountHandlers.set(e,t)}unregisterUnmountHandler(e){this.unmountHandlers.delete(e)}unmount(){this.unmountHandlers.forEach(e=>e())}}var Fe;let Vo=(Fe=class{static genSourceOpts(e){const t={...e};for(const i of Object.keys(t))(t[i]===void 0||i==="sourceId")&&delete t[i];return t}static getSourceRef(e,t){const i=typeof t=="string",n=String(e)+(i?t:"");let r=Fe.REFS.get(n);return r||(r=F(i?null:void 0),Fe.REFS.set(n,r)),r}},Ce(Fe,"REFS",new Map),Fe);function Va(o,e,t){const i=ne(ct),n=ne(kt);function r(){n.value&&(i.value.addSource(e.sourceId,Vo.genSourceOpts(e)),o.value=i.value.getSource(e.sourceId))}return G(n,r,{immediate:!0}),i.value.on("style.load",r),rt(()=>{n.value&&(t.unmount(),i.value.removeSource(e.sourceId)),i.value.off("style.load",r)})}const Ga=L({name:"MglGeoJsonSource",props:{sourceId:{type:String,required:!0},data:{type:[Object,String],required:!0},maxzoom:Number,attribution:String,buffer:Number,tolerance:Number,cluster:Boolean,clusterRadius:Number,clusterMaxZoom:Number,clusterMinPoints:Number,clusterProperties:Object,lineMetrics:Boolean,generateId:Boolean,promoteId:[Object,String],filter:[Array,String,Object]},slots:Object,setup(o,{slots:e}){const t=ne(Uo),i=Vo.getSourceRef(t,o.sourceId),n=new Wa,r={...o,type:"geojson"};return Ie(Wo,o.sourceId),Ie(Ni,n),Va(i,r,n),G([wr(o.data)?o.data:()=>o.data,i],([s,a])=>{a==null||a.setData(s||{type:"FeatureCollection",features:[]})},{immediate:!0}),()=>[Re("GeoJSON Source"),i.value&&e.default?e.default({}):void 0]}}),Pe=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function Oe(){return{layerId:{type:String,required:!0},source:{type:String},metadata:{type:[Object,Array,String,Number]},sourceLayer:{type:String},minzoom:{type:Number},maxzoom:{type:Number},filter:{type:Object},before:{type:String},layout:{type:Object},paint:{type:Object}}}function Ha(o,e,t,i){const n={id:o,type:e,source:t.source||i,metadata:t.metadata,minzoom:t.minzoom,maxzoom:t.maxzoom,"source-layer":t.sourceLayer,filter:t.filter,paint:t.paint,layout:t.layout};for(const r of Object.keys(n))n[r]===void 0&&delete n[r];return n}function Xa(o,e,t){if(t.props)for(const i of Pe){const n="on"+i.charAt(0).toUpperCase()+i.substr(1);t.props[n]&&o.on(i,e,t.props[n])}}function Ya(o,e,t){if(t.props)for(const i of Pe){const n="on"+i.charAt(0).toUpperCase()+i.substr(1);t.props[n]&&o.off(i,e,t.props[n])}}function Ui(o,e){const t=ne(ct),i=ne(kt),n=ne(Ni);function r(){i.value&&(e&&Ya(t.value,o,e.vnode),t.value.getLayer(o)&&t.value.removeLayer(o))}n.registerUnmountHandler(o,r),rt(()=>{n.unregisterUnmountHandler(o),r()})}L({name:"MglBackgroundLayer",props:{layerId:{type:String,required:!0},metadata:[Object,Array,String,Number],minzoom:Number,maxzoom:Number,before:String,layout:Object,paint:Object},emits:[...Pe],setup(o){const e=ne(ct),t=ne(kt);return Ui(o.layerId),G(()=>o.layout,i=>{if(i)for(const[n,r]of Object.entries(i))e.value.setLayoutProperty(o.layerId,n,r)}),G(()=>o.paint,i=>{if(i)for(const[n,r]of Object.entries(i))e.value.setPaintProperty(o.layerId,n,r)}),G(t,i=>{i&&e.value.addLayer({id:o.layerId,type:"background",metadata:o.metadata,minzoom:o.minzoom,maxzoom:o.maxzoom,layout:o.layout,paint:o.paint},o.before||void 0)},{immediate:!0}),()=>Re("Background Layer")}});function Te(o,e){const t=ne(Wo);if(!t&&!e.source)return;const i=Ro(),n=ne(ct),r=ne(kt),s=ne(Uo),a=Vo.getSourceRef(s,e.source||t);return Ui(e.layerId,i),G(()=>e.minzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),G(()=>e.maxzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),G(()=>e.layout,l=>{if(l)for(const[d,c]of Object.entries(l))n.value.setLayoutProperty(e.layerId,d,c)},{deep:!0}),G(()=>e.paint,l=>{if(l)for(const[d,c]of Object.entries(l))n.value.setPaintProperty(e.layerId,d,c)},{deep:!0}),G(()=>e.filter,l=>n.value.setFilter(e.layerId,l),{deep:!0}),G([r,a],([l,d])=>{l&&(d||d===void 0)&&(n.value.addLayer(Ha(e.layerId,o,e,t),e.before||void 0),Xa(n.value,e.layerId,i.vnode))},{immediate:!0}),()=>Re(`${o} Layer`)}L({name:"MglCircleLayer",props:Oe(),emits:[...Pe],setup(o){return Te("circle",o)}});L({name:"MglFillLayer",props:Oe(),emits:[...Pe],setup(o){return Te("fill",o)}});L({name:"MglFillExtrusionLayer",props:Oe(),emits:[...Pe],setup(o){return Te("fill-extrusion",o)}});L({name:"MglHeatmapLayer",props:Oe(),emits:[...Pe],setup(o){return Te("heatmap",o)}});L({name:"MglHillshadeLayer",props:Oe(),emits:[...Pe],setup(o){return Te("hillshade",o)}});const Ka=L({name:"MglLineLayer",props:Oe(),emits:[...Pe],setup(o){return Te("line",o)}});L({name:"MglRasterLayer",props:Oe(),emits:[...Pe],setup(o){return Te("raster",o)}});L({name:"MglSymbolLayer",props:Oe(),emits:[...Pe],setup(o){return Te("symbol",o)}});function pe(){return pe=Object.assign?Object.assign.bind():function(o){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)({}).hasOwnProperty.call(t,i)&&(o[i]=t[i])}return o},pe.apply(null,arguments)}var ge;(function(o){o.Commit="commit",o.Provisional="provisional",o.Finish="finish"})(ge||(ge={}));const he={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT_FEATURE_ID:"selectionPointFeatureId",SELECTION_POINT:"selectionPoint"},wo="currentlyDrawing",xt="edited",Wi="closingPoint",Vi="snappingPoint",Co="coordinatePoint",qa="coordinatePointFeatureId",Wt="coordinatePointIds",jt=10;function ao(o){return!!(o&&typeof o=="object"&&o!==null&&!Array.isArray(o))}function ai(o){return!!(o&&typeof o=="object"&&"properties"in o&&typeof o.properties=="object"&&o.properties!==null&&"mode"in o.properties)}function li(o){return!!(function(e){return typeof e=="number"&&!isNaN(new Date(e).valueOf())})(o)}const Za="Feature mode property does not match the mode being added to";var ot;(function(o){o.Drawing="drawing",o.Select="select",o.Static="static",o.Render="render"})(ot||(ot={}));const Ja={rightClick:!0,contextMenu:!1,leftClick:!0,onDragStart:!0,onDrag:!0,onDragEnd:!0};class Yt{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,t=!1){this._state="unregistered",this._styles={},this.pointerEvents=Ja,this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=ot.Drawing,this.mode="base",t||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=pe({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection),(e==null?void 0:e.pointerEvents)!==void 0&&(this.pointerEvents=e.pointerEvents)}allowPointerEvent(e,t){return typeof e=="boolean"?e:typeof e!="function"||e(t)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}afterFeatureUpdated(e){}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const t=(function(i,n){let r;if(ao(i))if(i.id==null)r="Feature has no id";else if(typeof i.id!="string"&&typeof i.id!="number")r="Feature must be string or number as per GeoJSON spec";else if(n(i.id))if(ao(i.geometry))if(ao(i.properties))if(typeof i.geometry.type=="string"&&["Polygon","LineString","Point"].includes(i.geometry.type))if(Array.isArray(i.geometry.coordinates)){if(!i.properties.mode||typeof i.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else r="Feature coordinates is not an array";else r="Feature is not Point, LineString or Polygon";else r="Feature has no properties";else r="Feature has no geometry";else r="Feature must match the id strategy (default is UUID4)";else r="Feature is not object";return r?{valid:!1,reason:r}:{valid:!0}})(e,this.store.idStrategy.isValidId);if(this.validate){const i=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Provisional});return{valid:t.valid&&i.valid,reason:i.reason}}return{valid:t.valid,reason:t.reason}}validateModeFeature(e,t){const i=this.performFeatureValidation(e);return i.valid?e.properties.mode!==this.mode?{valid:!1,reason:Za}:t(e):{valid:!1,reason:i.reason}}onFinish(e,t){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,t){}onDrag(e,t){}onDragEnd(e,t){}getHexColorStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getNumericStylingValue(e,t,i){return this.getStylingValue(e,t,i)}getStylingValue(e,t,i){return e===void 0?t:typeof e=="function"?e(i):e}}class Qa extends Yt{constructor(...e){super(...e),this.type=ot.Select}}function ze(o,e){const t=d=>d*Math.PI/180,i=t(o[1]),n=t(o[0]),r=t(e[1]),s=r-i,a=t(e[0])-n,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(i)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}const Gi=63710088e-1;function ye(o){return o%360*Math.PI/180}function el(o){return o/6371.0088}function it(o){return o%(2*Math.PI)*180/Math.PI}function le(o,e=9){const t=Math.pow(10,e);return Math.round(o*t)/t}const di=57.29577951308232,ci=.017453292519943295,Vt=6378137,ae=(o,e)=>({x:o===0?0:o*ci*Vt,y:e===0?0:Math.log(Math.tan(Math.PI/4+e*ci/2))*Vt}),nt=(o,e)=>({lng:o===0?0:di*(o/Vt),lat:e===0?0:(2*Math.atan(Math.exp(e/Vt))-Math.PI/2)*di});function tl(o){let e;if(o.geometry.type==="Polygon")e=o.geometry.coordinates;else{if(o.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e=[o.geometry.coordinates]}const t=[];for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length-1;s++)for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length-1;l++)n(r,s,a,l);return t.length>0;function i(r){return r<0||r>1}function n(r,s,a,l){const d=e[r][s],c=e[r][s+1],h=e[a][l],u=e[a][l+1],p=(function(I,M,k,R){if(zt(I,k)||zt(I,R)||zt(M,k)||zt(R,k))return null;const C=I[0],b=I[1],v=M[0],x=M[1],D=k[0],S=k[1],B=R[0],A=R[1],U=(C-v)*(S-A)-(b-x)*(D-B);return U===0?null:[((C*x-b*v)*(D-B)-(C-v)*(D*A-S*B))/U,((C*x-b*v)*(S-A)-(b-x)*(D*A-S*B))/U]})(d,c,h,u);if(p===null)return;let f,y;f=c[0]!==d[0]?(p[0]-d[0])/(c[0]-d[0]):(p[1]-d[1])/(c[1]-d[1]),y=u[0]!==h[0]?(p[0]-h[0])/(u[0]-h[0]):(p[1]-h[1])/(u[1]-h[1]),i(f)||i(y)||(p.toString(),t.push(p))}}function zt(o,e){return o[0]===e[0]&&o[1]===e[1]}function Go(o,e){return ui(o[0])<=e&&ui(o[1])<=e}function Hi(o){return o.length===2&&typeof o[0]=="number"&&typeof o[1]=="number"&&o[0]!==1/0&&o[1]!==1/0&&(t=o[0])>=-180&&t<=180&&(e=o[1])>=-90&&e<=90;var e,t}function ui(o){let e=1,t=0;for(;Math.round(o*e)/e!==o;)e*=10,t++;return t}const De=(o,e)=>{const{x:t,y:i}=o,{x:n,y:r}=e,s=n-t,a=r-i;return Math.sqrt(a*a+s*s)};class be{constructor({store:e,mode:t,project:i,unproject:n,pointerDistance:r,coordinatePrecision:s,projection:a}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=t,this.project=i,this.unproject=n,this.pointerDistance=r,this.coordinatePrecision=s,this.projection=a}}function Xi({unproject:o,point:e,pointerDistance:t}){const i=t/2,{x:n,y:r}=e;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[o(n-i,r-i),o(n+i,r-i),o(n+i,r+i),o(n-i,r+i),o(n-i,r-i)].map(s=>[s.lng,s.lat])]}}}class Gt extends be{constructor(e){super(e)}create(e){const{containerX:t,containerY:i}=e;return Xi({unproject:this.unproject,point:{x:t,y:i},pointerDistance:this.pointerDistance})}}class Ht extends be{constructor(e){super(e)}measure(e,t){const{x:i,y:n}=this.project(t[0],t[1]);return De({x:i,y:n},{x:e.containerX,y:e.containerY})}}class Po extends be{constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>this.getSnappable(n,r=>!!(r.properties&&r.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(n,r)=>this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode&&s.id!==r)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}getSnappable(e,t){const i=this.clickBoundingBox.create(e),n=this.store.search(i,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}a.forEach((l,d)=>{const c=this.pixelDistance.measure(e,l);c<r.minDist&&c<this.pointerDistance&&(r.coordinate=l,r.minDist=c,r.featureId=s.id,r.featureCoordinateIndex=d)})}),r}}function hi(o,e,t){const i=ye(o[0]),n=ye(o[1]),r=ye(t),s=el(e),a=Math.asin(Math.sin(n)*Math.cos(s)+Math.cos(n)*Math.sin(s)*Math.cos(r));return[it(i+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(n),Math.cos(s)-Math.sin(n)*Math.sin(a))),it(a)]}function pi(o,e){const t=ye(o[0]),i=ye(e[0]),n=ye(o[1]),r=ye(e[1]),s=Math.sin(i-t)*Math.cos(r),a=Math.cos(n)*Math.sin(r)-Math.sin(n)*Math.cos(r)*Math.cos(i-t);return it(Math.atan2(s,a))}function ol({x:o,y:e},{x:t,y:i}){const n=t-o,r=i-e;if(n===0&&r===0)return 0;let s=Math.atan2(r,n);return s*=180/Math.PI,s>180?s-=360:s<-180&&(s+=360),s}function il(o,e,t){const i=[],n=o.length;let r,s,a,l=0;for(let c=0;c<o.length&&!(e>=l&&c===o.length-1);c++){if(l>e&&i.length===0){if(r=e-l,!r)return i.push(o[c]),i;s=pi(o[c],o[c-1])-180,a=hi(o[c],r,s),i.push(a)}if(l>=t)return r=t-l,r?(s=pi(o[c],o[c-1])-180,a=hi(o[c],r,s),i.push(a),i):(i.push(o[c]),i);if(l>=e&&i.push(o[c]),c===o.length-1)return i;l+=ze(o[c],o[c+1])}if(l<e&&o.length===n)throw new Error("Start position is beyond line");const d=o[o.length-1];return[d,d]}function Ot(o){return o*(Math.PI/180)}function gi(o){return o*(180/Math.PI)}class nl extends be{constructor(e){super(e),this.config=void 0,this.config=e}generateInsertionCoordinates(e,t,i){const n=[e,t];let r=0;for(let d=0;d<n.length-1;d++)r+=ze(n[0],n[1]);if(r<=i)return n;let s=r/i-1;Number.isInteger(s)||(s=Math.floor(s)+1);const a=[];for(let d=0;d<s;d++){const c=il(n,i*d,i*(d+1));a.push(c)}const l=[];for(let d=0;d<a.length;d++)l.push(a[d][1]);return this.limitCoordinates(l)}generateInsertionGeodesicCoordinates(e,t,i){const n=ze(e,t),r=(function(s,a,l){const d=[],c=Ot(s[1]),h=Ot(s[0]),u=Ot(a[1]),p=Ot(a[0]);l+=1;const f=2*Math.asin(Math.sqrt(Math.sin((u-c)/2)**2+Math.cos(c)*Math.cos(u)*Math.sin((p-h)/2)**2));if(f===0||isNaN(f))return d;for(let y=0;y<=l;y++){const I=y/l,M=Math.sin((1-I)*f)/Math.sin(f),k=Math.sin(I*f)/Math.sin(f),R=M*Math.cos(c)*Math.cos(h)+k*Math.cos(u)*Math.cos(p),C=M*Math.cos(c)*Math.sin(h)+k*Math.cos(u)*Math.sin(p),b=M*Math.sin(c)+k*Math.sin(u);if(isNaN(R)||isNaN(C)||isNaN(b))continue;const v=Math.atan2(b,Math.sqrt(R**2+C**2)),x=Math.atan2(C,R);isNaN(v)||isNaN(x)||d.push([gi(x),gi(v)])}return d.slice(1,-1)})(e,t,Math.floor(n/i));return this.limitCoordinates(r)}limitCoordinates(e){return e.map(t=>[le(t[0],this.config.coordinatePrecision),le(t[1],this.config.coordinatePrecision)])}}function rl(o,e){return o[0]===e[0]&&o[1]===e[1]}function sl(o,e){if(o.geometry.type!=="LineString")return{valid:!1,reason:"Feature is not a LineString"};if(o.geometry.coordinates.length<2)return{valid:!1,reason:"Feature has less than 2 coordinates"};for(let t=0;t<o.geometry.coordinates.length;t++){if(!Hi(o.geometry.coordinates[t]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!Go(o.geometry.coordinates[t],e))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return{valid:!0}}function fi(o){return Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2))}function Ue(o,e){const t=(function(i,n){const[r,s,a]=i,[l,d,c]=n;return r*l+s*d+a*c})(o,e)/(fi(o)*fi(e));return Math.acos(Math.min(Math.max(t,-1),1))}function lo(o){const e=ye(o[1]),t=ye(o[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function We(o){const[e,t,i]=o,n=it(Math.asin(i));return[it(Math.atan2(t,e)),n]}function al(o,e,t){const i=lo(o),n=lo(e),r=lo(t),[s,a,l]=r,[d,c,h]=(function(A,U){const[q,oe,Z]=A,[Y,ie,ee]=U;return[oe*ee-Z*ie,Z*Y-q*ee,q*ie-oe*Y]})(i,n),u=c*l-h*a,p=h*s-d*l,f=d*a-c*s,y=f*c-p*h,I=u*h-f*d,M=p*d-u*c,k=1/Math.sqrt(Math.pow(y,2)+Math.pow(I,2)+Math.pow(M,2)),R=[y*k,I*k,M*k],C=[-1*y*k,-1*I*k,-1*M*k],b=Ue(i,n),v=Ue(i,R),x=Ue(n,R),D=Ue(i,C),S=Ue(n,C);let B;return B=v<D&&v<S||x<D&&x<S?R:C,Ue(i,B)>b||Ue(n,B)>b?ze(We(B),We(i))<=ze(We(B),We(n))?[We(i),!0,!1]:[We(n),!1,!0]:[We(B),!1,!1]}function ll(o,e,t){const i=e.x-o.x,n=e.y-o.y,r=Math.max(0,Math.min(1,((t.x-o.x)*i+(t.y-o.y)*n)/(i*i+n*n)));return{x:o.x+r*i,y:o.y+r*n}}class Yi extends be{constructor(e,t,i){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>{const r=this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode));return r.coordinate?[le(r.coordinate[0],this.config.coordinatePrecision),le(r.coordinate[1],this.config.coordinatePrecision)]:void 0},this.getSnappableCoordinate=(n,r)=>{const s=this.getSnappable(n,a=>!!(a.properties&&a.properties.mode===this.mode&&a.id!==r));return s.coordinate?[le(s.coordinate[0],this.config.coordinatePrecision),le(s.coordinate[1],this.config.coordinatePrecision)]:void 0},this.config=e,this.pixelDistance=t,this.clickBoundingBox=i}getSnappable(e,t){const i=this.clickBoundingBox.create(e),n=this.store.search(i,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}const l=[];for(let u=0;u<a.length-1;u++)l.push([a[u],a[u+1]]);let d;const c=[e.lng,e.lat];if(this.config.projection==="web-mercator"?d=(function(u,p){let f=[1/0,1/0],y=1/0,I=0;for(let M of p){const k=M[0],R=M[1];let C,b=1/0;const v=ae(k[0],k[1]),x=ae(R[0],R[1]),D=ae(u[0],u[1]);if(k[0]===u[0]&&k[1]===u[1])C=k;else if(R[0]===u[0]&&R[1]===u[1])C=R;else{const{x:S,y:B}=ll(v,x,D),{lng:A,lat:U}=nt(S,B);C=[A,U]}C&&(b=De(D,ae(C[0],C[1])),b<y&&(f=C,y=b,I=p.indexOf(M)))}return y===1/0?void 0:{coordinate:f,lineIndex:I,distance:y}})(c,l):this.config.projection==="globe"&&(d=(function(u,p){let f=[1/0,1/0],y=1/0,I=0;for(let M of p){const k=M[0],R=M[1];let C,b=1/0;k[0]===u[0]&&k[1]===u[1]?C=k:R[0]===u[0]&&R[1]===u[1]?C=R:[C]=al(k,R,u),C&&(b=ze(u,C),b<y&&(f=C,y=b,I=p.indexOf(M)))}return y===1/0?void 0:{coordinate:f,distance:y,lineIndex:I}})(c,l)),!d)return;const h=this.pixelDistance.measure(e,d.coordinate);h<r.minDistance&&h<this.pointerDistance&&(r.featureId=s.id,r.coordinate=[le(d.coordinate[0],this.config.coordinatePrecision),le(d.coordinate[1],this.config.coordinatePrecision)],r.featureCoordinateIndex=d.lineIndex,r.minDistance=h)}),r}}const dl={cancel:"Escape",finish:"Enter"},cl={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class ul extends Yt{constructor(e){super(e,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=dl,this.snapping=void 0,this.cursors=cl,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommittedCoordinates=void 0,this.snappedPointId=void 0,this.lastMouseMoveEvent=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=pe({},this.cursors,e.cursors)),e!=null&&e.snapping&&(this.snapping=e.snapping),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=pe({},this.keyEvents,e.keyEvents)),e!=null&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}updateSnappedCoordinate(e){const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[i]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[Vi]:!0}}]);this.snappedPointId=i}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);return t}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop(),this.updateGeometries([...e.coordinates],void 0,ge.Commit),this.store.updateProperty([{id:this.currentId,property:wo,value:void 0}]);const t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommittedCoordinates=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}updateGeometries(e,t,i){if(!this.currentId)return;const n={type:"LineString",coordinates:e};if(this.validate&&!this.validate({type:"Feature",geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:i}).valid)return;const r=[{id:this.currentId,geometry:n}];this.closingPointId&&t&&r.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),i==="commit"&&(this.lastCommittedCoordinates=n.coordinates),this.store.updateGeometry(r)}generateInsertCoordinates(e,t){if(!this.insertCoordinates||!this.lastCommittedCoordinates)throw new Error("Not able to insert coordinates");if(this.insertCoordinates.strategy!=="amount")throw new Error("Strategy does not exist");const i=ze(e,t)/(this.insertCoordinates.value+1);let n=[];return this.projection==="globe"?n=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,i):this.projection==="web-mercator"&&(n=this.insertPoint.generateInsertionCoordinates(e,t,i)),n}createLine(e){const[t]=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode,[wo]:!0}}]);this.lastCommittedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(e){if(!this.currentId)return;const t=this.store.getGeometryCopy(this.currentId).coordinates,[i]=this.store.create([{geometry:{type:"Point",coordinates:[...e]},properties:{mode:this.mode}}]);this.closingPointId=i,this.setCursor(this.cursors.close);const n=[...t,e];this.updateGeometries(n,void 0,ge.Commit),this.currentCoordinate++}updateToLine(e,t){if(!this.currentId)return;const i=this.store.getGeometryCopy(this.currentId).coordinates,[n,r]=this.lastCommittedCoordinates?this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1]:i[i.length-2],{x:s,y:a}=this.project(n,r);if(De({x:s,y:a},{x:t.x,y:t.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);const l=[...i,e];this.updateGeometries(l,i[i.length-1],ge.Commit),this.currentCoordinate++}registerBehaviors(e){this.coordinateSnapping=new Po(e,new Ht(e),new Gt(e)),this.insertPoint=new nl(e),this.clickBoundingBox=new Gt(e),this.pixelDistance=new Ht(e),this.lineSnapping=new Yi(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new Po(e,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start),this.lastMouseMoveEvent=e;const t=this.updateSnappedCoordinate(e)||[e.lng,e.lat];if(this.currentId===void 0||this.currentCoordinate===0)return;const i=this.store.getGeometryCopy(this.currentId).coordinates;if(i.pop(),this.closingPointId){const[r,s]=i[i.length-1],{x:a,y:l}=this.project(r,s);De({x:a,y:l},{x:e.containerX,y:e.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let n=[...i,t];if(this.insertCoordinates&&this.currentId&&this.lastCommittedCoordinates){const r=this.lastCommittedCoordinates[this.lastCommittedCoordinates.length-1],s=t;if(!rl(r,s)){const a=this.generateInsertCoordinates(r,s);n=[...this.lastCommittedCoordinates.slice(0,-1),...a,t]}}this.updateGeometries(n,void 0,ge.Provisional)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:i}=this.coordinateSnapping.getSnappable(e,s=>this.lineStringFilter(s));if(!t||i===void 0)return;const n=this.store.getGeometryCopy(t);let r;if(n.type==="LineString"&&(r=n.coordinates,!(r.length<=2))){if(r.splice(i,1),this.validate&&!this.validate({id:t,type:"Feature",geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:n}]),this.onFinish(t,{mode:this.mode,action:"edit"})}}onLeftClick(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const t=this.snapCoordinate(e)||[e.lng,e.lat];this.currentCoordinate===0?this.createLine(t):this.currentCoordinate===1&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}onClick(e){(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))&&(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"?this.onRightClick(e):e.button==="left"&&this.onLeftClick(e))}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.editable)return;let i;if(this.state==="started"){const n=this.lineSnapping.getSnappable(e,s=>this.lineStringFilter(s));n.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=n.featureCoordinateIndex,this.editedFeatureId=n.featureId,i=n.coordinate);const r=this.coordinateSnapping.getSnappable(e,s=>this.lineStringFilter(s));r.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=r.featureCoordinateIndex,this.editedFeatureId=r.featureId,i=r.coordinate)}if(this.editedFeatureId&&i){if(!this.editedPointId){const[n]=this.store.create([{geometry:{type:"Point",coordinates:i},properties:{mode:this.mode,[xt]:!0}}]);this.editedPointId=n}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const i=this.store.getGeometryCopy(this.editedFeatureId);this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?i.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,i.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const n={type:"LineString",coordinates:i.coordinates};this.validate&&!this.validate({type:"Feature",geometry:n,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:n}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:xt,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:xt,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.closingPointId,i=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),i!==void 0&&this.store.delete([i]),t!==void 0&&this.store.delete([t])}catch{}}styleFeature(e){const t=pe({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=jt,t;if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const i=e.properties[Wi];return t.pointColor=this.getHexColorStylingValue(i?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(i?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=50,t}return t}validateFeature(e){return this.validateModeFeature(e,t=>sl(t,this.coordinatePrecision))}lineStringFilter(e){return!!(e.geometry.type==="LineString"&&e.properties&&e.properties.mode===this.mode)}snapCoordinate(e){var t,i,n;let r;if((t=this.snapping)!=null&&t.toLine){let s;s=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}return(i=this.snapping)!=null&&i.toCoordinate&&(r=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),(n=this.snapping)!=null&&n.toCustom&&(r=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),r}afterFeatureUpdated(e){this.editedFeatureId===e.id&&this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0),this.snappedPointId&&this.lastMouseMoveEvent&&this.updateSnappedCoordinate(this.lastMouseMoveEvent),this.currentId===e.id&&(this.closingPointId&&(this.store.delete([this.closingPointId]),this.closingPointId=void 0),this.currentCoordinate=0,this.currentId=void 0,this.state==="drawing"&&this.setStarted())}}const hl="Feature is not a Point",pl="Feature has invalid coordinates",gl="Feature has coordinates with excessive precision";function fl(o,e){return o.geometry.type!=="Point"?{valid:!1,reason:hl}:Hi(o.geometry.coordinates)?Go(o.geometry.coordinates,e)?{valid:!0}:{valid:!1,reason:gl}:{valid:!1,reason:pl}}const ml={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"};class vl extends Yt{constructor(e){super(e,!0),this.mode="point",this.cursors=ml,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=pe({},this.cursors,e.cursors)),e!=null&&e.editable&&(this.editable=e.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(e,t){if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)){if(this.editable){const i=this.getNearestPointFeature(e);this.editedFeatureId=i==null?void 0:i.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}}onDrag(e,t){this.allowPointerEvent(this.pointerEvents.onDrag,e)&&this.editedFeatureId!==void 0&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:xt,value:!0}])))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:xt,value:!1}]),this.editedFeatureId=void 0,t(!0))}registerBehaviors(e){this.pixelDistance=new Ht(e),this.clickBoundingBox=new Gt(e)}styleFeature(e){const t=pe({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const i=!!(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(i?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(i?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(i?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(i?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}validateFeature(e){return this.validateModeFeature(e,t=>fl(t,this.coordinatePrecision))}onLeftClick(e){const t={type:"Point",coordinates:[e.lng,e.lat]},i={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:t,properties:i},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Finish}).valid)return;const[n]=this.store.create([{geometry:t,properties:i}]);this.onFinish(n,{mode:this.mode,action:"draw"})}onRightClick(e){if(!this.editable)return;const t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}getNearestPointFeature(e){const t=this.clickBoundingBox.create(e),i=this.store.search(t);let n,r=1/0;for(let s=0;s<i.length;s++){const a=i[s];if(a.geometry.type!=="Point"||a.properties.mode!==this.mode)continue;const l=this.pixelDistance.measure(e,a.geometry.coordinates);l>r||l>this.pointerDistance||(r=l,n=a)}return n}afterFeatureUpdated(e){this.editedFeatureId===e.id&&(this.editedFeatureId=void 0,this.setCursor(this.cursors.create))}}class yl extends be{constructor(e){super(e)}createOrUpdate(e){const t=this.store.getGeometryCopy(e),i=this.store.getPropertiesCopy(e);let n;if(t.type==="Polygon")n=t.coordinates[0].slice(0,-1);else{if(t.type!=="LineString")return;n=t.coordinates}const r=this.store.getPropertiesCopy(e),s=r.coordinatePointIds;if(s)if(s&&s.every(a=>this.store.has(a))){const a=r.coordinatePointIds,l=a.map(d=>this.store.getGeometryCopy(d).coordinates);if(a.length!==n.length){this.deleteCoordinatePoints(a);const d=this.createPoints(n,i.mode,e);this.setFeatureCoordinatePoints(e,d)}else n.forEach((d,c)=>{d[0]===l[c][0]&&d[1]===l[c][1]||this.store.updateGeometry([{id:a[c],geometry:{type:"Point",coordinates:d}}])})}else{const a=s.filter(d=>this.store.has(d));a.length&&this.deleteCoordinatePoints(a);const l=this.createPoints(n,i.mode,e);this.setFeatureCoordinatePoints(e,l)}else{const a=this.createPoints(n,i.mode,e);this.setFeatureCoordinatePoints(e,a)}}deletePointsByFeatureIds(e){for(const t of e)this.deleteIfPresent(t)}getUpdated(e,t){const i=this.store.getPropertiesCopy(e);if(i.coordinatePointIds)return i.coordinatePointIds.map((n,r)=>({id:n,geometry:pe({},this.store.getGeometryCopy(n),{coordinates:t[r]})}))}createPoints(e,t,i){return this.store.create(e.map((n,r)=>({geometry:{type:"Point",coordinates:n},properties:{mode:t,[Co]:!0,[qa]:i,index:r}})))}setFeatureCoordinatePoints(e,t){this.store.updateProperty([{id:e,property:Wt,value:t}])}deleteCoordinatePoints(e){const t=e.filter(i=>this.store.has(i));this.store.delete(t)}deleteIfPresent(e){const t=this.store.getPropertiesCopy(e).coordinatePointIds;t&&(this.deleteCoordinatePoints(t),this.setFeatureCoordinatePoints(e,null))}}function So(o,e){const t=o,i=e,n=ye(t[1]),r=ye(i[1]);let s=ye(i[0]-t[0]);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);const a=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),l=(it(Math.atan2(s,a))+360)%360;return l>180?-(360-l):l}function Ki(o,e,t){let i=e;e<0&&(i=-Math.abs(i));const n=i/Gi,r=o[0]*Math.PI/180,s=ye(o[1]),a=ye(t),l=n*Math.cos(a);let d=s+l;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);const c=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),h=Math.abs(c)>1e-11?l/c:Math.cos(s),u=[(180*(r+n*Math.sin(a)/h)/Math.PI+540)%360-180,180*d/Math.PI];return u[0]+=u[0]-o[0]>180?-360:o[0]-u[0]>180?360:0,u}function bl(o,e,t,i,n){const r=i(o[0],o[1]),s=i(e[0],e[1]),{lng:a,lat:l}=n((r.x+s.x)/2,(r.y+s.y)/2);return[le(a,t),le(l,t)]}function xl(o,e,t){const i=Ki(o,1e3*ze(o,e)/2,So(o,e));return[le(i[0],t),le(i[1],t)]}function mi({featureCoords:o,precision:e,unproject:t,project:i,projection:n}){const r=[];for(let s=0;s<o.length-1;s++){let a;if(n==="web-mercator")a=bl(o[s],o[s+1],e,i,t);else{if(n!=="globe")throw new Error("Invalid projection");a=xl(o[s],o[s+1],e)}r.push(a)}return r}class wl extends be{constructor(e,t,i){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=t,this.coordinatePointBehavior=i}get ids(){return this._midPoints.concat()}set ids(e){}insert(e,t,i){const n=this.store.getGeometryCopy(t),{midPointFeatureId:r,midPointSegment:s}=this.store.getPropertiesCopy(t),a=this.store.getGeometryCopy(r),l=a.type==="Polygon"?a.coordinates[0]:a.coordinates;l.splice(s+1,0,n.coordinates),a.coordinates=a.type==="Polygon"?[l]:l,this.store.updateGeometry([{id:r,geometry:a}]),this.store.getPropertiesCopy(e)[Wt]&&this.coordinatePointBehavior.createOrUpdate(e),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(l,r,i),this.selectionPointBehavior.create(l,a.type,r)}create(e,t,i){if(!this.store.has(t))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create((function(n,r,s,a,l,d){return mi({featureCoords:n,precision:s,project:a,unproject:l,projection:d}).map((c,h)=>({geometry:{type:"Point",coordinates:c},properties:r(h)}))})(e,n=>({mode:this.mode,[he.MID_POINT]:!0,midPointSegment:n,midPointFeatureId:t}),i,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(this._midPoints.length!==0)return mi({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((t,i)=>({id:this._midPoints[i],geometry:{type:"Point",coordinates:t}}))}}class Cl extends be{constructor(e){super(e),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,t,i){this._selectionPoints=this.store.create((function(n,r,s){const a=[],l=r==="Polygon"?n.length-1:n.length;for(let d=0;d<l;d++)a.push({geometry:{type:"Point",coordinates:n[d]},properties:s(d)});return a})(e,t,n=>({mode:this.mode,index:n,[he.SELECTION_POINT]:!0,[he.SELECTION_POINT_FEATURE_ID]:i})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(this._selectionPoints.length!==0)return this._selectionPoints.map((t,i)=>({id:t,geometry:{type:"Point",coordinates:e[i]}}))}getOneUpdated(e,t){if(this._selectionPoints[e]!==void 0)return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}}function qi(o,e){let t=!1;for(let s=0,a=e.length;s<a;s++){const l=e[s];for(let d=0,c=l.length,h=c-1;d<c;h=d++)(n=l[d])[1]>(i=o)[1]!=(r=l[h])[1]>i[1]&&i[0]<(r[0]-n[0])*(i[1]-n[1])/(r[1]-n[1])+n[0]&&(t=!t)}var i,n,r;return t}const ko=(o,e,t)=>{const i=r=>r*r,n=(r,s)=>i(r.x-s.x)+i(r.y-s.y);return Math.sqrt(((r,s,a)=>{const l=n(s,a);if(l===0)return n(r,s);let d=((r.x-s.x)*(a.x-s.x)+(r.y-s.y)*(a.y-s.y))/l;return d=Math.max(0,Math.min(1,d)),n(r,{x:s.x+d*(a.x-s.x),y:s.y+d*(a.y-s.y)})})(o,e,t))};class Pl extends be{constructor(e,t,i){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=t,this.pixelDistance=i}find(e,t){let i,n,r,s,a=1/0,l=1/0,d=1/0;const c=this.createClickBoundingBox.create(e),h=this.store.search(c);for(let u=0;u<h.length;u++){const p=h[u],f=p.geometry;if(f.type==="Point"){if(p.properties.selectionPoint||p.properties.coordinatePoint||!t&&p.properties[he.MID_POINT])continue;const y=this.pixelDistance.measure(e,f.coordinates);p.properties[he.MID_POINT]&&y<this.pointerDistance&&y<d?(d=y,r=p):!p.properties[he.MID_POINT]&&y<this.pointerDistance&&y<a&&(a=y,i=p)}else if(f.type==="LineString"){if(i)continue;for(let y=0;y<f.coordinates.length-1;y++){const I=f.coordinates[y],M=f.coordinates[y+1],k=ko({x:e.containerX,y:e.containerY},this.project(I[0],I[1]),this.project(M[0],M[1]));k<this.pointerDistance&&k<l&&(l=k,n=p)}}else if(f.type==="Polygon"){if(i||n)continue;qi([e.lng,e.lat],f.coordinates)&&(s=p)}}return{clickedFeature:i||n||s,clickedMidPoint:r}}}class Sl extends be{constructor(e,t,i,n,r){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=t,this.selectionPoints=i,this.midPoints=n,this.coordinatePoints=r}startDragging(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(e,t){const{clickedFeature:i}=this.featuresAtCursorEvent.find(e,!0);return!(!i||i.id!==t)}drag(e,t){if(!this.draggedFeatureId)return;const i=this.store.getGeometryCopy(this.draggedFeatureId),n=[e.lng,e.lat];if(i.type==="Polygon"||i.type==="LineString"){let r,s;if(i.type==="Polygon"?(r=i.coordinates[0],s=r.length-1):(r=i.coordinates,s=r.length),!this.dragPosition)return!1;for(let c=0;c<s;c++){const h=r[c];let u,p;if(this.config.projection==="web-mercator"){const f=ae(this.dragPosition[0],this.dragPosition[1]),y=ae(n[0],n[1]),I=ae(h[0],h[1]),M={x:f.x-y.x,y:f.y-y.y},k=I.x-M.x,R=I.y-M.y,{lng:C,lat:b}=nt(k,R);u=C,p=b}else{const f=[this.dragPosition[0]-n[0],this.dragPosition[1]-n[1]];u=h[0]-f[0],p=h[1]-f[1]}if(u=le(u,this.config.coordinatePrecision),p=le(p,this.config.coordinatePrecision),u>180||u<-180||p>90||p<-90)return!1;r[c]=[u,p]}i.type==="Polygon"&&(r[r.length-1]=[r[0][0],r[0][1]]);const a=this.selectionPoints.getUpdated(r)||[],l=this.midPoints.getUpdated(r)||[],d=this.coordinatePoints.getUpdated(this.draggedFeatureId,r)||[];if(t&&!t({type:"Feature",id:this.draggedFeatureId,geometry:i,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:ge.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:i},...a,...l,...d]),this.dragPosition=[e.lng,e.lat]}else i.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:n}}]),this.dragPosition=[e.lng,e.lat])}}class kl extends be{constructor(e,t,i,n,r,s,a){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.lineSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=n,this.coordinatePoints=r,this.coordinateSnapping=s,this.lineSnapping=a}getClosestCoordinate(e,t){const i={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return i;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<i.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);i.dist=s,i.index=a?0:r,i.isFirstOrLastPolygonCoord=a}}return i}getDraggableIndex(e,t){const i=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,i);return n.index===-1?-1:n.index}snapCoordinate(e,t,i){let n=[e.lng,e.lat];const r=s=>!!(s.properties&&s.properties.mode===i.properties.mode&&s.id!==this.draggedCoordinate.id);if(t!=null&&t.toLine){let s;s=this.lineSnapping.getSnappable(e,r).coordinate,s&&(n=s)}if(t.toCoordinate){let s;s=this.coordinateSnapping.getSnappable(e,r).coordinate,s&&(n=s)}if(t!=null&&t.toCustom){let s;s=t.toCustom(e,{currentCoordinate:this.draggedCoordinate.index,currentId:i.id,getCurrentGeometrySnapshot:i.id?()=>this.store.getGeometryCopy(i.id):()=>null,project:this.project,unproject:this.unproject}),s&&(n=s)}return n}drag(e,t,i,n){const r=this.draggedCoordinate.id;if(r===null)return!1;const s=this.draggedCoordinate.index,a=this.store.getGeometryCopy(r),l=this.store.getPropertiesCopy(r),d=a.type==="LineString"?a.coordinates:a.coordinates[0],c=a.type==="Polygon"&&(s===d.length-1||s===0),h={type:"Feature",id:r,geometry:a,properties:l},u=this.snapCoordinate(e,n,h);if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(c){const M=d.length-1;d[0]=u,d[M]=u}else d[s]=u;const p=this.selectionPoints.getOneUpdated(s,u),f=p?[p]:[],y=this.midPoints.getUpdated(d)||[],I=this.coordinatePoints.getUpdated(r,d)||[];return!(a.type!=="Point"&&!t&&tl({geometry:a})||i&&!i(h,{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:ge.Provisional}).valid||(this.store.updateGeometry([{id:r,geometry:a},...f,...y,...I]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}}function vi(o){let e=0,t=0,i=0;return(o.geometry.type==="Polygon"?o.geometry.coordinates[0].slice(0,-1):o.geometry.coordinates).forEach(n=>{e+=n[0],t+=n[1],i++},!0),[e/i,t/i]}const Zi=(o,e)=>{if(e===0||e===360||e===-360)return o;const t=.017453292519943295*e,i=(o.geometry.type==="Polygon"?o.geometry.coordinates[0]:o.geometry.coordinates).map(([s,a])=>ae(s,a)),n=i.reduce((s,a)=>({x:s.x+a.x,y:s.y+a.y}),{x:0,y:0});n.x/=i.length,n.y/=i.length;const r=i.map(s=>({x:n.x+(s.x-n.x)*Math.cos(t)-(s.y-n.y)*Math.sin(t),y:n.y+(s.x-n.x)*Math.sin(t)+(s.y-n.y)*Math.cos(t)})).map(({x:s,y:a})=>[nt(s,a).lng,nt(s,a).lat]);return o.geometry.type==="Polygon"?o.geometry.coordinates[0]=r:o.geometry.coordinates=r,o};function Io(o){const e=(o.geometry.type==="Polygon"?o.geometry.coordinates[0]:o.geometry.coordinates).map(t=>{const{x:i,y:n}=ae(t[0],t[1]);return[i,n]});return o.geometry.type==="Polygon"?(function(t){let i=0,n=0,r=0;const s=t.length;for(let a=0;a<s-1;a++){const[l,d]=t[a],[c,h]=t[a+1],u=l*h-c*d;i+=u,n+=(l+c)*u,r+=(d+h)*u}return i/=2,n/=6*i,r/=6*i,{x:n,y:r}})(e):(function(t){const i=t.length;let n=0,r=0;for(let s=0;s<i;s++){const[a,l]=t[s];n+=a,r+=l}return{x:n/i,y:r/i}})(e)}class Il extends be{constructor(e,t,i,n){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryCentroid=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.config=e,this.selectionPoints=t,this.midPoints=i,this.coordinatePoints=n}reset(){this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.selectedGeometryCentroid=void 0}rotate(e,t,i){this.selectedGeometry||(this.selectedGeometry=this.store.getGeometryCopy(t));const n=this.selectedGeometry;if(n.type!=="Polygon"&&n.type!=="LineString")return;const r=[e.lng,e.lat];let s;const a={type:"Feature",geometry:n,properties:{}};if(this.config.projection==="web-mercator"){this.selectedGeometryWebMercatorCentroid||(this.selectedGeometryWebMercatorCentroid=Io(a));const u=ae(e.lng,e.lat);if(s=ol(this.selectedGeometryWebMercatorCentroid,u),s===0)return;if(!this.lastBearing)return void(this.lastBearing=s);Zi(a,-(this.lastBearing-s))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(this.selectedGeometryCentroid||(this.selectedGeometryCentroid=vi({geometry:n})),s=So(this.selectedGeometryCentroid,r),!this.lastBearing)return void(this.lastBearing=s+180);(function(u,p){if(p===0||p===360||p===-360)return u;const f=vi(u);(u.geometry.type==="Polygon"?u.geometry.coordinates[0]:u.geometry.coordinates).forEach(y=>{const I=So(f,y)+p,M=(function(R,C){R[0]+=R[0]-C[0]>180?-360:C[0]-R[0]>180?360:0;const b=Gi,v=C[1]*Math.PI/180,x=R[1]*Math.PI/180,D=x-v;let S=Math.abs(R[0]-C[0])*Math.PI/180;S>Math.PI&&(S-=2*Math.PI);const B=Math.log(Math.tan(x/2+Math.PI/4)/Math.tan(v/2+Math.PI/4)),A=Math.abs(B)>1e-11?D/B:Math.cos(v);return Math.sqrt(D*D+A*A*S*S)*b})(f,y),k=Ki(f,M,I);y[0]=k[0],y[1]=k[1]})})(a,-(this.lastBearing-(s+180)))}const l=n.type==="Polygon"?n.coordinates[0]:n.coordinates;l.forEach(u=>{u[0]=le(u[0],this.coordinatePrecision),u[1]=le(u[1],this.coordinatePrecision)});const d=this.midPoints.getUpdated(l)||[],c=this.selectionPoints.getUpdated(l)||[],h=this.coordinatePoints.getUpdated(t,l)||[];if(i&&!i({id:t,type:"Feature",geometry:n,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:ge.Provisional}))return!1;this.store.updateGeometry([{id:t,geometry:n},...c,...d,...h]),this.projection==="web-mercator"?this.lastBearing=s:this.projection==="globe"&&(this.lastBearing=s+180)}}class Ml extends be{constructor(e,t){super(e),this.config=void 0,this.dragCoordinateResizeBehavior=void 0,this.config=e,this.dragCoordinateResizeBehavior=t}scale(e,t,i){if(!this.dragCoordinateResizeBehavior.isDragging()){const n=this.dragCoordinateResizeBehavior.getDraggableIndex(e,t);this.dragCoordinateResizeBehavior.startDragging(t,n)}this.dragCoordinateResizeBehavior.drag(e,"center-fixed",i)}reset(){this.dragCoordinateResizeBehavior.stopDragging()}}function Ji({coordinates:o,originX:e,originY:t,xScale:i,yScale:n}){i===1&&n===1||o.forEach(r=>{const{x:s,y:a}=ae(r[0],r[1]),l=e+(s-e)*i,d=t+(a-t)*n,{lng:c,lat:h}=nt(l,d);r[0]=c,r[1]=h})}class _l extends be{constructor(e,t,i,n,r){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=t,this.selectionPoints=i,this.midPoints=n,this.coordinatePoints=r}getClosestCoordinate(e,t){const i={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return i;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<i.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);i.dist=s,i.index=a?0:r,i.isFirstOrLastPolygonCoord=a}}return i}isValidDragWebMercator(e,t,i){switch(e){case 0:if(t<=0||i>=0)return!1;break;case 1:if(i>=0)return!1;break;case 2:if(t>=0||i>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||i<=0)return!1;break;case 5:if(i<=0)return!1;break;case 6:if(t<=0||i<=0)return!1;break;case 7:if(t<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;const t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:i,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=Io(i);if(!a)return null;const l=ae(s[0],s[1]),{closestBBoxIndex:d}=this.getIndexesWebMercator(n,l),c=ae(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:d,updatedCoords:r,webMercatorCursor:c,webMercatorSelected:l,webMercatorOrigin:a}),r}centerFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:i,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=Io(i);if(!a)return null;const l=ae(s[0],s[1]),{closestBBoxIndex:d}=this.getIndexesWebMercator(n,l),c=ae(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:d,updatedCoords:r,webMercatorCursor:c,webMercatorSelected:l,webMercatorOrigin:a}),r}scaleFixedWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:i,webMercatorCursor:n,updatedCoords:r}){if(!this.isValidDragWebMercator(e,t.x-n.x,t.y-n.y))return null;let s=De(t,n)/De(t,i);return s<0&&(s=this.minimumScale),Ji({coordinates:r,originX:t.x,originY:t.y,xScale:s,yScale:s}),r}oppositeFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:i,updatedCoords:n,selectedCoordinate:r}=t,s=ae(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(i,s),d={x:i[a][0],y:i[a][1]},c=ae(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:d}),n}oppositeWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:i,updatedCoords:n,selectedCoordinate:r}=t,s=ae(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(i,s),d={x:i[a][0],y:i[a][1]},c=ae(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:d}),n}scaleWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:i,webMercatorCursor:n,updatedCoords:r}){const s=t.x-n.x,a=t.y-n.y;if(!this.isValidDragWebMercator(e,s,a))return null;let l=1;s!==0&&e!==1&&e!==5&&(l=1-(t.x-i.x-s)/s);let d=1;return a!==0&&e!==3&&e!==7&&(d=1-(t.y-i.y-a)/a),this.validateScale(l,d)?(l<0&&(l=this.minimumScale),d<0&&(d=this.minimumScale),this.performWebMercatorScale(r,t.x,t.y,l,d),r):null}getFeature(e){if(this.draggedCoordinate.id===null)return null;const t=this.store.getGeometryCopy(e);return t.type!=="Polygon"&&t.type!=="LineString"?null:{id:e,type:"Feature",geometry:t,properties:{}}}getNormalisedCoordinates(e){return e.type==="Polygon"?e.coordinates[0]:e.coordinates}validateScale(e,t){const i=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,n=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return i&&n}performWebMercatorScale(e,t,i,n,r){e.forEach(s=>{const{x:a,y:l}=ae(s[0],s[1]),d=t+(a-t)*n,c=i+(l-i)*r,{lng:h,lat:u}=nt(d,c);s[0]=h,s[1]=u})}getBBoxWebMercator(e){const t=[1/0,1/0,-1/0,-1/0];(e=e.map(a=>{const{x:l,y:d}=ae(a[0],a[1]);return[l,d]})).forEach(([a,l])=>{a<t[0]&&(t[0]=a),l<t[1]&&(t[1]=l),a>t[2]&&(t[2]=a),l>t[3]&&(t[3]=l)});const[i,n,r,s]=t;return[[i,s],[(i+r)/2,s],[r,s],[r,s+(n-s)/2],[r,n],[(i+r)/2,n],[i,n],[i,s+(n-s)/2]]}getIndexesWebMercator(e,t){let i,n=1/0;for(let r=0;r<e.length;r++){const s=De({x:t.x,y:t.y},{x:e[r][0],y:e[r][1]});s<n&&(i=r,n=s)}if(i===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[i],closestBBoxIndex:i}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,t){const i=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,i);return n.index===-1?-1:n.index}drag(e,t,i){if(!this.draggedCoordinate.id)return!1;const n=this.getFeature(this.draggedCoordinate.id);if(!n)return!1;let r=null;if(t==="center"?r=this.centerWebMercatorDrag(e):t==="opposite"?r=this.oppositeWebMercatorDrag(e):t==="center-fixed"?r=this.centerFixedWebMercatorDrag(e):t==="opposite-fixed"&&(r=this.oppositeFixedWebMercatorDrag(e)),!r)return!1;for(let c=0;c<r.length;c++){const h=r[c];if(h[0]=le(h[0],this.coordinatePrecision),h[1]=le(h[1],this.coordinatePrecision),!Go(h,this.coordinatePrecision))return!1}const s=this.midPoints.getUpdated(r)||[],a=this.selectionPoints.getUpdated(r)||[],l=this.coordinatePoints.getUpdated(n.id,r)||[],d={type:n.geometry.type,coordinates:n.geometry.type==="Polygon"?[r]:r};return!(i&&!i({id:this.draggedCoordinate.id,type:"Feature",geometry:d,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:ge.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:d},...a,...s,...l]),0))}}const Rl={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},yi={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class Dl extends Qa{constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=Rl,this.cursors=yi,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.lineSnap=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?pe({},this.cursors,e.cursors):yi,(e==null?void 0:e.keyEvents)===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e!=null&&e.keyEvents&&(this.keyEvents=pe({},this.keyEvents,e.keyEvents)),(e==null?void 0:e.dragEventThrottle)!==void 0&&(this.dragEventThrottle=e.dragEventThrottle),(e==null?void 0:e.allowManualDeselection)!==void 0&&(this.allowManualDeselection=e.allowManualDeselection),e!=null&&e.flags){this.flags=pe({},this.flags,e.flags),this.validations={};for(const t in this.flags){const i=this.flags[t].feature;i&&i.validation&&(this.validations[t]=i.validation)}}}selectFeature(e){this.select(e,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new Ht(e),this.clickBoundingBox=new Gt(e),this.featuresAtMouseEvent=new Pl(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new Cl(e),this.coordinatePoints=new yl(e),this.midPoints=new wl(e,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new Po(e,this.pixelDistance,this.clickBoundingBox),this.lineSnap=new Yi(e,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new Il(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new Sl(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new kl(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap,this.lineSnap),this.dragCoordinateResizeFeature=new _l(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new Ml(e,this.dragCoordinateResizeFeature)}deselectFeature(){this.deselect()}deselect(){const e=this.selected.filter(t=>this.store.has(t)).map(t=>({id:t,property:he.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){if(!this.selectionPoints.ids.length)return;let t,i=1/0;if(this.selectionPoints.ids.forEach(u=>{const p=this.store.getGeometryCopy(u),f=this.pixelDistance.measure(e,p.coordinates);f<this.pointerDistance&&f<i&&(i=f,t=this.store.getPropertiesCopy(u))}),!t)return;const n=t.selectionPointFeatureId,r=t.index,s=this.store.getPropertiesCopy(n),a=this.flags[s.mode],l=this.validations[s.mode];if(!(a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.deletable))return;const d=this.store.getGeometryCopy(n);let c;if(d.type==="Polygon"){if(c=d.coordinates[0],c.length<=4)return}else if(d.type==="LineString"&&(c=d.coordinates,c.length<=2))return;if(!c||(d.type!=="Polygon"||r!==0&&r!==c.length-1?c.splice(r,1):(c.shift(),c.pop(),c.push([c[0][0],c[0][1]])),l&&!l({id:n,type:"Feature",geometry:d,properties:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:ge.Commit}).valid))return;const h=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(h),this.store.updateGeometry([{id:n,geometry:d}]),s.coordinatePointIds&&this.coordinatePoints.createOrUpdate(n),this.selectionPoints.create(c,d.type,n),a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.midpoints&&this.midPoints.create(c,n,this.coordinatePrecision)}select(e,t=!0){if(this.selected[0]===e)return;const{mode:i}=this.store.getPropertiesCopy(e),n=this.flags[i];if(!n||!n.feature)return;const r=this.selected[0];if(r){if(r===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:he.SELECTED,value:!0}]),this.onSelect(e);const{type:s,coordinates:a}=this.store.getGeometryCopy(e);if(s!=="LineString"&&s!=="Polygon")return;const l=s==="LineString"?a:a[0];l&&n&&n.feature.coordinates&&(this.selectionPoints.create(l,s,e),n.feature.coordinates.midpoints&&this.midPoints.create(l,e,this.coordinatePrecision))}onLeftClick(e){const{clickedFeature:t,clickedMidPoint:i}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&i)this.midPoints.insert(this.selected[0],i.id,this.coordinatePrecision);else if(t&&t.id)this.select(t.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(t=>e.heldKeys.includes(t))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(t=>e.heldKeys.includes(t))}preventDefaultKeyEvent(e){const t=this.canRotate(e),i=this.canScale(e);(t||i)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;const t=this.selected[0];this.onDeselect(this.selected[0]),this.coordinatePoints.deletePointsByFeatureIds([t]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.selected.length)return;const i=this.store.getPropertiesCopy(this.selected[0]),n=this.flags[i.mode];if(!(n&&n.feature&&(n.feature.draggable||n.feature.coordinates&&n.feature.coordinates.draggable||n.feature.coordinates&&n.feature.coordinates.resizable||n.feature.coordinates&&typeof n.feature.coordinates.midpoints=="object"&&n.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;const r=this.selected[0],s=this.dragCoordinate.getDraggableIndex(e,r);if(n&&n.feature&&n.feature.coordinates&&(n.feature.coordinates.draggable||n.feature.coordinates.resizable)&&s!==-1)return this.setCursor(this.cursors.dragStart),n.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(r,s):this.dragCoordinate.startDragging(r,s),void t(!1);if(n&&n.feature&&n.feature.coordinates&&typeof n.feature.coordinates.midpoints=="object"&&n.feature.coordinates.midpoints.draggable){const{clickedMidPoint:a}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&a){this.midPoints.insert(r,a.id,this.coordinatePrecision);const l=this.dragCoordinate.getDraggableIndex(e,r);return this.dragCoordinate.startDragging(r,l),void t(!1)}}return n&&n.feature&&n.feature.draggable&&this.dragFeature.canDrag(e,r)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,r),void t(!1)):void 0}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e))return;const i=this.selected[0];if(!i)return;const n=this.store.getPropertiesCopy(i),r=this.flags[n.mode],s=(r&&r.feature&&r.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const a=this.validations[n.mode];if(r&&r.feature&&r.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,i,a);if(r&&r.feature&&r.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,i,a);if(this.dragCoordinateResizeFeature.isDragging()&&r.feature&&r.feature.coordinates&&r.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,r.feature.coordinates.resizable,a)}if(this.dragCoordinate.isDragging()){var l;const d=(l=r.feature)==null||(l=l.coordinates)==null?void 0:l.snappable;let c={toCoordinate:!1};return d===!0?c={toCoordinate:!0}:typeof d=="object"&&(c=d),void this.dragCoordinate.drag(e,s,a,c)}this.dragFeature.isDragging()?this.dragFeature.drag(e,a):t(!0)}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&(this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0))}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let t=!1;this.midPoints.ids.forEach(r=>{if(t)return;const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!0)});let i=!1;if(this.selectionPoints.ids.forEach(r=>{const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!1,i=!0)}),t)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:n}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(n&&n.id===this.selected[0]||i)?this.cursors.pointerOver:"unset")}styleFeature(e){const t=pe({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&e.geometry.type==="Point"){if(e.properties.selectionPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties.midPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=50,t}else if(e.properties[he.SELECTED]){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=jt,t;if(e.geometry.type==="LineString")return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=jt,t;if(e.geometry.type==="Point")return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=jt,t}return t}afterFeatureUpdated(e){if(this.selected.length&&e.id===this.selected[0]){var t,i;const n=this.flags[e.properties.mode];if(n==null||(t=n.feature)==null||!t.coordinates)return;const r=e.geometry.type,s=e.id;let a;if(this.selectionPoints.delete(),this.midPoints.delete(),r==="Polygon")a=e.geometry.coordinates[0];else{if(r!=="LineString")return;a=e.geometry.coordinates}this.selectionPoints.create(a,r,s),n!=null&&(i=n.feature)!=null&&(i=i.coordinates)!=null&&i.midpoints&&this.midPoints.create(r==="Polygon"?e.geometry.coordinates[0]:e.geometry.coordinates,s,this.coordinatePrecision)}}}class El extends Yt{constructor(...e){super(...e),this.type=ot.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return pe({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}function Qi(o,e,t,i,n){for(;i>t;){if(i-t>600){const l=i-t+1,d=e-t+1,c=Math.log(l),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(l-h)/l)*(d-l/2<0?-1:1);Qi(o,e,Math.max(t,Math.floor(e-d*h/l+u)),Math.min(i,Math.floor(e+(l-d)*h/l+u)),n)}const r=o[e];let s=t,a=i;for(ft(o,t,e),n(o[i],r)>0&&ft(o,t,i);s<a;){for(ft(o,s,a),s++,a--;n(o[s],r)<0;)s++;for(;n(o[a],r)>0;)a--}n(o[t],r)===0?ft(o,t,a):(a++,ft(o,a,i)),a<=e&&(t=a+1),e<=a&&(i=a-1)}}function ft(o,e,t){const i=o[e];o[e]=o[t],o[t]=i}function Ze(o,e){mt(o,0,o.children.length,e,o)}function mt(o,e,t,i,n){n||(n=Qe([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const s=o.children[r];vt(n,o.leaf?i(s):s)}return n}function vt(o,e){return o.minX=Math.min(o.minX,e.minX),o.minY=Math.min(o.minY,e.minY),o.maxX=Math.max(o.maxX,e.maxX),o.maxY=Math.max(o.maxY,e.maxY),o}function Fl(o,e){return o.minX-e.minX}function Bl(o,e){return o.minY-e.minY}function co(o){return(o.maxX-o.minX)*(o.maxY-o.minY)}function Tt(o){return o.maxX-o.minX+(o.maxY-o.minY)}function zl(o,e){const t=Math.max(o.minX,e.minX),i=Math.max(o.minY,e.minY),n=Math.min(o.maxX,e.maxX),r=Math.min(o.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-i)}function uo(o,e){return o.minX<=e.minX&&o.minY<=e.minY&&e.maxX<=o.maxX&&e.maxY<=o.maxY}function $t(o,e){return e.minX<=o.maxX&&e.minY<=o.maxY&&e.maxX>=o.minX&&e.maxY>=o.minY}function Qe(o){return{children:o,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function bi(o,e,t,i,n){const r=[e,t];for(;r.length;){if((t=r.pop())-(e=r.pop())<=i)continue;const s=e+Math.ceil((t-e)/i/2)*i;Qi(o,s,e,t,n),r.push(e,s,s,t)}}class Ol{constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(e){let t=this.data;const i=[];if(!$t(e,t))return i;const n=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){const a=t.children[s],l=t.leaf?n(a):a;$t(e,l)&&(t.leaf?i.push(a):uo(e,l)?this._all(a,i):r.push(a))}t=r.pop()}return i}collides(e){let t=this.data;if($t(e,t)){const i=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],s=t.leaf?this.toBBox(r):r;if($t(e,s)){if(t.leaf||uo(e,s))return!0;i.push(r)}}t=i.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let i=0;i<e.length;i++)this.insert(e[i]);return}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const i=this.data;this.data=t,t=i}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=Qe([])}remove(e){let t=this.data;const i=this.toBBox(e),n=[],r=[];let s,a,l=!1;for(;t||n.length;){if(t||(t=n.pop(),a=n[n.length-1],s=r.pop(),l=!0),t.leaf){const d=t.children.indexOf(e);d!==-1&&(t.children.splice(d,1),n.push(t),this._condense(n))}l||t.leaf||!uo(t,i)?a?(s++,t=a.children[s],l=!1):t=null:(n.push(t),r.push(s),s=0,a=t,t=t.children[0])}}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}_all(e,t){const i=[];for(;e;)e.leaf?t.push(...e.children):i.push(...e.children),e=i.pop();return t}_build(e,t,i,n){const r=i-t+1;let s,a=this._maxEntries;if(r<=a)return s=Qe(e.slice(t,i+1)),Ze(s,this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,n-1))),s=Qe([]),s.leaf=!1,s.height=n;const l=Math.ceil(r/a),d=l*Math.ceil(Math.sqrt(a));bi(e,t,i,d,this.compareMinX);for(let c=t;c<=i;c+=d){const h=Math.min(c+d-1,i);bi(e,c,h,l,this.compareMinY);for(let u=c;u<=h;u+=l){const p=Math.min(u+l-1,h);s.children.push(this._build(e,u,p,n-1))}}return Ze(s,this.toBBox),s}_chooseSubtree(e,t,i,n){for(;n.push(t),!t.leaf&&n.length-1!==i;){let a,l=1/0,d=1/0;for(let c=0;c<t.children.length;c++){const h=t.children[c],u=co(h),p=(r=e,s=h,(Math.max(s.maxX,r.maxX)-Math.min(s.minX,r.minX))*(Math.max(s.maxY,r.maxY)-Math.min(s.minY,r.minY))-u);p<d?(d=p,l=u<l?u:l,a=h):p===d&&u<l&&(l=u,a=h)}t=a||t.children[0]}var r,s;return t}_insert(e,t,i){const n=i?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),vt(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const i=e[t],n=i.children.length,r=this._minEntries;this._chooseSplitAxis(i,r,n);const s=this._chooseSplitIndex(i,r,n),a=Qe(i.children.splice(s,i.children.length-s));a.height=i.height,a.leaf=i.leaf,Ze(i,this.toBBox),Ze(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(i,a)}_splitRoot(e,t){this.data=Qe([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Ze(this.data,this.toBBox)}_chooseSplitIndex(e,t,i){let n,r=1/0,s=1/0;for(let a=t;a<=i-t;a++){const l=mt(e,0,a,this.toBBox),d=mt(e,a,i,this.toBBox),c=zl(l,d),h=co(l)+co(d);c<r?(r=c,n=a,s=h<s?h:s):c===r&&h<s&&(s=h,n=a)}return n||i-t}_chooseSplitAxis(e,t,i){const n=e.leaf?this.compareMinX:Fl,r=e.leaf?this.compareMinY:Bl;this._allDistMargin(e,t,i,n)<this._allDistMargin(e,t,i,r)&&e.children.sort(n)}_allDistMargin(e,t,i,n){e.children.sort(n);const r=this.toBBox,s=mt(e,0,t,r),a=mt(e,i-t,i,r);let l=Tt(s)+Tt(a);for(let d=t;d<i-t;d++){const c=e.children[d];vt(s,e.leaf?r(c):c),l+=Tt(s)}for(let d=i-t-1;d>=t;d--){const c=e.children[d];vt(a,e.leaf?r(c):c),l+=Tt(a)}return l}_adjustParentBBoxes(e,t,i){for(let n=i;n>=0;n--)vt(t[n],e)}_condense(e){for(let t,i=e.length-1;i>=0;i--)e[i].children.length===0?i>0?(t=e[i-1].children,t.splice(t.indexOf(e[i]),1)):this.clear():Ze(e[i],this.toBBox)}}class Tl{constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new Ol(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}toBBox(e){const t=[],i=[];let n;if(e.geometry.type==="Polygon")n=e.geometry.coordinates[0];else if(e.geometry.type==="LineString")n=e.geometry.coordinates;else{if(e.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");n=[e.geometry.coordinates]}for(let a=0;a<n.length;a++)i.push(n[a][1]),t.push(n[a][0]);const r=Math.min(...i),s=Math.max(...i);return{minX:Math.min(...t),minY:r,maxX:Math.max(...t),maxY:s}}insert(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}load(e){const t=[],i=new Set;e.forEach(n=>{const r=this.toBBox(n);if(this.setMaps(n,r),i.has(String(n.id)))throw new Error(`Duplicate feature ID found ${n.id}`);i.add(String(n.id)),t.push(r)}),this.tree.load(t)}update(e){this.remove(e.id);const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}remove(e){const t=this.idToNode.get(e);if(!t)throw new Error(`${e} not inserted into the spatial index`);this.tree.remove(t)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(t=>this.nodeToId.get(t))}collides(e){return this.tree.collides(this.toBBox(e))}}const $l={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(o){const e=16*Math.random()|0;return(o=="x"?e:3&e|8).toString(16)}),isValidId:o=>typeof o=="string"&&o.length===36};class Ll{constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new Tl,this.tracked=!e||e.tracked!==!1,this.idStrategy=e&&e.idStrategy?e.idStrategy:$l}clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,t,i,n){if(e.length===0)return[];let r=this.clone(e);const s=[],a=[];return r=r.filter(l=>{l.id==null&&(l.id=this.idStrategy.getId());const d=l.id;if(t){const c=t(l);if(!c.valid)return a.push({id:d,valid:!1,reason:c.reason}),!1}if(this.tracked){if(l.properties.createdAt){if(!li(l.properties.createdAt))return a.push({id:l.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else l.properties.createdAt=+new Date;if(l.properties.updatedAt){if(!li(l.properties.updatedAt))return a.push({id:l.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else l.properties.updatedAt=+new Date}return this.has(d)?(a.push({id:d,valid:!1,reason:`Feature already exists with this id: ${d}`}),!1):(this.store[d]=l,s.push(d),i&&i(l),a.push({id:d,valid:!0}),!0)}),this.spatialIndex.load(r),s.length>0&&this._onChange(s,"create",n),a}search(e,t){const i=this.spatialIndex.search(e).map(n=>this.store[n]);return this.clone(t?i.filter(t):i)}registerOnChange(e){this._onChange=(t,i,n)=>{e(t,i,n)}}getGeometryCopy(e){const t=this.store[e];if(!t)throw new Error(`No feature with this id (${e}), can not get geometry copy`);return this.clone(t.geometry)}getPropertiesCopy(e){const t=this.store[e];if(!t)throw new Error(`No feature with this id (${e}), can not get properties copy`);return this.clone(t.properties)}updateProperty(e,t){const i=[];e.forEach(({id:n,property:r,value:s})=>{const a=this.store[n];if(!a)throw new Error(`No feature with this (${n}), can not update geometry`);i.push(n),s===void 0?delete a.properties[r]:a.properties[r]=s,this.tracked&&(a.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}updateGeometry(e,t){const i=[];e.forEach(({id:n,geometry:r})=>{i.push(n);const s=this.store[n];if(!s)throw new Error(`No feature with this (${n}), can not update geometry`);s.geometry=this.clone(r),this.spatialIndex.update(s),this.tracked&&(s.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i,"update",t)}create(e,t){const i=[];return e.forEach(({geometry:n,properties:r})=>{let s,a=pe({},r);this.tracked&&(s=+new Date,r?(a.createdAt=typeof r.createdAt=="number"?r.createdAt:s,a.updatedAt=typeof r.updatedAt=="number"?r.updatedAt:s):a={createdAt:s,updatedAt:s});const l=this.getId(),d={id:l,type:"Feature",geometry:n,properties:a};this.store[l]=d,this.spatialIndex.insert(d),i.push(l)}),this._onChange&&this._onChange([...i],"create",t),i}delete(e,t){e.forEach(i=>{if(!this.store[i])throw new Error(`No feature with id ${i}, can not delete`);delete this.store[i],this.spatialIndex.remove(i)}),this._onChange&&this._onChange([...e],"delete",t)}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}copyAllWhere(e){return this.clone(Object.keys(this.store).map(t=>this.store[t]).filter(t=>t.properties&&e(t.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}}class Je{constructor({name:e,callback:t,unregister:i,register:n}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,n(t))},this.unregister=()=>{this.register&&(this.registered=!1,i(t))},this.callback=t}}var jl={__proto__:null,TerraDrawBaseAdapter:class{constructor(o){this._nextKeyUpIsContextMenu=!1,this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof o.minPixelDragDistance=="number"?o.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof o.minPixelDragDistanceSelecting=="number"?o.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof o.minPixelDragDistanceDrawing=="number"?o.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof o.coordinatePrecision=="number"?o.coordinatePrecision:9}getButton(o){return o.button===-1?"neither":o.button===0?"left":o.button===1?"middle":o.button===2?"right":"neither"}getMapElementXYPosition(o){const e=this.getMapEventElement(),{left:t,top:i}=e.getBoundingClientRect();return{containerX:o.clientX-t,containerY:o.clientY-i}}getDrawEventFromEvent(o,e=!1){const t=this.getLngLatFromEvent(o);if(!t)return null;const{lng:i,lat:n}=t,{containerX:r,containerY:s}=this.getMapElementXYPosition(o),a=this.getButton(o),l=Array.from(this._heldKeys);return{lng:le(i,this._coordinatePrecision),lat:le(n,this._coordinatePrecision),containerX:r,containerY:s,button:a,heldKeys:l,isContextMenu:e}}register(o){this._currentModeCallbacks=o,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new Je({name:"pointerdown",callback:o=>{if(!this._currentModeCallbacks||!o.isPrimary)return;const e=this.getDrawEventFromEvent(o);e&&(this._dragState="pre-dragging",this._lastDrawEvent=e)},register:o=>{this.getMapEventElement().addEventListener("pointerdown",o)},unregister:o=>{this.getMapEventElement().removeEventListener("pointerdown",o)}}),new Je({name:"pointermove",callback:o=>{if(!this._currentModeCallbacks||!o.isPrimary)return;o.preventDefault();const e=this.getDrawEventFromEvent(o);if(e)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e),this._lastDrawEvent=e;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const t={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},i={x:e.containerX,y:e.containerY},n=this._currentModeCallbacks.getState(),r=De(t,i);let s=!1;if(s=n==="drawing"?r<this._minPixelDragDistanceDrawing:n==="selecting"?r<this._minPixelDragDistanceSelecting:r<this._minPixelDragDistance,s)return;this._nextKeyUpIsContextMenu=!1,this._dragState="dragging",this._currentModeCallbacks.onDragStart(e,a=>{this.setDraggability.bind(this)(a)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e,t=>{this.setDraggability.bind(this)(t)})},register:o=>{this.getMapEventElement().addEventListener("pointermove",o)},unregister:o=>{this.getMapEventElement().removeEventListener("pointermove",o)}}),new Je({name:"contextmenu",callback:o=>{this._currentModeCallbacks&&(o.preventDefault(),this._nextKeyUpIsContextMenu=!0)},register:o=>{this.getMapEventElement().addEventListener("contextmenu",o)},unregister:o=>{this.getMapEventElement().removeEventListener("contextmenu",o)}}),new Je({name:"pointerup",callback:o=>{if(!this._currentModeCallbacks||o.target!==this.getMapEventElement()||!o.isPrimary)return;const e=this.getDrawEventFromEvent(o);e&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e,t=>{this.setDraggability.bind(this)(t)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||(this._nextKeyUpIsContextMenu&&(e.isContextMenu=!0,this._nextKeyUpIsContextMenu=!1),this._currentModeCallbacks.onClick(e)),this._dragState="not-dragging",this.setDraggability(!0))},register:o=>{this.getMapEventElement().addEventListener("pointerup",o)},unregister:o=>{this.getMapEventElement().removeEventListener("pointerup",o)}}),new Je({name:"keyup",callback:o=>{this._currentModeCallbacks&&(this._heldKeys.delete(o.key),this._currentModeCallbacks.onKeyUp({key:o.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>o.preventDefault()}))},register:o=>{this.getMapEventElement().addEventListener("keyup",o)},unregister:o=>{this.getMapEventElement().removeEventListener("keyup",o)}}),new Je({name:"keydown",callback:o=>{this._currentModeCallbacks&&(this._heldKeys.add(o.key),this._currentModeCallbacks.onKeyDown({key:o.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>o.preventDefault()}))},register:o=>{this.getMapEventElement().addEventListener("keydown",o)},unregister:o=>{this.getMapEventElement().removeEventListener("keydown",o)}})]}unregister(){this._listeners.forEach(o=>{o.unregister()}),this.clear(),this._currentModeCallbacks=void 0}}};class Nl{constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new El;const t=new Set,i=e.modes.reduce((c,h)=>{if(t.has(h.mode))throw new Error(`There is already a ${h.mode} mode provided`);return t.add(h.mode),c[h.mode]=h,c},{}),n=Object.keys(i);if(n.length===0)throw new Error("No modes provided");n.forEach(c=>{if(i[c].type===ot.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=c}}),this._modes=pe({},i,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new Ll({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});const r=c=>{const h=[],u=this._store.copyAll().filter(p=>!c.includes(p.id)||(h.push(p),!1));return{changed:h,unchanged:u}},s=(c,h)=>{this._enabled&&this._eventListeners.finish.forEach(u=>{u(c,h)})},a=(c,h,u)=>{if(!this._enabled)return;this._eventListeners.change.forEach(y=>{y(c,h,u)});const{changed:p,unchanged:f}=r(c);h==="create"?this._adapter.render({created:p,deletedIds:[],unchanged:f,updated:[]},this.getModeStyles()):h==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:f,updated:p},this.getModeStyles()):h==="delete"?this._adapter.render({created:[],deletedIds:c,unchanged:f,updated:[]},this.getModeStyles()):h==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:f,updated:[]},this.getModeStyles())},l=c=>{if(!this._enabled)return;this._eventListeners.select.forEach(p=>{p(c)});const{changed:h,unchanged:u}=r([c]);this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())},d=c=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(p=>{p()});const{changed:h,unchanged:u}=r([c]);h&&this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())};Object.keys(this._modes).forEach(c=>{this._modes[c].register({mode:c,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:a,onSelect:l,onDeselect:d,onFinish:s,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const e={};return Object.keys(this._modes).forEach(t=>{e[t]=i=>this._instanceSelectMode&&i.properties[he.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(i):this._modes[t].styleFeature.bind(this._modes[t])(i)}),e}featuresAtLocation({lng:e,lat:t},i){const n=i&&i.pointerDistance!==void 0?i.pointerDistance:30,r=!i||i.ignoreSelectFeatures===void 0||i.ignoreSelectFeatures,s=!(!i||i.ignoreCoordinatePoints===void 0)&&i.ignoreCoordinatePoints,a=!(!i||i.ignoreCurrentlyDrawing===void 0)&&i.ignoreCurrentlyDrawing,l=!(!i||i.ignoreClosingPoints===void 0)&&i.ignoreClosingPoints,d=this._adapter.unproject.bind(this._adapter),c=this._adapter.project.bind(this._adapter),h=c(e,t),u=Xi({unproject:d,point:h,pointerDistance:n});return this._store.search(u).filter(p=>{if(r&&(p.properties[he.MID_POINT]||p.properties[he.SELECTION_POINT])||s&&p.properties[Co]||l&&p.properties[Wi]||a&&p.properties[wo])return!1;if(p.geometry.type==="Point"){const f=p.geometry.coordinates,y=c(f[0],f[1]);return De(h,y)<n}if(p.geometry.type==="LineString"){const f=p.geometry.coordinates;for(let y=0;y<f.length-1;y++){const I=f[y],M=f[y+1];if(ko(h,c(I[0],I[1]),c(M[0],M[1]))<n)return!0}return!1}if(qi([e,t],p.geometry.coordinates))return!0;if(i!=null&&i.includePolygonsWithinPointerDistance){const f=p.geometry.coordinates;for(const y of f)for(let I=0;I<y.length-1;I++){const M=y[I],k=y[I+1],R=c(M[0],M[1]),C=c(k[0],k[1]);if(ko(h,R,C)<n)return!0}}return!1})}getSelectModeOrThrow(){const e=this.getSelectMode({switchToSelectMode:!0});if(!e)throw new Error("No select mode defined in instance");return e}getSelectMode({switchToSelectMode:e}){if(this.checkEnabled(),!this._instanceSelectMode)return null;const t=this.getMode();return e&&t!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}isGuidanceFeature(e){return!!(e.properties[he.MID_POINT]||e.properties[he.SELECTION_POINT]||e.properties[Co]||e.properties[Vi])}setModeStyles(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=t}updateModeOptions(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(t)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}getModeState(){return this._mode.state}setMode(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled();const t=[];e.forEach(i=>{if(!this._store.has(i))throw new Error(`No feature with id ${i}, can not delete`);const n=this._store.copy(i);n.properties[he.SELECTED]&&this.deselectFeature(i),n.properties[Wt]&&t.push(...n.properties[Wt])}),this._store.delete([...e,...t],{origin:"api"})}selectFeature(e){this.getSelectModeOrThrow().selectFeature(e)}deselectFeature(e){this.getSelectModeOrThrow().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}updateFeatureGeometry(e,t){if(!this._store.has(e))throw new Error(`No feature with id ${e} present in store`);const i=this._store.copy(e);if(this.isGuidanceFeature(i))throw new Error("Guidance features are not allowed to be updated directly.");if(!(i&&t&&t.type&&t.coordinates))throw new Error("Invalid geometry provided");if(t.type!==i.geometry.type)throw new Error(`Geometry type mismatch: expected ${i.geometry.type}, got ${t.type}`);const n=i.properties.mode,r=this._modes[n];if(!r)throw new Error(`No mode with name ${n} present in instance`);const s=pe({},i,{geometry:t}),a=r.validateFeature(s);if(!a.valid)throw new Error(`Feature validation failed: ${a.reason||"Unknown reason"}`);if(this._store.updateGeometry([{id:i.id,geometry:t}],{origin:"api"}),r.afterFeatureUpdated){r.afterFeatureUpdated(s);const l=s.properties[he.SELECTED],d=this.getSelectMode({switchToSelectMode:!1});d&&l&&d.afterFeatureUpdated(s)}}transformFeatureGeometry(e,t){if(!this._store.has(e))throw new Error(`No feature with id ${e} present in store`);let i=this._store.copy(e);if(this.isGuidanceFeature(i))throw new Error("Guidance features are not allowed to be updated directly.");const n=i.properties.mode,r=this._modes[n];if(!r)throw new Error(`No mode with name ${n} present in instance`);let s;if(i.geometry.type==="Polygon")s=i.geometry.coordinates[0];else{if(i.geometry.type!=="LineString")throw new Error(`Feature geometry type ${i.geometry.type} is not supported for transformation`);s=i.geometry.coordinates}if(t.projection!="web-mercator")throw new Error(`Projection ${t.projection} is not currently supported for transformation`);if(t.type==="scale"){const{x:a,y:l}=ae(t.origin[0],t.origin[1]);Ji({coordinates:s,originX:a,originY:l,xScale:t.options.xScale||1,yScale:t.options.yScale||1})}else t.type==="rotate"&&(i=Zi(i,t.options.angle||0),s=i.geometry.type==="Polygon"?i.geometry.coordinates[0]:i.geometry.coordinates);if(s=s.map(a=>[le(a[0],this._adapter.getCoordinatePrecision()),le(a[1],this._adapter.getCoordinatePrecision())]),i.geometry.coordinates=i.geometry.type==="Polygon"?[s]:s,this._store.updateGeometry([{id:i.id,geometry:i.geometry}],{origin:"api"}),r.afterFeatureUpdated){r.afterFeatureUpdated(i);const a=i.properties[he.SELECTED],l=this.getSelectMode({switchToSelectMode:!1});l&&a&&l.afterFeatureUpdated(i)}}addFeatures(e){return this.checkEnabled(),e.length===0?[]:this._store.load(e,t=>{if(ai(t)){const i=t.properties.mode,n=this._modes[i];if(!n)return{id:t.id,valid:!1,reason:`${i} mode is not in the list of instantiated modes`};const r=n.validateFeature.bind(n)(t);return{id:t.id,valid:r.valid,reason:r.reason?r.reason:r.valid?void 0:"Feature is invalid"}}return{id:t.id,valid:!1,reason:"Mode property does not exist"}},t=>{if(ai(t)){const i=this._modes[t.properties.mode];i&&i.afterFeatureAdded&&i.afterFeatureAdded(t)}},{origin:"api"})}start(){this._enabled||(this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,t)=>{this._mode.onDragStart(e,t)},onDrag:(e,t)=>{this._mode.onDrag(e,t)},onDragEnd:(e,t)=>{this._mode.onDragEnd(e,t)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}}))}getFeaturesAtLngLat(e,t){const{lng:i,lat:n}=e;return this.featuresAtLocation({lng:i,lat:n},t)}getFeaturesAtPointerEvent(e,t){const i=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return i===null?[]:this.featuresAtLocation(i,t)}stop(){this._enabled&&(this._enabled=!1,this._adapter.unregister())}on(e,t){const i=this._eventListeners[e];i.includes(t)||i.push(t)}off(e,t){const i=this._eventListeners[e];i.includes(t)&&i.splice(i.indexOf(t),1)}}class Al extends jl.TerraDrawBaseAdapter{constructor(e){super(e),this._renderBeforeLayerId=void 0,this._prefixId=void 0,this._initialDragPan=void 0,this._initialDragRotate=void 0,this._nextRender=void 0,this._map=void 0,this._container=void 0,this.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},this._map=e.map,this._container=this._map.getContainer(),this._initialDragRotate=this._map.dragRotate.isEnabled(),this._initialDragPan=this._map.dragPan.isEnabled(),this._renderBeforeLayerId=e.renderBelowLayerId,this._prefixId=e.prefixId||"td"}_addGeoJSONSource(e,t){this._map.addSource(e,{type:"geojson",data:{type:"FeatureCollection",features:t},tolerance:0})}_addFillLayer(e){return this._map.addLayer({id:e,source:e,type:"fill",layout:{"fill-sort-key":["get","zIndex"]},paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})}_addFillOutlineLayer(e){return this._map.addLayer({id:e+"-outline",source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})}_addLineLayer(e){return this._map.addLayer({id:e,source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})}_addPointLayer(e){return this._map.addLayer({id:e,source:e,type:"circle",layout:{"circle-sort-key":["get","zIndex"]},paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})}_addLayer(e,t){t==="Point"&&this._addPointLayer(e),t==="LineString"&&this._addLineLayer(e),t==="Polygon"&&(this._addFillLayer(e),this._addFillOutlineLayer(e))}_addGeoJSONLayer(e,t){const i=`${this._prefixId}-${e.toLowerCase()}`;return this._addGeoJSONSource(i,t),this._addLayer(i,e),i}_setGeoJSONLayerData(e,t){const i=`${this._prefixId}-${e.toLowerCase()}`;return this._map.getSource(i).setData({type:"FeatureCollection",features:t}),i}updateChangedIds(e){[...e.updated,...e.created].forEach(t=>{t.geometry.type==="Point"?this.changedIds.points=!0:t.geometry.type==="LineString"?this.changedIds.linestrings=!0:t.geometry.type==="Polygon"&&(this.changedIds.polygons=!0)}),e.deletedIds.length>0&&(this.changedIds.deletion=!0),e.created.length===0&&e.updated.length===0&&e.deletedIds.length===0&&(this.changedIds.styling=!0)}getLngLatFromEvent(e){const{left:t,top:i}=this._container.getBoundingClientRect();return this.unproject(e.clientX-t,e.clientY-i)}getMapEventElement(){return this._map.getCanvas()}setDraggability(e){e?(this._initialDragRotate&&this._map.dragRotate.enable(),this._initialDragPan&&this._map.dragPan.enable()):(this._initialDragRotate&&this._map.dragRotate.disable(),this._initialDragPan&&this._map.dragPan.disable())}project(e,t){const{x:i,y:n}=this._map.project({lng:e,lat:t});return{x:i,y:n}}unproject(e,t){const{lng:i,lat:n}=this._map.unproject({x:e,y:t});return{lng:i,lat:n}}setCursor(e){const t=this._map.getCanvas();e==="unset"?t.style.removeProperty("cursor"):t.style.cursor=e}setDoubleClickToZoom(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}render(e,t){this.updateChangedIds(e),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(()=>{if(!this._currentModeCallbacks)return;const i=[...e.created,...e.updated,...e.unchanged],n=[],r=[],s=[];for(let c=0;c<i.length;c++){const h=i[c],{properties:u}=h,p=t[u.mode](h);h.geometry.type==="Point"?(u.pointColor=p.pointColor,u.pointOutlineColor=p.pointOutlineColor,u.pointOutlineWidth=p.pointOutlineWidth,u.pointWidth=p.pointWidth,u.zIndex=p.zIndex,n.push(h)):h.geometry.type==="LineString"?(u.lineStringColor=p.lineStringColor,u.lineStringWidth=p.lineStringWidth,r.push(h)):h.geometry.type==="Polygon"&&(u.polygonFillColor=p.polygonFillColor,u.polygonFillOpacity=p.polygonFillOpacity,u.polygonOutlineColor=p.polygonOutlineColor,u.polygonOutlineWidth=p.polygonOutlineWidth,s.push(h))}const a=this.changedIds.deletion||this.changedIds.styling,l=a||this.changedIds.linestrings,d=a||this.changedIds.polygons;(a||this.changedIds.points)&&this._setGeoJSONLayerData("Point",n),l&&this._setGeoJSONLayerData("LineString",r),d&&this._setGeoJSONLayerData("Polygon",s),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0),this._setGeoJSONLayerData("Point",[]),this._setGeoJSONLayerData("LineString",[]),this._setGeoJSONLayerData("Polygon",[]))}getCoordinatePrecision(){return super.getCoordinatePrecision()}unregister(){super.unregister(),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1},this._map.removeLayer(`${this._prefixId}-point`),this._map.removeSource(`${this._prefixId}-point`),this._map.removeLayer(`${this._prefixId}-linestring`),this._map.removeSource(`${this._prefixId}-linestring`),this._map.removeLayer(`${this._prefixId}-polygon`),this._map.removeLayer(`${this._prefixId}-polygon-outline`),this._map.removeSource(`${this._prefixId}-polygon`)}register(e){var t;super.register(e);const i=this._addGeoJSONLayer("Polygon",[]),n=this._addGeoJSONLayer("LineString",[]),r=this._addGeoJSONLayer("Point",[]);this._renderBeforeLayerId&&(this._map.moveLayer(r,this._renderBeforeLayerId),this._map.moveLayer(n,r),this._map.moveLayer(i+"-outline",n),this._map.moveLayer(i,n)),(t=this._currentModeCallbacks)!=null&&t.onReady&&this._currentModeCallbacks.onReady()}}const ue=[];for(let o=0;o<256;++o)ue.push((o+256).toString(16).slice(1));function Ul(o,e=0){return(ue[o[e+0]]+ue[o[e+1]]+ue[o[e+2]]+ue[o[e+3]]+"-"+ue[o[e+4]]+ue[o[e+5]]+"-"+ue[o[e+6]]+ue[o[e+7]]+"-"+ue[o[e+8]]+ue[o[e+9]]+"-"+ue[o[e+10]]+ue[o[e+11]]+ue[o[e+12]]+ue[o[e+13]]+ue[o[e+14]]+ue[o[e+15]]).toLowerCase()}let ho;const Wl=new Uint8Array(16);function Vl(){if(!ho){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ho=crypto.getRandomValues.bind(crypto)}return ho(Wl)}const Gl=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),xi={randomUUID:Gl};function Kt(o,e,t){var n;if(xi.randomUUID&&!o)return xi.randomUUID();o=o||{};const i=o.random??((n=o.rng)==null?void 0:n.call(o))??Vl();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,Ul(i)}function ve(){return{name:"Untitled",description:"A new geographic item",creation_timestamp:Date.now(),modification_timestamp:Date.now(),created_by:"anonymous",modified_by:"anonymous",tags:[]}}class yt{constructor(e=[],t=Kt(),i=ve()){Ce(this,"id");Ce(this,"meta");Ce(this,"routesInternal");this.id=t,this.meta=i||ve(),this.routesInternal=e}get name(){return this.meta||(this.meta=ve()),this.meta.name}set name(e){this.meta||(this.meta=ve()),this.meta.name=e}get routes(){return Me(this.routesInternal)}set routes(e){this.routesInternal=Me(e)}findRoute(e){return this.routesInternal.find(t=>t.id===e)}existRoute(e){return this.routesInternal.some(t=>t.id===e)}addRoute(e){if(this.existRoute(e.id))throw new Error(`[CartoSketch.Route] Route ${e.id} already exist`);this.routesInternal.push(Me(e)),this.updateModificationTime()}updateRoute(e){const t=this.routesInternal.findIndex(i=>i.id===e.id);if(t===-1)throw new Error(`[CartoSketch.Route] Route ${e.id} not found`);this.routesInternal[t]=Me(e),this.updateModificationTime()}removeRoute(e){const t=this.routesInternal.findIndex(i=>i.id===e);t!==-1&&(this.routesInternal.splice(t,1),this.updateModificationTime())}updateModificationTime(){this.meta.modification_timestamp=Date.now()}exportAsGeoJSON(){return{type:"FeatureCollection",features:this.routesInternal.map(e=>e.exportAsGeoJSON()),properties:this.meta}}exportToStorage(){return JSON.parse(JSON.stringify({id:this.id,meta:this.meta,routes:this.routesInternal.map(e=>e.exportToStorage())}))}}class Mo{constructor(e=Kt(),t=[],i={},n=ve()){Ce(this,"id");Ce(this,"meta");Ce(this,"properties");Ce(this,"points");this.id=e,this.meta=n||ve(),this.properties=i,this.points=t}get name(){return this.meta||(this.meta=ve()),this.meta.name}set name(e){this.meta||(this.meta=ve()),this.meta.name=e}setPoints(e){this.points=Me(e),this.updateModificationTime()}appendPoint(e){this.points.push(Me(e)),this.updateModificationTime()}getPoints(){return Me(this.points)}setProperties(e){const t=Me(e);Object.assign(this.properties,t),this.updateModificationTime()}updateModificationTime(){this.meta.modification_timestamp=Date.now()}exportAsGeoJSON(){return{type:"Feature",properties:{...this.properties,...this.meta,description:JSON.stringify({name:this.meta.name,id:this.id})},geometry:{type:"LineString",coordinates:this.points.map(e=>[e.longitude,e.latitude])}}}exportToStorage(){return Me({id:this.id,meta:this.meta,properties:this.properties,points:this.points})}}function Hl(o){if(!o)throw new Error("[importItemFromStorage] Invalid data provided");const e=new Mo(o.id||Kt(),o.points||[],o.properties||{},o.meta);return o.meta&&(e.meta=o.meta),e}function Xl(o){if(!o)throw new Error("[readCollectionFromStorage] Invalid data provided");const e=(o.routes||[]).map(i=>Hl(i)),t=new yt(e,o.id||Kt(),o.meta);return o.meta&&(t.meta=o.meta),t}const en=Pr("routes",()=>{const o=F(null),e=F(null),t=z(()=>o.value?o.value.routes.map(h=>({id:h.id,name:h.name,points:h.getPoints()})):[]);async function i(){const h=await Sr("routes");if(h)if(Array.isArray(h)){const u=ve();u.name="Default Routes";const p=new yt([],void 0,u);console.info("[RouteStore] Migrating old route data to new format");for(const f of h)if(f&&typeof f=="object"&&"id"in f&&"name"in f&&"points"in f&&Array.isArray(f.points)){const y=f,I=ve();I.name=y.name||"Untitled Route";const M=new Mo(y.id,y.points,{},I);p.addRoute(M)}else console.warn("[RouteStore] Invalid route data:",f);o.value=p,await Ne("routes",o.value.exportToStorage()),await Ae(),console.info("[RouteStore] Route Migration complete")}else if(h&&typeof h=="object"&&"id"in h&&"routes"in h)o.value=Xl(h);else{const u=ve();u.name="Default Routes",o.value=new yt([],void 0,u),await Ne("routes",o.value.exportToStorage()),await Ae()}else{const u=ve();u.name="Default Routes",o.value=new yt([],void 0,u)}}async function n(h,u={}){if(!o.value){const y=ve();y.name="Default Routes",o.value=new yt([],void 0,y)}const p=ve();p.name=h;const f=new Mo(void 0,[],u,p);return o.value.addRoute(f),await Ne("routes",o.value.exportToStorage()),await Ae(),f}async function r(h){o.value&&(o.value.removeRoute(h),e.value===h&&(e.value=null),await Ne("routes",o.value.exportToStorage()),await Ae())}async function s(h,u){if(!o.value)return;const p=o.value.findRoute(h);p&&(p.appendPoint(u),await Ne("routes",o.value.exportToStorage()),await Ae())}async function a(h,u){if(!o.value)return;const p=o.value.findRoute(h);p&&(u.name!==void 0&&(p.name=u.name),u.properties!==void 0&&p.setProperties(u.properties),await Ne("routes",o.value.exportToStorage()),await Ae())}async function l(h){if(!o.value)return;const u=o.value.findRoute(h);u&&(u.setPoints([]),await Ne("routes",o.value.exportToStorage()),await Ae())}function d(h){return o.value?o.value.findRoute(h)??null:null}function c(h){e.value=h}return{routeCollection:o,routes:t,currentRouteId:e,init:i,addRoute:n,deleteRoute:r,addPointToRoute:s,updateRoute:a,clearRoutePoints:l,getRouteById:d,setCurrentRouteId:c}});function Yl(o,e,t){const i=new Blob([o],{type:e}),n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(i),n.dataset.downloadurl=[e,n.download,n.href].join(":"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{URL.revokeObjectURL(n.href)},1500)}const Kl={class:"upload-container"},ql={class:"action-buttons"},Zl=L({__name:"TextFileUploaderDialog",props:He({multiple:{type:Boolean},icon:{},prompt:{},types:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:He(["update:value","confirm"],["update:show"]),setup(o,{emit:e}){const t=Fi(),i=o,n=e,r=Ct(o,"show");let s=[];const a=c=>{s=[];for(const h of c){const u=h.file;if(u)if(i.types.includes(u.type)){const p=new FileReader;p.onload=f=>{var y;(y=f.target)!=null&&y.result&&s.push(f.target.result),s.length===c.length&&n("update:value",s)},p.readAsText(u)}else t.warning(`Skipped file ${h.name} due to unsupported type ${u.type}`)}},l=()=>{n("confirm",s),r.value=!1},d=c=>{var h,u;return i.types.includes(((h=c.file.file)==null?void 0:h.type)??"")?!0:(t.error(`Unsupported file type ${((u=c.file.file)==null?void 0:u.type)??"unknown"}. Supported types: ['${i.types.join("', '")}']`),!1)};return(c,h)=>(H(),_e(_(Si),{show:r.value,"onUpdate:show":h[2]||(h[2]=u=>r.value=u),preset:"dialog",title:"Dialog"},{header:X(()=>[...h[3]||(h[3]=[Lt(" File Upload ",-1)])]),default:X(()=>[T("div",Kl,[W(_(Ma),{multiple:i.multiple??!1,onChange:h[0]||(h[0]=({fileList:u})=>a(u)),onBeforeUpload:d},{default:X(()=>[W(_(zi),null,{default:X(()=>[W(_(Ee),{size:36,name:"upload",class:"upload-icon"},{default:X(()=>[(H(),_e(po(i.icon??_(Ri))))]),_:1}),T("div",null,ke(i.prompt??"Drag and drop a file here or click to upload"),1)]),_:1})]),_:1},8,["multiple"])])]),action:X(()=>[T("div",ql,[W(_(Ve),{onClick:h[1]||(h[1]=u=>r.value=!1)},{default:X(()=>[...h[4]||(h[4]=[Lt(" Cancel ",-1)])]),_:1}),W(_(Ve),{type:"primary",onClick:l},{default:X(()=>[...h[5]||(h[5]=[Lt(" Upload ",-1)])]),_:1})])]),_:1},8,["show"]))}}),Jl=St(Zl,[["__scopeId","data-v-14c5a0c1"]]),Ql=L({__name:"MglDrawer",props:He({position:{}},{show:{type:Boolean,default:!1},showModifiers:{}}),emits:He(["update:width","update:height","click","contextmenu"],["update:show"]),setup(o,{emit:e}){Eo(u=>({a1b7bba2:_(n).modalColor,"305889d2":_(n).borderRadius,"60287bc6":c.value,"048a7f4c":d.value}));const t=o,i=e,n=Ao(),r=kr("route-drawer"),s=z(()=>t.position||"left"),a=z(()=>{var u,p,f,y;return Math.min(bo(Math.round((((p=(u=r.value)==null?void 0:u.parentElement)==null?void 0:p.clientWidth)??2e3)*.4),320,640),(((y=(f=r.value)==null?void 0:f.parentElement)==null?void 0:y.clientWidth)??1/0)-48)}),l=z(()=>{var u,p,f,y;return Math.min(bo(Math.round((((p=(u=r.value)==null?void 0:u.parentElement)==null?void 0:p.clientHeight)??2e3)*.4),320,640),(((y=(f=r.value)==null?void 0:f.parentElement)==null?void 0:y.clientHeight)??1/0)-48)}),d=z(()=>s.value==="left"?`${-16-a.value}px`:s.value==="right"?`${16+a.value}px`:s.value==="top"?`${-16-l.value}px`:s.value==="bottom"?`${16+l.value}px`:"0px"),c=z(()=>s.value==="left"||s.value==="right"?`${a.value}px`:`${l.value}px`),h=Ct(o,"show");return G(a,()=>i("update:width",a.value)),G(l,()=>i("update:height",l.value)),(u,p)=>(H(),_e(Do,{name:`slide-${s.value}`},{default:X(()=>[Ir(T("div",{ref:"route-drawer",class:At(["route-drawer",`route-drawer--${s.value}`]),onClick:p[0]||(p[0]=f=>i("click",f)),onContextmenu:p[1]||(p[1]=f=>i("contextmenu",f))},[Pi(u.$slots,"default",{},void 0,!0)],34),[[Mr,h.value]])]),_:3},8,["name"]))}}),ed=St(Ql,[["__scopeId","data-v-72b274a7"]]),td={class:"menu-list"},od=["onClick","onContextmenu","onTouchstart"],id={class:"swipe-container"},nd={style:{height:"fit-content",padding:"8px 12px"}},rd=["onClick"],sd={style:{padding:"16px"}},ad=120,ld=40,dd=L({__name:"SelectableSwipeableMenuList",props:He({items:{},menuOptions:{},swipeActions:{}},{selection:{type:String,default:null},selectionModifiers:{},multipleSelection:{type:Array,default:()=>[]},multipleSelectionModifiers:{}}),emits:He(["contextmenu"],["update:selection","update:multipleSelection"]),setup(o,{emit:e}){Eo(C=>({f3f0f46e:_(s).hoverColor,"3800c443":_(s).primaryColor,"02aac05f":_(s).bodyColor,"919b2974":a.value}));const t=o,i=Ct(o,"selection"),n=Ct(o,"multipleSelection"),r=e,s=Ao(),a=F("0s"),l=F({startX:0,delta:0,currentX:0,containerWidth:0,activeId:null,leftMax:0,rightMax:0}),d=F(!1),c=F(0),h=F(0),u=F(null);function p(C,b){l.value.activeId!==b&&M();const v=C.touches[0];l.value={startX:v.clientX,delta:l.value.delta??0,currentX:v.clientX,containerWidth:C.currentTarget.offsetWidth,activeId:b,leftMax:ad,rightMax:ld}}function f(C){l.value.activeId&&(l.value.currentX=C.touches[0].clientX,l.value.delta+=l.value.currentX-l.value.startX,l.value.delta=bo(l.value.delta,-l.value.leftMax,l.value.rightMax),l.value.startX=C.touches[0].clientX)}function y(){if(!l.value.activeId)return;a.value=`${Math.abs(l.value.delta)/l.value.containerWidth*.3}s`,setTimeout(()=>{a.value="0s"},300);const C=l.value.delta<0?l.value.leftMax:l.value.rightMax;l.value.delta=Math.abs(l.value.delta)>C*.4?Math.sign(l.value.delta)*C:0,l.value.delta===0&&Math.abs(l.value.delta)<5}function I(C,b){C.stopPropagation(),!(l.value.delta>5)&&(M(),i.value!==b.id&&(i.value=b.id))}function M(){l.value.delta>0||(l.value={startX:0,delta:0,currentX:0,containerWidth:0,activeId:null,leftMax:0,rightMax:0})}function k(C,b){if(C.stopPropagation(),C.preventDefault(),d.value){d.value=!1;return}u.value=b,c.value=C.clientX,h.value=C.clientY,d.value=!0,r("contextmenu",C,b)}function R(C){const b=[...n.value];if(b.includes(C)){const v=b.indexOf(C);b.splice(v,1)}else b.push(C);n.value=b}return(C,b)=>(H(),re(Ge,null,[T("div",td,[(H(!0),re(Ge,null,go(t.items,v=>(H(),re("div",{key:v.id,class:At(["menu-list-item",...v.id===i.value?["active"]:[]]),style:Ke({"touch-action":l.value.activeId===v.id?"pan-y":"auto"}),onClick:x=>I(x,v),onContextmenu:_r(x=>k(x,v),["prevent"]),onTouchstart:x=>p(x,v.id),onTouchmove:f,onTouchend:y},[T("div",id,[T("div",{class:"content-col",style:Ke({transform:`translateX(${l.value.activeId===v.id||l.value.delta>0?l.value.delta:0}px)`,willChange:l.value.activeId===v.id?"transform":"auto",flexDirection:l.value.delta>=0||l.value.activeId!==v.id?"row":"row-reverse"})},[Pi(C.$slots,"item",{item:v},()=>[T("div",nd,[T("div",null,ke(v.name??"Untitled"),1)])],!0)],4),T("div",{class:"actions-col",style:Ke({width:`${l.value.activeId===v.id&&l.value.delta<0?-l.value.delta:0}px`,visibility:l.value.activeId===v.id&&l.value.delta<0?"visible":"hidden",willChange:l.value.activeId===v.id?"width":"auto"})},[(H(!0),re(Ge,null,go(t.swipeActions,x=>(H(),re("button",{key:x.name,class:"menu-action",style:Ke({background:x.color||_(s).primaryColorSuppl}),onClick:()=>{x.action(v.id),l.value.activeId=null}},ke(x.label),13,rd))),128))],4),T("div",{class:"select-col",style:Ke({width:`${l.value.delta>0?l.value.delta:0}px`,backgroundColor:i.value===v.id?_(s).primaryColor:"transparent",visibility:l.value.delta>0?"visible":"hidden"})},[T("div",sd,[W(_(Ys),{checked:n.value.includes(v.id),style:Ke({border:i.value===v.id?`1px solid ${_(s).bodyColor}`:"none",BorderRadius:i.value===v.id?_(s).borderRadiusSmall:"none"}),"onUpdate:checked":()=>R(v.id)},null,8,["checked","style","onUpdate:checked"])])],4)])],46,od))),128))]),W(_(ki),{show:d.value,x:c.value,y:h.value,options:t.menuOptions.map(v=>{var x;return{...v,label:((x=v.label)==null?void 0:x.value)??v.label}}),placement:"bottom-start",trigger:"manual",onClick:b[0]||(b[0]=v=>d.value=!1),onClickoutside:b[1]||(b[1]=v=>d.value=!1)},null,8,["show","x","y","options"])],64))}}),cd=St(dd,[["__scopeId","data-v-da073853"]]),ud={class:"drawer-container",style:{height:"100%"}},hd={class:"drawer-header"},pd={class:"drawer-title"},gd={style:{height:"fit-content",padding:"8px 12px","text-align":"left"}},fd=L({__name:"TrackerViewRouteDrawer",props:{show:{type:Boolean,default:!1},showModifiers:{}},emits:He(["update:width"],["update:show"]),setup(o,{emit:e}){Eo(v=>({"414d7753":_(s).borderRadius,c5589f88:_(s).hoverColor,"536ab568":_(s).primaryColorPressed,a627c414:_(s).primaryColor,"6ec5fb8c":_(s).bodyColor}));const{t}=fo(),i=Ks(),n=e,r=en(),s=Ao(),a=Ct(o,"show"),l=F(!1),d=F(0),c=F(0),h=F(null),u=F(!1),p=F(""),f=F(null),y=[{label:z(()=>t("components.trackerViewRouteDrawer.contextMenu.new")),key:"new",props:{onClick:()=>{l.value=!1,r.addRoute(t("components.trackerViewRouteDrawer.nameNewRoute"))}}}],I=[{label:z(()=>t("components.trackerViewRouteDrawer.contextMenu.rename")),key:"rename",props:{onClick:()=>{var v;(v=h.value)!=null&&v.id&&(p.value=h.value.name||"",u.value=!0)}}},{label:z(()=>t("components.trackerViewRouteDrawer.contextMenu.delete")),key:"delete",props:{onClick:()=>{h.value&&r.deleteRoute(h.value.id)}}},{key:"divider-1",type:"divider"},...y],M=[{label:z(()=>t("components.trackerViewRouteDrawer.contextMenu.rename")),name:"rename",action:v=>{const x=r.routes.find(D=>D.id===v);f.value=v,p.value=(x==null?void 0:x.name)||"",u.value=!0}},{label:z(()=>t("components.trackerViewRouteDrawer.contextMenu.delete")),name:"delete",action:v=>r.deleteRoute(v),color:s.value.errorColorSuppl}];function k(v){if(v.stopPropagation(),v.preventDefault(),f.value=r.currentRouteId,l.value){l.value=!1;return}d.value=v.clientX,c.value=v.clientY,l.value=!0}async function R(v){p.value.trim()&&(await r.updateRoute(v,{name:p.value.trim()}),u.value=!1)}const C=F([]);function b(){i.warning({title:t("components.trackerViewRouteDrawer.deleteConfirmation.title"),content:t("components.trackerViewRouteDrawer.deleteConfirmation.prompt"),positiveText:t("components.trackerViewRouteDrawer.deleteConfirmation.yes"),negativeText:t("components.trackerViewRouteDrawer.deleteConfirmation.no"),onPositiveClick:()=>{C.value.forEach(v=>{r.deleteRoute(v),C.value=C.value.filter(x=>x!==v)})}})}return(v,x)=>(H(),re(Ge,null,[W(ed,{show:a.value,"onUpdate:show":x[3]||(x[3]=D=>a.value=D),position:"left",onClick:x[4]||(x[4]=()=>_(r).currentRouteId=null),"onUpdate:width":x[5]||(x[5]=D=>n("update:width",D)),onContextmenu:x[6]||(x[6]=D=>k(D))},{default:X(()=>[T("div",ud,[T("div",hd,[T("p",pd,ke(_(t)("components.trackerViewRouteDrawer.routes")),1),C.value.length>0?(H(),_e(_(Ve),{key:0,strong:"",secondary:"",circle:"",type:"error",onClick:b},{icon:X(()=>[W(_(Ee),{component:_(Is)},null,8,["component"])]),_:1})):Re("",!0)]),W(cd,{selection:_(r).currentRouteId,"onUpdate:selection":x[0]||(x[0]=D=>_(r).currentRouteId=D),"multiple-selection":C.value,"onUpdate:multipleSelection":x[1]||(x[1]=D=>C.value=D),items:_(r).routes,"menu-options":I,"swipe-actions":M,onContextmenu:x[2]||(x[2]=(D,S)=>{f.value=(S==null?void 0:S.id)??null,h.value=S??null})},{item:X(({item:D})=>[T("div",gd,[T("div",null,ke(D.name??_(t)("components.trackerViewRouteDrawer.nameNewRoute")),1),T("div",null,ke(_(t)("components.trackerViewRouteDrawer.points",{num:D.points.length})),1)])]),_:1},8,["selection","multiple-selection","items"])])]),_:1},8,["show"]),W(_(ki),{show:l.value,x:d.value,y:c.value,options:y.map(D=>({...D,label:D.label.value})),placement:"bottom-start",trigger:"manual",onClickoutside:x[7]||(x[7]=D=>l.value=!1)},null,8,["show","x","y","options"]),W(_(Si),{show:u.value,"onUpdate:show":x[10]||(x[10]=D=>u.value=D),preset:"dialog",title:"Rename Route","positive-text":"Save","negative-text":"Cancel",onPositiveClick:x[11]||(x[11]=()=>{f.value&&R(f.value)})},{default:X(()=>[W(_(Us),{value:p.value,"onUpdate:value":x[8]||(x[8]=D=>p.value=D),placeholder:"Enter new route name",onKeyup:x[9]||(x[9]=Rr(()=>{f.value&&R(f.value)},["enter"]))},null,8,["value"])]),_:1},8,["show"])],64))}}),md=St(fd,[["__scopeId","data-v-890e827a"]]),vd={style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},yd={key:0,style:{width:"100%",height:"100%"}},bd=["title","onClick"],xd=["title"],wd={key:1,style:{width:"100%",height:"100%",display:"grid","place-content":"center"}},Cd=L({__name:"TrackerView",setup(o){const e=jr(),t=Fi(),i=ne("geolocation"),{t:n}=fo(),r=fo(),s=F(7),l="https://api.maptiler.com/maps/basic-v2/style.json?key=dCeXFrS9lgSF8hm5C6nm",d=F({latitude:0,longitude:0}),c=wt(null),h=wt(null),u=F("select"),p=F(!1),f=en(),y=z(()=>{if(!f.currentRouteId)return[];const $=f.routes.find(V=>V.id===f.currentRouteId);return($==null?void 0:$.points)||[]}),I=F(!1),M=new Be.Marker,k=z(()=>{if(y.value.length>1||y.value.length===0)return M.remove(),{type:"FeatureCollection",features:[{type:"Feature",properties:{description:f.currentRouteId},geometry:{type:"LineString",coordinates:y.value.map($=>[$.longitude,$.latitude])}}]};if(y.value.length===1){M.setLngLat([y.value[0].longitude,y.value[0].latitude]);const $=c.value;$&&M.addTo($)}return{type:"FeatureCollection",features:[]}}),R=[{mode:new vl,name:n("trackerView.terraDrawTools.point"),icon:ys},{mode:new ul,name:n("trackerView.terraDrawTools.line"),icon:ms},{mode:new Dl({allowManualDeselection:!0,flags:{point:{feature:{draggable:!0}},polygon:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},linestring:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},freehand:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},circle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},rectangle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}}}}),name:n("trackerView.terraDrawTools.select"),icon:gs}];G([()=>e.settings.mapLanguage,()=>r.locale.value],$=>{$&&c.value&&C(c.value,$[0]==="interface"?$[1]:$[0])});const C=($,V)=>{const K=V==="zh-CN"?"zh":"en",fe=["City labels","Road labels","Station labels","Airport labels","Continent labels","Country labels"];for(const Se of fe)$.setLayoutProperty(Se,"text-field",["get",`name:${K}`])};function b($){var V;c.value=$.map,c.value&&C(c.value,r.locale.value),(V=c.value)==null||V.on("click",()=>{q.value=!1}),h.value=new Nl({adapter:new Al({map:c.value}),modes:R.map(K=>K.mode)}),h.value.start()}let v=-1;async function x(){try{if(p.value=!p.value,p.value){if(f.currentRouteId)await f.addPointToRoute(f.currentRouteId,i.present);else{const $=await f.addRoute(n("trackerView.nameNewRoute"));await f.addPointToRoute($.id,i.present),Y(),f.setCurrentRouteId($.id)}v=i.addListener($=>{f.addPointToRoute(f.currentRouteId,$)})}else v!==-1&&(i.removeListener(v),p.value=!1,v=-1)}catch($){console.error($)}}async function D(){Yl(JSON.stringify(k.value),"application/json","tracked-path-export")}const S=F(async()=>{});function B(){return new Promise(async($,V)=>{S.value=async K=>{K.length===0?V(new Error("No file selected")):$(K)},I.value=!0})}async function A(){try{const $=await B(),V=JSON.parse($[0]).features[0].geometry.coordinates.map(fe=>({latitude:fe[1],longitude:fe[0]})),K=await f.addRoute(n("trackerView.nameNewlyImportedRoute"));for(const fe of V)await f.addPointToRoute(K.id,fe);Y()}catch($){t.error(String($))}}const U=F(0),q=F(!1);G(q,$=>{var V;return(V=c.value)==null?void 0:V.easeTo({padding:{left:$?U.value:0},duration:500})});const oe=()=>q.value=!q.value,Z=F(!1),Y=()=>{Z.value||(Z.value=!0,setTimeout(()=>{Z.value=!1},3e3))},ie=F(""),ee=F(!1);return _o(async()=>{var $;await f.init();try{d.value=await i.refresh(),i.usingGPS||t.warning(n("trackerView.gpsWarning"),{duration:5e3})}catch(V){ie.value=V.message??String(V)}ee.value=!0,($=h.value)==null||$.start()}),($,V)=>(H(),re("div",vd,[W(_(Qr),{class:"map-layout","content-style":"padding: 0;",hoverable:""},{default:X(()=>[W(Do,{name:"map-load"},{default:X(()=>[ee.value&&!ie.value?(H(),re("div",yd,[W(_(Oa),{"map-style":l,center:[d.value.longitude,d.value.latitude],zoom:s.value,height:"100%","onMap:load":b},{default:X(()=>[W(_(Na),{position:"top-left"}),_(i).usingGPS?(H(),_e(_(ja),{key:0,position:"top-left","track-user-location":!0})):Re("",!0),W(_(La),{position:"top-left"}),W(_(Ua),{position:"bottom-left"}),W(_(so),{position:"top-right"},{default:X(()=>[(H(),re(Ge,null,go(R,K=>T("button",{key:K.name,class:At(["btn-control","btn-draw-mode",{active:K.mode.mode===u.value}]),title:K.name,onClick:()=>{var fe,Se,we;console.log("activeDrawMethod",u.value),u.value===K.mode.mode?((fe=h.value)==null||fe.setMode("select"),u.value="select"):(u.value=K.mode.mode,(Se=h.value)==null||Se.start(),(we=h.value)==null||we.setMode(K.mode.mode))}},[W(_(Ee),{size:20},{default:X(()=>[(H(),_e(po(K.icon),{class:"btn-default"}))]),_:2},1024)],10,bd)),64))]),_:1}),W(_(so),{position:"bottom-left"},{default:X(()=>[W(_(Jr),{trigger:"manual",show:Z.value},{trigger:X(()=>[T("button",{class:"btn-control btn-route-toggle",onClick:oe},[W(_(Ee),{size:24},{default:X(()=>[W(_(Cs))]),_:1})])]),default:X(()=>[T("span",null,ke(_(n)("trackerView.uiRouteCheckoutTip")),1)]),_:1},8,["show"])]),_:1}),W(_(so),{position:"top-right"},{default:X(()=>[T("button",{class:At(["btn-control","btn-record",p.value?"recording":"not-recording"]),title:p.value?_(n)("trackerView.uiRecordingStatus.on"):_(n)("trackerView.uiRecordingStatus.off"),onClick:x},[W(_(Ee),{size:20},{default:X(()=>[(H(),_e(po(p.value?_(Ss):_(xs)),{size:p.value?16:20,class:"stroke-inherit text-inherit"},null,8,["size"]))]),_:1})],10,xd),y.value.length>0&&!p.value?(H(),re("button",{key:0,class:"btn-control btn-clear",onClick:V[0]||(V[0]=K=>_(f).currentRouteId&&_(f).clearRoutePoints(_(f).currentRouteId))},[W(_(Ee),{size:20},{default:X(()=>[W(_(cs),{class:"stroke-inherit text-inherit",style:{transform:"translateX(-1.3px)"},size:"20"})]),_:1})])):Re("",!0),y.value.length>0&&!p.value?(H(),re("button",{key:1,class:"btn-control",onClick:D},[W(_(Ee),{size:20},{default:X(()=>[W(_(hs),{class:"btn-default",size:"20"})]),_:1})])):Re("",!0),y.value.length===0&&!p.value?(H(),re("button",{key:2,class:"btn-control",onClick:A},[W(_(Ee),{size:20},{default:X(()=>[W(_(Ri),{class:"btn-default",size:"20"})]),_:1})])):Re("",!0)]),_:1}),W(_(Ga),{"source-id":"geojson",data:k.value},{default:X(()=>[W(_(Ka),{"layer-id":"geojson",layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":5,"line-color":"#008800","line-opacity":.8}})]),_:1},8,["data"])]),_:1},8,["center","zoom"])])):(H(),re("div",wd,[ie.value?(H(),_e(_(Ts),{key:1,title:_(n)("app.error"),type:"error"},{default:X(()=>[T("div",null,[V[4]||(V[4]=T("br",null,null,-1)),T("b",null,ke(_(n)("app.error"))+": ",1),V[5]||(V[5]=T("br",null,null,-1)),T("code",null,ke(ie.value),1)])]),_:1},8,["title"])):(H(),_e(_(aa),{key:0,size:"large"},{description:X(()=>[W(_(Nr),null,{default:X(()=>[Lt(ke(_(n)("trackerView.mapLoading")),1)]),_:1})]),_:1}))]))]),_:1})]),_:1}),W(Jl,{show:I.value,"onUpdate:show":V[1]||(V[1]=K=>I.value=K),types:["application/json","text/plain"],onConfirm:S.value},null,8,["show","onConfirm"]),W(md,{show:q.value,"onUpdate:show":V[2]||(V[2]=K=>q.value=K),"onUpdate:width":V[3]||(V[3]=K=>U.value=K)},null,8,["show"])]))}}),Od=St(Cd,[["__scopeId","data-v-3a4deb40"]]);export{Od as default};
