import{d as E,c as ee,o as V,a as j,b as Ht,i as Sr,e as kr,f as Mr,h as g,r as xt,g as I,j as A,k as F,l as vo,N as yo,m as We,u as xo,t as ie,n as ge,p as Co,q as T,s as ri,v as _r,w as Dr,E as vi,W as yi,I as xi,S as Ci,x as ut,y as bi,z as tt,A as ve,B as Fr,C as bo,D as z,F as wo,G as he,H as it,J as B,K as Po,L as dt,M as X,O as re,P as Er,Q as Rr,R as Ne,V as Br,T as Or,U as jr,X as Io,Y as So,Z as si,_ as wi,$ as Pi,a0 as At,a1 as Pe,a2 as Ze,a3 as Ai,a4 as ce,a5 as Ui,a6 as Ct,a7 as zr,a8 as He,a9 as Lr,aa as Tr,ab as Ii,ac as $r,ad as Wr,ae as ko,af as Nr,ag as Ar,ah as Vi,ai as qe,aj as Ur,ak as Mo,al as Vr,am as Gi,an as Hi,ao as Gr,ap as Xi,aq as gt,ar as ot,as as De,at as Me,au as Hr,av as Xr,aw as Kr,ax as Yr,ay as Si,az as qr,aA as Dt,aB as Ft,aC as Et,aD as Zr,aE as Jr,aF as Ut,aG as ki,aH as ke,aI as Y,aJ as M,aK as _o,aL as U,aM as $t,aN as ai,aO as be,aP as Qr,aQ as es,aR as ts,aS as Mi,aT as Xt,aU as li,aV as Do,aW as Rt,aX as Wt,aY as is,aZ as di,a_ as os,a$ as ns,b0 as rs,b1 as ss}from"./index-ALYObSVJ.js";import{t as Jt,u as as,N as ls,D as ds,d as cs,a as us}from"./Image-BVNAHBdT.js";const hs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},ps=E({name:"Backspace",render:function(e,t){return V(),ee("svg",hs,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("path",{d:"M20 6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H9l-5-5a1.5 1.5 0 0 1 0-2l5-5z"}),j("path",{d:"M12 10l4 4m0-4l-4 4"})],-1)]))}}),gs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},fs=E({name:"Circle",render:function(e,t){return V(),ee("svg",gs,t[0]||(t[0]=[j("circle",{cx:"12",cy:"12",r:"9",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),ms={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},vs=E({name:"DeviceFloppy",render:function(e,t){return V(),ee("svg",ms,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("path",{d:"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"}),j("circle",{cx:"12",cy:"14",r:"2"}),j("path",{d:"M14 4v4H8V4"})],-1)]))}}),ys={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},xs=E({name:"HandFinger",render:function(e,t){return V(),ee("svg",ys,t[0]||(t[0]=[Ht('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 1 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7A69.74 69.74 0 0 1 7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path></g>',1)]))}}),Cs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},bs=E({name:"HandMove",render:function(e,t){return V(),ee("svg",Cs,t[0]||(t[0]=[Ht('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 0 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7L7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path><path d="M2.541 5.594a13.487 13.487 0 0 1 2.46-1.427"></path><path d="M14 3.458a13.44 13.44 0 0 1 3.685 1.612"></path></g>',1)]))}}),ws={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ps=E({name:"Line",render:function(e,t){return V(),ee("svg",ws,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("circle",{cx:"6",cy:"18",r:"2"}),j("circle",{cx:"18",cy:"6",r:"2"}),j("path",{d:"M7.5 16.5l9-9"})],-1)]))}}),Is={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ss=E({name:"MapPin",render:function(e,t){return V(),ee("svg",Is,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("circle",{cx:"12",cy:"11",r:"3"}),j("path",{d:"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"})],-1)]))}}),ks={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ms=E({name:"PlayerRecord",render:function(e,t){return V(),ee("svg",ks,t[0]||(t[0]=[j("circle",{cx:"12",cy:"12",r:"7",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),_s={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Ds=E({name:"Polygon",render:function(e,t){return V(),ee("svg",_s,t[0]||(t[0]=[Ht('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="2"></circle><circle cx="19" cy="8" r="2"></circle><circle cx="5" cy="11" r="2"></circle><circle cx="15" cy="19" r="2"></circle><path d="M6.5 9.5l3.5-3"></path><path d="M14 5.5L17 7"></path><path d="M18.5 10L16 17"></path><path d="M13.5 17.5l-7-5"></path></g>',1)]))}}),Fs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Es=E({name:"Route",render:function(e,t){return V(),ee("svg",Fs,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("circle",{cx:"6",cy:"19",r:"2"}),j("circle",{cx:"18",cy:"5",r:"2"}),j("path",{d:"M12 19h4.5a3.5 3.5 0 0 0 0-7h-8a3.5 3.5 0 0 1 0-7H12"})],-1)]))}}),Rs={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Bs=E({name:"Square",render:function(e,t){return V(),ee("svg",Rs,t[0]||(t[0]=[j("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))}}),Os={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Fo=E({name:"Upload",render:function(e,t){return V(),ee("svg",Os,t[0]||(t[0]=[j("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[j("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),j("path",{d:"M7 9l5-5l5 5"}),j("path",{d:"M12 4v12"})],-1)]))}}),js={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},zs=E({name:"Vector",render:function(e,t){return V(),ee("svg",js,t[0]||(t[0]=[Ht('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="17" width="4" height="4" rx="1"></rect><rect x="3" y="17" width="4" height="4" rx="1"></rect><path d="M5 7v10"></path><path d="M19 7v10"></path><path d="M7 5h10"></path><path d="M7 19h10"></path></g>',1)]))}});function Ls(i,e,t){return i===i&&(t!==void 0&&(i=i<=t?i:t),e!==void 0&&(i=i>=e?i:e)),i}function Eo(i,e,t){return t===void 0&&(t=e,e=void 0),t!==void 0&&(t=Jt(t),t=t===t?t:0),e!==void 0&&(e=Jt(e),e=e===e?e:0),Ls(Jt(i),e,t)}var Ts="[object String]";function $s(i){return typeof i=="string"||!kr(i)&&Sr(i)&&Mr(i)==Ts}const Ws=E({name:"Add",render(){return g("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},g("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),Ns=xt("attach",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),As=xt("cancel",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),Us=E({name:"ChevronDown",render(){return g("svg",{viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg"},g("path",{d:"M3.14645 5.64645C3.34171 5.45118 3.65829 5.45118 3.85355 5.64645L8 9.79289L12.1464 5.64645C12.3417 5.45118 12.6583 5.45118 12.8536 5.64645C13.0488 5.84171 13.0488 6.15829 12.8536 6.35355L8.35355 10.8536C8.15829 11.0488 7.84171 11.0488 7.64645 10.8536L3.14645 6.35355C2.95118 6.15829 2.95118 5.84171 3.14645 5.64645Z",fill:"currentColor"}))}}),Vs=xt("clear",()=>g("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},g("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},g("g",{fill:"currentColor","fill-rule":"nonzero"},g("path",{d:"M8,2 C11.3137085,2 14,4.6862915 14,8 C14,11.3137085 11.3137085,14 8,14 C4.6862915,14 2,11.3137085 2,8 C2,4.6862915 4.6862915,2 8,2 Z M6.5343055,5.83859116 C6.33943736,5.70359511 6.07001296,5.72288026 5.89644661,5.89644661 L5.89644661,5.89644661 L5.83859116,5.9656945 C5.70359511,6.16056264 5.72288026,6.42998704 5.89644661,6.60355339 L5.89644661,6.60355339 L7.293,8 L5.89644661,9.39644661 L5.83859116,9.4656945 C5.70359511,9.66056264 5.72288026,9.92998704 5.89644661,10.1035534 L5.89644661,10.1035534 L5.9656945,10.1614088 C6.16056264,10.2964049 6.42998704,10.2771197 6.60355339,10.1035534 L6.60355339,10.1035534 L8,8.707 L9.39644661,10.1035534 L9.4656945,10.1614088 C9.66056264,10.2964049 9.92998704,10.2771197 10.1035534,10.1035534 L10.1035534,10.1035534 L10.1614088,10.0343055 C10.2964049,9.83943736 10.2771197,9.57001296 10.1035534,9.39644661 L10.1035534,9.39644661 L8.707,8 L10.1035534,6.60355339 L10.1614088,6.5343055 C10.2964049,6.33943736 10.2771197,6.07001296 10.1035534,5.89644661 L10.1035534,5.89644661 L10.0343055,5.83859116 C9.83943736,5.70359511 9.57001296,5.72288026 9.39644661,5.89644661 L9.39644661,5.89644661 L8,7.293 L6.60355339,5.89644661 Z"}))))),Ro=E({name:"Eye",render(){return g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),g("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),Gs=E({name:"EyeOff",render(){return g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"}),g("path",{d:"M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z",fill:"currentColor"}),g("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z",fill:"currentColor"}),g("path",{d:"M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z",fill:"currentColor"}),g("path",{d:"M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z",fill:"currentColor"}))}}),Hs=xt("retry",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),g("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),Xs=xt("trash",()=>g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),g("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),Ks=I("base-clear","\n flex-shrink: 0;\n height: 1em;\n width: 1em;\n position: relative;\n",[A(">",[F("clear","\n font-size: var(--n-clear-size);\n height: 1em;\n width: 1em;\n cursor: pointer;\n color: var(--n-clear-color);\n transition: color .3s var(--n-bezier);\n display: flex;\n ",[A("&:hover","\n color: var(--n-clear-color-hover)!important;\n "),A("&:active","\n color: var(--n-clear-color-pressed)!important;\n ")]),F("placeholder","\n display: flex;\n "),F("clear, placeholder","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n ",[vo({originalTransform:"translateX(-50%) translateY(-50%)",left:"50%",top:"50%"})])])]),ci=E({name:"BaseClear",props:{clsPrefix:{type:String,required:!0},show:Boolean,onClear:Function},setup(i){return xo("-base-clear",Ks,ie(i,"clsPrefix")),{handleMouseDown(e){e.preventDefault()}}},render(){const{clsPrefix:i}=this;return g("div",{class:"".concat(i,"-base-clear")},g(yo,null,{default:()=>{var e,t;return this.show?g("div",{key:"dismiss",class:"".concat(i,"-base-clear__clear"),onClick:this.onClear,onMousedown:this.handleMouseDown,"data-clear":!0},We(this.$slots.icon,()=>[g(ge,{clsPrefix:i},{default:()=>g(Vs,null)})])):g("div",{key:"icon",class:"".concat(i,"-base-clear__placeholder")},(t=(e=this.$slots).placeholder)===null||t===void 0?void 0:t.call(e))}}))}}),Ys=E({name:"InternalSelectionSuffix",props:{clsPrefix:{type:String,required:!0},showArrow:{type:Boolean,default:void 0},showClear:{type:Boolean,default:void 0},loading:{type:Boolean,default:!1},onClear:Function},setup(i,{slots:e}){return()=>{const{clsPrefix:t}=i;return g(Co,{clsPrefix:t,class:"".concat(t,"-base-suffix"),strokeWidth:24,scale:.85,show:i.loading},{default:()=>i.showArrow?g(ci,{clsPrefix:t,show:i.showClear,onClear:i.onClear},{placeholder:()=>g(ge,{clsPrefix:t,class:"".concat(t,"-base-suffix__arrow")},{default:()=>We(e.default,()=>[g(Us,null)])})}):null})}}}),qs=I("alert","\n line-height: var(--n-line-height);\n border-radius: var(--n-border-radius);\n position: relative;\n transition: background-color .3s var(--n-bezier);\n background-color: var(--n-color);\n text-align: start;\n word-break: break-word;\n",[F("border","\n border-radius: inherit;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n transition: border-color .3s var(--n-bezier);\n border: var(--n-border);\n pointer-events: none;\n "),T("closable",[I("alert-body",[F("title","\n padding-right: 24px;\n ")])]),F("icon",{color:"var(--n-icon-color)"}),I("alert-body",{padding:"var(--n-padding)"},[F("title",{color:"var(--n-title-text-color)"}),F("content",{color:"var(--n-content-text-color)"})]),ri({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),F("icon","\n position: absolute;\n left: 0;\n top: 0;\n align-items: center;\n justify-content: center;\n display: flex;\n width: var(--n-icon-size);\n height: var(--n-icon-size);\n font-size: var(--n-icon-size);\n margin: var(--n-icon-margin);\n "),F("close","\n transition:\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n position: absolute;\n right: 0;\n top: 0;\n margin: var(--n-close-margin);\n "),T("show-icon",[I("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),T("right-adjust",[I("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),I("alert-body","\n border-radius: var(--n-border-radius);\n transition: border-color .3s var(--n-bezier);\n ",[F("title","\n transition: color .3s var(--n-bezier);\n font-size: 16px;\n line-height: 19px;\n font-weight: var(--n-title-font-weight);\n ",[A("& +",[F("content",{marginTop:"9px"})])]),F("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),F("icon",{transition:"color .3s var(--n-bezier)"})]),Zs=Object.assign(Object.assign({},ve.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),Js=E({name:"Alert",inheritAttrs:!1,props:Zs,slots:Object,setup(i){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:o,mergedRtlRef:n}=tt(i),r=ve("Alert","-alert",qs,Fr,i,e),s=bo("Alert",n,e),a=z(()=>{const{common:{cubicBezierEaseInOut:p},self:f}=r.value,{fontSize:v,borderRadius:S,titleFontWeight:P,lineHeight:w,iconSize:C,iconMargin:y,iconMarginRtl:x,closeIconSize:_,closeBorderRadius:D,closeSize:G,closeMargin:k,closeMarginRtl:L,padding:$}=f,{type:W}=i,{left:le,right:te}=wo(y);return{"--n-bezier":p,"--n-color":f[he("color",W)],"--n-close-icon-size":_,"--n-close-border-radius":D,"--n-close-color-hover":f[he("closeColorHover",W)],"--n-close-color-pressed":f[he("closeColorPressed",W)],"--n-close-icon-color":f[he("closeIconColor",W)],"--n-close-icon-color-hover":f[he("closeIconColorHover",W)],"--n-close-icon-color-pressed":f[he("closeIconColorPressed",W)],"--n-icon-color":f[he("iconColor",W)],"--n-border":f[he("border",W)],"--n-title-text-color":f[he("titleTextColor",W)],"--n-content-text-color":f[he("contentTextColor",W)],"--n-line-height":w,"--n-border-radius":S,"--n-font-size":v,"--n-title-font-weight":P,"--n-icon-size":C,"--n-icon-margin":y,"--n-icon-margin-rtl":x,"--n-close-size":G,"--n-close-margin":k,"--n-close-margin-rtl":L,"--n-padding":$,"--n-icon-margin-left":le,"--n-icon-margin-right":te}}),l=o?it("alert",z(()=>i.type[0]),a,i):void 0,d=B(!0),c=()=>{const{onAfterLeave:p,onAfterHide:f}=i;p&&p(),f&&f()};return{rtlEnabled:s,mergedClsPrefix:e,mergedBordered:t,visible:d,handleCloseClick:()=>{var p;Promise.resolve((p=i.onClose)===null||p===void 0?void 0:p.call(i)).then(f=>{f!==!1&&(d.value=!1)})},handleAfterLeave:()=>{c()},mergedTheme:r,cssVars:o?void 0:a,themeClass:l==null?void 0:l.themeClass,onRender:l==null?void 0:l.onRender}},render(){var i;return(i=this.onRender)===null||i===void 0||i.call(this),g(bi,{onAfterLeave:this.handleAfterLeave},{default:()=>{const{mergedClsPrefix:e,$slots:t}=this,o={class:["".concat(e,"-alert"),this.themeClass,this.closable&&"".concat(e,"-alert--closable"),this.showIcon&&"".concat(e,"-alert--show-icon"),!this.title&&this.closable&&"".concat(e,"-alert--right-adjust"),this.rtlEnabled&&"".concat(e,"-alert--rtl")],style:this.cssVars,role:"alert"};return this.visible?g("div",Object.assign({},_r(this.$attrs,o)),this.closable&&g(Dr,{clsPrefix:e,class:"".concat(e,"-alert__close"),onClick:this.handleCloseClick}),this.bordered&&g("div",{class:"".concat(e,"-alert__border")}),this.showIcon&&g("div",{class:"".concat(e,"-alert__icon"),"aria-hidden":"true"},We(t.icon,()=>[g(ge,{clsPrefix:e},{default:()=>{switch(this.type){case"success":return g(Ci,null);case"info":return g(xi,null);case"warning":return g(yi,null);case"error":return g(vi,null);default:return null}}})])),g("div",{class:["".concat(e,"-alert-body"),this.mergedBordered&&"".concat(e,"-alert-body--bordered")]},ut(t.header,n=>{const r=n||this.title;return r?g("div",{class:"".concat(e,"-alert-body__title")},r):null}),t.default&&g("div",{class:"".concat(e,"-alert-body__content")},t))):null}})}}),Bo=Po("n-input"),Qs=I("input","\n max-width: 100%;\n cursor: text;\n line-height: 1.5;\n z-index: auto;\n outline: none;\n box-sizing: border-box;\n position: relative;\n display: inline-flex;\n border-radius: var(--n-border-radius);\n background-color: var(--n-color);\n transition: background-color .3s var(--n-bezier);\n font-size: var(--n-font-size);\n font-weight: var(--n-font-weight);\n --n-padding-vertical: calc((var(--n-height) - 1.5 * var(--n-font-size)) / 2);\n",[F("input, textarea","\n overflow: hidden;\n flex-grow: 1;\n position: relative;\n "),F("input-el, textarea-el, input-mirror, textarea-mirror, separator, placeholder","\n box-sizing: border-box;\n font-size: inherit;\n line-height: 1.5;\n font-family: inherit;\n border: none;\n outline: none;\n background-color: #0000;\n text-align: inherit;\n transition:\n -webkit-text-fill-color .3s var(--n-bezier),\n caret-color .3s var(--n-bezier),\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier);\n "),F("input-el, textarea-el","\n -webkit-appearance: none;\n scrollbar-width: none;\n width: 100%;\n min-width: 0;\n text-decoration-color: var(--n-text-decoration-color);\n color: var(--n-text-color);\n caret-color: var(--n-caret-color);\n background-color: transparent;\n ",[A("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb","\n width: 0;\n height: 0;\n display: none;\n "),A("&::placeholder","\n color: #0000;\n -webkit-text-fill-color: transparent !important;\n "),A("&:-webkit-autofill ~",[F("placeholder","display: none;")])]),T("round",[dt("textarea","border-radius: calc(var(--n-height) / 2);")]),F("placeholder","\n pointer-events: none;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n overflow: hidden;\n color: var(--n-placeholder-color);\n ",[A("span","\n width: 100%;\n display: inline-block;\n ")]),T("textarea",[F("placeholder","overflow: visible;")]),dt("autosize","width: 100%;"),T("autosize",[F("textarea-el, input-el","\n position: absolute;\n top: 0;\n left: 0;\n height: 100%;\n ")]),I("input-wrapper","\n overflow: hidden;\n display: inline-flex;\n flex-grow: 1;\n position: relative;\n padding-left: var(--n-padding-left);\n padding-right: var(--n-padding-right);\n "),F("input-mirror","\n padding: 0;\n height: var(--n-height);\n line-height: var(--n-height);\n overflow: hidden;\n visibility: hidden;\n position: static;\n white-space: pre;\n pointer-events: none;\n "),F("input-el","\n padding: 0;\n height: var(--n-height);\n line-height: var(--n-height);\n ",[A("&[type=password]::-ms-reveal","display: none;"),A("+",[F("placeholder","\n display: flex;\n align-items: center; \n ")])]),dt("textarea",[F("placeholder","white-space: nowrap;")]),F("eye","\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n "),T("textarea","width: 100%;",[I("input-word-count","\n position: absolute;\n right: var(--n-padding-right);\n bottom: var(--n-padding-vertical);\n "),T("resizable",[I("input-wrapper","\n resize: vertical;\n min-height: var(--n-height);\n ")]),F("textarea-el, textarea-mirror, placeholder","\n height: 100%;\n padding-left: 0;\n padding-right: 0;\n padding-top: var(--n-padding-vertical);\n padding-bottom: var(--n-padding-vertical);\n word-break: break-word;\n display: inline-block;\n vertical-align: bottom;\n box-sizing: border-box;\n line-height: var(--n-line-height-textarea);\n margin: 0;\n resize: none;\n white-space: pre-wrap;\n scroll-padding-block-end: var(--n-padding-vertical);\n "),F("textarea-mirror","\n width: 100%;\n pointer-events: none;\n overflow: hidden;\n visibility: hidden;\n position: static;\n white-space: pre-wrap;\n overflow-wrap: break-word;\n ")]),T("pair",[F("input-el, placeholder","text-align: center;"),F("separator","\n display: flex;\n align-items: center;\n transition: color .3s var(--n-bezier);\n color: var(--n-text-color);\n white-space: nowrap;\n ",[I("icon","\n color: var(--n-icon-color);\n "),I("base-icon","\n color: var(--n-icon-color);\n ")])]),T("disabled","\n cursor: not-allowed;\n background-color: var(--n-color-disabled);\n ",[F("border","border: var(--n-border-disabled);"),F("input-el, textarea-el","\n cursor: not-allowed;\n color: var(--n-text-color-disabled);\n text-decoration-color: var(--n-text-color-disabled);\n "),F("placeholder","color: var(--n-placeholder-color-disabled);"),F("separator","color: var(--n-text-color-disabled);",[I("icon","\n color: var(--n-icon-color-disabled);\n "),I("base-icon","\n color: var(--n-icon-color-disabled);\n ")]),I("input-word-count","\n color: var(--n-count-text-color-disabled);\n "),F("suffix, prefix","color: var(--n-text-color-disabled);",[I("icon","\n color: var(--n-icon-color-disabled);\n "),I("internal-icon","\n color: var(--n-icon-color-disabled);\n ")])]),dt("disabled",[F("eye","\n color: var(--n-icon-color);\n cursor: pointer;\n ",[A("&:hover","\n color: var(--n-icon-color-hover);\n "),A("&:active","\n color: var(--n-icon-color-pressed);\n ")]),A("&:hover",[F("state-border","border: var(--n-border-hover);")]),T("focus","background-color: var(--n-color-focus);",[F("state-border","\n border: var(--n-border-focus);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),F("border, state-border","\n box-sizing: border-box;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n pointer-events: none;\n border-radius: inherit;\n border: var(--n-border);\n transition:\n box-shadow .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n "),F("state-border","\n border-color: #0000;\n z-index: 1;\n "),F("prefix","margin-right: 4px;"),F("suffix","\n margin-left: 4px;\n "),F("suffix, prefix","\n transition: color .3s var(--n-bezier);\n flex-wrap: nowrap;\n flex-shrink: 0;\n line-height: var(--n-height);\n white-space: nowrap;\n display: inline-flex;\n align-items: center;\n justify-content: center;\n color: var(--n-suffix-text-color);\n ",[I("base-loading","\n font-size: var(--n-icon-size);\n margin: 0 2px;\n color: var(--n-loading-color);\n "),I("base-clear","\n font-size: var(--n-icon-size);\n ",[F("placeholder",[I("base-icon","\n transition: color .3s var(--n-bezier);\n color: var(--n-icon-color);\n font-size: var(--n-icon-size);\n ")])]),A(">",[I("icon","\n transition: color .3s var(--n-bezier);\n color: var(--n-icon-color);\n font-size: var(--n-icon-size);\n ")]),I("base-icon","\n font-size: var(--n-icon-size);\n ")]),I("input-word-count","\n pointer-events: none;\n line-height: 1.5;\n font-size: .85em;\n color: var(--n-count-text-color);\n transition: color .3s var(--n-bezier);\n margin-left: 4px;\n font-variant: tabular-nums;\n "),["warning","error"].map(i=>T("".concat(i,"-status"),[dt("disabled",[I("base-loading","\n color: var(--n-loading-color-".concat(i,")\n ")),F("input-el, textarea-el","\n caret-color: var(--n-caret-color-".concat(i,");\n ")),F("state-border","\n border: var(--n-border-".concat(i,");\n ")),A("&:hover",[F("state-border","\n border: var(--n-border-hover-".concat(i,");\n "))]),A("&:focus","\n background-color: var(--n-color-focus-".concat(i,");\n "),[F("state-border","\n box-shadow: var(--n-box-shadow-focus-".concat(i,");\n border: var(--n-border-focus-").concat(i,");\n "))]),T("focus","\n background-color: var(--n-color-focus-".concat(i,");\n "),[F("state-border","\n box-shadow: var(--n-box-shadow-focus-".concat(i,");\n border: var(--n-border-focus-").concat(i,");\n "))])])]))]),ea=I("input",[T("disabled",[F("input-el, textarea-el","\n -webkit-text-fill-color: var(--n-text-color-disabled);\n ")])]);function ta(i){let e=0;for(const t of i)e++;return e}function Bt(i){return i===""||i==null}function ia(i){const e=B(null);function t(){const{value:r}=i;if(!(r!=null&&r.focus)){n();return}const{selectionStart:s,selectionEnd:a,value:l}=r;if(s==null||a==null){n();return}e.value={start:s,end:a,beforeText:l.slice(0,s),afterText:l.slice(a)}}function o(){var r;const{value:s}=e,{value:a}=i;if(!s||!a)return;const{value:l}=a,{start:d,beforeText:c,afterText:h}=s;let u=l.length;if(l.endsWith(h))u=l.length-h.length;else if(l.startsWith(c))u=c.length;else{const p=c[d-1],f=l.indexOf(p,d-1);f!==-1&&(u=f+1)}(r=a.setSelectionRange)===null||r===void 0||r.call(a,u,u)}function n(){e.value=null}return X(i,n),{recordCursor:t,restoreCursor:o}}const Ki=E({name:"InputWordCount",setup(i,{slots:e}){const{mergedValueRef:t,maxlengthRef:o,mergedClsPrefixRef:n,countGraphemesRef:r}=re(Bo),s=z(()=>{const{value:a}=t;return a===null||Array.isArray(a)?0:(r.value||ta)(a)});return()=>{const{value:a}=o,{value:l}=t;return g("span",{class:"".concat(n.value,"-input-word-count")},Er(e.default,{value:l===null||Array.isArray(l)?"":l},()=>[a===void 0?s.value:"".concat(s.value," / ").concat(a)]))}}}),oa=Object.assign(Object.assign({},ve.props),{bordered:{type:Boolean,default:void 0},type:{type:String,default:"text"},placeholder:[Array,String],defaultValue:{type:[String,Array],default:null},value:[String,Array],disabled:{type:Boolean,default:void 0},size:String,rows:{type:[Number,String],default:3},round:Boolean,minlength:[String,Number],maxlength:[String,Number],clearable:Boolean,autosize:{type:[Boolean,Object],default:!1},pair:Boolean,separator:String,readonly:{type:[String,Boolean],default:!1},passivelyActivated:Boolean,showPasswordOn:String,stateful:{type:Boolean,default:!0},autofocus:Boolean,inputProps:Object,resizable:{type:Boolean,default:!0},showCount:Boolean,loading:{type:Boolean,default:void 0},allowInput:Function,renderCount:Function,onMousedown:Function,onKeydown:Function,onKeyup:[Function,Array],onInput:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClick:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],countGraphemes:Function,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],textDecoration:[String,Array],attrSize:{type:Number,default:20},onInputBlur:[Function,Array],onInputFocus:[Function,Array],onDeactivate:[Function,Array],onActivate:[Function,Array],onWrapperFocus:[Function,Array],onWrapperBlur:[Function,Array],internalDeactivateOnEnter:Boolean,internalForceFocus:Boolean,internalLoadingBeforeSuffix:{type:Boolean,default:!0},showPasswordToggle:Boolean}),na=E({name:"Input",props:oa,slots:Object,setup(i){const{mergedClsPrefixRef:e,mergedBorderedRef:t,inlineThemeDisabled:o,mergedRtlRef:n}=tt(i),r=ve("Input","-input",Qs,Or,i,e);jr&&xo("-input-safari",ea,e);const s=B(null),a=B(null),l=B(null),d=B(null),c=B(null),h=B(null),u=B(null),p=ia(u),f=B(null),{localeRef:v}=as("Input"),S=B(i.defaultValue),P=ie(i,"value"),w=Io(P,S),C=So(i),{mergedSizeRef:y,mergedDisabledRef:x,mergedStatusRef:_}=C,D=B(!1),G=B(!1),k=B(!1),L=B(!1);let $=null;const W=z(()=>{const{placeholder:m,pair:b}=i;return b?Array.isArray(m)?m:m===void 0?["",""]:[m,m]:m===void 0?[v.value.placeholder]:[m]}),le=z(()=>{const{value:m}=k,{value:b}=w,{value:O}=W;return!m&&(Bt(b)||Array.isArray(b)&&Bt(b[0]))&&O[0]}),te=z(()=>{const{value:m}=k,{value:b}=w,{value:O}=W;return!m&&O[1]&&(Bt(b)||Array.isArray(b)&&Bt(b[1]))}),oe=si(()=>i.internalForceFocus||D.value),K=si(()=>{if(x.value||i.readonly||!i.clearable||!oe.value&&!G.value)return!1;const{value:m}=w,{value:b}=oe;return i.pair?!!(Array.isArray(m)&&(m[0]||m[1]))&&(G.value||b):!!m&&(G.value||b)}),de=z(()=>{const{showPasswordOn:m}=i;if(m)return m;if(i.showPasswordToggle)return"click"}),R=B(!1),N=z(()=>{const{textDecoration:m}=i;return m?Array.isArray(m)?m.map(b=>({textDecoration:b})):[{textDecoration:m}]:["",""]}),H=B(void 0),Se=()=>{var m,b;if(i.type==="textarea"){const{autosize:O}=i;if(O&&(H.value=(b=(m=f.value)===null||m===void 0?void 0:m.$el)===null||b===void 0?void 0:b.offsetWidth),!a.value||typeof O=="boolean")return;const{paddingTop:Q,paddingBottom:ae,lineHeight:J}=window.getComputedStyle(a.value),Oe=Number(Q.slice(0,-2)),je=Number(ae.slice(0,-2)),ze=Number(J.slice(0,-2)),{value:at}=l;if(!at)return;if(O.minRows){const lt=Math.max(O.minRows,1),Zt="".concat(Oe+je+ze*lt,"px");at.style.minHeight=Zt}if(O.maxRows){const lt="".concat(Oe+je+ze*O.maxRows,"px");at.style.maxHeight=lt}}},Ae=z(()=>{const{maxlength:m}=i;return m===void 0?void 0:Number(m)});wi(()=>{const{value:m}=w;Array.isArray(m)||qt(m)});const Ue=Pi().proxy;function Ve(m,b){const{onUpdateValue:O,"onUpdate:value":Q,onInput:ae}=i,{nTriggerFormInput:J}=C;O&&ce(O,m,b),Q&&ce(Q,m,b),ae&&ce(ae,m,b),S.value=m,J()}function It(m,b){const{onChange:O}=i,{nTriggerFormChange:Q}=C;O&&ce(O,m,b),S.value=m,Q()}function on(m){const{onBlur:b}=i,{nTriggerFormBlur:O}=C;b&&ce(b,m),O()}function nn(m){const{onFocus:b}=i,{nTriggerFormFocus:O}=C;b&&ce(b,m),O()}function rn(m){const{onClear:b}=i;b&&ce(b,m)}function sn(m){const{onInputBlur:b}=i;b&&ce(b,m)}function an(m){const{onInputFocus:b}=i;b&&ce(b,m)}function ln(){const{onDeactivate:m}=i;m&&ce(m)}function dn(){const{onActivate:m}=i;m&&ce(m)}function cn(m){const{onClick:b}=i;b&&ce(b,m)}function un(m){const{onWrapperFocus:b}=i;b&&ce(b,m)}function hn(m){const{onWrapperBlur:b}=i;b&&ce(b,m)}function pn(){k.value=!0}function gn(m){k.value=!1,m.target===h.value?St(m,1):St(m,0)}function St(m,b=0,O="input"){const Q=m.target.value;if(qt(Q),m instanceof InputEvent&&!m.isComposing&&(k.value=!1),i.type==="textarea"){const{value:J}=f;J&&J.syncUnifiedContainer()}if($=Q,k.value)return;p.recordCursor();const ae=fn(Q);if(ae)if(!i.pair)O==="input"?Ve(Q,{source:b}):It(Q,{source:b});else{let{value:J}=w;Array.isArray(J)?J=[J[0],J[1]]:J=["",""],J[b]=Q,O==="input"?Ve(J,{source:b}):It(J,{source:b})}Ue.$forceUpdate(),ae||Ze(p.restoreCursor)}function fn(m){const{countGraphemes:b,maxlength:O,minlength:Q}=i;if(b){let J;if(O!==void 0&&(J===void 0&&(J=b(m)),J>Number(O))||Q!==void 0&&(J===void 0&&(J=b(m)),J<Number(O)))return!1}const{allowInput:ae}=i;return typeof ae=="function"?ae(m):!0}function mn(m){sn(m),m.relatedTarget===s.value&&ln(),m.relatedTarget!==null&&(m.relatedTarget===c.value||m.relatedTarget===h.value||m.relatedTarget===a.value)||(L.value=!1),kt(m,"blur"),u.value=null}function vn(m,b){an(m),D.value=!0,L.value=!0,dn(),kt(m,"focus"),b===0?u.value=c.value:b===1?u.value=h.value:b===2&&(u.value=a.value)}function yn(m){i.passivelyActivated&&(hn(m),kt(m,"blur"))}function xn(m){i.passivelyActivated&&(D.value=!0,un(m),kt(m,"focus"))}function kt(m,b){m.relatedTarget!==null&&(m.relatedTarget===c.value||m.relatedTarget===h.value||m.relatedTarget===a.value||m.relatedTarget===s.value)||(b==="focus"?(nn(m),D.value=!0):b==="blur"&&(on(m),D.value=!1))}function Cn(m,b){St(m,b,"change")}function bn(m){cn(m)}function wn(m){rn(m),Ti()}function Ti(){i.pair?(Ve(["",""],{source:"clear"}),It(["",""],{source:"clear"})):(Ve("",{source:"clear"}),It("",{source:"clear"}))}function Pn(m){const{onMousedown:b}=i;b&&b(m);const{tagName:O}=m.target;if(O!=="INPUT"&&O!=="TEXTAREA"){if(i.resizable){const{value:Q}=s;if(Q){const{left:ae,top:J,width:Oe,height:je}=Q.getBoundingClientRect(),ze=14;if(ae+Oe-ze<m.clientX&&m.clientX<ae+Oe&&J+je-ze<m.clientY&&m.clientY<J+je)return}}m.preventDefault(),D.value||$i()}}function In(){var m;G.value=!0,i.type==="textarea"&&((m=f.value)===null||m===void 0||m.handleMouseEnterWrapper())}function Sn(){var m;G.value=!1,i.type==="textarea"&&((m=f.value)===null||m===void 0||m.handleMouseLeaveWrapper())}function kn(){x.value||de.value==="click"&&(R.value=!R.value)}function Mn(m){if(x.value)return;m.preventDefault();const b=Q=>{Q.preventDefault(),Ui("mouseup",document,b)};if(Ai("mouseup",document,b),de.value!=="mousedown")return;R.value=!0;const O=()=>{R.value=!1,Ui("mouseup",document,O)};Ai("mouseup",document,O)}function _n(m){i.onKeyup&&ce(i.onKeyup,m)}function Dn(m){switch(i.onKeydown&&ce(i.onKeydown,m),m.key){case"Escape":Yt();break;case"Enter":Fn(m);break}}function Fn(m){var b,O;if(i.passivelyActivated){const{value:Q}=L;if(Q){i.internalDeactivateOnEnter&&Yt();return}m.preventDefault(),i.type==="textarea"?(b=a.value)===null||b===void 0||b.focus():(O=c.value)===null||O===void 0||O.focus()}}function Yt(){i.passivelyActivated&&(L.value=!1,Ze(()=>{var m;(m=s.value)===null||m===void 0||m.focus()}))}function $i(){var m,b,O;x.value||(i.passivelyActivated?(m=s.value)===null||m===void 0||m.focus():((b=a.value)===null||b===void 0||b.focus(),(O=c.value)===null||O===void 0||O.focus()))}function En(){var m;!((m=s.value)===null||m===void 0)&&m.contains(document.activeElement)&&document.activeElement.blur()}function Rn(){var m,b;(m=a.value)===null||m===void 0||m.select(),(b=c.value)===null||b===void 0||b.select()}function Bn(){x.value||(a.value?a.value.focus():c.value&&c.value.focus())}function On(){const{value:m}=s;m!=null&&m.contains(document.activeElement)&&m!==document.activeElement&&Yt()}function jn(m){if(i.type==="textarea"){const{value:b}=a;b==null||b.scrollTo(m)}else{const{value:b}=c;b==null||b.scrollTo(m)}}function qt(m){const{type:b,pair:O,autosize:Q}=i;if(!O&&Q)if(b==="textarea"){const{value:ae}=l;ae&&(ae.textContent="".concat(m!=null?m:"","\r\n"))}else{const{value:ae}=d;ae&&(m?ae.textContent=m:ae.innerHTML="&nbsp;")}}function zn(){Se()}const Wi=B({top:"0"});function Ln(m){var b;const{scrollTop:O}=m.target;Wi.value.top="".concat(-O,"px"),(b=f.value)===null||b===void 0||b.syncUnifiedContainer()}let Mt=null;At(()=>{const{autosize:m,type:b}=i;m&&b==="textarea"?Mt=X(w,O=>{!Array.isArray(O)&&O!==$&&qt(O)}):Mt==null||Mt()});let _t=null;At(()=>{i.type==="textarea"?_t=X(w,m=>{var b;!Array.isArray(m)&&m!==$&&((b=f.value)===null||b===void 0||b.syncUnifiedContainer())}):_t==null||_t()}),Pe(Bo,{mergedValueRef:w,maxlengthRef:Ae,mergedClsPrefixRef:e,countGraphemesRef:ie(i,"countGraphemes")});const Tn={wrapperElRef:s,inputElRef:c,textareaElRef:a,isCompositing:k,clear:Ti,focus:$i,blur:En,select:Rn,deactivate:On,activate:Bn,scrollTo:jn},$n=bo("Input",n,e),Ni=z(()=>{const{value:m}=y,{common:{cubicBezierEaseInOut:b},self:{color:O,borderRadius:Q,textColor:ae,caretColor:J,caretColorError:Oe,caretColorWarning:je,textDecorationColor:ze,border:at,borderDisabled:lt,borderHover:Zt,borderFocus:Wn,placeholderColor:Nn,placeholderColorDisabled:An,lineHeightTextarea:Un,colorDisabled:Vn,colorFocus:Gn,textColorDisabled:Hn,boxShadowFocus:Xn,iconSize:Kn,colorFocusWarning:Yn,boxShadowFocusWarning:qn,borderWarning:Zn,borderFocusWarning:Jn,borderHoverWarning:Qn,colorFocusError:er,boxShadowFocusError:tr,borderError:ir,borderFocusError:or,borderHoverError:nr,clearSize:rr,clearColor:sr,clearColorHover:ar,clearColorPressed:lr,iconColor:dr,iconColorDisabled:cr,suffixTextColor:ur,countTextColor:hr,countTextColorDisabled:pr,iconColorHover:gr,iconColorPressed:fr,loadingColor:mr,loadingColorError:vr,loadingColorWarning:yr,fontWeight:xr,[he("padding",m)]:Cr,[he("fontSize",m)]:br,[he("height",m)]:wr}}=r.value,{left:Pr,right:Ir}=wo(Cr);return{"--n-bezier":b,"--n-count-text-color":hr,"--n-count-text-color-disabled":pr,"--n-color":O,"--n-font-size":br,"--n-font-weight":xr,"--n-border-radius":Q,"--n-height":wr,"--n-padding-left":Pr,"--n-padding-right":Ir,"--n-text-color":ae,"--n-caret-color":J,"--n-text-decoration-color":ze,"--n-border":at,"--n-border-disabled":lt,"--n-border-hover":Zt,"--n-border-focus":Wn,"--n-placeholder-color":Nn,"--n-placeholder-color-disabled":An,"--n-icon-size":Kn,"--n-line-height-textarea":Un,"--n-color-disabled":Vn,"--n-color-focus":Gn,"--n-text-color-disabled":Hn,"--n-box-shadow-focus":Xn,"--n-loading-color":mr,"--n-caret-color-warning":je,"--n-color-focus-warning":Yn,"--n-box-shadow-focus-warning":qn,"--n-border-warning":Zn,"--n-border-focus-warning":Jn,"--n-border-hover-warning":Qn,"--n-loading-color-warning":yr,"--n-caret-color-error":Oe,"--n-color-focus-error":er,"--n-box-shadow-focus-error":tr,"--n-border-error":ir,"--n-border-focus-error":or,"--n-border-hover-error":nr,"--n-loading-color-error":vr,"--n-clear-color":sr,"--n-clear-size":rr,"--n-clear-color-hover":ar,"--n-clear-color-pressed":lr,"--n-icon-color":dr,"--n-icon-color-hover":gr,"--n-icon-color-pressed":fr,"--n-icon-color-disabled":cr,"--n-suffix-text-color":ur}}),Ge=o?it("input",z(()=>{const{value:m}=y;return m[0]}),Ni,i):void 0;return Object.assign(Object.assign({},Tn),{wrapperElRef:s,inputElRef:c,inputMirrorElRef:d,inputEl2Ref:h,textareaElRef:a,textareaMirrorElRef:l,textareaScrollbarInstRef:f,rtlEnabled:$n,uncontrolledValue:S,mergedValue:w,passwordVisible:R,mergedPlaceholder:W,showPlaceholder1:le,showPlaceholder2:te,mergedFocus:oe,isComposing:k,activated:L,showClearButton:K,mergedSize:y,mergedDisabled:x,textDecorationStyle:N,mergedClsPrefix:e,mergedBordered:t,mergedShowPasswordOn:de,placeholderStyle:Wi,mergedStatus:_,textAreaScrollContainerWidth:H,handleTextAreaScroll:Ln,handleCompositionStart:pn,handleCompositionEnd:gn,handleInput:St,handleInputBlur:mn,handleInputFocus:vn,handleWrapperBlur:yn,handleWrapperFocus:xn,handleMouseEnter:In,handleMouseLeave:Sn,handleMouseDown:Pn,handleChange:Cn,handleClick:bn,handleClear:wn,handlePasswordToggleClick:kn,handlePasswordToggleMousedown:Mn,handleWrapperKeydown:Dn,handleWrapperKeyup:_n,handleTextAreaMirrorResize:zn,getTextareaScrollContainer:()=>a.value,mergedTheme:r,cssVars:o?void 0:Ni,themeClass:Ge==null?void 0:Ge.themeClass,onRender:Ge==null?void 0:Ge.onRender})},render(){var i,e;const{mergedClsPrefix:t,mergedStatus:o,themeClass:n,type:r,countGraphemes:s,onRender:a}=this,l=this.$slots;return a==null||a(),g("div",{ref:"wrapperElRef",class:["".concat(t,"-input"),n,o&&"".concat(t,"-input--").concat(o,"-status"),{["".concat(t,"-input--rtl")]:this.rtlEnabled,["".concat(t,"-input--disabled")]:this.mergedDisabled,["".concat(t,"-input--textarea")]:r==="textarea",["".concat(t,"-input--resizable")]:this.resizable&&!this.autosize,["".concat(t,"-input--autosize")]:this.autosize,["".concat(t,"-input--round")]:this.round&&r!=="textarea",["".concat(t,"-input--pair")]:this.pair,["".concat(t,"-input--focus")]:this.mergedFocus,["".concat(t,"-input--stateful")]:this.stateful}],style:this.cssVars,tabindex:!this.mergedDisabled&&this.passivelyActivated&&!this.activated?0:void 0,onFocus:this.handleWrapperFocus,onBlur:this.handleWrapperBlur,onClick:this.handleClick,onMousedown:this.handleMouseDown,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd,onKeyup:this.handleWrapperKeyup,onKeydown:this.handleWrapperKeydown},g("div",{class:"".concat(t,"-input-wrapper")},ut(l.prefix,d=>d&&g("div",{class:"".concat(t,"-input__prefix")},d)),r==="textarea"?g(Rr,{ref:"textareaScrollbarInstRef",class:"".concat(t,"-input__textarea"),container:this.getTextareaScrollContainer,triggerDisplayManually:!0,useUnifiedContainer:!0,internalHoistYRail:!0},{default:()=>{var d,c;const{textAreaScrollContainerWidth:h}=this,u={width:this.autosize&&h&&"".concat(h,"px")};return g(Ne,null,g("textarea",Object.assign({},this.inputProps,{ref:"textareaElRef",class:["".concat(t,"-input__textarea-el"),(d=this.inputProps)===null||d===void 0?void 0:d.class],autofocus:this.autofocus,rows:Number(this.rows),placeholder:this.placeholder,value:this.mergedValue,disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,readonly:this.readonly,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,style:[this.textDecorationStyle[0],(c=this.inputProps)===null||c===void 0?void 0:c.style,u],onBlur:this.handleInputBlur,onFocus:p=>{this.handleInputFocus(p,2)},onInput:this.handleInput,onChange:this.handleChange,onScroll:this.handleTextAreaScroll})),this.showPlaceholder1?g("div",{class:"".concat(t,"-input__placeholder"),style:[this.placeholderStyle,u],key:"placeholder"},this.mergedPlaceholder[0]):null,this.autosize?g(Br,{onResize:this.handleTextAreaMirrorResize},{default:()=>g("div",{ref:"textareaMirrorElRef",class:"".concat(t,"-input__textarea-mirror"),key:"mirror"})}):null)}}):g("div",{class:"".concat(t,"-input__input")},g("input",Object.assign({type:r==="password"&&this.mergedShowPasswordOn&&this.passwordVisible?"text":r},this.inputProps,{ref:"inputElRef",class:["".concat(t,"-input__input-el"),(i=this.inputProps)===null||i===void 0?void 0:i.class],style:[this.textDecorationStyle[0],(e=this.inputProps)===null||e===void 0?void 0:e.style],tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[0],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[0]:this.mergedValue,readonly:this.readonly,autofocus:this.autofocus,size:this.attrSize,onBlur:this.handleInputBlur,onFocus:d=>{this.handleInputFocus(d,0)},onInput:d=>{this.handleInput(d,0)},onChange:d=>{this.handleChange(d,0)}})),this.showPlaceholder1?g("div",{class:"".concat(t,"-input__placeholder")},g("span",null,this.mergedPlaceholder[0])):null,this.autosize?g("div",{class:"".concat(t,"-input__input-mirror"),key:"mirror",ref:"inputMirrorElRef"},"Â "):null),!this.pair&&ut(l.suffix,d=>d||this.clearable||this.showCount||this.mergedShowPasswordOn||this.loading!==void 0?g("div",{class:"".concat(t,"-input__suffix")},[ut(l["clear-icon-placeholder"],c=>(this.clearable||c)&&g(ci,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{placeholder:()=>c,icon:()=>{var h,u;return(u=(h=this.$slots)["clear-icon"])===null||u===void 0?void 0:u.call(h)}})),this.internalLoadingBeforeSuffix?null:d,this.loading!==void 0?g(Ys,{clsPrefix:t,loading:this.loading,showArrow:!1,showClear:!1,style:this.cssVars}):null,this.internalLoadingBeforeSuffix?d:null,this.showCount&&this.type!=="textarea"?g(Ki,null,{default:c=>{var h;const{renderCount:u}=this;return u?u(c):(h=l.count)===null||h===void 0?void 0:h.call(l,c)}}):null,this.mergedShowPasswordOn&&this.type==="password"?g("div",{class:"".concat(t,"-input__eye"),onMousedown:this.handlePasswordToggleMousedown,onClick:this.handlePasswordToggleClick},this.passwordVisible?We(l["password-visible-icon"],()=>[g(ge,{clsPrefix:t},{default:()=>g(Ro,null)})]):We(l["password-invisible-icon"],()=>[g(ge,{clsPrefix:t},{default:()=>g(Gs,null)})])):null]):null)),this.pair?g("span",{class:"".concat(t,"-input__separator")},We(l.separator,()=>[this.separator])):null,this.pair?g("div",{class:"".concat(t,"-input-wrapper")},g("div",{class:"".concat(t,"-input__input")},g("input",{ref:"inputEl2Ref",type:this.type,class:"".concat(t,"-input__input-el"),tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[1],disabled:this.mergedDisabled,maxlength:s?void 0:this.maxlength,minlength:s?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[1]:void 0,readonly:this.readonly,style:this.textDecorationStyle[1],onBlur:this.handleInputBlur,onFocus:d=>{this.handleInputFocus(d,1)},onInput:d=>{this.handleInput(d,1)},onChange:d=>{this.handleChange(d,1)}}),this.showPlaceholder2?g("div",{class:"".concat(t,"-input__placeholder")},g("span",null,this.mergedPlaceholder[1])):null),ut(l.suffix,d=>(this.clearable||d)&&g("div",{class:"".concat(t,"-input__suffix")},[this.clearable&&g(ci,{clsPrefix:t,show:this.showClearButton,onClear:this.handleClear},{icon:()=>{var c;return(c=l["clear-icon"])===null||c===void 0?void 0:c.call(l)},placeholder:()=>{var c;return(c=l["clear-icon-placeholder"])===null||c===void 0?void 0:c.call(l)}}),d]))):null,this.mergedBordered?g("div",{class:"".concat(t,"-input__border")}):null,this.mergedBordered?g("div",{class:"".concat(t,"-input__state-border")}):null,this.showCount&&r==="textarea"?g(Ki,null,{default:d=>{var c;const{renderCount:h}=this;return h?h(d):(c=l.count)===null||c===void 0?void 0:c.call(l,d)}}):null)}});function Oo(){const i=re(zr,null);return i===null&&Ct("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),i}const ra={success:g(Ci,null),error:g(vi,null),warning:g(yi,null),info:g(xi,null)},sa=E({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(i,{slots:e}){function t(n,r,s,a){const{gapDegree:l,viewBoxWidth:d,strokeWidth:c}=i,h=50,u=0,p=h,f=0,v=2*h,S=50+c/2,P="M ".concat(S,",").concat(S," m ").concat(u,",").concat(p,"\n      a ").concat(h,",").concat(h," 0 1 1 ").concat(f,",").concat(-v,"\n      a ").concat(h,",").concat(h," 0 1 1 ").concat(-f,",").concat(v),w=Math.PI*2*h,C={stroke:a==="rail"?s:typeof i.fillColor=="object"?"url(#gradient)":s,strokeDasharray:"".concat(n/100*(w-l),"px ").concat(d*8,"px"),strokeDashoffset:"-".concat(l/2,"px"),transformOrigin:r?"center":void 0,transform:r?"rotate(".concat(r,"deg)"):void 0};return{pathString:P,pathStyle:C}}const o=()=>{const n=typeof i.fillColor=="object",r=n?i.fillColor.stops[0]:"",s=n?i.fillColor.stops[1]:"";return n&&g("defs",null,g("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},g("stop",{offset:"0%","stop-color":r}),g("stop",{offset:"100%","stop-color":s})))};return()=>{const{fillColor:n,railColor:r,strokeWidth:s,offsetDegree:a,status:l,percentage:d,showIndicator:c,indicatorTextColor:h,unit:u,gapOffsetDegree:p,clsPrefix:f}=i,{pathString:v,pathStyle:S}=t(100,0,r,"rail"),{pathString:P,pathStyle:w}=t(d,a,n,"fill"),C=100+s;return g("div",{class:"".concat(f,"-progress-content"),role:"none"},g("div",{class:"".concat(f,"-progress-graph"),"aria-hidden":!0},g("div",{class:"".concat(f,"-progress-graph-circle"),style:{transform:p?"rotate(".concat(p,"deg)"):void 0}},g("svg",{viewBox:"0 0 ".concat(C," ").concat(C)},o(),g("g",null,g("path",{class:"".concat(f,"-progress-graph-circle-rail"),d:v,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:S})),g("g",null,g("path",{class:["".concat(f,"-progress-graph-circle-fill"),d===0&&"".concat(f,"-progress-graph-circle-fill--empty")],d:P,"stroke-width":s,"stroke-linecap":"round",fill:"none",style:w}))))),c?g("div",null,e.default?g("div",{class:"".concat(f,"-progress-custom-content"),role:"none"},e.default()):l!=="default"?g("div",{class:"".concat(f,"-progress-icon"),"aria-hidden":!0},g(ge,{clsPrefix:f},{default:()=>ra[l]})):g("div",{class:"".concat(f,"-progress-text"),style:{color:h},role:"none"},g("span",{class:"".concat(f,"-progress-text__percentage")},d),g("span",{class:"".concat(f,"-progress-text__unit")},u))):null)}}}),aa={success:g(Ci,null),error:g(vi,null),warning:g(yi,null),info:g(xi,null)},la=E({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(i,{slots:e}){const t=z(()=>He(i.height)),o=z(()=>{var s,a;return typeof i.fillColor=="object"?"linear-gradient(to right, ".concat((s=i.fillColor)===null||s===void 0?void 0:s.stops[0]," , ").concat((a=i.fillColor)===null||a===void 0?void 0:a.stops[1],")"):i.fillColor}),n=z(()=>i.railBorderRadius!==void 0?He(i.railBorderRadius):i.height!==void 0?He(i.height,{c:.5}):""),r=z(()=>i.fillBorderRadius!==void 0?He(i.fillBorderRadius):i.railBorderRadius!==void 0?He(i.railBorderRadius):i.height!==void 0?He(i.height,{c:.5}):"");return()=>{const{indicatorPlacement:s,railColor:a,railStyle:l,percentage:d,unit:c,indicatorTextColor:h,status:u,showIndicator:p,processing:f,clsPrefix:v}=i;return g("div",{class:"".concat(v,"-progress-content"),role:"none"},g("div",{class:"".concat(v,"-progress-graph"),"aria-hidden":!0},g("div",{class:["".concat(v,"-progress-graph-line"),{["".concat(v,"-progress-graph-line--indicator-").concat(s)]:!0}]},g("div",{class:"".concat(v,"-progress-graph-line-rail"),style:[{backgroundColor:a,height:t.value,borderRadius:n.value},l]},g("div",{class:["".concat(v,"-progress-graph-line-fill"),f&&"".concat(v,"-progress-graph-line-fill--processing")],style:{maxWidth:"".concat(i.percentage,"%"),background:o.value,height:t.value,lineHeight:t.value,borderRadius:r.value}},s==="inside"?g("div",{class:"".concat(v,"-progress-graph-line-indicator"),style:{color:h}},e.default?e.default():"".concat(d).concat(c)):null)))),p&&s==="outside"?g("div",null,e.default?g("div",{class:"".concat(v,"-progress-custom-content"),style:{color:h},role:"none"},e.default()):u==="default"?g("div",{role:"none",class:"".concat(v,"-progress-icon ").concat(v,"-progress-icon--as-text"),style:{color:h}},d,c):g("div",{class:"".concat(v,"-progress-icon"),"aria-hidden":!0},g(ge,{clsPrefix:v},{default:()=>aa[u]}))):null)}}});function Yi(i,e,t=100){return"m ".concat(t/2," ").concat(t/2-i," a ").concat(i," ").concat(i," 0 1 1 0 ").concat(2*i," a ").concat(i," ").concat(i," 0 1 1 0 -").concat(2*i)}const da=E({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:()=>[]},railColor:{type:Array,default:()=>[]},railStyle:{type:Array,default:()=>[]}},setup(i,{slots:e}){const t=z(()=>i.percentage.map((r,s)=>"".concat(Math.PI*r/100*(i.viewBoxWidth/2-i.strokeWidth/2*(1+2*s)-i.circleGap*s)*2,", ").concat(i.viewBoxWidth*8))),o=(n,r)=>{const s=i.fillColor[r],a=typeof s=="object"?s.stops[0]:"",l=typeof s=="object"?s.stops[1]:"";return typeof i.fillColor[r]=="object"&&g("linearGradient",{id:"gradient-".concat(r),x1:"100%",y1:"0%",x2:"0%",y2:"100%"},g("stop",{offset:"0%","stop-color":a}),g("stop",{offset:"100%","stop-color":l}))};return()=>{const{viewBoxWidth:n,strokeWidth:r,circleGap:s,showIndicator:a,fillColor:l,railColor:d,railStyle:c,percentage:h,clsPrefix:u}=i;return g("div",{class:"".concat(u,"-progress-content"),role:"none"},g("div",{class:"".concat(u,"-progress-graph"),"aria-hidden":!0},g("div",{class:"".concat(u,"-progress-graph-circle")},g("svg",{viewBox:"0 0 ".concat(n," ").concat(n)},g("defs",null,h.map((p,f)=>o(p,f))),h.map((p,f)=>g("g",{key:f},g("path",{class:"".concat(u,"-progress-graph-circle-rail"),d:Yi(n/2-r/2*(1+2*f)-s*f,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:d[f]},c[f]]}),g("path",{class:["".concat(u,"-progress-graph-circle-fill"),p===0&&"".concat(u,"-progress-graph-circle-fill--empty")],d:Yi(n/2-r/2*(1+2*f)-s*f,r,n),"stroke-width":r,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:t.value[f],strokeDashoffset:0,stroke:typeof l[f]=="object"?"url(#gradient-".concat(f,")"):l[f]}})))))),a&&e.default?g("div",null,g("div",{class:"".concat(u,"-progress-text")},e.default())):null)}}}),ca=A([I("progress",{display:"inline-block"},[I("progress-icon","\n color: var(--n-icon-color);\n transition: color .3s var(--n-bezier);\n "),T("line","\n width: 100%;\n display: block;\n ",[I("progress-content","\n display: flex;\n align-items: center;\n ",[I("progress-graph",{flex:1})]),I("progress-custom-content",{marginLeft:"14px"}),I("progress-icon","\n width: 30px;\n padding-left: 14px;\n height: var(--n-icon-size-line);\n line-height: var(--n-icon-size-line);\n font-size: var(--n-icon-size-line);\n ",[T("as-text","\n color: var(--n-text-color-line-outer);\n text-align: center;\n width: 40px;\n font-size: var(--n-font-size);\n padding-left: 4px;\n transition: color .3s var(--n-bezier);\n ")])]),T("circle, dashboard",{width:"120px"},[I("progress-custom-content","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n "),I("progress-text","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: inherit;\n font-size: var(--n-font-size-circle);\n color: var(--n-text-color-circle);\n font-weight: var(--n-font-weight-circle);\n transition: color .3s var(--n-bezier);\n white-space: nowrap;\n "),I("progress-icon","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: var(--n-icon-color);\n font-size: var(--n-icon-size-circle);\n ")]),T("multiple-circle","\n width: 200px;\n color: inherit;\n ",[I("progress-text","\n font-weight: var(--n-font-weight-circle);\n color: var(--n-text-color-circle);\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n ")]),I("progress-content",{position:"relative"}),I("progress-graph",{position:"relative"},[I("progress-graph-circle",[A("svg",{verticalAlign:"bottom"}),I("progress-graph-circle-fill","\n stroke: var(--n-fill-color);\n transition:\n opacity .3s var(--n-bezier),\n stroke .3s var(--n-bezier),\n stroke-dasharray .3s var(--n-bezier);\n ",[T("empty",{opacity:0})]),I("progress-graph-circle-rail","\n transition: stroke .3s var(--n-bezier);\n overflow: hidden;\n stroke: var(--n-rail-color);\n ")]),I("progress-graph-line",[T("indicator-inside",[I("progress-graph-line-rail","\n height: 16px;\n line-height: 16px;\n border-radius: 10px;\n ",[I("progress-graph-line-fill","\n height: inherit;\n border-radius: 10px;\n "),I("progress-graph-line-indicator","\n background: #0000;\n white-space: nowrap;\n text-align: right;\n margin-left: 14px;\n margin-right: 14px;\n height: inherit;\n font-size: 12px;\n color: var(--n-text-color-line-inner);\n transition: color .3s var(--n-bezier);\n ")])]),T("indicator-inside-label","\n height: 16px;\n display: flex;\n align-items: center;\n ",[I("progress-graph-line-rail","\n flex: 1;\n transition: background-color .3s var(--n-bezier);\n "),I("progress-graph-line-indicator","\n background: var(--n-fill-color);\n font-size: 12px;\n transform: translateZ(0);\n display: flex;\n vertical-align: middle;\n height: 16px;\n line-height: 16px;\n padding: 0 10px;\n border-radius: 10px;\n position: absolute;\n white-space: nowrap;\n color: var(--n-text-color-line-inner);\n transition:\n right .2s var(--n-bezier),\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n ")]),I("progress-graph-line-rail","\n position: relative;\n overflow: hidden;\n height: var(--n-rail-height);\n border-radius: 5px;\n background-color: var(--n-rail-color);\n transition: background-color .3s var(--n-bezier);\n ",[I("progress-graph-line-fill","\n background: var(--n-fill-color);\n position: relative;\n border-radius: 5px;\n height: inherit;\n width: 100%;\n max-width: 0%;\n transition:\n background-color .3s var(--n-bezier),\n max-width .2s var(--n-bezier);\n ",[T("processing",[A("&::after",'\n content: "";\n background-image: var(--n-line-bg-processing);\n animation: progress-processing-animation 2s var(--n-bezier) infinite;\n ')])])])])])]),A("@keyframes progress-processing-animation","\n 0% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 100%;\n opacity: 1;\n }\n 66% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n 100% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n ")]),ua=Object.assign(Object.assign({},ve.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),ha=E({name:"Progress",props:ua,setup(i){const e=z(()=>i.indicatorPlacement||i.indicatorPosition),t=z(()=>{if(i.gapDegree||i.gapDegree===0)return i.gapDegree;if(i.type==="dashboard")return 75}),{mergedClsPrefixRef:o,inlineThemeDisabled:n}=tt(i),r=ve("Progress","-progress",ca,Lr,i,o),s=z(()=>{const{status:l}=i,{common:{cubicBezierEaseInOut:d},self:{fontSize:c,fontSizeCircle:h,railColor:u,railHeight:p,iconSizeCircle:f,iconSizeLine:v,textColorCircle:S,textColorLineInner:P,textColorLineOuter:w,lineBgProcessing:C,fontWeightCircle:y,[he("iconColor",l)]:x,[he("fillColor",l)]:_}}=r.value;return{"--n-bezier":d,"--n-fill-color":_,"--n-font-size":c,"--n-font-size-circle":h,"--n-font-weight-circle":y,"--n-icon-color":x,"--n-icon-size-circle":f,"--n-icon-size-line":v,"--n-line-bg-processing":C,"--n-rail-color":u,"--n-rail-height":p,"--n-text-color-circle":S,"--n-text-color-line-inner":P,"--n-text-color-line-outer":w}}),a=n?it("progress",z(()=>i.status[0]),s,i):void 0;return{mergedClsPrefix:o,mergedIndicatorPlacement:e,gapDeg:t,cssVars:n?void 0:s,themeClass:a==null?void 0:a.themeClass,onRender:a==null?void 0:a.onRender}},render(){const{type:i,cssVars:e,indicatorTextColor:t,showIndicator:o,status:n,railColor:r,railStyle:s,color:a,percentage:l,viewBoxWidth:d,strokeWidth:c,mergedIndicatorPlacement:h,unit:u,borderRadius:p,fillBorderRadius:f,height:v,processing:S,circleGap:P,mergedClsPrefix:w,gapDeg:C,gapOffsetDegree:y,themeClass:x,$slots:_,onRender:D}=this;return D==null||D(),g("div",{class:[x,"".concat(w,"-progress"),"".concat(w,"-progress--").concat(i),"".concat(w,"-progress--").concat(n)],style:e,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":l,role:i==="circle"||i==="line"||i==="dashboard"?"progressbar":"none"},i==="circle"||i==="dashboard"?g(sa,{clsPrefix:w,status:n,showIndicator:o,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,offsetDegree:this.offsetDegree,percentage:l,viewBoxWidth:d,strokeWidth:c,gapDegree:C===void 0?i==="dashboard"?75:0:C,gapOffsetDegree:y,unit:u},_):i==="line"?g(la,{clsPrefix:w,status:n,showIndicator:o,indicatorTextColor:t,railColor:r,fillColor:a,railStyle:s,percentage:l,processing:S,indicatorPlacement:h,unit:u,fillBorderRadius:f,railBorderRadius:p,height:v},_):i==="multiple-circle"?g(da,{clsPrefix:w,strokeWidth:c,railColor:r,fillColor:a,railStyle:s,viewBoxWidth:d,percentage:l,showIndicator:o,circleGap:P},_):null)}}),pa=A([A("@keyframes spin-rotate","\n from {\n transform: rotate(0);\n }\n to {\n transform: rotate(360deg);\n }\n "),I("spin-container","\n position: relative;\n ",[I("spin-body","\n position: absolute;\n top: 50%;\n left: 50%;\n transform: translateX(-50%) translateY(-50%);\n ",[Tr()])]),I("spin-body","\n display: inline-flex;\n align-items: center;\n justify-content: center;\n flex-direction: column;\n "),I("spin","\n display: inline-flex;\n height: var(--n-size);\n width: var(--n-size);\n font-size: var(--n-size);\n color: var(--n-color);\n ",[T("rotate","\n animation: spin-rotate 2s linear infinite;\n ")]),I("spin-description","\n display: inline-block;\n font-size: var(--n-font-size);\n color: var(--n-text-color);\n transition: color .3s var(--n-bezier);\n margin-top: 8px;\n "),I("spin-content","\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n pointer-events: all;\n ",[T("spinning","\n user-select: none;\n -webkit-user-select: none;\n pointer-events: none;\n opacity: var(--n-opacity-spinning);\n ")])]),ga={small:20,medium:18,large:16},fa=Object.assign(Object.assign({},ve.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:()=>!0,default:void 0},delay:Number}),ma=E({name:"Spin",props:fa,slots:Object,setup(i){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=tt(i),o=ve("Spin","-spin",pa,$r,i,e),n=z(()=>{const{size:l}=i,{common:{cubicBezierEaseInOut:d},self:c}=o.value,{opacitySpinning:h,color:u,textColor:p}=c,f=typeof l=="number"?Wr(l):c[he("size",l)];return{"--n-bezier":d,"--n-opacity-spinning":h,"--n-size":f,"--n-color":u,"--n-text-color":p}}),r=t?it("spin",z(()=>{const{size:l}=i;return typeof l=="number"?String(l):l[0]}),n,i):void 0,s=ko(i,["spinning","show"]),a=B(!1);return At(l=>{let d;if(s.value){const{delay:c}=i;if(c){d=window.setTimeout(()=>{a.value=!0},c),l(()=>{clearTimeout(d)});return}}a.value=s.value}),{mergedClsPrefix:e,active:a,mergedStrokeWidth:z(()=>{const{strokeWidth:l}=i;if(l!==void 0)return l;const{size:d}=i;return ga[typeof d=="number"?"medium":d]}),cssVars:t?void 0:n,themeClass:r==null?void 0:r.themeClass,onRender:r==null?void 0:r.onRender}},render(){var i,e;const{$slots:t,mergedClsPrefix:o,description:n}=this,r=t.icon&&this.rotate,s=(n||t.description)&&g("div",{class:"".concat(o,"-spin-description")},n||((i=t.description)===null||i===void 0?void 0:i.call(t))),a=t.icon?g("div",{class:["".concat(o,"-spin-body"),this.themeClass]},g("div",{class:["".concat(o,"-spin"),r&&"".concat(o,"-spin--rotate")],style:t.default?"":this.cssVars},t.icon()),s):g("div",{class:["".concat(o,"-spin-body"),this.themeClass]},g(Co,{clsPrefix:o,style:t.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:"".concat(o,"-spin")}),s);return(e=this.onRender)===null||e===void 0||e.call(this),t.default?g("div",{class:["".concat(o,"-spin-container"),this.themeClass],style:this.cssVars},g("div",{class:["".concat(o,"-spin-content"),this.active&&"".concat(o,"-spin-content--spinning"),this.contentClass],style:this.contentStyle},t),g(Ii,{name:"fade-in-transition"},{default:()=>this.active?a:null})):a}}),va=I("text","\n transition: color .3s var(--n-bezier);\n color: var(--n-text-color);\n",[T("strong","\n font-weight: var(--n-font-weight-strong);\n "),T("italic",{fontStyle:"italic"}),T("underline",{textDecoration:"underline"}),T("code","\n line-height: 1.4;\n display: inline-block;\n font-family: var(--n-font-famliy-mono);\n transition: \n color .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n box-sizing: border-box;\n padding: .05em .35em 0 .35em;\n border-radius: var(--n-code-border-radius);\n font-size: .9em;\n color: var(--n-code-text-color);\n background-color: var(--n-code-color);\n border: var(--n-code-border);\n ")]),ya=Object.assign(Object.assign({},ve.props),{code:Boolean,type:{type:String,default:"default"},delete:Boolean,strong:Boolean,italic:Boolean,underline:Boolean,depth:[String,Number],tag:String,as:{type:String,validator:()=>!0,default:void 0}}),xa=E({name:"Text",props:ya,setup(i){const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=tt(i),o=ve("Typography","-text",va,Nr,i,e),n=z(()=>{const{depth:s,type:a}=i,l=a==="default"?s===void 0?"textColor":"textColor".concat(s,"Depth"):he("textColor",a),{common:{fontWeightStrong:d,fontFamilyMono:c,cubicBezierEaseInOut:h},self:{codeTextColor:u,codeBorderRadius:p,codeColor:f,codeBorder:v,[l]:S}}=o.value;return{"--n-bezier":h,"--n-text-color":S,"--n-font-weight-strong":d,"--n-font-famliy-mono":c,"--n-code-border-radius":p,"--n-code-text-color":u,"--n-code-color":f,"--n-code-border":v}}),r=t?it("text",z(()=>"".concat(i.type[0]).concat(i.depth||"")),n,i):void 0;return{mergedClsPrefix:e,compitableTag:ko(i,["as","tag"]),cssVars:t?void 0:n,themeClass:r==null?void 0:r.themeClass,onRender:r==null?void 0:r.onRender}},render(){var i,e,t;const{mergedClsPrefix:o}=this;(i=this.onRender)===null||i===void 0||i.call(this);const n=["".concat(o,"-text"),this.themeClass,{["".concat(o,"-text--code")]:this.code,["".concat(o,"-text--delete")]:this.delete,["".concat(o,"-text--strong")]:this.strong,["".concat(o,"-text--italic")]:this.italic,["".concat(o,"-text--underline")]:this.underline}],r=(t=(e=this.$slots).default)===null||t===void 0?void 0:t.call(e);return this.code?g("code",{class:n,style:this.cssVars},this.delete?g("del",null,r):r):this.delete?g("del",{class:n,style:this.cssVars},r):g(this.compitableTag||"span",{class:n,style:this.cssVars},r)}}),nt=Po("n-upload"),Ca=A([I("upload","width: 100%;",[T("dragger-inside",[I("upload-trigger","\n display: block;\n ")]),T("drag-over",[I("upload-dragger","\n border: var(--n-dragger-border-hover);\n ")])]),I("upload-dragger","\n cursor: pointer;\n box-sizing: border-box;\n width: 100%;\n text-align: center;\n border-radius: var(--n-border-radius);\n padding: 24px;\n opacity: 1;\n transition:\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n background-color: var(--n-dragger-color);\n border: var(--n-dragger-border);\n ",[A("&:hover","\n border: var(--n-dragger-border-hover);\n "),T("disabled","\n cursor: not-allowed;\n ")]),I("upload-trigger","\n display: inline-block;\n box-sizing: border-box;\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[A("+",[I("upload-file-list","margin-top: 8px;")]),T("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n "),T("image-card","\n width: 96px;\n height: 96px;\n ",[I("base-icon","\n font-size: 24px;\n "),I("upload-dragger","\n padding: 0;\n height: 100%;\n width: 100%;\n display: flex;\n align-items: center;\n justify-content: center;\n ")])]),I("upload-file-list","\n line-height: var(--n-line-height);\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[A("a, img","outline: none;"),T("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n ",[I("upload-file","cursor: not-allowed;")]),T("grid","\n display: grid;\n grid-template-columns: repeat(auto-fill, 96px);\n grid-gap: 8px;\n margin-top: 0;\n "),I("upload-file","\n display: block;\n box-sizing: border-box;\n cursor: default;\n padding: 0px 12px 0 6px;\n transition: background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n ",[ri(),I("progress",[ri({foldPadding:!0})]),A("&:hover","\n background-color: var(--n-item-color-hover);\n ",[I("upload-file-info",[F("action","\n opacity: 1;\n ")])]),T("image-type","\n border-radius: var(--n-border-radius);\n text-decoration: underline;\n text-decoration-color: #0000;\n ",[I("upload-file-info","\n padding-top: 0px;\n padding-bottom: 0px;\n width: 100%;\n height: 100%;\n display: flex;\n justify-content: space-between;\n align-items: center;\n padding: 6px 0;\n ",[I("progress","\n padding: 2px 0;\n margin-bottom: 0;\n "),F("name","\n padding: 0 8px;\n "),F("thumbnail","\n width: 32px;\n height: 32px;\n font-size: 28px;\n display: flex;\n justify-content: center;\n align-items: center;\n ",[A("img","\n width: 100%;\n ")])])]),T("text-type",[I("progress","\n box-sizing: border-box;\n padding-bottom: 6px;\n margin-bottom: 6px;\n ")]),T("image-card-type","\n position: relative;\n width: 96px;\n height: 96px;\n border: var(--n-item-border-image-card);\n border-radius: var(--n-border-radius);\n padding: 0;\n display: flex;\n align-items: center;\n justify-content: center;\n transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n overflow: hidden;\n ",[I("progress","\n position: absolute;\n left: 8px;\n bottom: 8px;\n right: 8px;\n width: unset;\n "),I("upload-file-info","\n padding: 0;\n width: 100%;\n height: 100%;\n ",[F("thumbnail","\n width: 100%;\n height: 100%;\n display: flex;\n flex-direction: column;\n align-items: center;\n justify-content: center;\n font-size: 36px;\n ",[A("img","\n width: 100%;\n ")])]),A("&::before",'\n position: absolute;\n z-index: 1;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n opacity: 0;\n transition: opacity .2s var(--n-bezier);\n content: "";\n '),A("&:hover",[A("&::before","opacity: 1;"),I("upload-file-info",[F("thumbnail","opacity: .12;")])])]),T("error-status",[A("&:hover","\n background-color: var(--n-item-color-hover-error);\n "),I("upload-file-info",[F("name","color: var(--n-item-text-color-error);"),F("thumbnail","color: var(--n-item-text-color-error);")]),T("image-card-type","\n border: var(--n-item-border-image-card-error);\n ")]),T("with-url","\n cursor: pointer;\n ",[I("upload-file-info",[F("name","\n color: var(--n-item-text-color-success);\n text-decoration-color: var(--n-item-text-color-success);\n ",[A("a","\n text-decoration: underline;\n ")])])]),I("upload-file-info","\n position: relative;\n padding-top: 6px;\n padding-bottom: 6px;\n display: flex;\n flex-wrap: nowrap;\n ",[F("thumbnail","\n font-size: 18px;\n opacity: 1;\n transition: opacity .2s var(--n-bezier);\n color: var(--n-item-icon-color);\n ",[I("base-icon","\n margin-right: 2px;\n vertical-align: middle;\n transition: color .3s var(--n-bezier);\n ")]),F("action","\n padding-top: inherit;\n padding-bottom: inherit;\n position: absolute;\n right: 0;\n top: 0;\n bottom: 0;\n width: 80px;\n display: flex;\n align-items: center;\n transition: opacity .2s var(--n-bezier);\n justify-content: flex-end;\n opacity: 0;\n ",[I("button",[A("&:not(:last-child)",{marginRight:"4px"}),I("base-icon",[A("svg",[vo()])])]),T("image-type","\n position: relative;\n max-width: 80px;\n width: auto;\n "),T("image-card-type","\n z-index: 2;\n position: absolute;\n width: 100%;\n height: 100%;\n left: 0;\n right: 0;\n bottom: 0;\n top: 0;\n display: flex;\n justify-content: center;\n align-items: center;\n ")]),F("name","\n color: var(--n-item-text-color);\n flex: 1;\n display: flex;\n justify-content: center;\n text-overflow: ellipsis;\n overflow: hidden;\n flex-direction: column;\n text-decoration-color: #0000;\n font-size: var(--n-font-size);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier); \n ",[A("a","\n color: inherit;\n text-decoration: underline;\n ")])])])]),I("upload-file-input","\n display: none;\n width: 0;\n height: 0;\n opacity: 0;\n ")]),jo="__UPLOAD_DRAGGER__",zo=E({name:"UploadDragger",[jo]:!0,setup(i,{slots:e}){const t=re(nt,null);return t||Ct("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:o},mergedDisabledRef:{value:n},maxReachedRef:{value:r}}=t;return g("div",{class:["".concat(o,"-upload-dragger"),(n||r)&&"".concat(o,"-upload-dragger--disabled")]},e)}}}),ba=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),wa=g("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},g("g",{fill:"none"},g("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),Pa=E({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:re(nt).mergedThemeRef}},render(){return g(bi,null,{default:()=>this.show?g(ha,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null})}});var ui=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(o.next(c))}catch(h){s(h)}}function l(c){try{d(o.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((o=o.apply(i,e||[])).next())})};function Lo(i){return i.includes("image/")}function qi(i=""){const e=i.split("/"),o=e[e.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(o)||[""])[0]}const Zi=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,To=i=>{if(i.type)return Lo(i.type);const e=qi(i.name||"");if(Zi.test(e))return!0;const t=i.thumbnailUrl||i.url||"",o=qi(t);return!!(/^data:image\//.test(t)||Zi.test(o))};function Ia(i){return ui(this,void 0,void 0,function*(){return yield new Promise(e=>{if(!i.type||!Lo(i.type)){e("");return}e(window.URL.createObjectURL(i))})})}const Sa=Ar&&window.FileReader&&window.File;function ka(i){return i.isDirectory}function Ma(i){return i.isFile}function _a(i,e){return ui(this,void 0,void 0,function*(){const t=[];function o(n){return ui(this,void 0,void 0,function*(){for(const r of n)if(r){if(e&&ka(r)){const s=r.createReader();let a=[],l;try{do l=yield new Promise((d,c)=>{s.readEntries(d,c)}),a=a.concat(l);while(l.length>0)}catch(d){Vi("upload","error happens when handling directory upload",d)}yield o(a)}else if(Ma(r))try{const s=yield new Promise((a,l)=>{r.file(a,l)});t.push({file:s,entry:r,source:"dnd"})}catch(s){Vi("upload","error happens when handling file upload",s)}}})}return yield o(i),t})}function ft(i){const{id:e,name:t,percentage:o,status:n,url:r,file:s,thumbnailUrl:a,type:l,fullPath:d,batchId:c}=i;return{id:e,name:t,percentage:o!=null?o:null,status:n,url:r!=null?r:null,file:s!=null?s:null,thumbnailUrl:a!=null?a:null,type:l!=null?l:null,fullPath:d!=null?d:null,batchId:c!=null?c:null}}function Da(i,e,t){return i=i.toLowerCase(),e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase(),t.split(",").map(n=>n.trim()).filter(Boolean).some(n=>{if(n.startsWith(".")){if(i.endsWith(n))return!0}else if(n.includes("/")){const[r,s]=e.split("/"),[a,l]=n.split("/");if((a==="*"||r&&a&&a===r)&&(l==="*"||s&&l&&l===s))return!0}else return!0;return!1})}var Ji=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(o.next(c))}catch(h){s(h)}}function l(c){try{d(o.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((o=o.apply(i,e||[])).next())})};const Ot={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},Fa=E({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup(i){const e=re(nt),t=B(null),o=B(""),n=z(()=>{const{file:x}=i;return x.status==="finished"?"success":x.status==="error"?"error":"info"}),r=z(()=>{const{file:x}=i;if(x.status==="error")return"error"}),s=z(()=>{const{file:x}=i;return x.status==="uploading"}),a=z(()=>{if(!e.showCancelButtonRef.value)return!1;const{file:x}=i;return["uploading","pending","error"].includes(x.status)}),l=z(()=>{if(!e.showRemoveButtonRef.value)return!1;const{file:x}=i;return["finished"].includes(x.status)}),d=z(()=>{if(!e.showDownloadButtonRef.value)return!1;const{file:x}=i;return["finished"].includes(x.status)}),c=z(()=>{if(!e.showRetryButtonRef.value)return!1;const{file:x}=i;return["error"].includes(x.status)}),h=si(()=>o.value||i.file.thumbnailUrl||i.file.url),u=z(()=>{if(!e.showPreviewButtonRef.value)return!1;const{file:{status:x},listType:_}=i;return["finished"].includes(x)&&h.value&&_==="image-card"});function p(){return Ji(this,void 0,void 0,function*(){const x=e.onRetryRef.value;x&&(yield x({file:i.file}))===!1||e.submit(i.file.id)})}function f(x){x.preventDefault();const{file:_}=i;["finished","pending","error"].includes(_.status)?S(_):["uploading"].includes(_.status)?w(_):Ur("upload","The button clicked type is unknown.")}function v(x){x.preventDefault(),P(i.file)}function S(x){const{xhrMap:_,doChange:D,onRemoveRef:{value:G},mergedFileListRef:{value:k}}=e;Promise.resolve(G?G({file:Object.assign({},x),fileList:k,index:i.index}):!0).then(L=>{if(L===!1)return;const $=Object.assign({},x,{status:"removed"});_.delete(x.id),D($,void 0,{remove:!0})})}function P(x){const{onDownloadRef:{value:_},customDownloadRef:{value:D}}=e;Promise.resolve(_?_(Object.assign({},x)):!0).then(G=>{G!==!1&&(D?D(Object.assign({},x)):cs(x.url,x.name))})}function w(x){const{xhrMap:_}=e,D=_.get(x.id);D==null||D.abort(),S(Object.assign({},x))}function C(x){const{onPreviewRef:{value:_}}=e;if(_)_(i.file,{event:x});else if(i.listType==="image-card"){const{value:D}=t;if(!D)return;D.click()}}const y=()=>Ji(this,void 0,void 0,function*(){const{listType:x}=i;x!=="image"&&x!=="image-card"||e.shouldUseThumbnailUrlRef.value(i.file)&&(o.value=yield e.getFileThumbnailUrlResolver(i.file))});return At(()=>{y()}),{mergedTheme:e.mergedThemeRef,progressStatus:n,buttonType:r,showProgress:s,disabled:e.mergedDisabledRef,showCancelButton:a,showRemoveButton:l,showDownloadButton:d,showRetryButton:c,showPreviewButton:u,mergedThumbnailUrl:h,shouldUseThumbnailUrl:e.shouldUseThumbnailUrlRef,renderIcon:e.renderIconRef,imageRef:t,handleRemoveOrCancelClick:f,handleDownloadClick:v,handleRetryClick:p,handlePreviewClick:C}},render(){const{clsPrefix:i,mergedTheme:e,listType:t,file:o,renderIcon:n}=this;let r;const s=t==="image";s||t==="image-card"?r=!this.shouldUseThumbnailUrl(o)||!this.mergedThumbnailUrl?g("span",{class:"".concat(i,"-upload-file-info__thumbnail")},n?n(o):To(o)?g(ge,{clsPrefix:i},{default:ba}):g(ge,{clsPrefix:i},{default:wa})):g("a",{rel:"noopener noreferer",target:"_blank",href:o.url||void 0,class:"".concat(i,"-upload-file-info__thumbnail"),onClick:this.handlePreviewClick},t==="image-card"?g(ls,{src:this.mergedThumbnailUrl||void 0,previewSrc:o.url||void 0,alt:o.name,ref:"imageRef"}):g("img",{src:this.mergedThumbnailUrl||void 0,alt:o.name})):r=g("span",{class:"".concat(i,"-upload-file-info__thumbnail")},n?n(o):g(ge,{clsPrefix:i},{default:()=>g(Ns,null)}));const l=g(Pa,{show:this.showProgress,percentage:o.percentage||0,status:this.progressStatus}),d=t==="text"||t==="image";return g("div",{class:["".concat(i,"-upload-file"),"".concat(i,"-upload-file--").concat(this.progressStatus,"-status"),o.url&&o.status!=="error"&&t!=="image-card"&&"".concat(i,"-upload-file--with-url"),"".concat(i,"-upload-file--").concat(t,"-type")]},g("div",{class:"".concat(i,"-upload-file-info")},r,g("div",{class:"".concat(i,"-upload-file-info__name")},d&&(o.url&&o.status!=="error"?g("a",{rel:"noopener noreferer",target:"_blank",href:o.url||void 0,onClick:this.handlePreviewClick},o.name):g("span",{onClick:this.handlePreviewClick},o.name)),s&&l),g("div",{class:["".concat(i,"-upload-file-info__action"),"".concat(i,"-upload-file-info__action--").concat(t,"-type")]},this.showPreviewButton?g(qe,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Ot},{icon:()=>g(ge,{clsPrefix:i},{default:()=>g(Ro,null)})}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&g(qe,{key:"cancelOrTrash",theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:Ot,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:()=>g(yo,null,{default:()=>this.showRemoveButton?g(ge,{clsPrefix:i,key:"trash"},{default:()=>g(Xs,null)}):g(ge,{clsPrefix:i,key:"cancel"},{default:()=>g(As,null)})})}),this.showRetryButton&&!this.disabled&&g(qe,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Ot},{icon:()=>g(ge,{clsPrefix:i},{default:()=>g(Hs,null)})}),this.showDownloadButton?g(qe,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:e.peers.Button,themeOverrides:e.peerOverrides.Button,builtinThemeOverrides:Ot},{icon:()=>g(ge,{clsPrefix:i},{default:()=>g(ds,null)})}):null)),!s&&l)}}),$o=E({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup(i,{slots:e}){const t=re(nt,null);t||Ct("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef:o,mergedDisabledRef:n,maxReachedRef:r,listTypeRef:s,dragOverRef:a,openOpenFileDialog:l,draggerInsideRef:d,handleFileAddition:c,mergedDirectoryDndRef:h,triggerClassRef:u,triggerStyleRef:p}=t,f=z(()=>s.value==="image-card");function v(){n.value||r.value||l()}function S(y){y.preventDefault(),a.value=!0}function P(y){y.preventDefault(),a.value=!0}function w(y){y.preventDefault(),a.value=!1}function C(y){var x;if(y.preventDefault(),!d.value||n.value||r.value){a.value=!1;return}const _=(x=y.dataTransfer)===null||x===void 0?void 0:x.items;_!=null&&_.length?_a(Array.from(_).map(D=>D.webkitGetAsEntry()),h.value).then(D=>{c(D)}).finally(()=>{a.value=!1}):a.value=!1}return()=>{var y;const{value:x}=o;return i.abstract?(y=e.default)===null||y===void 0?void 0:y.call(e,{handleClick:v,handleDrop:C,handleDragOver:S,handleDragEnter:P,handleDragLeave:w}):g("div",{class:["".concat(x,"-upload-trigger"),(n.value||r.value)&&"".concat(x,"-upload-trigger--disabled"),f.value&&"".concat(x,"-upload-trigger--image-card"),u.value],style:p.value,onClick:v,onDrop:C,onDragover:S,onDragenter:P,onDragleave:w},f.value?g(zo,null,{default:()=>We(e.default,()=>[g(ge,{clsPrefix:x},{default:()=>g(Ws,null)})])}):e)}}}),Ea=E({name:"UploadFileList",setup(i,{slots:e}){const t=re(nt,null);t||Ct("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef:o,mergedClsPrefixRef:n,listTypeRef:r,mergedFileListRef:s,fileListClassRef:a,fileListStyleRef:l,cssVarsRef:d,themeClassRef:c,maxReachedRef:h,showTriggerRef:u,imageGroupPropsRef:p}=t,f=z(()=>r.value==="image-card"),v=()=>s.value.map((P,w)=>g(Fa,{clsPrefix:n.value,key:P.id,file:P,index:w,listType:r.value})),S=()=>f.value?g(us,Object.assign({},p.value),{default:v}):g(bi,{group:!0},{default:v});return()=>{const{value:P}=n,{value:w}=o;return g("div",{class:["".concat(P,"-upload-file-list"),f.value&&"".concat(P,"-upload-file-list--grid"),w?c==null?void 0:c.value:void 0,a.value],style:[w&&d?d.value:"",l.value]},S(),u.value&&!h.value&&f.value&&g($o,null,e))}}});var Qi=function(i,e,t,o){function n(r){return r instanceof t?r:new t(function(s){s(r)})}return new(t||(t=Promise))(function(r,s){function a(c){try{d(o.next(c))}catch(h){s(h)}}function l(c){try{d(o.throw(c))}catch(h){s(h)}}function d(c){c.done?r(c.value):n(c.value).then(a,l)}d((o=o.apply(i,e||[])).next())})};function Ra(i,e,t){const{doChange:o,xhrMap:n}=i;let r=0;function s(l){var d;let c=Object.assign({},e,{status:"error",percentage:r});n.delete(e.id),c=ft(((d=i.onError)===null||d===void 0?void 0:d.call(i,{file:c,event:l}))||c),o(c,l)}function a(l){var d;if(i.isErrorState){if(i.isErrorState(t)){s(l);return}}else if(t.status<200||t.status>=300){s(l);return}let c=Object.assign({},e,{status:"finished",percentage:r});n.delete(e.id),c=ft(((d=i.onFinish)===null||d===void 0?void 0:d.call(i,{file:c,event:l}))||c),o(c,l)}return{handleXHRLoad:a,handleXHRError:s,handleXHRAbort(l){const d=Object.assign({},e,{status:"removed",file:null,percentage:r});n.delete(e.id),o(d,l)},handleXHRProgress(l){const d=Object.assign({},e,{status:"uploading"});if(l.lengthComputable){const c=Math.ceil(l.loaded/l.total*100);d.percentage=c,r=c}o(d,l)}}}function Ba(i){const{inst:e,file:t,data:o,headers:n,withCredentials:r,action:s,customRequest:a}=i,{doChange:l}=i.inst;let d=0;a({file:t,data:o,headers:n,withCredentials:r,action:s,onProgress(c){const h=Object.assign({},t,{status:"uploading"}),u=c.percent;h.percentage=u,d=u,l(h)},onFinish(){var c;let h=Object.assign({},t,{status:"finished",percentage:d});h=ft(((c=e.onFinish)===null||c===void 0?void 0:c.call(e,{file:h}))||h),l(h)},onError(){var c;let h=Object.assign({},t,{status:"error",percentage:d});h=ft(((c=e.onError)===null||c===void 0?void 0:c.call(e,{file:h}))||h),l(h)}})}function Oa(i,e,t){const o=Ra(i,e,t);t.onabort=o.handleXHRAbort,t.onerror=o.handleXHRError,t.onload=o.handleXHRLoad,t.upload&&(t.upload.onprogress=o.handleXHRProgress)}function Wo(i,e){return typeof i=="function"?i({file:e}):i||{}}function ja(i,e,t){const o=Wo(e,t);o&&Object.keys(o).forEach(n=>{i.setRequestHeader(n,o[n])})}function za(i,e,t){const o=Wo(e,t);o&&Object.keys(o).forEach(n=>{i.append(n,o[n])})}function La(i,e,t,{method:o,action:n,withCredentials:r,responseType:s,headers:a,data:l}){const d=new XMLHttpRequest;d.responseType=s,i.xhrMap.set(t.id,d),d.withCredentials=r;const c=new FormData;if(za(c,l,t),t.file!==null&&c.append(e,t.file),Oa(i,t,d),n!==void 0){d.open(o.toUpperCase(),n),ja(d,a,t),d.send(c);const h=Object.assign({},t,{status:"uploading"});i.doChange(h)}}const Ta=Object.assign(Object.assign({},ve.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,customDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:()=>[]},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:i=>Sa?To(i):!1},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),$a=E({name:"Upload",props:Ta,setup(i){i.abstract&&i.listType==="image-card"&&Ct("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef:e,inlineThemeDisabled:t}=tt(i),o=ve("Upload","-upload",Ca,Vr,i,e),n=So(i),r=B(i.defaultFileList),s=ie(i,"fileList"),a=B(null),l={value:!1},d=B(!1),c=new Map,h=Io(s,r),u=z(()=>h.value.map(ft)),p=z(()=>{const{max:k}=i;return k!==void 0?u.value.length>=k:!1});function f(){var k;(k=a.value)===null||k===void 0||k.click()}function v(k){const L=k.target;C(L.files?Array.from(L.files).map($=>({file:$,entry:null,source:"input"})):null,k),L.value=""}function S(k){const{"onUpdate:fileList":L,onUpdateFileList:$}=i;L&&ce(L,k),$&&ce($,k),r.value=k}const P=z(()=>i.multiple||i.directory),w=(k,L,$={append:!1,remove:!1})=>{const{append:W,remove:le}=$,te=Array.from(u.value),oe=te.findIndex(K=>K.id===k.id);if(W||le||~oe){W?te.push(k):le?te.splice(oe,1):te.splice(oe,1,k);const{onChange:K}=i;K&&K({file:k,fileList:te,event:L}),S(te)}};function C(k,L){if(!k||k.length===0)return;const{onBeforeUpload:$}=i;k=P.value?k:[k[0]];const{max:W,accept:le}=i;k=k.filter(({file:oe,source:K})=>K==="dnd"&&(le!=null&&le.trim())?Da(oe.name,oe.type,le):!0),W&&(k=k.slice(0,W-u.value.length));const te=Gi();Promise.all(k.map(oe=>Qi(this,[oe],void 0,function*({file:K,entry:de}){var R;const N={id:Gi(),batchId:te,name:K.name,status:"pending",percentage:0,file:K,url:null,type:K.type,thumbnailUrl:null,fullPath:(R=de==null?void 0:de.fullPath)!==null&&R!==void 0?R:"/".concat(K.webkitRelativePath||K.name)};return!$||(yield $({file:N,fileList:u.value}))!==!1?N:null}))).then(oe=>Qi(this,void 0,void 0,function*(){let K=Promise.resolve();oe.forEach(de=>{K=K.then(Ze).then(()=>{de&&w(de,L,{append:!0})})}),yield K})).then(()=>{i.defaultUpload&&y()})}function y(k){const{method:L,action:$,withCredentials:W,headers:le,data:te,name:oe}=i,K=k!==void 0?u.value.filter(R=>R.id===k):u.value,de=k!==void 0;K.forEach(R=>{const{status:N}=R;(N==="pending"||N==="error"&&de)&&(i.customRequest?Ba({inst:{doChange:w,xhrMap:c,onFinish:i.onFinish,onError:i.onError},file:R,action:$,withCredentials:W,headers:le,data:te,customRequest:i.customRequest}):La({doChange:w,xhrMap:c,onFinish:i.onFinish,onError:i.onError,isErrorState:i.isErrorState},oe,R,{method:L,action:$,withCredentials:W,responseType:i.responseType,headers:le,data:te}))})}function x(k){var L;if(k.thumbnailUrl)return k.thumbnailUrl;const{createThumbnailUrl:$}=i;return $?(L=$(k.file,k))!==null&&L!==void 0?L:k.url||"":k.url?k.url:k.file?Ia(k.file):""}const _=z(()=>{const{common:{cubicBezierEaseInOut:k},self:{draggerColor:L,draggerBorder:$,draggerBorderHover:W,itemColorHover:le,itemColorHoverError:te,itemTextColorError:oe,itemTextColorSuccess:K,itemTextColor:de,itemIconColor:R,itemDisabledOpacity:N,lineHeight:H,borderRadius:Se,fontSize:Ae,itemBorderImageCardError:Ue,itemBorderImageCard:Ve}}=o.value;return{"--n-bezier":k,"--n-border-radius":Se,"--n-dragger-border":$,"--n-dragger-border-hover":W,"--n-dragger-color":L,"--n-font-size":Ae,"--n-item-color-hover":le,"--n-item-color-hover-error":te,"--n-item-disabled-opacity":N,"--n-item-icon-color":R,"--n-item-text-color":de,"--n-item-text-color-error":oe,"--n-item-text-color-success":K,"--n-line-height":H,"--n-item-border-image-card-error":Ue,"--n-item-border-image-card":Ve}}),D=t?it("upload",void 0,_,i):void 0;Pe(nt,{mergedClsPrefixRef:e,mergedThemeRef:o,showCancelButtonRef:ie(i,"showCancelButton"),showDownloadButtonRef:ie(i,"showDownloadButton"),showRemoveButtonRef:ie(i,"showRemoveButton"),showRetryButtonRef:ie(i,"showRetryButton"),onRemoveRef:ie(i,"onRemove"),onDownloadRef:ie(i,"onDownload"),customDownloadRef:ie(i,"customDownload"),mergedFileListRef:u,triggerClassRef:ie(i,"triggerClass"),triggerStyleRef:ie(i,"triggerStyle"),shouldUseThumbnailUrlRef:ie(i,"shouldUseThumbnailUrl"),renderIconRef:ie(i,"renderIcon"),xhrMap:c,submit:y,doChange:w,showPreviewButtonRef:ie(i,"showPreviewButton"),onPreviewRef:ie(i,"onPreview"),getFileThumbnailUrlResolver:x,listTypeRef:ie(i,"listType"),dragOverRef:d,openOpenFileDialog:f,draggerInsideRef:l,handleFileAddition:C,mergedDisabledRef:n.mergedDisabledRef,maxReachedRef:p,fileListClassRef:ie(i,"fileListClass"),fileListStyleRef:ie(i,"fileListStyle"),abstractRef:ie(i,"abstract"),acceptRef:ie(i,"accept"),cssVarsRef:t?void 0:_,themeClassRef:D==null?void 0:D.themeClass,onRender:D==null?void 0:D.onRender,showTriggerRef:ie(i,"showTrigger"),imageGroupPropsRef:ie(i,"imageGroupProps"),mergedDirectoryDndRef:z(()=>{var k;return(k=i.directoryDnd)!==null&&k!==void 0?k:i.directory}),onRetryRef:ie(i,"onRetry")});const G={clear:()=>{r.value=[]},submit:y,openOpenFileDialog:f};return Object.assign({mergedClsPrefix:e,draggerInsideRef:l,inputElRef:a,mergedTheme:o,dragOver:d,mergedMultiple:P,cssVars:t?void 0:_,themeClass:D==null?void 0:D.themeClass,onRender:D==null?void 0:D.onRender,handleFileInputChange:v},G)},render(){var i,e;const{draggerInsideRef:t,mergedClsPrefix:o,$slots:n,directory:r,onRender:s}=this;if(n.default&&!this.abstract){const l=n.default()[0];!((i=l==null?void 0:l.type)===null||i===void 0)&&i[jo]&&(t.value=!0)}const a=g("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:"".concat(o,"-upload-file-input"),accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:r||void 0,directory:r||void 0}));return this.abstract?g(Ne,null,(e=n.default)===null||e===void 0?void 0:e.call(n),g(Mo,{to:"body"},a)):(s==null||s(),g("div",{class:["".concat(o,"-upload"),t.value&&"".concat(o,"-upload--dragger-inside"),this.dragOver&&"".concat(o,"-upload--drag-over"),this.themeClass],style:this.cssVars},a,this.showTrigger&&this.listType!=="image-card"&&g($o,null,n),this.showFileList&&g(Ea,null,n)))}});function _i(){const i=re(Gr,null);return z(()=>{if(i===null)return Hi;const{mergedThemeRef:{value:e},mergedThemeOverridesRef:{value:t}}=i,o=(e==null?void 0:e.common)||Hi;return t!=null&&t.common?Object.assign({},o,t.common):o})}/*!
* @indoorequal/vue-maplibre-gl v8.4.0
* (c) 2025 FranÃ§ois de Metz <francois@2metz.fr>
* @license MIT
*/var Wa=Object.defineProperty,Na=(i,e,t)=>e in i?Wa(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Di=(i,e,t)=>Na(i,typeof e!="symbol"?e+"":e,t);const Aa=Symbol("map"),rt=Aa,bt=Symbol("isLoaded"),Ua=Symbol("isInitialized"),No=Ua,Fi=Symbol("componentId"),Ei=Symbol("sourceId"),Ao=Symbol("sourceLayerRegistry"),Va=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function Ga(i,e,t,o){return n=>t.emit(o,{type:n.type,map:e,component:i,event:n})}function Ha(i,e){const t=De.LngLat.convert(i),o=De.LngLat.convert(e);return t.lng===o.lng&&t.lat===o.lat}var wt=(i=>(i.TOP_LEFT="top-left",i.TOP_RIGHT="top-right",i.BOTTOM_LEFT="bottom-left",i.BOTTOM_RIGHT="bottom-right",i))(wt||{});const st=Object.values(wt),eo=new Map,Xa=Symbol("default");function Ka(i,e,t=Xa){var o;let n=eo.get(t);return n||(n=Xr({isLoaded:!1,isMounted:!1,language:null}),eo.set(t,n)),n.isLoaded=((o=e.value)==null?void 0:o.loaded())||!1,n.isMounted=!1,n.component=i,n.map=e.value,n}const Ya=E({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:i=>i in wt},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Object}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup(i,e){const t=Xi(Pi()),o=gt(),n=gt(),r=B(!1),s=B(!1),a=new Map,l=Ka(t,n,i.mapKey);Pe(rt,n),Pe(bt,s),Pe(No,r),Pe(Fi,t.uid),Pe(Ei,""),X(()=>i.bearing,u=>{var p;u&&((p=n.value)==null||p.setBearing(u))}),X(()=>i.bounds,u=>{var p;u&&((p=n.value)==null||p.fitBounds(u,i.fitBoundsOptions))}),X(()=>i.center,u=>{var p,f;const v=(p=n.value)==null?void 0:p.getCenter();u&&v&&!Ha(u,v)&&((f=n.value)==null||f.setCenter(u))}),X(()=>i.maxBounds,u=>{var p;u&&((p=n.value)==null||p.setMaxBounds(u))}),X(()=>i.maxPitch,u=>{var p;u&&((p=n.value)==null||p.setMaxPitch(u))}),X(()=>i.maxZoom,u=>{var p;u&&((p=n.value)==null||p.setMaxZoom(u))}),X(()=>i.minPitch,u=>{var p;u&&((p=n.value)==null||p.setMinPitch(u))}),X(()=>i.minZoom,u=>{var p;u&&((p=n.value)==null||p.setMinZoom(u))}),X(()=>i.pitch,u=>{var p;u&&((p=n.value)==null||p.setPitch(u))}),X(()=>i.renderWorldCopies,u=>{var p;u&&((p=n.value)==null||p.setRenderWorldCopies(u))}),X(()=>i.mapStyle,u=>{var p;u&&((p=n.value)==null||p.setStyle(u))}),X(()=>i.transformRequest,u=>{var p;u&&((p=n.value)==null||p.setTransformRequest(u))}),X(()=>i.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))}),X(()=>i.zoom,u=>{var p;u&&((p=n.value)==null||p.setZoom(u))});function d(){l.isMounted=!0;const u={...i,style:i.mapStyle,container:o.value};for(const p of Object.keys(u))u[p]===void 0&&delete u[p];if(n.value=Xi(new De.Map(u)),l.map=n.value,r.value=!0,a.set("__load",()=>(s.value=!0,l.isLoaded=!0)),n.value.on("load",a.get("__load")),a.set("__moveend",()=>e.emit("update:center",n.value.getCenter())),n.value.on("moveend",a.get("__moveend")),a.set("__zoomend",()=>e.emit("update:zoom",n.value.getZoom())),n.value.on("zoomend",a.get("__zoomend")),a.set("__pitchend",()=>e.emit("update:pitch",n.value.getPitch())),n.value.on("pitchend",a.get("__pitchend")),a.set("__rotateend",()=>e.emit("update:bearing",n.value.getBearing())),n.value.on("rotateend",a.get("__rotateend")),t.vnode.props){for(const p of Va)if(t.vnode.props["onMap:"+p]){const f="map:".concat(p),v=Ga(t,n.value,e,f);a.set(p,v),n.value.on(p,v)}}n.value.getCanvas().addEventListener("webglcontextlost",h)}async function c(){l.isMounted=!1,l.isLoaded=!1,s.value=!1,n.value&&(n.value.getCanvas().removeEventListener("webglcontextlost",h),r.value=!1,a.forEach((u,p)=>{n.value.off(p.startsWith("__")?p.substring(2):p,u)}),n.value.remove())}function h(){c(),Ze(d)}return wi(d),ot(c),e.expose({map:n}),()=>[g("div",{ref:o,style:{height:i.height,width:i.width}}),r.value&&e.slots.default?e.slots.default({}):void 0]},render(){return null}});function qa(i,e,t){X(i,o=>{var n,r;o&&st.indexOf(o)===-1||((n=e.value)!=null&&n.hasControl(t)&&e.value.removeControl(t),(r=e.value)==null||r.addControl(t,o))},{immediate:!0})}function Pt(i,e){const t=re(rt),o=re(No),n=gt();return n.value=i(),qa(()=>e.position,t,n.value),ot(()=>{var r;return o.value&&((r=t.value)==null?void 0:r.removeControl(n.value))}),{control:n,map:t}}class Za{constructor(e,t){Di(this,"container"),this.isAdded=e,this.container=document.createElement("div"),this.setClasses(t)}getDefaultPosition(){return wt.TOP_LEFT}onAdd(){return Ze(()=>this.isAdded.value=!0),this.container}onRemove(){this.isAdded.value=!1,this.container.remove()}setClasses(e){this.container.className=e}}const Qt=E({name:"MglCustomControl",props:{position:{type:String,validator:i=>st.indexOf(i)!==-1},class:{type:String,default:"maplibregl-ctrl maplibregl-ctrl-group"}},slots:Object,setup(i,{slots:e}){const t=B(!1),{control:o}=Pt(()=>new Za(t,i.class),i);return X(()=>i.class,()=>o.value.setClasses(i.class)),()=>{var n;return t.value?g(Mo,{to:o.value.container},(n=e.default)==null?void 0:n.call(e,{})):Me("custom-component")}},render(){return null}}),Ja=E({name:"MglFullscreenControl",props:{position:{type:String,validator:i=>st.indexOf(i)!==-1},container:{type:Object,default:null}},setup(i){const{control:e,map:t}=Pt(()=>new De.FullscreenControl({container:i.container||void 0}),i);function o(){Ze(()=>{var n;return(n=t.value)==null?void 0:n.resize()})}e.value.on("fullscreenstart",o),e.value.on("fullscreenend",o),ot(()=>{e.value.off("fullscreenstart",o),e.value.off("fullscreenend",o)})},render(){return null}}),Qa=E({name:"MglGeolocateControl",props:{position:{type:String,default:wt.TOP_RIGHT,validator:i=>st.indexOf(i)!==-1},positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},emits:["trackuserlocationstart","trackuserlocationend","userlocationlostfocus","userlocationfocus","geolocate","error","outofmaxbounds"],setup(i,e){const{control:t}=Pt(()=>new De.GeolocateControl({positionOptions:i.positionOptions,fitBoundsOptions:i.fitBoundsOptions,trackUserLocation:i.trackUserLocation,showAccuracyCircle:i.showAccuracyCircle,showUserLocation:i.showUserLocation}),i);function o(n){const r=s=>{e.emit(n,s)};t.value.on(n,r),ot(()=>{t.value.off(n,r)})}o("trackuserlocationstart"),o("trackuserlocationend"),o("userlocationlostfocus"),o("userlocationfocus"),o("geolocate"),o("error"),o("outofmaxbounds")},render(){return null}}),el=E({name:"MglNavigationControl",props:{position:{type:String,validator:i=>st.indexOf(i)!==-1},showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:Boolean},setup(i){Pt(()=>new De.NavigationControl({showCompass:i.showCompass,showZoom:i.showZoom,visualizePitch:i.visualizePitch}),i)},render(){return null}});var Uo=(i=>(i.IMPERIAL="imperial",i.METRIC="metric",i.NAUTICAL="nautical",i))(Uo||{});const tl=Object.values(Uo),il=E({name:"MglScaleControl",props:{position:{type:String,validator:i=>st.indexOf(i)!==-1},maxWidth:{type:Number,default:100},unit:{type:String,default:"metric",validator:i=>tl.indexOf(i)!==-1}},setup(i){Pt(()=>new De.ScaleControl({maxWidth:i.maxWidth,unit:i.unit}),i)},render(){return null}});let ol=class{constructor(){Di(this,"unmountHandlers",new Map)}registerUnmountHandler(e,t){this.unmountHandlers.set(e,t)}unregisterUnmountHandler(e){this.unmountHandlers.delete(e)}unmount(){this.unmountHandlers.forEach(e=>e())}};const Vo=class hi{static genSourceOpts(e){const t={...e};for(const o of Object.keys(t))(t[o]===void 0||o==="sourceId")&&delete t[o];return t}static getSourceRef(e,t){const o=typeof t=="string",n=String(e)+(o?t:"");let r=hi.REFS.get(n);return r||(r=B(o?null:void 0),hi.REFS.set(n,r)),r}};Di(Vo,"REFS",new Map);let Ri=Vo;function nl(i,e,t){const o=re(rt),n=re(bt);function r(){n.value&&(o.value.addSource(e.sourceId,Ri.genSourceOpts(e)),i.value=o.value.getSource(e.sourceId))}return X(n,r,{immediate:!0}),o.value.on("style.load",r),ot(()=>{n.value&&(t.unmount(),o.value.removeSource(e.sourceId)),o.value.off("style.load",r)})}const rl=E({name:"MglGeoJsonSource",props:{sourceId:{type:String,required:!0},data:{type:[Object,String],required:!0},maxzoom:Number,attribution:String,buffer:Number,tolerance:Number,cluster:Boolean,clusterRadius:Number,clusterMaxZoom:Number,clusterMinPoints:Number,clusterProperties:Object,lineMetrics:Boolean,generateId:Boolean,promoteId:[Object,String],filter:[Array,String,Object]},slots:Object,setup(i,{slots:e}){const t=re(Fi),o=Ri.getSourceRef(t,i.sourceId),n=new ol,r={...i,type:"geojson"};return Pe(Ei,i.sourceId),Pe(Ao,n),nl(o,r,n),X([Hr(i.data)?i.data:()=>i.data,o],([s,a])=>{a==null||a.setData(s||{type:"FeatureCollection",features:[]})},{immediate:!0}),()=>[Me("GeoJSON Source"),o.value&&e.default?e.default({}):void 0]}}),Ce=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function Ee(){return{layerId:{type:String,required:!0},source:{type:String},metadata:{type:[Object,Array,String,Number]},sourceLayer:{type:String},minzoom:{type:Number},maxzoom:{type:Number},filter:{type:Object},before:{type:String},layout:{type:Object},paint:{type:Object}}}function sl(i,e,t,o){const n={id:i,type:e,source:t.source||o,metadata:t.metadata,minzoom:t.minzoom,maxzoom:t.maxzoom,"source-layer":t.sourceLayer,filter:t.filter,paint:t.paint,layout:t.layout};for(const r of Object.keys(n))n[r]===void 0&&delete n[r];return n}function al(i,e,t){if(t.props)for(const o of Ce){const n="on"+o.charAt(0).toUpperCase()+o.substr(1);t.props[n]&&i.on(o,e,t.props[n])}}function ll(i,e,t){if(t.props)for(const o of Ce){const n="on"+o.charAt(0).toUpperCase()+o.substr(1);t.props[n]&&i.off(o,e,t.props[n])}}function Go(i,e){const t=re(rt),o=re(bt),n=re(Ao);function r(){o.value&&(e&&ll(t.value,i,e.vnode),t.value.getLayer(i)&&t.value.removeLayer(i))}n.registerUnmountHandler(i,r),ot(()=>{n.unregisterUnmountHandler(i),r()})}E({name:"MglBackgroundLayer",props:{layerId:{type:String,required:!0},metadata:[Object,Array,String,Number],minzoom:Number,maxzoom:Number,before:String,layout:Object,paint:Object},emits:[...Ce],setup(i){const e=re(rt),t=re(bt);return Go(i.layerId),X(()=>i.layout,o=>{if(o)for(const[n,r]of Object.entries(o))e.value.setLayoutProperty(i.layerId,n,r)}),X(()=>i.paint,o=>{if(o)for(const[n,r]of Object.entries(o))e.value.setPaintProperty(i.layerId,n,r)}),X(t,o=>{o&&e.value.addLayer({id:i.layerId,type:"background",metadata:i.metadata,minzoom:i.minzoom,maxzoom:i.maxzoom,layout:i.layout,paint:i.paint},i.before||void 0)},{immediate:!0}),()=>Me("Background Layer")}});function Re(i,e){const t=re(Ei);if(!t&&!e.source)return;const o=Pi(),n=re(rt),r=re(bt),s=re(Fi),a=Ri.getSourceRef(s,e.source||t);return Go(e.layerId,o),X(()=>e.minzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),X(()=>e.maxzoom,()=>n.value.setLayerZoomRange(e.layerId,e.minzoom||0,e.maxzoom||24)),X(()=>e.layout,l=>{if(l)for(const[d,c]of Object.entries(l))n.value.setLayoutProperty(e.layerId,d,c)},{deep:!0}),X(()=>e.paint,l=>{if(l)for(const[d,c]of Object.entries(l))n.value.setPaintProperty(e.layerId,d,c)},{deep:!0}),X(()=>e.filter,l=>n.value.setFilter(e.layerId,l),{deep:!0}),X([r,a],([l,d])=>{l&&(d||d===void 0)&&(n.value.addLayer(sl(e.layerId,i,e,t),e.before||void 0),al(n.value,e.layerId,o.vnode))},{immediate:!0}),()=>Me("".concat(i," Layer"))}E({name:"MglCircleLayer",props:Ee(),emits:[...Ce],setup(i){return Re("circle",i)}});E({name:"MglFillLayer",props:Ee(),emits:[...Ce],setup(i){return Re("fill",i)}});E({name:"MglFillExtrusionLayer",props:Ee(),emits:[...Ce],setup(i){return Re("fill-extrusion",i)}});E({name:"MglHeatmapLayer",props:Ee(),emits:[...Ce],setup(i){return Re("heatmap",i)}});E({name:"MglHillshadeLayer",props:Ee(),emits:[...Ce],setup(i){return Re("hillshade",i)}});const dl=E({name:"MglLineLayer",props:Ee(),emits:[...Ce],setup(i){return Re("line",i)}});E({name:"MglRasterLayer",props:Ee(),emits:[...Ce],setup(i){return Re("raster",i)}});E({name:"MglSymbolLayer",props:Ee(),emits:[...Ce],setup(i){return Re("symbol",i)}});function Z(){return Z=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var o in t)({}).hasOwnProperty.call(t,o)&&(i[o]=t[o])}return i},Z.apply(null,arguments)}var q;(function(i){i.Commit="commit",i.Provisional="provisional",i.Finish="finish"})(q||(q={}));const me={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT_FEATURE_ID:"selectionPointFeatureId",SELECTION_POINT:"selectionPoint"},xe="currentlyDrawing",Ie="edited",Je="closingPoint",pi="snappingPoint",Bi="coordinatePoint",cl="coordinatePointFeatureId",mt="coordinatePointIds",_e=10;function ei(i){return!!(i&&typeof i=="object"&&i!==null&&!Array.isArray(i))}function to(i){return!!(i&&typeof i=="object"&&"properties"in i&&typeof i.properties=="object"&&i.properties!==null&&"mode"in i.properties)}function io(i){return!!function(e){return typeof e=="number"&&!isNaN(new Date(e).valueOf())}(i)}const ul="Feature mode property does not match the mode being added to";var Qe;(function(i){i.Drawing="drawing",i.Select="select",i.Static="static",i.Render="render"})(Qe||(Qe={}));const hl={rightClick:!0,contextMenu:!1,leftClick:!0,onDragStart:!0,onDrag:!0,onDragEnd:!0};class Be{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,t=!1){this._state="unregistered",this._styles={},this.pointerEvents=hl,this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=Qe.Drawing,this.mode="base",t||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=Z({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection),(e==null?void 0:e.pointerEvents)!==void 0&&(this.pointerEvents=e.pointerEvents)}allowPointerEvent(e,t){return typeof e=="boolean"?e:typeof e!="function"||e(t)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const t=function(o,n){let r;if(ei(o))if(o.id==null)r="Feature has no id";else if(typeof o.id!="string"&&typeof o.id!="number")r="Feature must be string or number as per GeoJSON spec";else if(n(o.id))if(ei(o.geometry))if(ei(o.properties))if(typeof o.geometry.type=="string"&&["Polygon","LineString","Point"].includes(o.geometry.type))if(Array.isArray(o.geometry.coordinates)){if(!o.properties.mode||typeof o.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else r="Feature coordinates is not an array";else r="Feature is not Point, LineString or Polygon";else r="Feature has no properties";else r="Feature has no geometry";else r="Feature must match the id strategy (default is UUID4)";else r="Feature is not object";return r?{valid:!1,reason:r}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){const o=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional});return{valid:t.valid&&o.valid,reason:o.reason}}return{valid:t.valid,reason:t.reason}}validateModeFeature(e,t){const o=this.performFeatureValidation(e);return o.valid?e.properties.mode!==this.mode?{valid:!1,reason:ul}:t(e):{valid:!1,reason:o.reason}}onFinish(e,t){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,t){}onDrag(e,t){}onDragEnd(e,t){}getHexColorStylingValue(e,t,o){return this.getStylingValue(e,t,o)}getNumericStylingValue(e,t,o){return this.getStylingValue(e,t,o)}getStylingValue(e,t,o){return e===void 0?t:typeof e=="function"?e(o):e}}class pl extends Be{constructor(...e){super(...e),this.type=Qe.Select}}function we(i,e){const t=d=>d*Math.PI/180,o=t(i[1]),n=t(i[0]),r=t(e[1]),s=r-o,a=t(e[0])-n,l=Math.sin(s/2)*Math.sin(s/2)+Math.cos(o)*Math.cos(r)*Math.sin(a/2)*Math.sin(a/2);return 2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l))*6371e3/1e3}const Ho=63710088e-1;function pe(i){return i%360*Math.PI/180}function Xo(i){return i/6371.0088}function Fe(i){return i%(2*Math.PI)*180/Math.PI}function ne(i,e=9){const t=Math.pow(10,e);return Math.round(i*t)/t}const oo=57.29577951308232,no=.017453292519943295,Vt=6378137,se=(i,e)=>({x:i===0?0:i*no*Vt,y:e===0?0:Math.log(Math.tan(Math.PI/4+e*no/2))*Vt}),et=(i,e)=>({lng:i===0?0:oo*(i/Vt),lat:e===0?0:(2*Math.atan(Math.exp(e/Vt))-Math.PI/2)*oo});function gl(i,e,t){const o=pe(i[0]),n=pe(i[1]),r=pe(t),s=Xo(e),a=Math.asin(Math.sin(n)*Math.cos(s)+Math.cos(n)*Math.sin(s)*Math.cos(r));return[Fe(o+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(n),Math.cos(s)-Math.sin(n)*Math.sin(a))),Fe(a)]}function ro(i){const{center:e,radiusKilometers:t,coordinatePrecision:o}=i,n=i.steps?i.steps:64,r=[];for(let s=0;s<n;s++){const a=gl(e,t,-360*s/n);r.push([ne(a[0],o),ne(a[1],o)])}return r.push(r[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[r]},properties:{}}}function Ko(i){let e;if(i.geometry.type==="Polygon")e=i.geometry.coordinates;else{if(i.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e=[i.geometry.coordinates]}const t=[];for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length-1;s++)for(let a=0;a<e.length;a++)for(let l=0;l<e[a].length-1;l++)n(r,s,a,l);return t.length>0;function o(r){return r<0||r>1}function n(r,s,a,l){const d=e[r][s],c=e[r][s+1],h=e[a][l],u=e[a][l+1],p=function(S,P,w,C){if(jt(S,w)||jt(S,C)||jt(P,w)||jt(C,w))return null;const y=S[0],x=S[1],_=P[0],D=P[1],G=w[0],k=w[1],L=C[0],$=C[1],W=(y-_)*(k-$)-(x-D)*(G-L);return W===0?null:[((y*D-x*_)*(G-L)-(y-_)*(G*$-k*L))/W,((y*D-x*_)*(k-$)-(x-D)*(G*$-k*L))/W]}(d,c,h,u);if(p===null)return;let f,v;f=c[0]!==d[0]?(p[0]-d[0])/(c[0]-d[0]):(p[1]-d[1])/(c[1]-d[1]),v=u[0]!==h[0]?(p[0]-h[0])/(u[0]-h[0]):(p[1]-h[1])/(u[1]-h[1]),o(f)||o(v)||(p.toString(),t.push(p))}}function jt(i,e){return i[0]===e[0]&&i[1]===e[1]}function Kt(i,e){return so(i[0])<=e&&so(i[1])<=e}function Oi(i){return i.length===2&&typeof i[0]=="number"&&typeof i[1]=="number"&&i[0]!==1/0&&i[1]!==1/0&&(t=i[0])>=-180&&t<=180&&(e=i[1])>=-90&&e<=90;var e,t}function so(i){let e=1,t=0;for(;Math.round(i*e)/e!==i;)e*=10,t++;return t}const fl="Feature has holes",ml="Feature has less than 4 coordinates",vl="Feature has invalid coordinates",yl="Feature coordinates are not closed";function ji(i,e){if(i.geometry.type!=="Polygon")return{valid:!1,reason:"Feature is not a Polygon"};if(i.geometry.coordinates.length!==1)return{valid:!1,reason:fl};if(i.geometry.coordinates[0].length<4)return{valid:!1,reason:ml};for(let n=0;n<i.geometry.coordinates[0].length;n++){if(!Oi(i.geometry.coordinates[0][n]))return{valid:!1,reason:vl};if(!Kt(i.geometry.coordinates[0][n],e))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return(t=i.geometry.coordinates[0][0])[0]!==(o=i.geometry.coordinates[0][i.geometry.coordinates[0].length-1])[0]||t[1]!==o[1]?{valid:!1,reason:yl}:{valid:!0};var t,o}function Yo(i,e){const t=ji(i,e);return t.valid?Ko(i)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:t}const xl={cancel:"Escape",finish:"Enter"},Cl={start:"crosshair"};class bl extends Be{constructor(e){super(e,!0),this.mode="circle",this.center=void 0,this.clickCount=0,this.currentCircleId=void 0,this.keyEvents=xl,this.cursors=Cl,this.startingRadiusKilometers=1e-5,this.cursorMovedAfterInitialCursorDown=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents)),e!=null&&e.startingRadiusKilometers&&(this.startingRadiusKilometers=e.startingRadiusKilometers)}close(){if(this.currentCircleId===void 0)return;this.store.updateProperty([{id:this.currentCircleId,property:xe,value:void 0}]);const e=this.currentCircleId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(this.clickCount===0){this.center=[e.lng,e.lat];const t=ro({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),[o]=this.store.create([{geometry:t.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers,[xe]:!0}}]);this.currentCircleId=o,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else this.clickCount===1&&this.center&&this.currentCircleId!==void 0&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(e),this.close()}onMouseMove(e){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(e)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e])}catch(t){}}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=_e),t}validateFeature(e){return this.validateModeFeature(e,t=>Yo(t,this.coordinatePrecision))}updateCircle(e){if(this.clickCount===1&&this.center&&this.currentCircleId){const t=we(this.center,[e.lng,e.lat]);let o;if(this.projection==="web-mercator"){const n=function(r,s){const a=1e3*we(r,s);if(a===0)return 1;const{x:l,y:d}=se(r[0],r[1]),{x:c,y:h}=se(s[0],s[1]);return Math.sqrt(Math.pow(c-l,2)+Math.pow(h-d,2))/a}(this.center,[e.lng,e.lat]);o=function(r){const{center:s,radiusKilometers:a,coordinatePrecision:l}=r,d=r.steps?r.steps:64,c=1e3*a,[h,u]=s,{x:p,y:f}=se(h,u),v=[];for(let S=0;S<d;S++){const P=360*S/d*Math.PI/180,w=c*Math.cos(P),C=c*Math.sin(P),[y,x]=[p+w,f+C],{lng:_,lat:D}=et(y,x);v.push([ne(_,l),ne(D,l)])}return v.push(v[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[v]},properties:{}}}({center:this.center,radiusKilometers:t*n,coordinatePrecision:this.coordinatePrecision})}else{if(this.projection!=="globe")throw new Error("Invalid projection");o=ro({center:this.center,radiusKilometers:t,coordinatePrecision:this.coordinatePrecision})}if(this.validate&&!this.validate({type:"Feature",id:this.currentCircleId,geometry:o.geometry,properties:{radiusKilometers:t}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid)return;this.store.updateGeometry([{id:this.currentCircleId,geometry:o.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:t}])}}}const ye=(i,e)=>{const{x:t,y:o}=i,{x:n,y:r}=e,s=n-t,a=r-o;return Math.sqrt(a*a+s*s)};function zi(i){if(!function(t){const o=t.coordinates[0];let n=0;for(let r=0;r<o.length-1;r++){const[s,a]=o[r],[l,d]=o[r+1];n+=(l-s)*(d+a)}return n<0}(i))return{type:"Polygon",coordinates:[i.coordinates[0].reverse()]}}const wl={cancel:"Escape",finish:"Enter"},Pl={start:"crosshair",close:"pointer"};class Il extends Be{constructor(e){super(e,!0),this.mode="freehand",this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.minDistance=20,this.keyEvents=wl,this.cursors=Pl,this.preventPointsNearClose=!0,this.autoClose=!1,this.autoCloseTimeout=500,this.hasLeftStartingPoint=!1,this.preventNewFeature=!1,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.minDistance&&(this.minDistance=e.minDistance),(e==null?void 0:e.preventPointsNearClose)!==void 0&&(this.preventPointsNearClose=e.preventPointsNearClose),(e==null?void 0:e.autoClose)!==void 0&&(this.autoClose=e.autoClose),e!=null&&e.autoCloseTimeout&&(this.autoCloseTimeout=e.autoCloseTimeout),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents)),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors))}close(){if(this.currentId===void 0)return;if(this.currentId){const t=zi(this.store.getGeometryCopy(this.currentId));t&&this.store.updateGeometry([{id:this.currentId,geometry:t}]),this.store.updateProperty([{id:this.currentId,property:xe,value:void 0}])}const e=this.currentId;if(this.validate&&e){const t=this.store.getGeometryCopy(e);if(!this.validate({type:"Feature",id:e,geometry:t,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return}this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.hasLeftStartingPoint=!1,this.state==="drawing"&&this.setStarted(),this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){if(this.currentId===void 0||this.startingClick===!1)return;const t=this.store.getGeometryCopy(this.currentId),o=t.coordinates[0].length-2,[n,r]=t.coordinates[0][o],{x:s,y:a}=this.project(n,r),l=ye({x:s,y:a},{x:e.containerX,y:e.containerY}),[d,c]=t.coordinates[0][0],{x:h,y:u}=this.project(d,c);if(ye({x:h,y:u},{x:e.containerX,y:e.containerY})<this.pointerDistance){if(this.autoClose&&this.hasLeftStartingPoint&&(this.preventNewFeature=!0,setTimeout(()=>{this.preventNewFeature=!1},this.autoCloseTimeout),this.close()),this.setCursor(this.cursors.close),this.preventPointsNearClose)return}else this.hasLeftStartingPoint=!0,this.setCursor(this.cursors.start);if(l<this.minDistance)return;t.coordinates[0].pop();const p={type:"Polygon",coordinates:[[...t.coordinates[0],[e.lng,e.lat],t.coordinates[0][0]]]};this.validate&&!this.validate({type:"Feature",id:this.currentId,geometry:p,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||this.store.updateGeometry([{id:this.currentId,geometry:p}])}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)){if(this.preventNewFeature)return;if(this.startingClick===!1){const[t,o]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[xe]:!0}},{geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:{mode:this.mode,[Je]:!0}}]);return this.currentId=t,this.closingPointId=o,this.startingClick=!0,void this.setDrawing()}this.close()}}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.startingClick===!0&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentId,t=this.closingPointId;this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),t!==void 0&&this.store.delete([t])}catch(o){}}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode?(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=_e,t):(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode&&(t.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,e),t.zIndex=50),t)}validateFeature(e){return this.validateModeFeature(e,t=>ji(t,this.coordinatePrecision))}}class fe{constructor({store:e,mode:t,project:o,unproject:n,pointerDistance:r,coordinatePrecision:s,projection:a}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=t,this.project=o,this.unproject=n,this.pointerDistance=r,this.coordinatePrecision=s,this.projection=a}}function qo({unproject:i,point:e,pointerDistance:t}){const o=t/2,{x:n,y:r}=e;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[i(n-o,r-o),i(n+o,r-o),i(n+o,r+o),i(n-o,r+o),i(n-o,r-o)].map(s=>[s.lng,s.lat])]}}}class vt extends fe{constructor(e){super(e)}create(e){const{containerX:t,containerY:o}=e;return qo({unproject:this.unproject,point:{x:t,y:o},pointerDistance:this.pointerDistance})}}class yt extends fe{constructor(e){super(e)}measure(e,t){const{x:o,y:n}=this.project(t[0],t[1]);return ye({x:o,y:n},{x:e.containerX,y:e.containerY})}}class Gt extends fe{constructor(e,t,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>this.getSnappable(n,r=>!!(r.properties&&r.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(n,r)=>this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode&&s.id!==r)).coordinate,this.config=e,this.pixelDistance=t,this.clickBoundingBox=o}getSnappable(e,t){const o=this.clickBoundingBox.create(e),n=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}a.forEach((l,d)=>{const c=this.pixelDistance.measure(e,l);c<r.minDist&&c<this.pointerDistance&&(r.coordinate=l,r.minDist=c,r.featureId=s.id,r.featureCoordinateIndex=d)})}),r}}function ao(i,e,t){const o=pe(i[0]),n=pe(i[1]),r=pe(t),s=Xo(e),a=Math.asin(Math.sin(n)*Math.cos(s)+Math.cos(n)*Math.sin(s)*Math.cos(r));return[Fe(o+Math.atan2(Math.sin(r)*Math.sin(s)*Math.cos(n),Math.cos(s)-Math.sin(n)*Math.sin(a))),Fe(a)]}function lo(i,e){const t=pe(i[0]),o=pe(e[0]),n=pe(i[1]),r=pe(e[1]),s=Math.sin(o-t)*Math.cos(r),a=Math.cos(n)*Math.sin(r)-Math.sin(n)*Math.cos(r)*Math.cos(o-t);return Fe(Math.atan2(s,a))}function Sl({x:i,y:e},{x:t,y:o}){const n=t-i,r=o-e;if(n===0&&r===0)return 0;let s=Math.atan2(r,n);return s*=180/Math.PI,s>180?s-=360:s<-180&&(s+=360),s}function kl(i,e,t){const o=[],n=i.length;let r,s,a,l=0;for(let c=0;c<i.length&&!(e>=l&&c===i.length-1);c++){if(l>e&&o.length===0){if(r=e-l,!r)return o.push(i[c]),o;s=lo(i[c],i[c-1])-180,a=ao(i[c],r,s),o.push(a)}if(l>=t)return r=t-l,r?(s=lo(i[c],i[c-1])-180,a=ao(i[c],r,s),o.push(a),o):(o.push(i[c]),o);if(l>=e&&o.push(i[c]),c===i.length-1)return o;l+=we(i[c],i[c+1])}if(l<e&&i.length===n)throw new Error("Start position is beyond line");const d=i[i.length-1];return[d,d]}function zt(i){return i*(Math.PI/180)}function co(i){return i*(180/Math.PI)}class Ml extends fe{constructor(e){super(e),this.config=void 0,this.config=e}generateInsertionCoordinates(e,t,o){const n=[e,t];let r=0;for(let d=0;d<n.length-1;d++)r+=we(n[0],n[1]);if(r<=o)return n;let s=r/o-1;Number.isInteger(s)||(s=Math.floor(s)+1);const a=[];for(let d=0;d<s;d++){const c=kl(n,o*d,o*(d+1));a.push(c)}const l=[];for(let d=0;d<a.length;d++)l.push(a[d][1]);return this.limitCoordinates(l)}generateInsertionGeodesicCoordinates(e,t,o){const n=we(e,t),r=function(s,a,l){const d=[],c=zt(s[1]),h=zt(s[0]),u=zt(a[1]),p=zt(a[0]);l+=1;const f=2*Math.asin(Math.sqrt(Math.sin((u-c)/2)**2+Math.cos(c)*Math.cos(u)*Math.sin((p-h)/2)**2));if(f===0||isNaN(f))return d;for(let v=0;v<=l;v++){const S=v/l,P=Math.sin((1-S)*f)/Math.sin(f),w=Math.sin(S*f)/Math.sin(f),C=P*Math.cos(c)*Math.cos(h)+w*Math.cos(u)*Math.cos(p),y=P*Math.cos(c)*Math.sin(h)+w*Math.cos(u)*Math.sin(p),x=P*Math.sin(c)+w*Math.sin(u);if(isNaN(C)||isNaN(y)||isNaN(x))continue;const _=Math.atan2(x,Math.sqrt(C**2+y**2)),D=Math.atan2(y,C);isNaN(_)||isNaN(D)||d.push([co(D),co(_)])}return d.slice(1,-1)}(e,t,Math.floor(n/o));return this.limitCoordinates(r)}limitCoordinates(e){return e.map(t=>[ne(t[0],this.config.coordinatePrecision),ne(t[1],this.config.coordinatePrecision)])}}function Nt(i,e){return i[0]===e[0]&&i[1]===e[1]}function _l(i,e){if(i.geometry.type!=="LineString")return{valid:!1,reason:"Feature is not a LineString"};if(i.geometry.coordinates.length<2)return{valid:!1,reason:"Feature has less than 2 coordinates"};for(let t=0;t<i.geometry.coordinates.length;t++){if(!Oi(i.geometry.coordinates[t]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!Kt(i.geometry.coordinates[t],e))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return{valid:!0}}function uo(i){return Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)+Math.pow(i[2],2))}function Le(i,e){const t=function(o,n){const[r,s,a]=o,[l,d,c]=n;return r*l+s*d+a*c}(i,e)/(uo(i)*uo(e));return Math.acos(Math.min(Math.max(t,-1),1))}function ti(i){const e=pe(i[1]),t=pe(i[0]);return[Math.cos(e)*Math.cos(t),Math.cos(e)*Math.sin(t),Math.sin(e)]}function Te(i){const[e,t,o]=i,n=Fe(Math.asin(o));return[Fe(Math.atan2(t,e)),n]}function Dl(i,e,t){const o=ti(i),n=ti(e),r=ti(t),[s,a,l]=r,[d,c,h]=function($,W){const[le,te,oe]=$,[K,de,R]=W;return[te*R-oe*de,oe*K-le*R,le*de-te*K]}(o,n),u=c*l-h*a,p=h*s-d*l,f=d*a-c*s,v=f*c-p*h,S=u*h-f*d,P=p*d-u*c,w=1/Math.sqrt(Math.pow(v,2)+Math.pow(S,2)+Math.pow(P,2)),C=[v*w,S*w,P*w],y=[-1*v*w,-1*S*w,-1*P*w],x=Le(o,n),_=Le(o,C),D=Le(n,C),G=Le(o,y),k=Le(n,y);let L;return L=_<G&&_<k||D<G&&D<k?C:y,Le(o,L)>x||Le(n,L)>x?we(Te(L),Te(o))<=we(Te(L),Te(n))?[Te(o),!0,!1]:[Te(n),!1,!0]:[Te(L),!1,!1]}function Fl(i,e,t){const o=e.x-i.x,n=e.y-i.y,r=Math.max(0,Math.min(1,((t.x-i.x)*o+(t.y-i.y)*n)/(o*o+n*n)));return{x:i.x+r*o,y:i.y+r*n}}class Li extends fe{constructor(e,t,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=n=>{const r=this.getSnappable(n,s=>!!(s.properties&&s.properties.mode===this.mode));return r.coordinate?[ne(r.coordinate[0],this.config.coordinatePrecision),ne(r.coordinate[1],this.config.coordinatePrecision)]:void 0},this.getSnappableCoordinate=(n,r)=>{const s=this.getSnappable(n,a=>!!(a.properties&&a.properties.mode===this.mode&&a.id!==r));return s.coordinate?[ne(s.coordinate[0],this.config.coordinatePrecision),ne(s.coordinate[1],this.config.coordinatePrecision)]:void 0},this.config=e,this.pixelDistance=t,this.clickBoundingBox=o}getSnappable(e,t){const o=this.clickBoundingBox.create(e),n=this.store.search(o,t),r={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return n.forEach(s=>{let a;if(s.geometry.type==="Polygon")a=s.geometry.coordinates[0];else{if(s.geometry.type!=="LineString")return;a=s.geometry.coordinates}const l=[];for(let u=0;u<a.length-1;u++)l.push([a[u],a[u+1]]);let d;const c=[e.lng,e.lat];if(this.config.projection==="web-mercator"?d=function(u,p){let f=[1/0,1/0],v=1/0,S=0;for(let P of p){const w=P[0],C=P[1];let y,x=1/0;const _=se(w[0],w[1]),D=se(C[0],C[1]),G=se(u[0],u[1]);if(w[0]===u[0]&&w[1]===u[1])y=w;else if(C[0]===u[0]&&C[1]===u[1])y=C;else{const{x:k,y:L}=Fl(_,D,G),{lng:$,lat:W}=et(k,L);y=[$,W]}y&&(x=ye(G,se(y[0],y[1])),x<v&&(f=y,v=x,S=p.indexOf(P)))}return v===1/0?void 0:{coordinate:f,lineIndex:S,distance:v}}(c,l):this.config.projection==="globe"&&(d=function(u,p){let f=[1/0,1/0],v=1/0,S=0;for(let P of p){const w=P[0],C=P[1];let y,x=1/0;w[0]===u[0]&&w[1]===u[1]?y=w:C[0]===u[0]&&C[1]===u[1]?y=C:[y]=Dl(w,C,u),y&&(x=we(u,y),x<v&&(f=y,v=x,S=p.indexOf(P)))}return v===1/0?void 0:{coordinate:f,distance:v,lineIndex:S}}(c,l)),!d)return;const h=this.pixelDistance.measure(e,d.coordinate);h<r.minDistance&&h<this.pointerDistance&&(r.featureId=s.id,r.coordinate=[ne(d.coordinate[0],this.config.coordinatePrecision),ne(d.coordinate[1],this.config.coordinatePrecision)],r.featureCoordinateIndex=d.lineIndex,r.minDistance=h)}),r}}const El={cancel:"Escape",finish:"Enter"},Rl={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class Bl extends Be{constructor(e){super(e,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=El,this.snapping=void 0,this.cursors=Rl,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommitedCoordinates=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors)),e!=null&&e.snapping&&(this.snapping=e.snapping),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents)),e!=null&&e.insertCoordinates&&(this.insertCoordinates=e.insertCoordinates),e&&e.editable&&(this.editable=e.editable)}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId);e.coordinates.pop(),this.updateGeometries([...e.coordinates],void 0,q.Commit),this.store.updateProperty([{id:this.currentId,property:xe,value:void 0}]);const t=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommitedCoordinates=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}updateGeometries(e,t,o){if(!this.currentId)return;const n={type:"LineString",coordinates:e};if(this.validate&&!this.validate({type:"Feature",geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:o}).valid)return;const r=[{id:this.currentId,geometry:n}];this.closingPointId&&t&&r.push({id:this.closingPointId,geometry:{type:"Point",coordinates:t}}),o==="commit"&&(this.lastCommitedCoordinates=n.coordinates),this.store.updateGeometry(r)}generateInsertCoordinates(e,t){if(!this.insertCoordinates||!this.lastCommitedCoordinates)throw new Error("Not able to insert coordinates");if(this.insertCoordinates.strategy!=="amount")throw new Error("Strategy does not exist");const o=we(e,t)/(this.insertCoordinates.value+1);let n=[];return this.projection==="globe"?n=this.insertPoint.generateInsertionGeodesicCoordinates(e,t,o):this.projection==="web-mercator"&&(n=this.insertPoint.generateInsertionCoordinates(e,t,o)),n}createLine(e){const[t]=this.store.create([{geometry:{type:"LineString",coordinates:[e,e]},properties:{mode:this.mode,[xe]:!0}}]);this.lastCommitedCoordinates=[e,e],this.currentId=t,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(e){if(!this.currentId)return;const t=this.store.getGeometryCopy(this.currentId).coordinates,[o]=this.store.create([{geometry:{type:"Point",coordinates:[...e]},properties:{mode:this.mode}}]);this.closingPointId=o,this.setCursor(this.cursors.close);const n=[...t,e];this.updateGeometries(n,void 0,q.Commit),this.currentCoordinate++}updateToLine(e,t){if(!this.currentId)return;const o=this.store.getGeometryCopy(this.currentId).coordinates,[n,r]=this.lastCommitedCoordinates?this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1]:o[o.length-2],{x:s,y:a}=this.project(n,r);if(ye({x:s,y:a},{x:t.x,y:t.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);const l=[...o,e];this.updateGeometries(l,o[o.length-1],q.Commit),this.currentCoordinate++}registerBehaviors(e){this.coordinateSnapping=new Gt(e,new yt(e),new vt(e)),this.insertPoint=new Ml(e),this.clickBoundingBox=new vt(e),this.pixelDistance=new yt(e),this.lineSnapping=new Li(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new Gt(e,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start);const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[s]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[pi]:!0}}]);this.snappedPointId=s}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const o=t||[e.lng,e.lat];if(this.currentId===void 0||this.currentCoordinate===0)return;const n=this.store.getGeometryCopy(this.currentId).coordinates;if(n.pop(),this.closingPointId){const[s,a]=n[n.length-1],{x:l,y:d}=this.project(s,a);ye({x:l,y:d},{x:e.containerX,y:e.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let r=[...n,o];if(this.insertCoordinates&&this.currentId&&this.lastCommitedCoordinates){const s=this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1],a=o;if(!Nt(s,a)){const l=this.generateInsertCoordinates(s,a);r=[...this.lastCommitedCoordinates.slice(0,-1),...l,o]}}this.updateGeometries(r,void 0,q.Provisional)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:o}=this.coordinateSnapping.getSnappable(e,s=>this.lineStringFilter(s));if(!t||o===void 0)return;const n=this.store.getGeometryCopy(t);let r;if(n.type==="LineString"&&(r=n.coordinates,!(r.length<=2))){if(r.splice(o,1),this.validate&&!this.validate({id:t,type:"Feature",geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:n}]),this.onFinish(t,{mode:this.mode,action:"edit"})}}onLeftClick(e){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const t=this.snapCoordinate(e)||[e.lng,e.lat];this.currentCoordinate===0?this.createLine(t):this.currentCoordinate===1&&this.currentId?this.firstUpdateToLine(t):this.currentId&&this.updateToLine(t,{x:e.containerX,y:e.containerY})}onClick(e){(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))&&(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"?this.onRightClick(e):e.button==="left"&&this.onLeftClick(e))}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.editable)return;let o;if(this.state==="started"){const n=this.lineSnapping.getSnappable(e,s=>this.lineStringFilter(s));n.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=n.featureCoordinateIndex,this.editedFeatureId=n.featureId,o=n.coordinate);const r=this.coordinateSnapping.getSnappable(e,s=>this.lineStringFilter(s));r.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=r.featureCoordinateIndex,this.editedFeatureId=r.featureId,o=r.coordinate)}if(this.editedFeatureId&&o){if(!this.editedPointId){const[n]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,[Ie]:!0}}]);this.editedPointId=n}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o=this.store.getGeometryCopy(this.editedFeatureId);this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?o.coordinates[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates.splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const n={type:"LineString",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:n,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:n}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.closingPointId,o=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e!==void 0&&this.store.delete([e]),o!==void 0&&this.store.delete([o]),t!==void 0&&this.store.delete([t])}catch(n){}}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode)return t.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,t.lineStringWidth,e),t.zIndex=_e,t;if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const o=e.properties[Je];return t.pointColor=this.getHexColorStylingValue(o?this.styles.closingPointColor:this.styles.snappingPointColor,t.pointColor,e),t.pointWidth=this.getNumericStylingValue(o?this.styles.closingPointWidth:this.styles.snappingPointWidth,t.pointWidth,e),t.pointOutlineColor=this.getHexColorStylingValue(o?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e),t.pointOutlineWidth=this.getNumericStylingValue(o?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e),t.zIndex=50,t}return t}validateFeature(e){return this.validateModeFeature(e,t=>_l(t,this.coordinatePrecision))}lineStringFilter(e){return!!(e.geometry.type==="LineString"&&e.properties&&e.properties.mode===this.mode)}snapCoordinate(e){var t,o,n;let r;if((t=this.snapping)!=null&&t.toLine){let s;s=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}return(o=this.snapping)!=null&&o.toCoordinate&&(r=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e)),(n=this.snapping)!=null&&n.toCustom&&(r=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),r}}const Ol="Feature is not a Point",jl="Feature has invalid coordinates",zl="Feature has coordinates with excessive precision";function Ll(i,e){return i.geometry.type!=="Point"?{valid:!1,reason:Ol}:Oi(i.geometry.coordinates)?Kt(i.geometry.coordinates,e)?{valid:!0}:{valid:!1,reason:zl}:{valid:!1,reason:jl}}const Tl={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"};class $l extends Be{constructor(e){super(e,!0),this.mode="point",this.cursors=Tl,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors)),e!=null&&e.editable&&(this.editable=e.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(e,t){if(this.allowPointerEvent(this.pointerEvents.onDragStart,e)){if(this.editable){const o=this.getNearestPointFeature(e);this.editedFeatureId=o==null?void 0:o.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),t(!1))}}onDrag(e,t){this.allowPointerEvent(this.pointerEvents.onDrag,e)&&this.editedFeatureId!==void 0&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[e.lng,e.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!0}])))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!1}]),this.editedFeatureId=void 0,t(!0))}registerBehaviors(e){this.pixelDistance=new yt(e),this.clickBoundingBox=new vt(e)}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode){const o=!!(e.id&&this.editedFeatureId===e.id);t.pointWidth=this.getNumericStylingValue(o?this.styles.editedPointWidth:this.styles.pointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(o?this.styles.editedPointColor:this.styles.pointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(o?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(o?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e),t.zIndex=30}return t}validateFeature(e){return this.validateModeFeature(e,t=>Ll(t,this.coordinatePrecision))}onLeftClick(e){const t={type:"Point",coordinates:[e.lng,e.lat]},o={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:t,properties:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Finish}).valid)return;const[n]=this.store.create([{geometry:t,properties:o}]);this.onFinish(n,{mode:this.mode,action:"draw"})}onRightClick(e){if(!this.editable)return;const t=this.getNearestPointFeature(e);t&&this.store.delete([t.id])}getNearestPointFeature(e){const t=this.clickBoundingBox.create(e),o=this.store.search(t);let n,r=1/0;for(let s=0;s<o.length;s++){const a=o[s];if(a.geometry.type!=="Point"||a.properties.mode!==this.mode)continue;const l=this.pixelDistance.measure(e,a.geometry.coordinates);l>r||l>this.pointerDistance||(r=l,n=a)}return n}}class Wl extends fe{constructor(e,t){super(e),this.config=void 0,this.pixelDistance=void 0,this._startEndPoints=[],this.config=e,this.pixelDistance=t}get ids(){return this._startEndPoints.concat()}set ids(e){}create(e,t){if(this.ids.length)throw new Error("Opening and closing points already created");if(e.length<=3)throw new Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:e[0]},properties:{mode:t,[Je]:!0}},{geometry:{type:"Point",coordinates:e[e.length-2]},properties:{mode:t,[Je]:!0}}])}delete(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}update(e){if(this.ids.length!==2)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:e[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:e[e.length-3]}}])}isClosingPoint(e){const t=this.store.getGeometryCopy(this.ids[0]),o=this.store.getGeometryCopy(this.ids[1]),n=this.pixelDistance.measure(e,t.coordinates),r=this.pixelDistance.measure(e,o.coordinates);return{isClosing:n<this.pointerDistance,isPreviousClosing:r<this.pointerDistance}}}class Zo extends fe{constructor(e){super(e)}createOrUpdate(e){const t=this.store.getGeometryCopy(e),o=this.store.getPropertiesCopy(e);let n;if(t.type==="Polygon")n=t.coordinates[0].slice(0,-1);else{if(t.type!=="LineString")return;n=t.coordinates}const r=this.store.getPropertiesCopy(e),s=r.coordinatePointIds;if(s)if(s&&s.every(a=>this.store.has(a))){const a=r.coordinatePointIds,l=a.map(d=>this.store.getGeometryCopy(d).coordinates);if(a.length!==n.length){this.deleteCoordinatePoints(a);const d=this.createPoints(n,o.mode,e);this.setFeatureCoordinatePoints(e,d)}else n.forEach((d,c)=>{d[0]===l[c][0]&&d[1]===l[c][1]||this.store.updateGeometry([{id:a[c],geometry:{type:"Point",coordinates:d}}])})}else{const a=s.filter(d=>this.store.has(d));a.length&&this.deleteCoordinatePoints(a);const l=this.createPoints(n,o.mode,e);this.setFeatureCoordinatePoints(e,l)}else{const a=this.createPoints(n,o.mode,e);this.setFeatureCoordinatePoints(e,a)}}deletePointsByFeatureIds(e){for(const t of e)this.deleteIfPresent(t)}getUpdated(e,t){const o=this.store.getPropertiesCopy(e);if(o.coordinatePointIds)return o.coordinatePointIds.map((n,r)=>({id:n,geometry:Z({},this.store.getGeometryCopy(n),{coordinates:t[r]})}))}createPoints(e,t,o){return this.store.create(e.map((n,r)=>({geometry:{type:"Point",coordinates:n},properties:{mode:t,[Bi]:!0,[cl]:o,index:r}})))}setFeatureCoordinatePoints(e,t){this.store.updateProperty([{id:e,property:mt,value:t}])}deleteCoordinatePoints(e){const t=e.filter(o=>this.store.has(o));this.store.delete(t)}deleteIfPresent(e){const t=this.store.getPropertiesCopy(e).coordinatePointIds;t&&(this.deleteCoordinatePoints(t),this.setFeatureCoordinatePoints(e,null))}}const Nl={cancel:"Escape",finish:"Enter"},Al={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"};class Ul extends Be{constructor(e){super(e,!0),this.mode="polygon",this.currentCoordinate=0,this.currentId=void 0,this.keyEvents=Nl,this.cursors=Al,this.mouseMove=!1,this.showCoordinatePoints=!1,this.snapping=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinatePoints=void 0,this.lineSnapping=void 0,this.coordinateSnapping=void 0,this.pixelDistance=void 0,this.closingPoints=void 0,this.clickBoundingBox=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents)),e!=null&&e.snapping&&(this.snapping=e.snapping),(e==null?void 0:e.editable)!==void 0&&(this.editable=e.editable),(e==null?void 0:e.pointerEvents)!==void 0&&(this.pointerEvents=e.pointerEvents),(e==null?void 0:e.showCoordinatePoints)!==void 0){if(this.showCoordinatePoints=e.showCoordinatePoints,this.coordinatePoints&&e.showCoordinatePoints===!0)this.store.copyAllWhere(t=>t.mode===this.mode).map(t=>t.id).forEach(t=>{this.coordinatePoints.createOrUpdate(t)});else if(this.coordinatePoints&&this.showCoordinatePoints===!1){const t=this.store.copyAllWhere(o=>o.mode===this.mode&&!!o[mt]);this.coordinatePoints.deletePointsByFeatureIds(t.map(o=>o.id))}}}close(){if(this.currentId===void 0)return;const e=this.store.getGeometryCopy(this.currentId).coordinates[0];if(e.length<5||!this.updatePolygonGeometry([...e.slice(0,-2),e[0]],q.Finish))return;const t=this.currentId;if(this.currentId){const o=zi(this.store.getGeometryCopy(this.currentId));o&&this.store.updateGeometry([{id:this.currentId,geometry:o}]),this.store.updateProperty([{id:this.currentId,property:xe,value:void 0}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),this.state==="drawing"&&this.setStarted(),this.onFinish(t,{mode:this.mode,action:"draw"})}registerBehaviors(e){this.clickBoundingBox=new vt(e),this.pixelDistance=new yt(e),this.lineSnapping=new Li(e,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new Gt(e,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new Wl(e,this.pixelDistance),this.coordinatePoints=new Zo(e)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){this.mouseMove=!0,this.setCursor(this.cursors.start);const t=this.snapCoordinate(e);if(t){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:t}}]);else{const[r]=this.store.create([{geometry:{type:"Point",coordinates:t},properties:{mode:this.mode,[pi]:!0}}]);this.snappedPointId=r}e.lng=t[0],e.lat=t[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);if(this.currentId===void 0||this.currentCoordinate===0)return;const o=this.store.getGeometryCopy(this.currentId).coordinates[0];let n;if(this.currentCoordinate===1){const r=1/Math.pow(10,this.coordinatePrecision-1),s=Math.max(1e-6,r);n=[o[0],[e.lng,e.lat],[e.lng,e.lat-s],o[0]]}else if(this.currentCoordinate===2)n=[o[0],o[1],[e.lng,e.lat],o[0]];else{const{isClosing:r,isPreviousClosing:s}=this.closingPoints.isClosingPoint(e);s||r?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),n=[...o.slice(0,-2),o[0],o[0]]):n=[...o.slice(0,-2),[e.lng,e.lat],o[0]]}this.updatePolygonGeometry(n,q.Provisional)}updatePolygonGeometry(e,t){if(!this.currentId)return!1;const o={type:"Polygon",coordinates:[e]};return!(this.validate&&!this.validate({type:"Feature",geometry:o},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:o}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId),0))}snapCoordinate(e){var t,o,n;let r;if((t=this.snapping)!=null&&t.toLine){let s;s=this.currentId?this.lineSnapping.getSnappableCoordinate(e,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}if((o=this.snapping)!=null&&o.toCoordinate){let s;s=this.currentId?this.coordinateSnapping.getSnappableCoordinate(e,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(e),s&&(r=s)}return(n=this.snapping)!=null&&n.toCustom&&(r=this.snapping.toCustom(e,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),r}polygonFilter(e){return!!(e.geometry.type==="Polygon"&&e.properties&&e.properties.mode===this.mode)}onRightClick(e){if(!this.editable||this.state!=="started")return;const{featureId:t,featureCoordinateIndex:o}=this.coordinateSnapping.getSnappable(e,s=>this.polygonFilter(s));if(!t||o===void 0)return;const n=this.store.getGeometryCopy(t);let r;n.type==="Polygon"&&(r=n.coordinates[0],r.length<=4||(n.type!=="Polygon"||o!==0&&o!==r.length-1?r.splice(o,1):(r.shift(),r.pop(),r.push([r[0][0],r[0][1]])),(!this.validate||this.validate({id:t,type:"Feature",geometry:n,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:t,geometry:n}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(t),this.onFinish(t,{mode:this.mode,action:"edit"}))))}onLeftClick(e){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.currentCoordinate===0){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const[o]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[xe]:!0}}]);this.currentId=o,this.currentCoordinate++,this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(o),this.setDrawing()}else if(this.currentCoordinate===1&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const o=this.store.getGeometryCopy(this.currentId);if(Nt([e.lng,e.lat],o.coordinates[0][0])||!this.updatePolygonGeometry([o.coordinates[0][0],[e.lng,e.lat],[e.lng,e.lat],o.coordinates[0][0]],q.Commit))return;this.currentCoordinate++}else if(this.currentCoordinate===2&&this.currentId){const t=this.snapCoordinate(e);t&&(e.lng=t[0],e.lat=t[1]);const o=this.store.getGeometryCopy(this.currentId).coordinates[0];if(Nt([e.lng,e.lat],o[1])||!this.updatePolygonGeometry([o[0],o[1],[e.lng,e.lat],[e.lng,e.lat],o[0]],q.Commit))return;this.currentCoordinate===2&&this.closingPoints.create(o,"polygon"),this.currentCoordinate++}else if(this.currentId){const t=this.store.getGeometryCopy(this.currentId).coordinates[0],{isClosing:o,isPreviousClosing:n}=this.closingPoints.isClosingPoint(e);if(n||o)this.close();else{const r=this.snapCoordinate(e);if(r&&(e.lng=r[0],e.lat=r[1]),Nt([e.lng,e.lat],t[this.currentCoordinate-1]))return;const s=function(a=[[[0,0],[0,1],[1,1],[1,0],[0,0]]]){return{type:"Feature",geometry:{type:"Polygon",coordinates:a},properties:{}}}([[...t.slice(0,-1),[e.lng,e.lat],t[0]]]);if(!this.updatePolygonGeometry(s.geometry.coordinates[0],q.Commit))return;this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(s.geometry.coordinates[0])}}}onClick(e){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(e),this.mouseMove=!1,e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onKeyDown(){}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.editable)return;let o;if(this.state==="started"){const n=this.lineSnapping.getSnappable(e,s=>this.polygonFilter(s));n.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=n.featureCoordinateIndex,this.editedFeatureId=n.featureId,o=n.coordinate);const r=this.coordinateSnapping.getSnappable(e,s=>this.polygonFilter(s));r.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=r.featureCoordinateIndex,this.editedFeatureId=r.featureId,o=r.coordinate)}if(this.editedFeatureId&&o){if(!this.editedPointId){const[n]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,[Ie]:!0}}]);this.editedPointId=n}this.setCursor(this.cursors.dragStart),t(!1)}}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o=this.store.getGeometryCopy(this.editedFeatureId),n=o.coordinates[0];this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?this.editedFeatureCoordinateIndex===0||this.editedFeatureCoordinateIndex===o.coordinates[0].length-1?(n[0]=[e.lng,e.lat],n[n.length-1]=[e.lng,e.lat]):n[this.editedFeatureCoordinateIndex]=[e.lng,e.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o.coordinates[0].splice(this.editedInsertIndex,0,[e.lng,e.lat]),this.editedFeatureCoordinateIndex++);const r={type:"Polygon",coordinates:o.coordinates};this.validate&&!this.validate({type:"Feature",geometry:r,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:r}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.editedFeatureId),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[e.lng,e.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!0}]))}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:Ie,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,t(!0))}cleanUp(){const e=this.currentId,t=this.snappedPointId,o=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{e&&this.coordinatePoints.deletePointsByFeatureIds([e]),e!==void 0&&this.store.delete([e]),o!==void 0&&this.store.delete([o]),t!==void 0&&this.store.delete([t]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(n){}}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=_e,t;if(e.geometry.type==="Point"){const o=e.properties[Ie],n=e.properties[Bi],r=o?"editedPoint":e.properties[Je]?"closingPoint":e.properties[pi]?"snappingPoint":n?"coordinatePoint":void 0;if(!r)return t;const s={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth},coordinatePoint:{width:this.styles.coordinatePointWidth,color:this.styles.coordinatePointColor,outlineColor:this.styles.coordinatePointOutlineColor,outlineWidth:this.styles.coordinatePointOutlineWidth}};return t.pointWidth=this.getNumericStylingValue(s[r].width,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(s[r].color,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(s[r].outlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(s[r].outlineWidth,2,e),t.zIndex=o?40:n?20:30,t}}return t}afterFeatureAdded(e){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(e.id)}validateFeature(e){return this.validateModeFeature(e,t=>ji(t,this.coordinatePrecision))}}const Vl={cancel:"Escape",finish:"Enter"},Gl={start:"crosshair"};class Hl extends Be{constructor(e){super(e,!0),this.mode="rectangle",this.center=void 0,this.clickCount=0,this.currentRectangleId=void 0,this.keyEvents=Vl,this.cursors=Gl,this.updateOptions(e)}updateOptions(e){super.updateOptions(e),e!=null&&e.cursors&&(this.cursors=Z({},this.cursors,e.cursors)),(e==null?void 0:e.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents))}updateRectangle(e,t){if(this.clickCount===1&&this.center&&this.currentRectangleId){const o=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],n={type:"Polygon",coordinates:[[o,[e.lng,o[1]],[e.lng,e.lat],[o[0],e.lat],o]]};if(this.validate&&!this.validate({id:this.currentRectangleId,geometry:n},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:t}).valid)return;this.store.updateGeometry([{id:this.currentRectangleId,geometry:n}])}}close(){const e=this.currentRectangleId;if(e){const t=zi(this.store.getGeometryCopy(e));t&&this.store.updateGeometry([{id:e,geometry:t}]),this.store.updateProperty([{id:e,property:xe,value:void 0}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.onFinish(e,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(e){if(e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e))if(this.clickCount===0){this.center=[e.lng,e.lat];const[t]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat],[e.lng,e.lat]]]},properties:{mode:this.mode,[xe]:!0}}]);this.currentRectangleId=t,this.clickCount++,this.setDrawing()}else this.updateRectangle(e,q.Finish),this.close()}onMouseMove(e){this.updateRectangle(e,q.Provisional)}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel?this.cleanUp():e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const e=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),e!==void 0&&this.store.delete([e])}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e.type==="Feature"&&e.geometry.type==="Polygon"&&e.properties.mode===this.mode&&(t.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,t.polygonFillColor,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,t.polygonOutlineColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,t.polygonOutlineWidth,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,t.polygonFillOpacity,e),t.zIndex=_e),t}validateFeature(e){return this.validateModeFeature(e,t=>Yo(t,this.coordinatePrecision))}}function gi(i,e){const t=i,o=e,n=pe(t[1]),r=pe(o[1]);let s=pe(o[0]-t[0]);s>Math.PI&&(s-=2*Math.PI),s<-Math.PI&&(s+=2*Math.PI);const a=Math.log(Math.tan(r/2+Math.PI/4)/Math.tan(n/2+Math.PI/4)),l=(Fe(Math.atan2(s,a))+360)%360;return l>180?-(360-l):l}function Jo(i,e,t){let o=e;e<0&&(o=-Math.abs(o));const n=o/Ho,r=i[0]*Math.PI/180,s=pe(i[1]),a=pe(t),l=n*Math.cos(a);let d=s+l;Math.abs(d)>Math.PI/2&&(d=d>0?Math.PI-d:-Math.PI-d);const c=Math.log(Math.tan(d/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),h=Math.abs(c)>1e-11?l/c:Math.cos(s),u=[(180*(r+n*Math.sin(a)/h)/Math.PI+540)%360-180,180*d/Math.PI];return u[0]+=u[0]-i[0]>180?-360:i[0]-u[0]>180?360:0,u}function Xl(i,e,t,o,n){const r=o(i[0],i[1]),s=o(e[0],e[1]),{lng:a,lat:l}=n((r.x+s.x)/2,(r.y+s.y)/2);return[ne(a,t),ne(l,t)]}function Kl(i,e,t){const o=Jo(i,1e3*we(i,e)/2,gi(i,e));return[ne(o[0],t),ne(o[1],t)]}function ho({featureCoords:i,precision:e,unproject:t,project:o,projection:n}){const r=[];for(let s=0;s<i.length-1;s++){let a;if(n==="web-mercator")a=Xl(i[s],i[s+1],e,o,t);else{if(n!=="globe")throw new Error("Invalid projection");a=Kl(i[s],i[s+1],e)}r.push(a)}return r}class Yl extends fe{constructor(e,t,o){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=t,this.coordinatePointBehavior=o}get ids(){return this._midPoints.concat()}set ids(e){}insert(e,t,o){const n=this.store.getGeometryCopy(t),{midPointFeatureId:r,midPointSegment:s}=this.store.getPropertiesCopy(t),a=this.store.getGeometryCopy(r),l=a.type==="Polygon"?a.coordinates[0]:a.coordinates;l.splice(s+1,0,n.coordinates),a.coordinates=a.type==="Polygon"?[l]:l,this.store.updateGeometry([{id:r,geometry:a}]),this.store.getPropertiesCopy(e)[mt]&&this.coordinatePointBehavior.createOrUpdate(e),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(l,r,o),this.selectionPointBehavior.create(l,a.type,r)}create(e,t,o){if(!this.store.has(t))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(n,r,s,a,l,d){return ho({featureCoords:n,precision:s,project:a,unproject:l,projection:d}).map((c,h)=>({geometry:{type:"Point",coordinates:c},properties:r(h)}))}(e,n=>({mode:this.mode,[me.MID_POINT]:!0,midPointSegment:n,midPointFeatureId:t}),o,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(this._midPoints.length!==0)return ho({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((t,o)=>({id:this._midPoints[o],geometry:{type:"Point",coordinates:t}}))}}class ql extends fe{constructor(e){super(e),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,t,o){this._selectionPoints=this.store.create(function(n,r,s){const a=[],l=r==="Polygon"?n.length-1:n.length;for(let d=0;d<l;d++)a.push({geometry:{type:"Point",coordinates:n[d]},properties:s(d)});return a}(e,t,n=>({mode:this.mode,index:n,[me.SELECTION_POINT]:!0,[me.SELECTION_POINT_FEATURE_ID]:o})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(this._selectionPoints.length!==0)return this._selectionPoints.map((t,o)=>({id:t,geometry:{type:"Point",coordinates:e[o]}}))}getOneUpdated(e,t){if(this._selectionPoints[e]!==void 0)return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:t}}}}function Qo(i,e){let t=!1;for(let s=0,a=e.length;s<a;s++){const l=e[s];for(let d=0,c=l.length,h=c-1;d<c;h=d++)(n=l[d])[1]>(o=i)[1]!=(r=l[h])[1]>o[1]&&o[0]<(r[0]-n[0])*(o[1]-n[1])/(r[1]-n[1])+n[0]&&(t=!t)}var o,n,r;return t}const fi=(i,e,t)=>{const o=r=>r*r,n=(r,s)=>o(r.x-s.x)+o(r.y-s.y);return Math.sqrt(((r,s,a)=>{const l=n(s,a);if(l===0)return n(r,s);let d=((r.x-s.x)*(a.x-s.x)+(r.y-s.y)*(a.y-s.y))/l;return d=Math.max(0,Math.min(1,d)),n(r,{x:s.x+d*(a.x-s.x),y:s.y+d*(a.y-s.y)})})(i,e,t))};class Zl extends fe{constructor(e,t,o){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=t,this.pixelDistance=o}find(e,t){let o,n,r,s,a=1/0,l=1/0,d=1/0;const c=this.createClickBoundingBox.create(e),h=this.store.search(c);for(let u=0;u<h.length;u++){const p=h[u],f=p.geometry;if(f.type==="Point"){if(p.properties.selectionPoint||p.properties.coordinatePoint||!t&&p.properties[me.MID_POINT])continue;const v=this.pixelDistance.measure(e,f.coordinates);p.properties[me.MID_POINT]&&v<this.pointerDistance&&v<d?(d=v,r=p):!p.properties[me.MID_POINT]&&v<this.pointerDistance&&v<a&&(a=v,o=p)}else if(f.type==="LineString"){if(o)continue;for(let v=0;v<f.coordinates.length-1;v++){const S=f.coordinates[v],P=f.coordinates[v+1],w=fi({x:e.containerX,y:e.containerY},this.project(S[0],S[1]),this.project(P[0],P[1]));w<this.pointerDistance&&w<l&&(l=w,n=p)}}else if(f.type==="Polygon"){if(o||n)continue;Qo([e.lng,e.lat],f.coordinates)&&(s=p)}}return{clickedFeature:o||n||s,clickedMidPoint:r}}}class Jl extends fe{constructor(e,t,o,n,r){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=t,this.selectionPoints=o,this.midPoints=n,this.coordinatePoints=r}startDragging(e,t){this.draggedFeatureId=t,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(e,t){const{clickedFeature:o}=this.featuresAtCursorEvent.find(e,!0);return!(!o||o.id!==t)}drag(e,t){if(!this.draggedFeatureId)return;const o=this.store.getGeometryCopy(this.draggedFeatureId),n=[e.lng,e.lat];if(o.type==="Polygon"||o.type==="LineString"){let r,s;if(o.type==="Polygon"?(r=o.coordinates[0],s=r.length-1):(r=o.coordinates,s=r.length),!this.dragPosition)return!1;for(let c=0;c<s;c++){const h=r[c];let u,p;if(this.config.projection==="web-mercator"){const f=se(this.dragPosition[0],this.dragPosition[1]),v=se(n[0],n[1]),S=se(h[0],h[1]),P={x:f.x-v.x,y:f.y-v.y},w=S.x-P.x,C=S.y-P.y,{lng:y,lat:x}=et(w,C);u=y,p=x}else{const f=[this.dragPosition[0]-n[0],this.dragPosition[1]-n[1]];u=h[0]-f[0],p=h[1]-f[1]}if(u=ne(u,this.config.coordinatePrecision),p=ne(p,this.config.coordinatePrecision),u>180||u<-180||p>90||p<-90)return!1;r[c]=[u,p]}o.type==="Polygon"&&(r[r.length-1]=[r[0][0],r[0][1]]);const a=this.selectionPoints.getUpdated(r)||[],l=this.midPoints.getUpdated(r)||[],d=this.coordinatePoints.getUpdated(this.draggedFeatureId,r)||[];if(t&&!t({type:"Feature",id:this.draggedFeatureId,geometry:o,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o},...a,...l,...d]),this.dragPosition=[e.lng,e.lat]}else o.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:n}}]),this.dragPosition=[e.lng,e.lat])}}class Ql extends fe{constructor(e,t,o,n,r,s,a){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.lineSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=t,this.selectionPoints=o,this.midPoints=n,this.coordinatePoints=r,this.coordinateSnapping=s,this.lineSnapping=a}getClosestCoordinate(e,t){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return o;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<o.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);o.dist=s,o.index=a?0:r,o.isFirstOrLastPolygonCoord=a}}return o}getDraggableIndex(e,t){const o=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,o);return n.index===-1?-1:n.index}snapCoordinate(e,t,o){let n=[e.lng,e.lat];const r=s=>!!(s.properties&&s.properties.mode===o.properties.mode&&s.id!==this.draggedCoordinate.id);if(t!=null&&t.toLine){let s;s=this.lineSnapping.getSnappable(e,r).coordinate,s&&(n=s)}if(t.toCoordinate){let s;s=this.coordinateSnapping.getSnappable(e,r).coordinate,s&&(n=s)}if(t!=null&&t.toCustom){let s;s=t.toCustom(e,{currentCoordinate:this.draggedCoordinate.index,currentId:o.id,getCurrentGeometrySnapshot:o.id?()=>this.store.getGeometryCopy(o.id):()=>null,project:this.project,unproject:this.unproject}),s&&(n=s)}return n}drag(e,t,o,n){const r=this.draggedCoordinate.id;if(r===null)return!1;const s=this.draggedCoordinate.index,a=this.store.getGeometryCopy(r),l=this.store.getPropertiesCopy(r),d=a.type==="LineString"?a.coordinates:a.coordinates[0],c=a.type==="Polygon"&&(s===d.length-1||s===0),h={type:"Feature",id:r,geometry:a,properties:l},u=this.snapCoordinate(e,n,h);if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(c){const P=d.length-1;d[0]=u,d[P]=u}else d[s]=u;const p=this.selectionPoints.getOneUpdated(s,u),f=p?[p]:[],v=this.midPoints.getUpdated(d)||[],S=this.coordinatePoints.getUpdated(r,d)||[];return!(a.type!=="Point"&&!t&&Ko({geometry:a})||o&&!o(h,{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid||(this.store.updateGeometry([{id:r,geometry:a},...f,...v,...S]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}}function po(i){let e=0,t=0,o=0;return(i.geometry.type==="Polygon"?i.geometry.coordinates[0].slice(0,-1):i.geometry.coordinates).forEach(n=>{e+=n[0],t+=n[1],o++},!0),[e/o,t/o]}function mi(i){const e=(i.geometry.type==="Polygon"?i.geometry.coordinates[0]:i.geometry.coordinates).map(t=>{const{x:o,y:n}=se(t[0],t[1]);return[o,n]});return i.geometry.type==="Polygon"?function(t){let o=0,n=0,r=0;const s=t.length;for(let a=0;a<s-1;a++){const[l,d]=t[a],[c,h]=t[a+1],u=l*h-c*d;o+=u,n+=(l+c)*u,r+=(d+h)*u}return o/=2,n/=6*o,r/=6*o,{x:n,y:r}}(e):function(t){const o=t.length;let n=0,r=0;for(let s=0;s<o;s++){const[a,l]=t[s];n+=a,r+=l}return{x:n/o,y:r/o}}(e)}class ed extends fe{constructor(e,t,o,n){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryCentroid=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.config=e,this.selectionPoints=t,this.midPoints=o,this.coordinatePoints=n}reset(){this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.selectedGeometryCentroid=void 0}rotate(e,t,o){this.selectedGeometry||(this.selectedGeometry=this.store.getGeometryCopy(t));const n=this.selectedGeometry;if(n.type!=="Polygon"&&n.type!=="LineString")return;const r=[e.lng,e.lat];let s;const a={type:"Feature",geometry:n,properties:{}};if(this.config.projection==="web-mercator"){this.selectedGeometryWebMercatorCentroid||(this.selectedGeometryWebMercatorCentroid=mi(a));const u=se(e.lng,e.lat);if(s=Sl(this.selectedGeometryWebMercatorCentroid,u),s===0)return;if(!this.lastBearing)return void(this.lastBearing=s);((p,f)=>{if(f===0||f===360||f===-360)return p;const v=.017453292519943295*f,S=(p.geometry.type==="Polygon"?p.geometry.coordinates[0]:p.geometry.coordinates).map(([C,y])=>se(C,y)),P=S.reduce((C,y)=>({x:C.x+y.x,y:C.y+y.y}),{x:0,y:0});P.x/=S.length,P.y/=S.length;const w=S.map(C=>({x:P.x+(C.x-P.x)*Math.cos(v)-(C.y-P.y)*Math.sin(v),y:P.y+(C.x-P.x)*Math.sin(v)+(C.y-P.y)*Math.cos(v)})).map(({x:C,y})=>[et(C,y).lng,et(C,y).lat]);p.geometry.type==="Polygon"?p.geometry.coordinates[0]=w:p.geometry.coordinates=w})(a,-(this.lastBearing-s))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(this.selectedGeometryCentroid||(this.selectedGeometryCentroid=po({geometry:n})),s=gi(this.selectedGeometryCentroid,r),!this.lastBearing)return void(this.lastBearing=s+180);(function(u,p){if(p===0||p===360||p===-360)return u;const f=po(u);(u.geometry.type==="Polygon"?u.geometry.coordinates[0]:u.geometry.coordinates).forEach(v=>{const S=gi(f,v)+p,P=function(C,y){C[0]+=C[0]-y[0]>180?-360:y[0]-C[0]>180?360:0;const x=Ho,_=y[1]*Math.PI/180,D=C[1]*Math.PI/180,G=D-_;let k=Math.abs(C[0]-y[0])*Math.PI/180;k>Math.PI&&(k-=2*Math.PI);const L=Math.log(Math.tan(D/2+Math.PI/4)/Math.tan(_/2+Math.PI/4)),$=Math.abs(L)>1e-11?G/L:Math.cos(_);return Math.sqrt(G*G+$*$*k*k)*x}(f,v),w=Jo(f,P,S);v[0]=w[0],v[1]=w[1]})})(a,-(this.lastBearing-(s+180)))}const l=n.type==="Polygon"?n.coordinates[0]:n.coordinates;l.forEach(u=>{u[0]=ne(u[0],this.coordinatePrecision),u[1]=ne(u[1],this.coordinatePrecision)});const d=this.midPoints.getUpdated(l)||[],c=this.selectionPoints.getUpdated(l)||[],h=this.coordinatePoints.getUpdated(t,l)||[];if(o&&!o({id:t,type:"Feature",geometry:n,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}))return!1;this.store.updateGeometry([{id:t,geometry:n},...c,...d,...h]),this.projection==="web-mercator"?this.lastBearing=s:this.projection==="globe"&&(this.lastBearing=s+180)}}class td extends fe{constructor(e,t){super(e),this.config=void 0,this.dragCoordinateResizeBehavior=void 0,this.config=e,this.dragCoordinateResizeBehavior=t}scale(e,t,o){if(!this.dragCoordinateResizeBehavior.isDragging()){const n=this.dragCoordinateResizeBehavior.getDraggableIndex(e,t);this.dragCoordinateResizeBehavior.startDragging(t,n)}this.dragCoordinateResizeBehavior.drag(e,"center-fixed",o)}reset(){this.dragCoordinateResizeBehavior.stopDragging()}}class id extends fe{constructor(e,t,o,n,r){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=t,this.selectionPoints=o,this.midPoints=n,this.coordinatePoints=r}getClosestCoordinate(e,t){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let n;if(t.type==="LineString")n=t.coordinates;else{if(t.type!=="Polygon")return o;n=t.coordinates[0]}for(let r=0;r<n.length;r++){const s=this.pixelDistance.measure(e,n[r]);if(s<this.pointerDistance&&s<o.dist){const a=t.type==="Polygon"&&(r===n.length-1||r===0);o.dist=s,o.index=a?0:r,o.isFirstOrLastPolygonCoord=a}}return o}isValidDragWebMercator(e,t,o){switch(e){case 0:if(t<=0||o>=0)return!1;break;case 1:if(o>=0)return!1;break;case 2:if(t>=0||o>=0)return!1;break;case 3:if(t>=0)return!1;break;case 4:if(t>=0||o<=0)return!1;break;case 5:if(o<=0)return!1;break;case 6:if(t<=0||o<=0)return!1;break;case 7:if(t<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;const t=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(t),feature:e,updatedCoords:t,selectedCoordinate:t[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:o,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=mi(o);if(!a)return null;const l=se(s[0],s[1]),{closestBBoxIndex:d}=this.getIndexesWebMercator(n,l),c=se(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:d,updatedCoords:r,webMercatorCursor:c,webMercatorSelected:l,webMercatorOrigin:a}),r}centerFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{feature:o,boundingBox:n,updatedCoords:r,selectedCoordinate:s}=t,a=mi(o);if(!a)return null;const l=se(s[0],s[1]),{closestBBoxIndex:d}=this.getIndexesWebMercator(n,l),c=se(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:d,updatedCoords:r,webMercatorCursor:c,webMercatorSelected:l,webMercatorOrigin:a}),r}scaleFixedWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:o,webMercatorCursor:n,updatedCoords:r}){if(!this.isValidDragWebMercator(e,t.x-n.x,t.y-n.y))return null;let s=ye(t,n)/ye(t,o);return s<0&&(s=this.minimumScale),this.performWebMercatorScale(r,t.x,t.y,s,s),r}oppositeFixedWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:o,updatedCoords:n,selectedCoordinate:r}=t,s=se(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(o,s),d={x:o[a][0],y:o[a][1]},c=se(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:d}),n}oppositeWebMercatorDrag(e){const t=this.getSelectedFeatureDataWebMercator();if(!t)return null;const{boundingBox:o,updatedCoords:n,selectedCoordinate:r}=t,s=se(r[0],r[1]),{oppositeBboxIndex:a,closestBBoxIndex:l}=this.getIndexesWebMercator(o,s),d={x:o[a][0],y:o[a][1]},c=se(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:l,updatedCoords:n,webMercatorCursor:c,webMercatorSelected:s,webMercatorOrigin:d}),n}scaleWebMercator({closestBBoxIndex:e,webMercatorOrigin:t,webMercatorSelected:o,webMercatorCursor:n,updatedCoords:r}){const s=t.x-n.x,a=t.y-n.y;if(!this.isValidDragWebMercator(e,s,a))return null;let l=1;s!==0&&e!==1&&e!==5&&(l=1-(t.x-o.x-s)/s);let d=1;return a!==0&&e!==3&&e!==7&&(d=1-(t.y-o.y-a)/a),this.validateScale(l,d)?(l<0&&(l=this.minimumScale),d<0&&(d=this.minimumScale),this.performWebMercatorScale(r,t.x,t.y,l,d),r):null}getFeature(e){if(this.draggedCoordinate.id===null)return null;const t=this.store.getGeometryCopy(e);return t.type!=="Polygon"&&t.type!=="LineString"?null:{id:e,type:"Feature",geometry:t,properties:{}}}getNormalisedCoordinates(e){return e.type==="Polygon"?e.coordinates[0]:e.coordinates}validateScale(e,t){const o=!isNaN(e)&&t<Number.MAX_SAFE_INTEGER,n=!isNaN(t)&&t<Number.MAX_SAFE_INTEGER;return o&&n}performWebMercatorScale(e,t,o,n,r){e.forEach(s=>{const{x:a,y:l}=se(s[0],s[1]),d=t+(a-t)*n,c=o+(l-o)*r,{lng:h,lat:u}=et(d,c);s[0]=h,s[1]=u})}getBBoxWebMercator(e){const t=[1/0,1/0,-1/0,-1/0];(e=e.map(a=>{const{x:l,y:d}=se(a[0],a[1]);return[l,d]})).forEach(([a,l])=>{a<t[0]&&(t[0]=a),l<t[1]&&(t[1]=l),a>t[2]&&(t[2]=a),l>t[3]&&(t[3]=l)});const[o,n,r,s]=t;return[[o,s],[(o+r)/2,s],[r,s],[r,s+(n-s)/2],[r,n],[(o+r)/2,n],[o,n],[o,s+(n-s)/2]]}getIndexesWebMercator(e,t){let o,n=1/0;for(let r=0;r<e.length;r++){const s=ye({x:t.x,y:t.y},{x:e[r][0],y:e[r][1]});s<n&&(o=r,n=s)}if(o===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[o],closestBBoxIndex:o}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,t){this.draggedCoordinate={id:e,index:t}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,t){const o=this.store.getGeometryCopy(t),n=this.getClosestCoordinate(e,o);return n.index===-1?-1:n.index}drag(e,t,o){if(!this.draggedCoordinate.id)return!1;const n=this.getFeature(this.draggedCoordinate.id);if(!n)return!1;let r=null;if(t==="center"?r=this.centerWebMercatorDrag(e):t==="opposite"?r=this.oppositeWebMercatorDrag(e):t==="center-fixed"?r=this.centerFixedWebMercatorDrag(e):t==="opposite-fixed"&&(r=this.oppositeFixedWebMercatorDrag(e)),!r)return!1;for(let c=0;c<r.length;c++){const h=r[c];if(h[0]=ne(h[0],this.coordinatePrecision),h[1]=ne(h[1],this.coordinatePrecision),!Kt(h,this.coordinatePrecision))return!1}const s=this.midPoints.getUpdated(r)||[],a=this.selectionPoints.getUpdated(r)||[],l=this.coordinatePoints.getUpdated(n.id,r)||[],d={type:n.geometry.type,coordinates:n.geometry.type==="Polygon"?[r]:r};return!(o&&!o({id:this.draggedCoordinate.id,type:"Feature",geometry:d,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:q.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:d},...a,...s,...l]),0))}}const od={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},go={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class nd extends pl{constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=od,this.cursors=go,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.lineSnap=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?Z({},this.cursors,e.cursors):go,(e==null?void 0:e.keyEvents)===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e!=null&&e.keyEvents&&(this.keyEvents=Z({},this.keyEvents,e.keyEvents)),(e==null?void 0:e.dragEventThrottle)!==void 0&&(this.dragEventThrottle=e.dragEventThrottle),(e==null?void 0:e.allowManualDeselection)!==void 0&&(this.allowManualDeselection=e.allowManualDeselection),e!=null&&e.flags){this.flags=Z({},this.flags,e.flags),this.validations={};for(const t in this.flags){const o=this.flags[t].feature;o&&o.validation&&(this.validations[t]=o.validation)}}}selectFeature(e){this.select(e,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new yt(e),this.clickBoundingBox=new vt(e),this.featuresAtMouseEvent=new Zl(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new ql(e),this.coordinatePoints=new Zo(e),this.midPoints=new Yl(e,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new Gt(e,this.pixelDistance,this.clickBoundingBox),this.lineSnap=new Li(e,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new ed(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new Jl(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new Ql(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap,this.lineSnap),this.dragCoordinateResizeFeature=new id(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new td(e,this.dragCoordinateResizeFeature)}deselectFeature(){this.deselect()}deselect(){const e=this.selected.filter(t=>this.store.has(t)).map(t=>({id:t,property:me.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){if(!this.selectionPoints.ids.length)return;let t,o=1/0;if(this.selectionPoints.ids.forEach(u=>{const p=this.store.getGeometryCopy(u),f=this.pixelDistance.measure(e,p.coordinates);f<this.pointerDistance&&f<o&&(o=f,t=this.store.getPropertiesCopy(u))}),!t)return;const n=t.selectionPointFeatureId,r=t.index,s=this.store.getPropertiesCopy(n),a=this.flags[s.mode],l=this.validations[s.mode];if(!(a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.deletable))return;const d=this.store.getGeometryCopy(n);let c;if(d.type==="Polygon"){if(c=d.coordinates[0],c.length<=4)return}else if(d.type==="LineString"&&(c=d.coordinates,c.length<=2))return;if(!c||(d.type!=="Polygon"||r!==0&&r!==c.length-1?c.splice(r,1):(c.shift(),c.pop(),c.push([c[0][0],c[0][1]])),l&&!l({id:n,type:"Feature",geometry:d,properties:s},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:q.Commit}).valid))return;const h=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(h),this.store.updateGeometry([{id:n,geometry:d}]),s.coordinatePointIds&&this.coordinatePoints.createOrUpdate(n),this.selectionPoints.create(c,d.type,n),a&&a.feature&&a.feature.coordinates&&a.feature.coordinates.midpoints&&this.midPoints.create(c,n,this.coordinatePrecision)}select(e,t=!0){if(this.selected[0]===e)return;const{mode:o}=this.store.getPropertiesCopy(e),n=this.flags[o];if(!n||!n.feature)return;const r=this.selected[0];if(r){if(r===e)return;this.deselect()}t&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:me.SELECTED,value:!0}]),this.onSelect(e);const{type:s,coordinates:a}=this.store.getGeometryCopy(e);if(s!=="LineString"&&s!=="Polygon")return;const l=s==="LineString"?a:a[0];l&&n&&n.feature.coordinates&&(this.selectionPoints.create(l,s,e),n.feature.coordinates.midpoints&&this.midPoints.create(l,e,this.coordinatePrecision))}onLeftClick(e){const{clickedFeature:t,clickedMidPoint:o}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&o)this.midPoints.insert(this.selected[0],o.id,this.coordinatePrecision);else if(t&&t.id)this.select(t.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){e.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,e)||e.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,e)?this.onRightClick(e):e.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,e)&&this.onLeftClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(t=>e.heldKeys.includes(t))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(t=>e.heldKeys.includes(t))}preventDefaultKeyEvent(e){const t=this.canRotate(e),o=this.canScale(e);(t||o)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;const t=this.selected[0];this.onDeselect(this.selected[0]),this.coordinatePoints.deletePointsByFeatureIds([t]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,e)||!this.selected.length)return;const o=this.store.getPropertiesCopy(this.selected[0]),n=this.flags[o.mode];if(!(n&&n.feature&&(n.feature.draggable||n.feature.coordinates&&n.feature.coordinates.draggable||n.feature.coordinates&&n.feature.coordinates.resizable||n.feature.coordinates&&typeof n.feature.coordinates.midpoints=="object"&&n.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;const r=this.selected[0],s=this.dragCoordinate.getDraggableIndex(e,r);if(n&&n.feature&&n.feature.coordinates&&(n.feature.coordinates.draggable||n.feature.coordinates.resizable)&&s!==-1)return this.setCursor(this.cursors.dragStart),n.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(r,s):this.dragCoordinate.startDragging(r,s),void t(!1);if(n&&n.feature&&n.feature.coordinates&&typeof n.feature.coordinates.midpoints=="object"&&n.feature.coordinates.midpoints.draggable){const{clickedMidPoint:a}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&a){this.midPoints.insert(r,a.id,this.coordinatePrecision);const l=this.dragCoordinate.getDraggableIndex(e,r);return this.dragCoordinate.startDragging(r,l),void t(!1)}}return n&&n.feature&&n.feature.draggable&&this.dragFeature.canDrag(e,r)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,r),void t(!1)):void 0}onDrag(e,t){if(!this.allowPointerEvent(this.pointerEvents.onDrag,e))return;const o=this.selected[0];if(!o)return;const n=this.store.getPropertiesCopy(o),r=this.flags[n.mode],s=(r&&r.feature&&r.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const a=this.validations[n.mode];if(r&&r.feature&&r.feature.rotateable&&this.canRotate(e))return t(!1),void this.rotateFeature.rotate(e,o,a);if(r&&r.feature&&r.feature.scaleable&&this.canScale(e))return t(!1),void this.scaleFeature.scale(e,o,a);if(this.dragCoordinateResizeFeature.isDragging()&&r.feature&&r.feature.coordinates&&r.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return t(!1),void this.dragCoordinateResizeFeature.drag(e,r.feature.coordinates.resizable,a)}if(this.dragCoordinate.isDragging()){var l;const d=(l=r.feature)==null||(l=l.coordinates)==null?void 0:l.snappable;let c={toCoordinate:!1};return d===!0?c={toCoordinate:!0}:typeof d=="object"&&(c=d),void this.dragCoordinate.drag(e,s,a,c)}this.dragFeature.isDragging()?this.dragFeature.drag(e,a):t(!0)}onDragEnd(e,t){this.allowPointerEvent(this.pointerEvents.onDragEnd,e)&&(this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),t(!0))}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let t=!1;this.midPoints.ids.forEach(r=>{if(t)return;const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!0)});let o=!1;if(this.selectionPoints.ids.forEach(r=>{const s=this.store.getGeometryCopy(r);this.pixelDistance.measure(e,s.coordinates)<this.pointerDistance&&(t=!1,o=!0)}),t)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:n}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(n&&n.id===this.selected[0]||o)?this.cursors.pointerOver:"unset")}styleFeature(e){const t=Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&e.geometry.type==="Point"){if(e.properties.selectionPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,t.pointWidth,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),t.zIndex=30,t;if(e.properties.midPoint)return t.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,t.pointOutlineColor,e),t.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),t.zIndex=50,t}else if(e.properties[me.SELECTED]){if(e.geometry.type==="Polygon")return t.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,t.polygonFillColor,e),t.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,t.polygonOutlineWidth,e),t.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,t.polygonOutlineColor,e),t.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,t.polygonFillOpacity,e),t.zIndex=_e,t;if(e.geometry.type==="LineString")return t.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,t.lineStringColor,e),t.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,t.lineStringWidth,e),t.zIndex=_e,t;if(e.geometry.type==="Point")return t.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,t.pointWidth,e),t.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,t.pointColor,e),t.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,t.pointOutlineColor,e),t.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,t.pointOutlineWidth,e),t.zIndex=_e,t}return t}}class rd extends Be{constructor(...e){super(...e),this.type=Qe.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return Z({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}function en(i,e,t,o,n){for(;o>t;){if(o-t>600){const l=o-t+1,d=e-t+1,c=Math.log(l),h=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*h*(l-h)/l)*(d-l/2<0?-1:1);en(i,e,Math.max(t,Math.floor(e-d*h/l+u)),Math.min(o,Math.floor(e+(l-d)*h/l+u)),n)}const r=i[e];let s=t,a=o;for(ct(i,t,e),n(i[o],r)>0&&ct(i,t,o);s<a;){for(ct(i,s,a),s++,a--;n(i[s],r)<0;)s++;for(;n(i[a],r)>0;)a--}n(i[t],r)===0?ct(i,t,a):(a++,ct(i,a,o)),a<=e&&(t=a+1),e<=a&&(o=a-1)}}function ct(i,e,t){const o=i[e];i[e]=i[t],i[t]=o}function Xe(i,e){ht(i,0,i.children.length,e,i)}function ht(i,e,t,o,n){n||(n=Ye([])),n.minX=1/0,n.minY=1/0,n.maxX=-1/0,n.maxY=-1/0;for(let r=e;r<t;r++){const s=i.children[r];pt(n,i.leaf?o(s):s)}return n}function pt(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function sd(i,e){return i.minX-e.minX}function ad(i,e){return i.minY-e.minY}function ii(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Lt(i){return i.maxX-i.minX+(i.maxY-i.minY)}function ld(i,e){const t=Math.max(i.minX,e.minX),o=Math.max(i.minY,e.minY),n=Math.min(i.maxX,e.maxX),r=Math.min(i.maxY,e.maxY);return Math.max(0,n-t)*Math.max(0,r-o)}function oi(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function Tt(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function Ye(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function fo(i,e,t,o,n){const r=[e,t];for(;r.length;){if((t=r.pop())-(e=r.pop())<=o)continue;const s=e+Math.ceil((t-e)/o/2)*o;en(i,s,e,t,n),r.push(e,s,s,t)}}class dd{constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(e){let t=this.data;const o=[];if(!Tt(e,t))return o;const n=this.toBBox,r=[];for(;t;){for(let s=0;s<t.children.length;s++){const a=t.children[s],l=t.leaf?n(a):a;Tt(e,l)&&(t.leaf?o.push(a):oi(e,l)?this._all(a,o):r.push(a))}t=r.pop()}return o}collides(e){let t=this.data;if(Tt(e,t)){const o=[];for(;t;){for(let n=0;n<t.children.length;n++){const r=t.children[n],s=t.leaf?this.toBBox(r):r;if(Tt(e,s)){if(t.leaf||oi(e,s))return!0;o.push(r)}}t=o.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let o=0;o<e.length;o++)this.insert(e[o]);return}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){const o=this.data;this.data=t,t=o}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=Ye([])}remove(e){let t=this.data;const o=this.toBBox(e),n=[],r=[];let s,a,l=!1;for(;t||n.length;){if(t||(t=n.pop(),a=n[n.length-1],s=r.pop(),l=!0),t.leaf){const d=t.children.indexOf(e);d!==-1&&(t.children.splice(d,1),n.push(t),this._condense(n))}l||t.leaf||!oi(t,o)?a?(s++,t=a.children[s],l=!1):t=null:(n.push(t),r.push(s),s=0,a=t,t=t.children[0])}}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}_all(e,t){const o=[];for(;e;)e.leaf?t.push(...e.children):o.push(...e.children),e=o.pop();return t}_build(e,t,o,n){const r=o-t+1;let s,a=this._maxEntries;if(r<=a)return s=Ye(e.slice(t,o+1)),Xe(s,this.toBBox),s;n||(n=Math.ceil(Math.log(r)/Math.log(a)),a=Math.ceil(r/Math.pow(a,n-1))),s=Ye([]),s.leaf=!1,s.height=n;const l=Math.ceil(r/a),d=l*Math.ceil(Math.sqrt(a));fo(e,t,o,d,this.compareMinX);for(let c=t;c<=o;c+=d){const h=Math.min(c+d-1,o);fo(e,c,h,l,this.compareMinY);for(let u=c;u<=h;u+=l){const p=Math.min(u+l-1,h);s.children.push(this._build(e,u,p,n-1))}}return Xe(s,this.toBBox),s}_chooseSubtree(e,t,o,n){for(;n.push(t),!t.leaf&&n.length-1!==o;){let a,l=1/0,d=1/0;for(let c=0;c<t.children.length;c++){const h=t.children[c],u=ii(h),p=(r=e,s=h,(Math.max(s.maxX,r.maxX)-Math.min(s.minX,r.minX))*(Math.max(s.maxY,r.maxY)-Math.min(s.minY,r.minY))-u);p<d?(d=p,l=u<l?u:l,a=h):p===d&&u<l&&(l=u,a=h)}t=a||t.children[0]}var r,s;return t}_insert(e,t,o){const n=o?e:this.toBBox(e),r=[],s=this._chooseSubtree(n,this.data,t,r);for(s.children.push(e),pt(s,n);t>=0&&r[t].children.length>this._maxEntries;)this._split(r,t),t--;this._adjustParentBBoxes(n,r,t)}_split(e,t){const o=e[t],n=o.children.length,r=this._minEntries;this._chooseSplitAxis(o,r,n);const s=this._chooseSplitIndex(o,r,n),a=Ye(o.children.splice(s,o.children.length-s));a.height=o.height,a.leaf=o.leaf,Xe(o,this.toBBox),Xe(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(o,a)}_splitRoot(e,t){this.data=Ye([e,t]),this.data.height=e.height+1,this.data.leaf=!1,Xe(this.data,this.toBBox)}_chooseSplitIndex(e,t,o){let n,r=1/0,s=1/0;for(let a=t;a<=o-t;a++){const l=ht(e,0,a,this.toBBox),d=ht(e,a,o,this.toBBox),c=ld(l,d),h=ii(l)+ii(d);c<r?(r=c,n=a,s=h<s?h:s):c===r&&h<s&&(s=h,n=a)}return n||o-t}_chooseSplitAxis(e,t,o){const n=e.leaf?this.compareMinX:sd,r=e.leaf?this.compareMinY:ad;this._allDistMargin(e,t,o,n)<this._allDistMargin(e,t,o,r)&&e.children.sort(n)}_allDistMargin(e,t,o,n){e.children.sort(n);const r=this.toBBox,s=ht(e,0,t,r),a=ht(e,o-t,o,r);let l=Lt(s)+Lt(a);for(let d=t;d<o-t;d++){const c=e.children[d];pt(s,e.leaf?r(c):c),l+=Lt(s)}for(let d=o-t-1;d>=t;d--){const c=e.children[d];pt(a,e.leaf?r(c):c),l+=Lt(a)}return l}_adjustParentBBoxes(e,t,o){for(let n=o;n>=0;n--)pt(t[n],e)}_condense(e){for(let t,o=e.length-1;o>=0;o--)e[o].children.length===0?o>0?(t=e[o-1].children,t.splice(t.indexOf(e[o]),1)):this.clear():Xe(e[o],this.toBBox)}}class cd{constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new dd(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(e,t){this.idToNode.set(e.id,t),this.nodeToId.set(t,e.id)}toBBox(e){const t=[],o=[];let n;if(e.geometry.type==="Polygon")n=e.geometry.coordinates[0];else if(e.geometry.type==="LineString")n=e.geometry.coordinates;else{if(e.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");n=[e.geometry.coordinates]}for(let a=0;a<n.length;a++)o.push(n[a][1]),t.push(n[a][0]);const r=Math.min(...o),s=Math.max(...o);return{minX:Math.min(...t),minY:r,maxX:Math.max(...t),maxY:s}}insert(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}load(e){const t=[],o=new Set;e.forEach(n=>{const r=this.toBBox(n);if(this.setMaps(n,r),o.has(String(n.id)))throw new Error("Duplicate feature ID found ".concat(n.id));o.add(String(n.id)),t.push(r)}),this.tree.load(t)}update(e){this.remove(e.id);const t=this.toBBox(e);this.setMaps(e,t),this.tree.insert(t)}remove(e){const t=this.idToNode.get(e);if(!t)throw new Error("".concat(e," not inserted into the spatial index"));this.tree.remove(t)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(t=>this.nodeToId.get(t))}collides(e){return this.tree.collides(this.toBBox(e))}}const ud={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=16*Math.random()|0;return(i=="x"?e:3&e|8).toString(16)}),isValidId:i=>typeof i=="string"&&i.length===36};class hd{constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new cd,this.tracked=!e||e.tracked!==!1,this.idStrategy=e&&e.idStrategy?e.idStrategy:ud}clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,t,o,n){if(e.length===0)return[];let r=this.clone(e);const s=[],a=[];return r=r.filter(l=>{l.id==null&&(l.id=this.idStrategy.getId());const d=l.id;if(t){const c=t(l);if(!c.valid)return a.push({id:d,valid:!1,reason:c.reason}),!1}if(this.tracked){if(l.properties.createdAt){if(!io(l.properties.createdAt))return a.push({id:l.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else l.properties.createdAt=+new Date;if(l.properties.updatedAt){if(!io(l.properties.updatedAt))return a.push({id:l.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else l.properties.updatedAt=+new Date}return this.has(d)?(a.push({id:d,valid:!1,reason:"Feature already exists with this id: ".concat(d)}),!1):(this.store[d]=l,s.push(d),o&&o(l),a.push({id:d,valid:!0}),!0)}),this.spatialIndex.load(r),s.length>0&&this._onChange(s,"create",n),a}search(e,t){const o=this.spatialIndex.search(e).map(n=>this.store[n]);return this.clone(t?o.filter(t):o)}registerOnChange(e){this._onChange=(t,o,n)=>{e(t,o,n)}}getGeometryCopy(e){const t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get geometry copy"));return this.clone(t.geometry)}getPropertiesCopy(e){const t=this.store[e];if(!t)throw new Error("No feature with this id (".concat(e,"), can not get properties copy"));return this.clone(t.properties)}updateProperty(e,t){const o=[];e.forEach(({id:n,property:r,value:s})=>{const a=this.store[n];if(!a)throw new Error("No feature with this (".concat(n,"), can not update geometry"));o.push(n),s===void 0?delete a.properties[r]:a.properties[r]=s,this.tracked&&(a.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(o,"update",t)}updateGeometry(e,t){const o=[];e.forEach(({id:n,geometry:r})=>{o.push(n);const s=this.store[n];if(!s)throw new Error("No feature with this (".concat(n,"), can not update geometry"));s.geometry=this.clone(r),this.spatialIndex.update(s),this.tracked&&(s.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(o,"update",t)}create(e,t){const o=[];return e.forEach(({geometry:n,properties:r})=>{let s,a=Z({},r);this.tracked&&(s=+new Date,r?(a.createdAt=typeof r.createdAt=="number"?r.createdAt:s,a.updatedAt=typeof r.updatedAt=="number"?r.updatedAt:s):a={createdAt:s,updatedAt:s});const l=this.getId(),d={id:l,type:"Feature",geometry:n,properties:a};this.store[l]=d,this.spatialIndex.insert(d),o.push(l)}),this._onChange&&this._onChange([...o],"create",t),o}delete(e,t){e.forEach(o=>{if(!this.store[o])throw new Error("No feature with id ".concat(o,", can not delete"));delete this.store[o],this.spatialIndex.remove(o)}),this._onChange&&this._onChange([...e],"delete",t)}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}copyAllWhere(e){return this.clone(Object.keys(this.store).map(t=>this.store[t]).filter(t=>t.properties&&e(t.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}}class Ke{constructor({name:e,callback:t,unregister:o,register:n}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,n(t))},this.unregister=()=>{this.register&&(this.registered=!1,o(t))},this.callback=t}}var pd={__proto__:null,TerraDrawBaseAdapter:class{constructor(i){this._nextKeyUpIsContextMenu=!1,this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof i.minPixelDragDistance=="number"?i.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof i.minPixelDragDistanceSelecting=="number"?i.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof i.minPixelDragDistanceDrawing=="number"?i.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof i.coordinatePrecision=="number"?i.coordinatePrecision:9}getButton(i){return i.button===-1?"neither":i.button===0?"left":i.button===1?"middle":i.button===2?"right":"neither"}getMapElementXYPosition(i){const e=this.getMapEventElement(),{left:t,top:o}=e.getBoundingClientRect();return{containerX:i.clientX-t,containerY:i.clientY-o}}getDrawEventFromEvent(i,e=!1){const t=this.getLngLatFromEvent(i);if(!t)return null;const{lng:o,lat:n}=t,{containerX:r,containerY:s}=this.getMapElementXYPosition(i),a=this.getButton(i),l=Array.from(this._heldKeys);return{lng:ne(o,this._coordinatePrecision),lat:ne(n,this._coordinatePrecision),containerX:r,containerY:s,button:a,heldKeys:l,isContextMenu:e}}register(i){this._currentModeCallbacks=i,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new Ke({name:"pointerdown",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState="pre-dragging",this._lastDrawEvent=e)},register:i=>{this.getMapEventElement().addEventListener("pointerdown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerdown",i)}}),new Ke({name:"pointermove",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;i.preventDefault();const e=this.getDrawEventFromEvent(i);if(e)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e),this._lastDrawEvent=e;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const t={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},o={x:e.containerX,y:e.containerY},n=this._currentModeCallbacks.getState(),r=ye(t,o);let s=!1;if(s=n==="drawing"?r<this._minPixelDragDistanceDrawing:n==="selecting"?r<this._minPixelDragDistanceSelecting:r<this._minPixelDragDistance,s)return;this._nextKeyUpIsContextMenu=!1,this._dragState="dragging",this._currentModeCallbacks.onDragStart(e,a=>{this.setDraggability.bind(this)(a)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e,t=>{this.setDraggability.bind(this)(t)})},register:i=>{this.getMapEventElement().addEventListener("pointermove",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointermove",i)}}),new Ke({name:"contextmenu",callback:i=>{this._currentModeCallbacks&&(i.preventDefault(),this._nextKeyUpIsContextMenu=!0)},register:i=>{this.getMapEventElement().addEventListener("contextmenu",i)},unregister:i=>{this.getMapEventElement().removeEventListener("contextmenu",i)}}),new Ke({name:"pointerup",callback:i=>{if(!this._currentModeCallbacks||i.target!==this.getMapEventElement()||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e,t=>{this.setDraggability.bind(this)(t)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||(this._nextKeyUpIsContextMenu&&(e.isContextMenu=!0,this._nextKeyUpIsContextMenu=!1),this._currentModeCallbacks.onClick(e)),this._dragState="not-dragging",this.setDraggability(!0))},register:i=>{this.getMapEventElement().addEventListener("pointerup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerup",i)}}),new Ke({name:"keyup",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.delete(i.key),this._currentModeCallbacks.onKeyUp({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keyup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keyup",i)}}),new Ke({name:"keydown",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.add(i.key),this._currentModeCallbacks.onKeyDown({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keydown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keydown",i)}})]}unregister(){this._listeners.forEach(i=>{i.unregister()}),this.clear(),this._currentModeCallbacks=void 0}}};class gd{constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new rd;const t=new Set,o=e.modes.reduce((c,h)=>{if(t.has(h.mode))throw new Error("There is already a ".concat(h.mode," mode provided"));return t.add(h.mode),c[h.mode]=h,c},{}),n=Object.keys(o);if(n.length===0)throw new Error("No modes provided");n.forEach(c=>{if(o[c].type===Qe.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=c}}),this._modes=Z({},o,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new hd({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});const r=c=>{const h=[],u=this._store.copyAll().filter(p=>!c.includes(p.id)||(h.push(p),!1));return{changed:h,unchanged:u}},s=(c,h)=>{this._enabled&&this._eventListeners.finish.forEach(u=>{u(c,h)})},a=(c,h,u)=>{if(!this._enabled)return;this._eventListeners.change.forEach(v=>{v(c,h,u)});const{changed:p,unchanged:f}=r(c);h==="create"?this._adapter.render({created:p,deletedIds:[],unchanged:f,updated:[]},this.getModeStyles()):h==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:f,updated:p},this.getModeStyles()):h==="delete"?this._adapter.render({created:[],deletedIds:c,unchanged:f,updated:[]},this.getModeStyles()):h==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:f,updated:[]},this.getModeStyles())},l=c=>{if(!this._enabled)return;this._eventListeners.select.forEach(p=>{p(c)});const{changed:h,unchanged:u}=r([c]);this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())},d=c=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(p=>{p()});const{changed:h,unchanged:u}=r([c]);h&&this._adapter.render({created:[],deletedIds:[],unchanged:u,updated:h},this.getModeStyles())};Object.keys(this._modes).forEach(c=>{this._modes[c].register({mode:c,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:a,onSelect:l,onDeselect:d,onFinish:s,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const e={};return Object.keys(this._modes).forEach(t=>{e[t]=o=>this._instanceSelectMode&&o.properties[me.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(o):this._modes[t].styleFeature.bind(this._modes[t])(o)}),e}featuresAtLocation({lng:e,lat:t},o){const n=o&&o.pointerDistance!==void 0?o.pointerDistance:30,r=!o||o.ignoreSelectFeatures===void 0||o.ignoreSelectFeatures,s=!(!o||o.ignoreCoordinatePoints===void 0)&&o.ignoreCoordinatePoints,a=!(!o||o.ignoreCurrentlyDrawing===void 0)&&o.ignoreCurrentlyDrawing,l=!(!o||o.ignoreClosingPoints===void 0)&&o.ignoreClosingPoints,d=this._adapter.unproject.bind(this._adapter),c=this._adapter.project.bind(this._adapter),h=c(e,t),u=qo({unproject:d,point:h,pointerDistance:n});return this._store.search(u).filter(p=>{if(r&&(p.properties[me.MID_POINT]||p.properties[me.SELECTION_POINT])||s&&p.properties[Bi]||l&&p.properties[Je]||a&&p.properties[xe])return!1;if(p.geometry.type==="Point"){const f=p.geometry.coordinates,v=c(f[0],f[1]);return ye(h,v)<n}if(p.geometry.type==="LineString"){const f=p.geometry.coordinates;for(let v=0;v<f.length-1;v++){const S=f[v],P=f[v+1];if(fi(h,c(S[0],S[1]),c(P[0],P[1]))<n)return!0}return!1}if(Qo([e,t],p.geometry.coordinates))return!0;if(o!=null&&o.includePolygonsWithinPointerDistance){const f=p.geometry.coordinates;for(const v of f)for(let S=0;S<v.length-1;S++){const P=v[S],w=v[S+1],C=c(P[0],P[1]),y=c(w[0],w[1]);if(fi(h,C,y)<n)return!0}}return!1})}getSelectMode(){if(this.checkEnabled(),!this._instanceSelectMode)throw new Error("No select mode defined in instance");return this.getMode()!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}setModeStyles(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=t}updateModeOptions(e,t){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(t)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}getModeState(){return this._mode.state}setMode(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled();const t=[];e.forEach(o=>{if(!this._store.has(o))throw new Error("No feature with id ".concat(o,", can not delete"));const n=this._store.copy(o);n.properties[me.SELECTED]&&this.deselectFeature(o),n.properties[mt]&&t.push(...n.properties[mt])}),this._store.delete([...e,...t],{origin:"api"})}selectFeature(e){this.getSelectMode().selectFeature(e)}deselectFeature(e){this.getSelectMode().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}addFeatures(e){return this.checkEnabled(),e.length===0?[]:this._store.load(e,t=>{if(to(t)){const o=t.properties.mode,n=this._modes[o];if(!n)return{id:t.id,valid:!1,reason:"".concat(o," mode is not in the list of instantiated modes")};const r=n.validateFeature.bind(n)(t);return{id:t.id,valid:r.valid,reason:r.reason?r.reason:r.valid?void 0:"Feature is invalid"}}return{id:t.id,valid:!1,reason:"Mode property does not exist"}},t=>{if(to(t)){const o=this._modes[t.properties.mode];o&&o.afterFeatureAdded&&o.afterFeatureAdded(t)}},{origin:"api"})}start(){this._enabled||(this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,t)=>{this._mode.onDragStart(e,t)},onDrag:(e,t)=>{this._mode.onDrag(e,t)},onDragEnd:(e,t)=>{this._mode.onDragEnd(e,t)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}}))}getFeaturesAtLngLat(e,t){const{lng:o,lat:n}=e;return this.featuresAtLocation({lng:o,lat:n},t)}getFeaturesAtPointerEvent(e,t){const o=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return o===null?[]:this.featuresAtLocation(o,t)}stop(){this._enabled&&(this._enabled=!1,this._adapter.unregister())}on(e,t){const o=this._eventListeners[e];o.includes(t)||o.push(t)}off(e,t){const o=this._eventListeners[e];o.includes(t)&&o.splice(o.indexOf(t),1)}}class fd extends pd.TerraDrawBaseAdapter{constructor(e){super(e),this._renderBeforeLayerId=void 0,this._initialDragPan=void 0,this._initialDragRotate=void 0,this._nextRender=void 0,this._map=void 0,this._container=void 0,this.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},this._map=e.map,this._container=this._map.getContainer(),this._initialDragRotate=this._map.dragRotate.isEnabled(),this._initialDragPan=this._map.dragPan.isEnabled(),this._renderBeforeLayerId=e.renderBelowLayerId}_addGeoJSONSource(e,t){this._map.addSource(e,{type:"geojson",data:{type:"FeatureCollection",features:t},tolerance:0})}_addFillLayer(e){return this._map.addLayer({id:e,source:e,type:"fill",layout:{"fill-sort-key":["get","zIndex"]},paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})}_addFillOutlineLayer(e){return this._map.addLayer({id:e+"-outline",source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})}_addLineLayer(e){return this._map.addLayer({id:e,source:e,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})}_addPointLayer(e){return this._map.addLayer({id:e,source:e,type:"circle",layout:{"circle-sort-key":["get","zIndex"]},paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})}_addLayer(e,t){t==="Point"&&this._addPointLayer(e),t==="LineString"&&this._addLineLayer(e),t==="Polygon"&&(this._addFillLayer(e),this._addFillOutlineLayer(e))}_addGeoJSONLayer(e,t){const o="td-".concat(e.toLowerCase());return this._addGeoJSONSource(o,t),this._addLayer(o,e),o}_setGeoJSONLayerData(e,t){const o="td-".concat(e.toLowerCase());return this._map.getSource(o).setData({type:"FeatureCollection",features:t}),o}updateChangedIds(e){[...e.updated,...e.created].forEach(t=>{t.geometry.type==="Point"?this.changedIds.points=!0:t.geometry.type==="LineString"?this.changedIds.linestrings=!0:t.geometry.type==="Polygon"&&(this.changedIds.polygons=!0)}),e.deletedIds.length>0&&(this.changedIds.deletion=!0),e.created.length===0&&e.updated.length===0&&e.deletedIds.length===0&&(this.changedIds.styling=!0)}getLngLatFromEvent(e){const{left:t,top:o}=this._container.getBoundingClientRect();return this.unproject(e.clientX-t,e.clientY-o)}getMapEventElement(){return this._map.getCanvas()}setDraggability(e){e?(this._initialDragRotate&&this._map.dragRotate.enable(),this._initialDragPan&&this._map.dragPan.enable()):(this._initialDragRotate&&this._map.dragRotate.disable(),this._initialDragPan&&this._map.dragPan.disable())}project(e,t){const{x:o,y:n}=this._map.project({lng:e,lat:t});return{x:o,y:n}}unproject(e,t){const{lng:o,lat:n}=this._map.unproject({x:e,y:t});return{lng:o,lat:n}}setCursor(e){const t=this._map.getCanvas();e==="unset"?t.style.removeProperty("cursor"):t.style.cursor=e}setDoubleClickToZoom(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}render(e,t){this.updateChangedIds(e),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(()=>{if(!this._currentModeCallbacks)return;const o=[...e.created,...e.updated,...e.unchanged],n=[],r=[],s=[];for(let c=0;c<o.length;c++){const h=o[c],{properties:u}=h,p=t[u.mode](h);h.geometry.type==="Point"?(u.pointColor=p.pointColor,u.pointOutlineColor=p.pointOutlineColor,u.pointOutlineWidth=p.pointOutlineWidth,u.pointWidth=p.pointWidth,u.zIndex=p.zIndex,n.push(h)):h.geometry.type==="LineString"?(u.lineStringColor=p.lineStringColor,u.lineStringWidth=p.lineStringWidth,r.push(h)):h.geometry.type==="Polygon"&&(u.polygonFillColor=p.polygonFillColor,u.polygonFillOpacity=p.polygonFillOpacity,u.polygonOutlineColor=p.polygonOutlineColor,u.polygonOutlineWidth=p.polygonOutlineWidth,s.push(h))}const a=this.changedIds.deletion||this.changedIds.styling,l=a||this.changedIds.linestrings,d=a||this.changedIds.polygons;(a||this.changedIds.points)&&this._setGeoJSONLayerData("Point",n),l&&this._setGeoJSONLayerData("LineString",r),d&&this._setGeoJSONLayerData("Polygon",s),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0),this._setGeoJSONLayerData("Point",[]),this._setGeoJSONLayerData("LineString",[]),this._setGeoJSONLayerData("Polygon",[]))}getCoordinatePrecision(){return super.getCoordinatePrecision()}unregister(){super.unregister(),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1},this._map.removeLayer("td-point"),this._map.removeSource("td-point"),this._map.removeLayer("td-linestring"),this._map.removeSource("td-linestring"),this._map.removeLayer("td-polygon"),this._map.removeLayer("td-polygon-outline"),this._map.removeSource("td-polygon")}register(e){var t;super.register(e);const o=this._addGeoJSONLayer("Polygon",[]),n=this._addGeoJSONLayer("LineString",[]),r=this._addGeoJSONLayer("Point",[]);this._renderBeforeLayerId&&(this._map.moveLayer(r,this._renderBeforeLayerId),this._map.moveLayer(n,r),this._map.moveLayer(o+"-outline",n),this._map.moveLayer(o,n)),(t=this._currentModeCallbacks)!=null&&t.onReady&&this._currentModeCallbacks.onReady()}}const md={size:[String,Number],color:String,tag:String},vd=Symbol("IconConfigInjection"),yd="span",$e=E({name:"Icon",props:md,setup(i,{slots:e}){const t=re(vd,null),o=z(()=>{var s;const a=(s=i.size)!==null&&s!==void 0?s:t==null?void 0:t.size;if(a!==void 0)return typeof a=="number"||/^\d+$/.test(a)?"".concat(a,"px"):a}),n=z(()=>{const{color:s}=i;return s===void 0?t?t.color:void 0:s}),r=z(()=>{var s;const{tag:a}=i;return a===void 0?(s=t==null?void 0:t.tag)!==null&&s!==void 0?s:yd:a});return Kr(()=>{Yr()}),()=>g(r.value,{class:"xicon",style:{color:n.value,fontSize:o.value}},[Si(e,"default")])}}),ue=[];for(let i=0;i<256;++i)ue.push((i+256).toString(16).slice(1));function xd(i,e=0){return(ue[i[e+0]]+ue[i[e+1]]+ue[i[e+2]]+ue[i[e+3]]+"-"+ue[i[e+4]]+ue[i[e+5]]+"-"+ue[i[e+6]]+ue[i[e+7]]+"-"+ue[i[e+8]]+ue[i[e+9]]+"-"+ue[i[e+10]]+ue[i[e+11]]+ue[i[e+12]]+ue[i[e+13]]+ue[i[e+14]]+ue[i[e+15]]).toLowerCase()}let ni;const Cd=new Uint8Array(16);function bd(){if(!ni){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ni=crypto.getRandomValues.bind(crypto)}return ni(Cd)}const wd=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),mo={randomUUID:wd};function Pd(i,e,t){var n,r,s;if(mo.randomUUID&&!i)return mo.randomUUID();i=i||{};const o=(s=(r=i.random)!=null?r:(n=i.rng)==null?void 0:n.call(i))!=null?s:bd();if(o.length<16)throw new Error("Random bytes length must be >= 16");return o[6]=o[6]&15|64,o[8]=o[8]&63|128,xd(o)}const tn=qr("routes",{state:()=>({routes:[],currentRouteId:B(null)}),actions:{async init(){const i=await Jr("routes");i&&(this.routes=$s(i)?JSON.parse(i):i)},async addRoute(i){const e={...i,id:Pd()};return this.routes.push(e),await Dt("routes",Ft(this.routes)),await Et(),e},async deleteRoute(i){this.routes=this.routes.filter(e=>e.id!==i),this.currentRouteId===i&&(this.currentRouteId=null),await Dt("routes",Ft(this.routes)),await Et()},async addPointToRoute(i,e){const t=this.routes.find(o=>o.id===i);t&&(t.points.length>0&&Zr(t.points[t.points.length-1],e)||t&&(t.points.push(e),await Dt("routes",Ft(this.routes)),await Et()))},async updateRoute(i,e){const t=this.routes.find(o=>o.id===i);t&&(Object.assign(t,e),await Dt("routes",Ft(this.routes)),await Et())}}});function Id(i,e,t){const o=new Blob([i],{type:e}),n=document.createElement("a");n.download=t,n.href=URL.createObjectURL(o),n.dataset.downloadurl=[e,n.download,n.href].join(":"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{URL.revokeObjectURL(n.href)},1500)}const Sd={class:"flex-col justify-center items-center gap-4 w-full"},kd={class:"flex justify-end gap-4"},Md=E({__name:"TextFileUploaderDialog",props:Ut({multiple:{type:Boolean},icon:{},prompt:{},types:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:Ut(["update:value","confirm"],["update:show"]),setup(i,{emit:e}){const t=Oo(),o=i,n=e,r=ki(i,"show");let s=[];const a=c=>{s=[];for(const h of c){const u=h.file;if(u)if(o.types.includes(u.type)){const p=new FileReader;p.onload=f=>{var v;(v=f.target)!=null&&v.result&&s.push(f.target.result),s.length===c.length&&n("update:value",s)},p.readAsText(u)}else t.warning("Skipped file ".concat(h.name," due to unsupported type ").concat(u.type))}},l=()=>{n("confirm",s),r.value=!1},d=c=>{var h,u,p,f;return o.types.includes((u=(h=c.file.file)==null?void 0:h.type)!=null?u:"")?!0:(t.error("Unsupported file type ".concat((f=(p=c.file.file)==null?void 0:p.type)!=null?f:"unknown",". Supported types: ['").concat(o.types.join("', '"),"']")),!1)};return(c,h)=>(V(),ke(M(_o),{show:r.value,"onUpdate:show":h[2]||(h[2]=u=>r.value=u),preset:"dialog",title:"Dialog"},{header:Y(()=>h[3]||(h[3]=[$t(" File Upload ")])),default:Y(()=>{var u;return[j("div",Sd,[U(M($a),{multiple:(u=o.multiple)!=null?u:!1,onChange:h[0]||(h[0]=({fileList:p})=>a(p)),onBeforeUpload:d},{default:Y(()=>[U(M(zo),null,{default:Y(()=>{var p;return[U(M($e),{size:36,name:"upload",class:"opacity-50"},{default:Y(()=>{var f;return[(V(),ke(ai((f=o.icon)!=null?f:M(Fo))))]}),_:1}),j("div",null,be((p=o.prompt)!=null?p:"Drag and drop a file here or click to upload"),1)]}),_:1})]),_:1},8,["multiple"])])]}),action:Y(()=>[j("div",kd,[U(M(qe),{onClick:h[1]||(h[1]=u=>r.value=!1)},{default:Y(()=>h[4]||(h[4]=[$t("Cancel")])),_:1,__:[4]}),U(M(qe),{type:"primary",onClick:l},{default:Y(()=>h[5]||(h[5]=[$t("Upload")])),_:1,__:[5]})])]),_:1},8,["show"]))}}),_d=E({__name:"MglDrawer",props:{show:{type:Boolean,default:!1},showModifiers:{}},emits:Ut(["update:width","click","contextmenu"],["update:show"]),setup(i,{emit:e}){Mi(d=>({"35e21170":a.value,"3d7df430":M(o).modalColor,"06469490":M(o).borderRadius,"160a12b3":s.value}));const t=e,o=_i(),n=Qr("route-drawer"),r=z(()=>{var d,c,h,u,p,f;return Math.min(Eo(Math.round(((h=(c=(d=n.value)==null?void 0:d.parentElement)==null?void 0:c.clientWidth)!=null?h:2e3)*.4),320,640),((f=(p=(u=n.value)==null?void 0:u.parentElement)==null?void 0:p.clientWidth)!=null?f:1/0)-48)}),s=z(()=>"".concat(-16-r.value,"px")),a=z(()=>"".concat(r.value,"px")),l=ki(i,"show");return X(r,()=>t("update:width",r.value)),(d,c)=>(V(),ke(Ii,{name:"slide"},{default:Y(()=>[es(j("div",{class:"route-drawer",ref:"route-drawer",onClick:c[0]||(c[0]=h=>t("click",h)),onContextmenu:c[1]||(c[1]=h=>t("contextmenu",h))},[Si(d.$slots,"default",{},void 0,!0)],544),[[ts,l.value]])]),_:3}))}}),Dd=Xt(_d,[["__scopeId","data-v-802be7eb"]]),Fd={class:"menu-list"},Ed=["onClick","onContextmenu","onTouchstart"],Rd={class:"swipe-container"},Bd={style:{height:"fit-content",padding:"8px 12px"}},Od=["onClick"],jd=E({__name:"SelectableSwipeableMenuList",props:{items:{},selectedId:{},menuOptions:{},swipeActions:{}},emits:["select","contextmenu"],setup(i,{emit:e}){Mi(P=>({"15dc0624":M(n).borderRadius,"6fba3ed2":M(n).hoverColor,"00a6a95e":M(n).primaryColorPressed,"60b0a391":M(n).primaryColor,cd1c585e:M(n).bodyColor,"9ca02690":r.value}));const t=i,o=e,n=_i(),r=B("0s"),s=B({startX:0,delta:0,currentX:0,containerWidth:0,activeId:null}),a=B(!1),l=B(0),d=B(0),c=B(null);function h(P,w){var y;s.value.activeId!==w&&v();const C=P.touches[0];s.value={startX:C.clientX,delta:(y=s.value.delta)!=null?y:0,currentX:C.clientX,containerWidth:P.currentTarget.offsetWidth,activeId:w}}function u(P){s.value.activeId&&(s.value.currentX=P.touches[0].clientX,s.value.delta+=s.value.startX-s.value.currentX,s.value.delta=Eo(s.value.delta,0,s.value.containerWidth),s.value.startX=P.touches[0].clientX)}function p(){s.value.activeId&&(r.value="".concat(s.value.delta/s.value.containerWidth*.3,"s"),setTimeout(()=>{r.value="0s"},300),s.value.delta=s.value.delta>s.value.containerWidth*.5?s.value.containerWidth:0)}function f(P,w){P.stopPropagation(),!(s.value.delta>5)&&(v(),o("select",w.id))}function v(){s.value={startX:0,delta:0,currentX:0,containerWidth:0,activeId:null}}function S(P,w){if(P.stopPropagation(),P.preventDefault(),a.value){a.value=!1;return}c.value=w,l.value=P.clientX,d.value=P.clientY,a.value=!0,o("contextmenu",P,w)}return(P,w)=>(V(),ee(Ne,null,[j("div",Fd,[(V(!0),ee(Ne,null,li(t.items,C=>(V(),ee("div",{key:C.id,onClick:y=>f(y,C),onContextmenu:is(y=>S(y,C),["prevent"]),onTouchstart:y=>h(y,C.id),onTouchmove:u,onTouchend:p,class:Wt(["menu-list-item",...C.id===t.selectedId?["active"]:[]]),style:Rt({"touch-action":s.value.activeId===C.id?"pan-y":"auto"})},[j("div",Rd,[j("div",{class:"content-col",style:Rt({transform:"translateX(".concat(s.value.activeId===C.id?-s.value.delta:0,"px)"),willChange:s.value.activeId===C.id?"transform":"auto"})},[Si(P.$slots,"item",{item:C},()=>{var y;return[j("div",Bd,[j("div",null,be((y=C.name)!=null?y:"Untitled"),1)])]},!0)],4),j("div",{class:"actions-col",style:Rt({width:"".concat(s.value.activeId===C.id?s.value.delta:0,"px"),willChange:s.value.activeId===C.id?"width":"auto"})},[(V(!0),ee(Ne,null,li(t.swipeActions,y=>(V(),ee("button",{key:y.name,class:"menu-action",onClick:()=>{y.action(C.id),s.value.activeId=null},style:Rt({background:y.color||M(n).primaryColorSuppl})},be(y.label),13,Od))),128))],4)])],46,Ed))),128))]),U(M(Do),{show:a.value,x:l.value,y:d.value,options:t.menuOptions,onClickoutside:w[0]||(w[0]=C=>a.value=!1),placement:"bottom-start",trigger:"manual"},null,8,["show","x","y","options"])],64))}}),zd=Xt(jd,[["__scopeId","data-v-3fdbf90a"]]),Ld={class:"p-4",style:{height:"100%"}},Td={class:"text-lg font-bold mb-4"},$d={style:{height:"fit-content",padding:"8px 12px","text-align":"left"}},Wd=E({__name:"TrackerViewRouteDrawer",props:{show:{type:Boolean,default:!1},showModifiers:{}},emits:Ut(["update:width"],["update:show"]),setup(i,{emit:e}){Mi(C=>({"874f5c72":M(r).borderRadius,"730ad0a0":M(r).hoverColor,e3823f50:M(r).primaryColorPressed,"27f6f86a":M(r).primaryColor,"9bab54d0":M(r).bodyColor}));const{t}=di(),o=e,n=tn(),r=_i(),s=ki(i,"show"),a=B(!1),l=B(0),d=B(0),c=B(null),h=B(!1),u=B(""),p=B(null),f=[{label:t("components.trackerViewRouteDrawer.contextMenu.new"),key:"new",props:{onClick:()=>{a.value=!1,n.addRoute({name:"Untitled Route",points:[]})}}}],v=[{label:t("components.trackerViewRouteDrawer.contextMenu.rename"),key:"rename",props:{onClick:()=>{var C;(C=c.value)!=null&&C.id&&(u.value=c.value.name||"",h.value=!0)}}},{label:t("components.trackerViewRouteDrawer.contextMenu.delete"),key:"delete",props:{onClick:()=>{c.value&&n.deleteRoute(c.value.id)}}},{key:"divider-1",type:"divider"},...f],S=[{label:t("components.trackerViewRouteDrawer.contextMenu.rename"),name:"rename",action:C=>{const y=n.routes.find(x=>x.id===C);p.value=C,u.value=(y==null?void 0:y.name)||"",h.value=!0}},{label:t("components.trackerViewRouteDrawer.contextMenu.delete"),name:"delete",action:C=>n.deleteRoute(C),color:r.value.errorColorSuppl}];function P(C){if(C.stopPropagation(),C.preventDefault(),p.value=n.currentRouteId,a.value){a.value=!1;return}l.value=C.clientX,d.value=C.clientY,a.value=!0}async function w(C){u.value.trim()&&(await n.updateRoute(C,{name:u.value.trim()}),h.value=!1)}return(C,y)=>(V(),ee(Ne,null,[U(Dd,{show:s.value,"onUpdate:show":y[2]||(y[2]=x=>s.value=x),onClick:y[3]||(y[3]=()=>M(n).currentRouteId=null),"onUpdate:width":y[4]||(y[4]=x=>o("update:width",x)),onContextmenu:y[5]||(y[5]=x=>P(x))},{default:Y(()=>[j("div",Ld,[j("p",Td,be(M(t)("components.trackerViewRouteDrawer.routes")),1),U(zd,{items:M(n).routes,"selected-id":M(n).currentRouteId,"menu-options":v,"swipe-actions":S,onSelect:y[0]||(y[0]=x=>M(n).currentRouteId=x),onContextmenu:y[1]||(y[1]=(x,_)=>{var D;p.value=(D=_==null?void 0:_.id)!=null?D:null,c.value=_!=null?_:null})},{item:Y(({item:x})=>{var _;return[j("div",$d,[j("div",null,be((_=x.name)!=null?_:M(t)("components.trackerViewRouteDrawer.nameNewRoute")),1),j("div",null,be(M(t)("components.trackerViewRouteDrawer.points",{num:x.points.length})),1)])]}),_:1},8,["items","selected-id"])])]),_:1},8,["show"]),U(M(Do),{show:a.value,x:l.value,y:d.value,options:f,onClickoutside:y[6]||(y[6]=x=>a.value=!1),placement:"bottom-start",trigger:"manual"},null,8,["show","x","y"]),U(M(_o),{preset:"dialog",show:h.value,"onUpdate:show":y[9]||(y[9]=x=>h.value=x),title:"Rename Route","positive-text":"Save","negative-text":"Cancel",onPositiveClick:y[10]||(y[10]=()=>{p.value&&w(p.value)})},{default:Y(()=>[U(M(na),{value:u.value,"onUpdate:value":y[7]||(y[7]=x=>u.value=x),placeholder:"Enter new route name",onKeyup:y[8]||(y[8]=os(()=>{p.value&&w(p.value)},["enter"]))},null,8,["value"])]),_:1},8,["show"])],64))}}),Nd=Xt(Wd,[["__scopeId","data-v-769c8e91"]]),Ad={style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},Ud={key:0,style:{width:"100%",height:"100%"}},Vd=["title","onClick"],Gd=["title"],Hd={key:1,style:{width:"100%",height:"100%",display:"grid","place-content":"center"}},Xd=E({__name:"TrackerView",setup(i){const e=Oo(),t=re("geolocation"),{t:o}=di(),n=di(),r=B(7),a="https://api.maptiler.com/maps/basic-v2/style.json?key=".concat("dCeXFrS9lgSF8hm5C6nm"),l=B({latitude:0,longitude:0}),d=gt(null),c=gt(null),h=B("select"),u=B(!1),p=tn(),f=z(()=>{if(!p.currentRouteId)return[];const R=p.routes.find(N=>N.id===p.currentRouteId);return(R==null?void 0:R.points)||[]}),v=B(!1),S=new De.Marker,P=z(()=>{if(f.value.length>1||f.value.length===0)return S.remove(),{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:f.value.map(R=>[R.longitude,R.latitude])}}]};if(f.value.length===1){S.setLngLat([f.value[0].longitude,f.value[0].latitude]);const R=d.value;R&&S.addTo(R)}return{type:"FeatureCollection",features:[]}}),w=[{mode:new Hl,name:o("trackerView.terraDrawTools.rect"),icon:zs},{mode:new $l,name:o("trackerView.terraDrawTools.point"),icon:Ss},{mode:new Ul,name:o("trackerView.terraDrawTools.polygon"),icon:Ds},{mode:new bl,name:o("trackerView.terraDrawTools.circle"),icon:fs},{mode:new Bl,name:o("trackerView.terraDrawTools.line"),icon:Ps},{mode:new nd({allowManualDeselection:!0,flags:{point:{feature:{draggable:!0}},polygon:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},linestring:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},freehand:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},circle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},rectangle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}}}}),name:o("trackerView.terraDrawTools.select"),icon:xs},{mode:new Il,name:o("trackerView.terraDrawTools.draw"),icon:bs}],C=R=>{const N=n.locale.value==="zh-CN"?"zh":"en",H=["City labels","Road labels","Station labels","Airport labels","Continent labels","Country labels"];for(const Se of H)R.setLayoutProperty(Se,"text-field",["get","name:".concat(N)])};function y(R){var N;d.value=R.map,d.value&&C(d.value),(N=d.value)==null||N.on("click",()=>{W.value=!1}),c.value=new gd({adapter:new fd({map:d.value}),modes:w.map(H=>H.mode)}),c.value.start()}let x=-1;async function _(){try{if(u.value=!u.value,u.value){if(p.currentRouteId)await p.addPointToRoute(p.currentRouteId,t.presentLocation);else{const R=await p.addRoute({points:[t.presentLocation],name:o("trackerView.nameNewRoute")});oe(),p.currentRouteId=R.id}x=t.addListener(R=>{p.addPointToRoute(p.currentRouteId,R)})}else x!==-1&&(t.removeListener(x),u.value=!1,x=-1)}catch(R){console.error(R)}}async function D(){Id(JSON.stringify(P.value),"application/json","tracked-path-export")}let G=B(async R=>{});function k(){return new Promise(async(R,N)=>{G.value=async H=>{H.length===0?N(new Error("No file selected")):R(H)},v.value=!0})}function L(){k().then(R=>{const N=JSON.parse(R[0]).features[0].geometry.coordinates.map(H=>({latitude:H[1],longitude:H[0]}));p.addRoute({points:N,name:o("trackerView.nameNewlyImportedRoute")}).then(oe)}).catch(R=>{e.error(R)})}const $=B(0),W=B(!1);X(W,R=>{var N;return(N=d.value)==null?void 0:N.easeTo({padding:{left:R?$.value:0},duration:500})});const le=()=>W.value=!W.value,te=B(!1),oe=()=>{te.value||(te.value=!0,setTimeout(()=>{te.value=!1},3e3))},K=B(""),de=B(!1);return wi(async()=>{var R,N;try{l.value=await t.refresh(),t.usingGPS||e.warning(o("trackerView.gpsWarning"),{duration:5e3})}catch(H){K.value=(R=H.message)!=null?R:String(H)}de.value=!0,await ns(),await p.init(),(N=c.value)==null||N.start()}),(R,N)=>(V(),ee("div",Ad,[U(M(rs),{class:"map-layout","content-style":"padding: 0;"},{default:Y(()=>[U(Ii,{name:"map-load"},{default:Y(()=>[de.value&&!K.value?(V(),ee("div",Ud,[U(M(Ya),{"map-style":a,center:[l.value.longitude,l.value.latitude],zoom:r.value,height:"100%","onMap:load":y},{default:Y(()=>[U(M(el),{position:"top-left"}),M(t).usingGPS?(V(),ke(M(Qa),{key:0,position:"top-left","track-user-location":!0})):Me("",!0),U(M(Ja),{position:"top-left"}),U(M(il),{position:"bottom-left"}),U(M(Qt),{position:"top-right"},{default:Y(()=>[(V(),ee(Ne,null,li(w,H=>j("button",{key:H.name,class:Wt(["!flex justify-center items-center",H.mode.mode===h.value?"!bg-blue-200 rounded-sm transition-colors":""]),title:H.name,onClick:()=>{var Se,Ae,Ue;console.log("activeDrawMethod",h.value),h.value===H.mode.mode?((Se=c.value)==null||Se.setMode("select"),h.value="select"):(h.value=H.mode.mode,(Ae=c.value)==null||Ae.start(),(Ue=c.value)==null||Ue.setMode(H.mode.mode))}},[U(M($e),{size:20},{default:Y(()=>[(V(),ke(ai(H.icon),{class:"stroke-stone-800 text-stone-800"}))]),_:2},1024)],10,Vd)),64))]),_:1}),U(M(Qt),{position:"bottom-left"},{default:Y(()=>[U(M(ss),{trigger:"manual",show:te.value},{trigger:Y(()=>[j("button",{class:Wt("!flex justify-center items-center transition-all hover:rounded-sm stroke-sky-800 fill-sky-700 text-sky-800"),onClick:le},[U(M($e),{size:24},{default:Y(()=>[U(M(Es))]),_:1})])]),default:Y(()=>[j("span",null,be(M(o)("trackerView.uiRouteCheckoutTip")),1)]),_:1},8,["show"])]),_:1}),U(M(Qt),{position:"top-right"},{default:Y(()=>[j("button",{class:Wt(["!flex justify-center items-center transition-all hover:rounded-sm",u.value?"hover:!bg-red-700 hover:stroke-white hover:text-white stroke-red-700 fill-red-600 text-red-700":"stroke-sky-800 fill-sky-700 text-sky-800"]),title:u.value?M(o)("trackerView.uiRecordingStatus.on"):M(o)("trackerView.uiRecordingStatus.off"),onClick:_},[U(M($e),{size:20},{default:Y(()=>[(V(),ke(ai(u.value?M(Bs):M(Ms)),{size:u.value?16:20,class:"stroke-inherit text-inherit"},null,8,["size"]))]),_:1})],10,Gd),f.value.length>0&&!u.value?(V(),ee("button",{key:0,class:"stroke-red-700 text-red-700 hover:!bg-red-700 hover:stroke-white hover:text-white hover:rounded-sm transition-all !flex justify-center items-center",onClick:N[0]||(N[0]=H=>M(p).currentRouteId&&M(p).updateRoute(M(p).currentRouteId,{points:[]}))},[U(M($e),{size:20},{default:Y(()=>[U(M(ps),{class:"stroke-inherit text-inherit",style:{transform:"translateX(-1.3px)"},size:"20"})]),_:1})])):Me("",!0),f.value.length>0&&!u.value?(V(),ee("button",{key:1,class:"!flex justify-center items-center",onClick:D},[U(M($e),{size:20},{default:Y(()=>[U(M(vs),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):Me("",!0),f.value.length===0&&!u.value?(V(),ee("button",{key:2,class:"!flex justify-center items-center",onClick:L},[U(M($e),{size:20},{default:Y(()=>[U(M(Fo),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):Me("",!0)]),_:1}),U(M(rl),{"source-id":"geojson",data:P.value},{default:Y(()=>[U(M(dl),{"layer-id":"geojson",layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":5,"line-color":"#008800","line-opacity":.8}})]),_:1},8,["data"])]),_:1},8,["center","zoom"])])):(V(),ee("div",Hd,[K.value?(V(),ke(M(Js),{key:1,title:M(o)("app.error"),type:"error"},{default:Y(()=>[j("div",null,[N[4]||(N[4]=j("br",null,null,-1)),j("b",null,be(M(o)("app.error"))+": ",1),N[5]||(N[5]=j("br",null,null,-1)),j("code",null,be(K.value),1)])]),_:1},8,["title"])):(V(),ke(M(ma),{key:0,size:"large"},{description:Y(()=>[U(M(xa),null,{default:Y(()=>[$t(be(M(o)("trackerView.locationLoading")),1)]),_:1})]),_:1}))]))]),_:1})]),_:1}),U(Md,{show:v.value,"onUpdate:show":N[1]||(N[1]=H=>v.value=H),types:["application/json","text/plain"],onConfirm:M(G)},null,8,["show","onConfirm"]),U(Nd,{show:W.value,"onUpdate:show":N[2]||(N[2]=H=>W.value=H),"onUpdate:width":N[3]||(N[3]=H=>$.value=H)},null,8,["show"])]))}}),Zd=Xt(Xd,[["__scopeId","data-v-432fc063"]]);export{Zd as default};
