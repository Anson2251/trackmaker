var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});import{d as defineComponent,c as createElementBlock,o as openBlock,a as createBaseVNode,b as createStaticVNode,i as isObjectLike,e as isArray,f as baseGetTag,h as h$1,r as replaceable,g as cB,j as cE,k as cM,l as fadeInHeightExpandTransition,m as c$1,n as mergeProps,N as NBaseClose,p as resolveSlot,q as NBaseIcon,E as ErrorIcon,W as WarningIcon,I as InfoIcon,S as SuccessIcon,s as resolveWrappedSlot,t as NFadeInExpandTransition,u as useConfig,v as useTheme,w as alertLight,x as useRtl,y as computed,z as getMargin,A as createKey,B as useThemeClass,C as ref,D as createInjectionKey,F as cNotM,G as watch,H as inject,J as resolveSlotWithTypedProps,K as Scrollbar,L as Fragment,V as VResizeObserver,M as inputLight,O as isSafari,P as useStyle,Q as toRef,R as useMergedState,T as useFormItem,U as useMemo,X as onMounted,Y as getCurrentInstance,Z as watchEffect,_ as provide,$ as nextTick,a0 as on,a1 as call,a2 as off,a3 as throwError,a4 as messageApiInjectionKey,a5 as formatLength,a6 as progressLight,a7 as fadeInTransition,a8 as NBaseLoading,a9 as Transition,aa as spinLight,ab as pxfy,ac as useCompitable,ad as iconSwitchTransition,ae as isBrowser,af as error,ag as Button,ah as NIconSwitchTransition,ai as warn,aj as Teleport,ak as uploadLight,al as createId,am as derived,an as configProviderInjectionKey,ao as markRaw,ap as shallowRef,aq as onBeforeUnmount,ar as maplibreGlExports,as as createCommentVNode,at as isRef,au as reactive,av as onBeforeMount,aw as mountStyle,ax as renderSlot,ay as defineStore,az as storeGet,aA as storeSet,aB as cloneDeep,aC as storeSave,aD as isEqual,aE as mergeModels,aF as useModel,aG as createBlock,aH as withCtx,aI as unref,aJ as NModal,aK as createVNode,aL as createTextVNode,aM as resolveDynamicComponent,aN as toDisplayString,aO as useTemplateRef,aP as withDirectives,aQ as vShow,aR as useCssVars,aS as _export_sfc,aT as renderList,aU as NDropdown,aV as normalizeStyle,aW as normalizeClass,aX as withModifiers,aY as useI18n,aZ as withKeys,a_ as useSettingsStore,a$ as storeInit,b0 as NCard,b1 as NPopover,b2 as NText}from"./index-CW4GV-YS.js";import{N as NImage,D as DownloadIcon,d as download,a as NImageGroup}from"./Image-Dsi0jRaU.js";import{t as toNumber,u as useLocale}from"./use-locale-BMHbt4wc.js";import{N as NBaseClear,a as NBaseSuffix}from"./Suffix-C-BHSqzD.js";const _hoisted_1$g={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Backspace=defineComponent({name:"Backspace",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$g,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("path",{d:"M20 6a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H9l-5-5a1.5 1.5 0 0 1 0-2l5-5z"}),createBaseVNode("path",{d:"M12 10l4 4m0-4l-4 4"})],-1)]))},"render")}),_hoisted_1$f={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Circle$1=defineComponent({name:"Circle",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$f,_cache[0]||(_cache[0]=[createBaseVNode("circle",{cx:"12",cy:"12",r:"9",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))},"render")}),_hoisted_1$e={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},DeviceFloppy=defineComponent({name:"DeviceFloppy",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$e,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("path",{d:"M6 4h10l4 4v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2"}),createBaseVNode("circle",{cx:"12",cy:"14",r:"2"}),createBaseVNode("path",{d:"M14 4v4H8V4"})],-1)]))},"render")}),_hoisted_1$d={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},HandFinger=defineComponent({name:"HandFinger",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$d,_cache[0]||(_cache[0]=[createStaticVNode('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 1 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7A69.74 69.74 0 0 1 7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path></g>',1)]))},"render")}),_hoisted_1$c={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},HandMove=defineComponent({name:"HandMove",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$c,_cache[0]||(_cache[0]=[createStaticVNode('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 13V4.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M11 11.5v-2a1.5 1.5 0 0 1 3 0V12"></path><path d="M14 10.5a1.5 1.5 0 0 1 3 0V12"></path><path d="M17 11.5a1.5 1.5 0 0 1 3 0V16a6 6 0 0 1-6 6h-2h.208a6 6 0 0 1-5.012-2.7L7 19c-.312-.479-1.407-2.388-3.286-5.728a1.5 1.5 0 0 1 .536-2.022a1.867 1.867 0 0 1 2.28.28L8 13"></path><path d="M2.541 5.594a13.487 13.487 0 0 1 2.46-1.427"></path><path d="M14 3.458a13.44 13.44 0 0 1 3.685 1.612"></path></g>',1)]))},"render")}),_hoisted_1$b={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Line$1=defineComponent({name:"Line",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$b,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("circle",{cx:"6",cy:"18",r:"2"}),createBaseVNode("circle",{cx:"18",cy:"6",r:"2"}),createBaseVNode("path",{d:"M7.5 16.5l9-9"})],-1)]))},"render")}),_hoisted_1$a={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},MapPin=defineComponent({name:"MapPin",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$a,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("circle",{cx:"12",cy:"11",r:"3"}),createBaseVNode("path",{d:"M17.657 16.657L13.414 20.9a2 2 0 0 1-2.827 0l-4.244-4.243a8 8 0 1 1 11.314 0z"})],-1)]))},"render")}),_hoisted_1$9={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},PlayerRecord=defineComponent({name:"PlayerRecord",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$9,_cache[0]||(_cache[0]=[createBaseVNode("circle",{cx:"12",cy:"12",r:"7",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))},"render")}),_hoisted_1$8={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Polygon=defineComponent({name:"Polygon",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$8,_cache[0]||(_cache[0]=[createStaticVNode('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="2"></circle><circle cx="19" cy="8" r="2"></circle><circle cx="5" cy="11" r="2"></circle><circle cx="15" cy="19" r="2"></circle><path d="M6.5 9.5l3.5-3"></path><path d="M14 5.5L17 7"></path><path d="M18.5 10L16 17"></path><path d="M13.5 17.5l-7-5"></path></g>',1)]))},"render")}),_hoisted_1$7={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Route=defineComponent({name:"Route",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$7,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("circle",{cx:"6",cy:"19",r:"2"}),createBaseVNode("circle",{cx:"18",cy:"5",r:"2"}),createBaseVNode("path",{d:"M12 19h4.5a3.5 3.5 0 0 0 0-7h-8a3.5 3.5 0 0 1 0-7H12"})],-1)]))},"render")}),_hoisted_1$6={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Square=defineComponent({name:"Square",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$6,_cache[0]||(_cache[0]=[createBaseVNode("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)]))},"render")}),_hoisted_1$5={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Upload=defineComponent({name:"Upload",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$5,_cache[0]||(_cache[0]=[createBaseVNode("g",{fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[createBaseVNode("path",{d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2"}),createBaseVNode("path",{d:"M7 9l5-5l5 5"}),createBaseVNode("path",{d:"M12 4v12"})],-1)]))},"render")}),_hoisted_1$4={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},Vector=defineComponent({name:"Vector",render:__name(function(_ctx,_cache){return openBlock(),createElementBlock("svg",_hoisted_1$4,_cache[0]||(_cache[0]=[createStaticVNode('<g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="3" width="4" height="4" rx="1"></rect><rect x="17" y="17" width="4" height="4" rx="1"></rect><rect x="3" y="17" width="4" height="4" rx="1"></rect><path d="M5 7v10"></path><path d="M19 7v10"></path><path d="M7 5h10"></path><path d="M7 19h10"></path></g>',1)]))},"render")});function baseClamp(number,lower,upper){return number===number&&(upper!==void 0&&(number=number<=upper?number:upper),lower!==void 0&&(number=number>=lower?number:lower)),number}__name(baseClamp,"baseClamp");function clamp(number,lower,upper){return upper===void 0&&(upper=lower,lower=void 0),upper!==void 0&&(upper=toNumber(upper),upper=upper===upper?upper:0),lower!==void 0&&(lower=toNumber(lower),lower=lower===lower?lower:0),baseClamp(toNumber(number),lower,upper)}__name(clamp,"clamp");var stringTag="[object String]";function isString(value){return typeof value=="string"||!isArray(value)&&isObjectLike(value)&&baseGetTag(value)==stringTag}__name(isString,"isString");const AddIcon=defineComponent({name:"Add",render(){return h$1("svg",{width:"512",height:"512",viewBox:"0 0 512 512",fill:"none",xmlns:"http://www.w3.org/2000/svg"},h$1("path",{d:"M256 112V400M400 256H112",stroke:"currentColor","stroke-width":"32","stroke-linecap":"round","stroke-linejoin":"round"}))}}),AttachIcon=replaceable("attach",()=>h$1("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},h$1("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},h$1("g",{fill:"currentColor","fill-rule":"nonzero"},h$1("path",{d:"M3.25735931,8.70710678 L7.85355339,4.1109127 C8.82986412,3.13460197 10.4127766,3.13460197 11.3890873,4.1109127 C12.365398,5.08722343 12.365398,6.67013588 11.3890873,7.64644661 L6.08578644,12.9497475 C5.69526215,13.3402718 5.06209717,13.3402718 4.67157288,12.9497475 C4.28104858,12.5592232 4.28104858,11.9260582 4.67157288,11.5355339 L9.97487373,6.23223305 C10.1701359,6.0369709 10.1701359,5.72038841 9.97487373,5.52512627 C9.77961159,5.32986412 9.4630291,5.32986412 9.26776695,5.52512627 L3.96446609,10.8284271 C3.18341751,11.6094757 3.18341751,12.8758057 3.96446609,13.6568542 C4.74551468,14.4379028 6.01184464,14.4379028 6.79289322,13.6568542 L12.0961941,8.35355339 C13.4630291,6.98671837 13.4630291,4.77064094 12.0961941,3.40380592 C10.7293591,2.0369709 8.51328163,2.0369709 7.14644661,3.40380592 L2.55025253,8 C2.35499039,8.19526215 2.35499039,8.51184464 2.55025253,8.70710678 C2.74551468,8.90236893 3.06209717,8.90236893 3.25735931,8.70710678 Z"}))))),CancelIcon=replaceable("cancel",()=>h$1("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},h$1("g",{stroke:"none","stroke-width":"1",fill:"none","fill-rule":"evenodd"},h$1("g",{fill:"currentColor","fill-rule":"nonzero"},h$1("path",{d:"M2.58859116,2.7156945 L2.64644661,2.64644661 C2.82001296,2.47288026 3.08943736,2.45359511 3.2843055,2.58859116 L3.35355339,2.64644661 L8,7.293 L12.6464466,2.64644661 C12.8417088,2.45118446 13.1582912,2.45118446 13.3535534,2.64644661 C13.5488155,2.84170876 13.5488155,3.15829124 13.3535534,3.35355339 L8.707,8 L13.3535534,12.6464466 C13.5271197,12.820013 13.5464049,13.0894374 13.4114088,13.2843055 L13.3535534,13.3535534 C13.179987,13.5271197 12.9105626,13.5464049 12.7156945,13.4114088 L12.6464466,13.3535534 L8,8.707 L3.35355339,13.3535534 C3.15829124,13.5488155 2.84170876,13.5488155 2.64644661,13.3535534 C2.45118446,13.1582912 2.45118446,12.8417088 2.64644661,12.6464466 L7.293,8 L2.64644661,3.35355339 C2.47288026,3.17998704 2.45359511,2.91056264 2.58859116,2.7156945 L2.64644661,2.64644661 L2.58859116,2.7156945 Z"}))))),EyeIcon=defineComponent({name:"Eye",render(){return h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},h$1("path",{d:"M255.66 112c-77.94 0-157.89 45.11-220.83 135.33a16 16 0 0 0-.27 17.77C82.92 340.8 161.8 400 255.66 400c92.84 0 173.34-59.38 221.79-135.25a16.14 16.14 0 0 0 0-17.47C428.89 172.28 347.8 112 255.66 112z",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"}),h$1("circle",{cx:"256",cy:"256",r:"80",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"}))}}),EyeOffIcon=defineComponent({name:"EyeOff",render(){return h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},h$1("path",{d:"M432 448a15.92 15.92 0 0 1-11.31-4.69l-352-352a16 16 0 0 1 22.62-22.62l352 352A16 16 0 0 1 432 448z",fill:"currentColor"}),h$1("path",{d:"M255.66 384c-41.49 0-81.5-12.28-118.92-36.5c-34.07-22-64.74-53.51-88.7-91v-.08c19.94-28.57 41.78-52.73 65.24-72.21a2 2 0 0 0 .14-2.94L93.5 161.38a2 2 0 0 0-2.71-.12c-24.92 21-48.05 46.76-69.08 76.92a31.92 31.92 0 0 0-.64 35.54c26.41 41.33 60.4 76.14 98.28 100.65C162 402 207.9 416 255.66 416a239.13 239.13 0 0 0 75.8-12.58a2 2 0 0 0 .77-3.31l-21.58-21.58a4 4 0 0 0-3.83-1a204.8 204.8 0 0 1-51.16 6.47z",fill:"currentColor"}),h$1("path",{d:"M490.84 238.6c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.66 96a227.34 227.34 0 0 0-74.89 12.83a2 2 0 0 0-.75 3.31l21.55 21.55a4 4 0 0 0 3.88 1a192.82 192.82 0 0 1 50.21-6.69c40.69 0 80.58 12.43 118.55 37c34.71 22.4 65.74 53.88 89.76 91a.13.13 0 0 1 0 .16a310.72 310.72 0 0 1-64.12 72.73a2 2 0 0 0-.15 2.95l19.9 19.89a2 2 0 0 0 2.7.13a343.49 343.49 0 0 0 68.64-78.48a32.2 32.2 0 0 0-.1-34.78z",fill:"currentColor"}),h$1("path",{d:"M256 160a95.88 95.88 0 0 0-21.37 2.4a2 2 0 0 0-1 3.38l112.59 112.56a2 2 0 0 0 3.38-1A96 96 0 0 0 256 160z",fill:"currentColor"}),h$1("path",{d:"M165.78 233.66a2 2 0 0 0-3.38 1a96 96 0 0 0 115 115a2 2 0 0 0 1-3.38z",fill:"currentColor"}))}}),RetryIcon=replaceable("retry",()=>h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},h$1("path",{d:"M320,146s24.36-12-64-12A160,160,0,1,0,416,294",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-miterlimit: 10; stroke-width: 32px;"}),h$1("polyline",{points:"256 58 336 138 256 218",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),TrashIcon=replaceable("trash",()=>h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},h$1("path",{d:"M432,144,403.33,419.74A32,32,0,0,1,371.55,448H140.46a32,32,0,0,1-31.78-28.26L80,144",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),h$1("rect",{x:"32",y:"64",width:"448",height:"80",rx:"16",ry:"16",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),h$1("line",{x1:"312",y1:"240",x2:"200",y2:"352",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}),h$1("line",{x1:"312",y1:"352",x2:"200",y2:"240",style:"fill: none; stroke: currentcolor; stroke-linecap: round; stroke-linejoin: round; stroke-width: 32px;"}))),style$4=cB("alert","\n line-height: var(--n-line-height);\n border-radius: var(--n-border-radius);\n position: relative;\n transition: background-color .3s var(--n-bezier);\n background-color: var(--n-color);\n text-align: start;\n word-break: break-word;\n",[cE("border","\n border-radius: inherit;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n transition: border-color .3s var(--n-bezier);\n border: var(--n-border);\n pointer-events: none;\n "),cM("closable",[cB("alert-body",[cE("title","\n padding-right: 24px;\n ")])]),cE("icon",{color:"var(--n-icon-color)"}),cB("alert-body",{padding:"var(--n-padding)"},[cE("title",{color:"var(--n-title-text-color)"}),cE("content",{color:"var(--n-content-text-color)"})]),fadeInHeightExpandTransition({originalTransition:"transform .3s var(--n-bezier)",enterToProps:{transform:"scale(1)"},leaveToProps:{transform:"scale(0.9)"}}),cE("icon","\n position: absolute;\n left: 0;\n top: 0;\n align-items: center;\n justify-content: center;\n display: flex;\n width: var(--n-icon-size);\n height: var(--n-icon-size);\n font-size: var(--n-icon-size);\n margin: var(--n-icon-margin);\n "),cE("close","\n transition:\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n position: absolute;\n right: 0;\n top: 0;\n margin: var(--n-close-margin);\n "),cM("show-icon",[cB("alert-body",{paddingLeft:"calc(var(--n-icon-margin-left) + var(--n-icon-size) + var(--n-icon-margin-right))"})]),cM("right-adjust",[cB("alert-body",{paddingRight:"calc(var(--n-close-size) + var(--n-padding) + 2px)"})]),cB("alert-body","\n border-radius: var(--n-border-radius);\n transition: border-color .3s var(--n-bezier);\n ",[cE("title","\n transition: color .3s var(--n-bezier);\n font-size: 16px;\n line-height: 19px;\n font-weight: var(--n-title-font-weight);\n ",[c$1("& +",[cE("content",{marginTop:"9px"})])]),cE("content",{transition:"color .3s var(--n-bezier)",fontSize:"var(--n-font-size)"})]),cE("icon",{transition:"color .3s var(--n-bezier)"})]),alertProps=Object.assign(Object.assign({},useTheme.props),{title:String,showIcon:{type:Boolean,default:!0},type:{type:String,default:"default"},bordered:{type:Boolean,default:!0},closable:Boolean,onClose:Function,onAfterLeave:Function,onAfterHide:Function}),NAlert=defineComponent({name:"Alert",inheritAttrs:!1,props:alertProps,slots:Object,setup(props){const{mergedClsPrefixRef,mergedBorderedRef,inlineThemeDisabled,mergedRtlRef}=useConfig(props),themeRef=useTheme("Alert","-alert",style$4,alertLight,props,mergedClsPrefixRef),rtlEnabledRef=useRtl("Alert",mergedRtlRef,mergedClsPrefixRef),cssVarsRef=computed(()=>{const{common:{cubicBezierEaseInOut},self}=themeRef.value,{fontSize,borderRadius,titleFontWeight,lineHeight,iconSize,iconMargin,iconMarginRtl,closeIconSize,closeBorderRadius,closeSize,closeMargin,closeMarginRtl,padding}=self,{type}=props,{left,right}=getMargin(iconMargin);return{"--n-bezier":cubicBezierEaseInOut,"--n-color":self[createKey("color",type)],"--n-close-icon-size":closeIconSize,"--n-close-border-radius":closeBorderRadius,"--n-close-color-hover":self[createKey("closeColorHover",type)],"--n-close-color-pressed":self[createKey("closeColorPressed",type)],"--n-close-icon-color":self[createKey("closeIconColor",type)],"--n-close-icon-color-hover":self[createKey("closeIconColorHover",type)],"--n-close-icon-color-pressed":self[createKey("closeIconColorPressed",type)],"--n-icon-color":self[createKey("iconColor",type)],"--n-border":self[createKey("border",type)],"--n-title-text-color":self[createKey("titleTextColor",type)],"--n-content-text-color":self[createKey("contentTextColor",type)],"--n-line-height":lineHeight,"--n-border-radius":borderRadius,"--n-font-size":fontSize,"--n-title-font-weight":titleFontWeight,"--n-icon-size":iconSize,"--n-icon-margin":iconMargin,"--n-icon-margin-rtl":iconMarginRtl,"--n-close-size":closeSize,"--n-close-margin":closeMargin,"--n-close-margin-rtl":closeMarginRtl,"--n-padding":padding,"--n-icon-margin-left":left,"--n-icon-margin-right":right}}),themeClassHandle=inlineThemeDisabled?useThemeClass("alert",computed(()=>props.type[0]),cssVarsRef,props):void 0,visibleRef=ref(!0),doAfterLeave=__name(()=>{const{onAfterLeave,onAfterHide}=props;onAfterLeave&&onAfterLeave(),onAfterHide&&onAfterHide()},"doAfterLeave");return{rtlEnabled:rtlEnabledRef,mergedClsPrefix:mergedClsPrefixRef,mergedBordered:mergedBorderedRef,visible:visibleRef,handleCloseClick:__name(()=>{var _a4;Promise.resolve((_a4=props.onClose)===null||_a4===void 0?void 0:_a4.call(props)).then(result=>{result!==!1&&(visibleRef.value=!1)})},"handleCloseClick"),handleAfterLeave:__name(()=>{doAfterLeave()},"handleAfterLeave"),mergedTheme:themeRef,cssVars:inlineThemeDisabled?void 0:cssVarsRef,themeClass:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender}},render(){var _a4;return(_a4=this.onRender)===null||_a4===void 0||_a4.call(this),h$1(NFadeInExpandTransition,{onAfterLeave:this.handleAfterLeave},{default:__name(()=>{const{mergedClsPrefix,$slots}=this,attrs={class:["".concat(mergedClsPrefix,"-alert"),this.themeClass,this.closable&&"".concat(mergedClsPrefix,"-alert--closable"),this.showIcon&&"".concat(mergedClsPrefix,"-alert--show-icon"),!this.title&&this.closable&&"".concat(mergedClsPrefix,"-alert--right-adjust"),this.rtlEnabled&&"".concat(mergedClsPrefix,"-alert--rtl")],style:this.cssVars,role:"alert"};return this.visible?h$1("div",Object.assign({},mergeProps(this.$attrs,attrs)),this.closable&&h$1(NBaseClose,{clsPrefix:mergedClsPrefix,class:"".concat(mergedClsPrefix,"-alert__close"),onClick:this.handleCloseClick}),this.bordered&&h$1("div",{class:"".concat(mergedClsPrefix,"-alert__border")}),this.showIcon&&h$1("div",{class:"".concat(mergedClsPrefix,"-alert__icon"),"aria-hidden":"true"},resolveSlot($slots.icon,()=>[h$1(NBaseIcon,{clsPrefix:mergedClsPrefix},{default:__name(()=>{switch(this.type){case"success":return h$1(SuccessIcon,null);case"info":return h$1(InfoIcon,null);case"warning":return h$1(WarningIcon,null);case"error":return h$1(ErrorIcon,null);default:return null}},"default")})])),h$1("div",{class:["".concat(mergedClsPrefix,"-alert-body"),this.mergedBordered&&"".concat(mergedClsPrefix,"-alert-body--bordered")]},resolveWrappedSlot($slots.header,children=>{const mergedChildren=children||this.title;return mergedChildren?h$1("div",{class:"".concat(mergedClsPrefix,"-alert-body__title")},mergedChildren):null}),$slots.default&&h$1("div",{class:"".concat(mergedClsPrefix,"-alert-body__content")},$slots))):null},"default")})}}),inputInjectionKey=createInjectionKey("n-input"),style$3=cB("input","\n max-width: 100%;\n cursor: text;\n line-height: 1.5;\n z-index: auto;\n outline: none;\n box-sizing: border-box;\n position: relative;\n display: inline-flex;\n border-radius: var(--n-border-radius);\n background-color: var(--n-color);\n transition: background-color .3s var(--n-bezier);\n font-size: var(--n-font-size);\n font-weight: var(--n-font-weight);\n --n-padding-vertical: calc((var(--n-height) - 1.5 * var(--n-font-size)) / 2);\n",[cE("input, textarea","\n overflow: hidden;\n flex-grow: 1;\n position: relative;\n "),cE("input-el, textarea-el, input-mirror, textarea-mirror, separator, placeholder","\n box-sizing: border-box;\n font-size: inherit;\n line-height: 1.5;\n font-family: inherit;\n border: none;\n outline: none;\n background-color: #0000;\n text-align: inherit;\n transition:\n -webkit-text-fill-color .3s var(--n-bezier),\n caret-color .3s var(--n-bezier),\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier);\n "),cE("input-el, textarea-el","\n -webkit-appearance: none;\n scrollbar-width: none;\n width: 100%;\n min-width: 0;\n text-decoration-color: var(--n-text-decoration-color);\n color: var(--n-text-color);\n caret-color: var(--n-caret-color);\n background-color: transparent;\n ",[c$1("&::-webkit-scrollbar, &::-webkit-scrollbar-track-piece, &::-webkit-scrollbar-thumb","\n width: 0;\n height: 0;\n display: none;\n "),c$1("&::placeholder","\n color: #0000;\n -webkit-text-fill-color: transparent !important;\n "),c$1("&:-webkit-autofill ~",[cE("placeholder","display: none;")])]),cM("round",[cNotM("textarea","border-radius: calc(var(--n-height) / 2);")]),cE("placeholder","\n pointer-events: none;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n overflow: hidden;\n color: var(--n-placeholder-color);\n ",[c$1("span","\n width: 100%;\n display: inline-block;\n ")]),cM("textarea",[cE("placeholder","overflow: visible;")]),cNotM("autosize","width: 100%;"),cM("autosize",[cE("textarea-el, input-el","\n position: absolute;\n top: 0;\n left: 0;\n height: 100%;\n ")]),cB("input-wrapper","\n overflow: hidden;\n display: inline-flex;\n flex-grow: 1;\n position: relative;\n padding-left: var(--n-padding-left);\n padding-right: var(--n-padding-right);\n "),cE("input-mirror","\n padding: 0;\n height: var(--n-height);\n line-height: var(--n-height);\n overflow: hidden;\n visibility: hidden;\n position: static;\n white-space: pre;\n pointer-events: none;\n "),cE("input-el","\n padding: 0;\n height: var(--n-height);\n line-height: var(--n-height);\n ",[c$1("&[type=password]::-ms-reveal","display: none;"),c$1("+",[cE("placeholder","\n display: flex;\n align-items: center; \n ")])]),cNotM("textarea",[cE("placeholder","white-space: nowrap;")]),cE("eye","\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n "),cM("textarea","width: 100%;",[cB("input-word-count","\n position: absolute;\n right: var(--n-padding-right);\n bottom: var(--n-padding-vertical);\n "),cM("resizable",[cB("input-wrapper","\n resize: vertical;\n min-height: var(--n-height);\n ")]),cE("textarea-el, textarea-mirror, placeholder","\n height: 100%;\n padding-left: 0;\n padding-right: 0;\n padding-top: var(--n-padding-vertical);\n padding-bottom: var(--n-padding-vertical);\n word-break: break-word;\n display: inline-block;\n vertical-align: bottom;\n box-sizing: border-box;\n line-height: var(--n-line-height-textarea);\n margin: 0;\n resize: none;\n white-space: pre-wrap;\n scroll-padding-block-end: var(--n-padding-vertical);\n "),cE("textarea-mirror","\n width: 100%;\n pointer-events: none;\n overflow: hidden;\n visibility: hidden;\n position: static;\n white-space: pre-wrap;\n overflow-wrap: break-word;\n ")]),cM("pair",[cE("input-el, placeholder","text-align: center;"),cE("separator","\n display: flex;\n align-items: center;\n transition: color .3s var(--n-bezier);\n color: var(--n-text-color);\n white-space: nowrap;\n ",[cB("icon","\n color: var(--n-icon-color);\n "),cB("base-icon","\n color: var(--n-icon-color);\n ")])]),cM("disabled","\n cursor: not-allowed;\n background-color: var(--n-color-disabled);\n ",[cE("border","border: var(--n-border-disabled);"),cE("input-el, textarea-el","\n cursor: not-allowed;\n color: var(--n-text-color-disabled);\n text-decoration-color: var(--n-text-color-disabled);\n "),cE("placeholder","color: var(--n-placeholder-color-disabled);"),cE("separator","color: var(--n-text-color-disabled);",[cB("icon","\n color: var(--n-icon-color-disabled);\n "),cB("base-icon","\n color: var(--n-icon-color-disabled);\n ")]),cB("input-word-count","\n color: var(--n-count-text-color-disabled);\n "),cE("suffix, prefix","color: var(--n-text-color-disabled);",[cB("icon","\n color: var(--n-icon-color-disabled);\n "),cB("internal-icon","\n color: var(--n-icon-color-disabled);\n ")])]),cNotM("disabled",[cE("eye","\n color: var(--n-icon-color);\n cursor: pointer;\n ",[c$1("&:hover","\n color: var(--n-icon-color-hover);\n "),c$1("&:active","\n color: var(--n-icon-color-pressed);\n ")]),c$1("&:hover",[cE("state-border","border: var(--n-border-hover);")]),cM("focus","background-color: var(--n-color-focus);",[cE("state-border","\n border: var(--n-border-focus);\n box-shadow: var(--n-box-shadow-focus);\n ")])]),cE("border, state-border","\n box-sizing: border-box;\n position: absolute;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n pointer-events: none;\n border-radius: inherit;\n border: var(--n-border);\n transition:\n box-shadow .3s var(--n-bezier),\n border-color .3s var(--n-bezier);\n "),cE("state-border","\n border-color: #0000;\n z-index: 1;\n "),cE("prefix","margin-right: 4px;"),cE("suffix","\n margin-left: 4px;\n "),cE("suffix, prefix","\n transition: color .3s var(--n-bezier);\n flex-wrap: nowrap;\n flex-shrink: 0;\n line-height: var(--n-height);\n white-space: nowrap;\n display: inline-flex;\n align-items: center;\n justify-content: center;\n color: var(--n-suffix-text-color);\n ",[cB("base-loading","\n font-size: var(--n-icon-size);\n margin: 0 2px;\n color: var(--n-loading-color);\n "),cB("base-clear","\n font-size: var(--n-icon-size);\n ",[cE("placeholder",[cB("base-icon","\n transition: color .3s var(--n-bezier);\n color: var(--n-icon-color);\n font-size: var(--n-icon-size);\n ")])]),c$1(">",[cB("icon","\n transition: color .3s var(--n-bezier);\n color: var(--n-icon-color);\n font-size: var(--n-icon-size);\n ")]),cB("base-icon","\n font-size: var(--n-icon-size);\n ")]),cB("input-word-count","\n pointer-events: none;\n line-height: 1.5;\n font-size: .85em;\n color: var(--n-count-text-color);\n transition: color .3s var(--n-bezier);\n margin-left: 4px;\n font-variant: tabular-nums;\n "),["warning","error"].map(status=>cM("".concat(status,"-status"),[cNotM("disabled",[cB("base-loading","\n color: var(--n-loading-color-".concat(status,")\n ")),cE("input-el, textarea-el","\n caret-color: var(--n-caret-color-".concat(status,");\n ")),cE("state-border","\n border: var(--n-border-".concat(status,");\n ")),c$1("&:hover",[cE("state-border","\n border: var(--n-border-hover-".concat(status,");\n "))]),c$1("&:focus","\n background-color: var(--n-color-focus-".concat(status,");\n "),[cE("state-border","\n box-shadow: var(--n-box-shadow-focus-".concat(status,");\n border: var(--n-border-focus-").concat(status,");\n "))]),cM("focus","\n background-color: var(--n-color-focus-".concat(status,");\n "),[cE("state-border","\n box-shadow: var(--n-box-shadow-focus-".concat(status,");\n border: var(--n-border-focus-").concat(status,");\n "))])])]))]),safariStyle=cB("input",[cM("disabled",[cE("input-el, textarea-el","\n -webkit-text-fill-color: var(--n-text-color-disabled);\n ")])]);function len(s2){let count=0;for(const _2 of s2)count++;return count}__name(len,"len");function isEmptyInputValue(value){return value===""||value==null}__name(isEmptyInputValue,"isEmptyInputValue");function useCursor(inputElRef){const selectionRef=ref(null);function recordCursor(){const{value:input}=inputElRef;if(!(input!=null&&input.focus)){reset();return}const{selectionStart,selectionEnd,value}=input;if(selectionStart==null||selectionEnd==null){reset();return}selectionRef.value={start:selectionStart,end:selectionEnd,beforeText:value.slice(0,selectionStart),afterText:value.slice(selectionEnd)}}__name(recordCursor,"recordCursor");function restoreCursor(){var _a4;const{value:selection}=selectionRef,{value:inputEl}=inputElRef;if(!selection||!inputEl)return;const{value}=inputEl,{start,beforeText,afterText}=selection;let startPos=value.length;if(value.endsWith(afterText))startPos=value.length-afterText.length;else if(value.startsWith(beforeText))startPos=beforeText.length;else{const beforeLastChar=beforeText[start-1],newIndex=value.indexOf(beforeLastChar,start-1);newIndex!==-1&&(startPos=newIndex+1)}(_a4=inputEl.setSelectionRange)===null||_a4===void 0||_a4.call(inputEl,startPos,startPos)}__name(restoreCursor,"restoreCursor");function reset(){selectionRef.value=null}return __name(reset,"reset"),watch(inputElRef,reset),{recordCursor,restoreCursor}}__name(useCursor,"useCursor");const WordCount=defineComponent({name:"InputWordCount",setup(_2,{slots}){const{mergedValueRef,maxlengthRef,mergedClsPrefixRef,countGraphemesRef}=inject(inputInjectionKey),wordCountRef=computed(()=>{const{value:mergedValue}=mergedValueRef;return mergedValue===null||Array.isArray(mergedValue)?0:(countGraphemesRef.value||len)(mergedValue)});return()=>{const{value:maxlength}=maxlengthRef,{value:mergedValue}=mergedValueRef;return h$1("span",{class:"".concat(mergedClsPrefixRef.value,"-input-word-count")},resolveSlotWithTypedProps(slots.default,{value:mergedValue===null||Array.isArray(mergedValue)?"":mergedValue},()=>[maxlength===void 0?wordCountRef.value:"".concat(wordCountRef.value," / ").concat(maxlength)]))}}}),inputProps=Object.assign(Object.assign({},useTheme.props),{bordered:{type:Boolean,default:void 0},type:{type:String,default:"text"},placeholder:[Array,String],defaultValue:{type:[String,Array],default:null},value:[String,Array],disabled:{type:Boolean,default:void 0},size:String,rows:{type:[Number,String],default:3},round:Boolean,minlength:[String,Number],maxlength:[String,Number],clearable:Boolean,autosize:{type:[Boolean,Object],default:!1},pair:Boolean,separator:String,readonly:{type:[String,Boolean],default:!1},passivelyActivated:Boolean,showPasswordOn:String,stateful:{type:Boolean,default:!0},autofocus:Boolean,inputProps:Object,resizable:{type:Boolean,default:!0},showCount:Boolean,loading:{type:Boolean,default:void 0},allowInput:Function,renderCount:Function,onMousedown:Function,onKeydown:Function,onKeyup:[Function,Array],onInput:[Function,Array],onFocus:[Function,Array],onBlur:[Function,Array],onClick:[Function,Array],onChange:[Function,Array],onClear:[Function,Array],countGraphemes:Function,status:String,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],textDecoration:[String,Array],attrSize:{type:Number,default:20},onInputBlur:[Function,Array],onInputFocus:[Function,Array],onDeactivate:[Function,Array],onActivate:[Function,Array],onWrapperFocus:[Function,Array],onWrapperBlur:[Function,Array],internalDeactivateOnEnter:Boolean,internalForceFocus:Boolean,internalLoadingBeforeSuffix:{type:Boolean,default:!0},showPasswordToggle:Boolean}),NInput=defineComponent({name:"Input",props:inputProps,slots:Object,setup(props){const{mergedClsPrefixRef,mergedBorderedRef,inlineThemeDisabled,mergedRtlRef}=useConfig(props),themeRef=useTheme("Input","-input",style$3,inputLight,props,mergedClsPrefixRef);isSafari&&useStyle("-input-safari",safariStyle,mergedClsPrefixRef);const wrapperElRef=ref(null),textareaElRef=ref(null),textareaMirrorElRef=ref(null),inputMirrorElRef=ref(null),inputElRef=ref(null),inputEl2Ref=ref(null),currentFocusedInputRef=ref(null),focusedInputCursorControl=useCursor(currentFocusedInputRef),textareaScrollbarInstRef=ref(null),{localeRef}=useLocale("Input"),uncontrolledValueRef=ref(props.defaultValue),controlledValueRef=toRef(props,"value"),mergedValueRef=useMergedState(controlledValueRef,uncontrolledValueRef),formItem=useFormItem(props),{mergedSizeRef,mergedDisabledRef,mergedStatusRef}=formItem,focusedRef=ref(!1),hoverRef=ref(!1),isComposingRef=ref(!1),activatedRef=ref(!1);let syncSource=null;const mergedPlaceholderRef=computed(()=>{const{placeholder,pair}=props;return pair?Array.isArray(placeholder)?placeholder:placeholder===void 0?["",""]:[placeholder,placeholder]:placeholder===void 0?[localeRef.value.placeholder]:[placeholder]}),showPlaceholder1Ref=computed(()=>{const{value:isComposing}=isComposingRef,{value:mergedValue}=mergedValueRef,{value:mergedPlaceholder}=mergedPlaceholderRef;return!isComposing&&(isEmptyInputValue(mergedValue)||Array.isArray(mergedValue)&&isEmptyInputValue(mergedValue[0]))&&mergedPlaceholder[0]}),showPlaceholder2Ref=computed(()=>{const{value:isComposing}=isComposingRef,{value:mergedValue}=mergedValueRef,{value:mergedPlaceholder}=mergedPlaceholderRef;return!isComposing&&mergedPlaceholder[1]&&(isEmptyInputValue(mergedValue)||Array.isArray(mergedValue)&&isEmptyInputValue(mergedValue[1]))}),mergedFocusRef=useMemo(()=>props.internalForceFocus||focusedRef.value),showClearButton=useMemo(()=>{if(mergedDisabledRef.value||props.readonly||!props.clearable||!mergedFocusRef.value&&!hoverRef.value)return!1;const{value:mergedValue}=mergedValueRef,{value:mergedFocus}=mergedFocusRef;return props.pair?!!(Array.isArray(mergedValue)&&(mergedValue[0]||mergedValue[1]))&&(hoverRef.value||mergedFocus):!!mergedValue&&(hoverRef.value||mergedFocus)}),mergedShowPasswordOnRef=computed(()=>{const{showPasswordOn}=props;if(showPasswordOn)return showPasswordOn;if(props.showPasswordToggle)return"click"}),passwordVisibleRef=ref(!1),textDecorationStyleRef=computed(()=>{const{textDecoration}=props;return textDecoration?Array.isArray(textDecoration)?textDecoration.map(v2=>({textDecoration:v2})):[{textDecoration}]:["",""]}),textAreaScrollContainerWidthRef=ref(void 0),updateTextAreaStyle=__name(()=>{var _a4,_b;if(props.type==="textarea"){const{autosize}=props;if(autosize&&(textAreaScrollContainerWidthRef.value=(_b=(_a4=textareaScrollbarInstRef.value)===null||_a4===void 0?void 0:_a4.$el)===null||_b===void 0?void 0:_b.offsetWidth),!textareaElRef.value||typeof autosize=="boolean")return;const{paddingTop:stylePaddingTop,paddingBottom:stylePaddingBottom,lineHeight:styleLineHeight}=window.getComputedStyle(textareaElRef.value),paddingTop=Number(stylePaddingTop.slice(0,-2)),paddingBottom=Number(stylePaddingBottom.slice(0,-2)),lineHeight=Number(styleLineHeight.slice(0,-2)),{value:textareaMirrorEl}=textareaMirrorElRef;if(!textareaMirrorEl)return;if(autosize.minRows){const minRows=Math.max(autosize.minRows,1),styleMinHeight="".concat(paddingTop+paddingBottom+lineHeight*minRows,"px");textareaMirrorEl.style.minHeight=styleMinHeight}if(autosize.maxRows){const styleMaxHeight="".concat(paddingTop+paddingBottom+lineHeight*autosize.maxRows,"px");textareaMirrorEl.style.maxHeight=styleMaxHeight}}},"updateTextAreaStyle"),maxlengthRef=computed(()=>{const{maxlength}=props;return maxlength===void 0?void 0:Number(maxlength)});onMounted(()=>{const{value}=mergedValueRef;Array.isArray(value)||syncMirror(value)});const vm=getCurrentInstance().proxy;function doUpdateValue(value,meta){const{onUpdateValue,"onUpdate:value":_onUpdateValue,onInput}=props,{nTriggerFormInput}=formItem;onUpdateValue&&call(onUpdateValue,value,meta),_onUpdateValue&&call(_onUpdateValue,value,meta),onInput&&call(onInput,value,meta),uncontrolledValueRef.value=value,nTriggerFormInput()}__name(doUpdateValue,"doUpdateValue");function doChange(value,meta){const{onChange}=props,{nTriggerFormChange}=formItem;onChange&&call(onChange,value,meta),uncontrolledValueRef.value=value,nTriggerFormChange()}__name(doChange,"doChange");function doBlur(e2){const{onBlur}=props,{nTriggerFormBlur}=formItem;onBlur&&call(onBlur,e2),nTriggerFormBlur()}__name(doBlur,"doBlur");function doFocus(e2){const{onFocus}=props,{nTriggerFormFocus}=formItem;onFocus&&call(onFocus,e2),nTriggerFormFocus()}__name(doFocus,"doFocus");function doClear(e2){const{onClear}=props;onClear&&call(onClear,e2)}__name(doClear,"doClear");function doUpdateValueBlur(e2){const{onInputBlur}=props;onInputBlur&&call(onInputBlur,e2)}__name(doUpdateValueBlur,"doUpdateValueBlur");function doUpdateValueFocus(e2){const{onInputFocus}=props;onInputFocus&&call(onInputFocus,e2)}__name(doUpdateValueFocus,"doUpdateValueFocus");function doDeactivate(){const{onDeactivate}=props;onDeactivate&&call(onDeactivate)}__name(doDeactivate,"doDeactivate");function doActivate(){const{onActivate}=props;onActivate&&call(onActivate)}__name(doActivate,"doActivate");function doClick(e2){const{onClick}=props;onClick&&call(onClick,e2)}__name(doClick,"doClick");function doWrapperFocus(e2){const{onWrapperFocus}=props;onWrapperFocus&&call(onWrapperFocus,e2)}__name(doWrapperFocus,"doWrapperFocus");function doWrapperBlur(e2){const{onWrapperBlur}=props;onWrapperBlur&&call(onWrapperBlur,e2)}__name(doWrapperBlur,"doWrapperBlur");function handleCompositionStart(){isComposingRef.value=!0}__name(handleCompositionStart,"handleCompositionStart");function handleCompositionEnd(e2){isComposingRef.value=!1,e2.target===inputEl2Ref.value?handleInput(e2,1):handleInput(e2,0)}__name(handleCompositionEnd,"handleCompositionEnd");function handleInput(e2,index=0,event="input"){const targetValue=e2.target.value;if(syncMirror(targetValue),e2 instanceof InputEvent&&!e2.isComposing&&(isComposingRef.value=!1),props.type==="textarea"){const{value:textareaScrollbarInst}=textareaScrollbarInstRef;textareaScrollbarInst&&textareaScrollbarInst.syncUnifiedContainer()}if(syncSource=targetValue,isComposingRef.value)return;focusedInputCursorControl.recordCursor();const isIncomingValueValid=allowInput(targetValue);if(isIncomingValueValid)if(!props.pair)event==="input"?doUpdateValue(targetValue,{source:index}):doChange(targetValue,{source:index});else{let{value}=mergedValueRef;Array.isArray(value)?value=[value[0],value[1]]:value=["",""],value[index]=targetValue,event==="input"?doUpdateValue(value,{source:index}):doChange(value,{source:index})}vm.$forceUpdate(),isIncomingValueValid||nextTick(focusedInputCursorControl.restoreCursor)}__name(handleInput,"handleInput");function allowInput(value){const{countGraphemes,maxlength,minlength}=props;if(countGraphemes){let graphemesCount;if(maxlength!==void 0&&(graphemesCount===void 0&&(graphemesCount=countGraphemes(value)),graphemesCount>Number(maxlength))||minlength!==void 0&&(graphemesCount===void 0&&(graphemesCount=countGraphemes(value)),graphemesCount<Number(maxlength)))return!1}const{allowInput:allowInput2}=props;return typeof allowInput2=="function"?allowInput2(value):!0}__name(allowInput,"allowInput");function handleInputBlur(e2){doUpdateValueBlur(e2),e2.relatedTarget===wrapperElRef.value&&doDeactivate(),e2.relatedTarget!==null&&(e2.relatedTarget===inputElRef.value||e2.relatedTarget===inputEl2Ref.value||e2.relatedTarget===textareaElRef.value)||(activatedRef.value=!1),dealWithEvent(e2,"blur"),currentFocusedInputRef.value=null}__name(handleInputBlur,"handleInputBlur");function handleInputFocus(e2,index){doUpdateValueFocus(e2),focusedRef.value=!0,activatedRef.value=!0,doActivate(),dealWithEvent(e2,"focus"),index===0?currentFocusedInputRef.value=inputElRef.value:index===1?currentFocusedInputRef.value=inputEl2Ref.value:index===2&&(currentFocusedInputRef.value=textareaElRef.value)}__name(handleInputFocus,"handleInputFocus");function handleWrapperBlur(e2){props.passivelyActivated&&(doWrapperBlur(e2),dealWithEvent(e2,"blur"))}__name(handleWrapperBlur,"handleWrapperBlur");function handleWrapperFocus(e2){props.passivelyActivated&&(focusedRef.value=!0,doWrapperFocus(e2),dealWithEvent(e2,"focus"))}__name(handleWrapperFocus,"handleWrapperFocus");function dealWithEvent(e2,type){e2.relatedTarget!==null&&(e2.relatedTarget===inputElRef.value||e2.relatedTarget===inputEl2Ref.value||e2.relatedTarget===textareaElRef.value||e2.relatedTarget===wrapperElRef.value)||(type==="focus"?(doFocus(e2),focusedRef.value=!0):type==="blur"&&(doBlur(e2),focusedRef.value=!1))}__name(dealWithEvent,"dealWithEvent");function handleChange(e2,index){handleInput(e2,index,"change")}__name(handleChange,"handleChange");function handleClick(e2){doClick(e2)}__name(handleClick,"handleClick");function handleClear(e2){doClear(e2),clearValue()}__name(handleClear,"handleClear");function clearValue(){props.pair?(doUpdateValue(["",""],{source:"clear"}),doChange(["",""],{source:"clear"})):(doUpdateValue("",{source:"clear"}),doChange("",{source:"clear"}))}__name(clearValue,"clearValue");function handleMouseDown(e2){const{onMousedown}=props;onMousedown&&onMousedown(e2);const{tagName}=e2.target;if(tagName!=="INPUT"&&tagName!=="TEXTAREA"){if(props.resizable){const{value:wrapperEl}=wrapperElRef;if(wrapperEl){const{left,top,width,height}=wrapperEl.getBoundingClientRect(),resizeHandleSize=14;if(left+width-resizeHandleSize<e2.clientX&&e2.clientX<left+width&&top+height-resizeHandleSize<e2.clientY&&e2.clientY<top+height)return}}e2.preventDefault(),focusedRef.value||focus()}}__name(handleMouseDown,"handleMouseDown");function handleMouseEnter(){var _a4;hoverRef.value=!0,props.type==="textarea"&&((_a4=textareaScrollbarInstRef.value)===null||_a4===void 0||_a4.handleMouseEnterWrapper())}__name(handleMouseEnter,"handleMouseEnter");function handleMouseLeave(){var _a4;hoverRef.value=!1,props.type==="textarea"&&((_a4=textareaScrollbarInstRef.value)===null||_a4===void 0||_a4.handleMouseLeaveWrapper())}__name(handleMouseLeave,"handleMouseLeave");function handlePasswordToggleClick(){mergedDisabledRef.value||mergedShowPasswordOnRef.value==="click"&&(passwordVisibleRef.value=!passwordVisibleRef.value)}__name(handlePasswordToggleClick,"handlePasswordToggleClick");function handlePasswordToggleMousedown(e2){if(mergedDisabledRef.value)return;e2.preventDefault();const preventDefaultOnce=__name(e3=>{e3.preventDefault(),off("mouseup",document,preventDefaultOnce)},"preventDefaultOnce");if(on("mouseup",document,preventDefaultOnce),mergedShowPasswordOnRef.value!=="mousedown")return;passwordVisibleRef.value=!0;const hidePassword=__name(()=>{passwordVisibleRef.value=!1,off("mouseup",document,hidePassword)},"hidePassword");on("mouseup",document,hidePassword)}__name(handlePasswordToggleMousedown,"handlePasswordToggleMousedown");function handleWrapperKeyup(e2){props.onKeyup&&call(props.onKeyup,e2)}__name(handleWrapperKeyup,"handleWrapperKeyup");function handleWrapperKeydown(e2){switch(props.onKeydown&&call(props.onKeydown,e2),e2.key){case"Escape":handleWrapperKeydownEsc();break;case"Enter":handleWrapperKeydownEnter(e2);break}}__name(handleWrapperKeydown,"handleWrapperKeydown");function handleWrapperKeydownEnter(e2){var _a4,_b;if(props.passivelyActivated){const{value:focused}=activatedRef;if(focused){props.internalDeactivateOnEnter&&handleWrapperKeydownEsc();return}e2.preventDefault(),props.type==="textarea"?(_a4=textareaElRef.value)===null||_a4===void 0||_a4.focus():(_b=inputElRef.value)===null||_b===void 0||_b.focus()}}__name(handleWrapperKeydownEnter,"handleWrapperKeydownEnter");function handleWrapperKeydownEsc(){props.passivelyActivated&&(activatedRef.value=!1,nextTick(()=>{var _a4;(_a4=wrapperElRef.value)===null||_a4===void 0||_a4.focus()}))}__name(handleWrapperKeydownEsc,"handleWrapperKeydownEsc");function focus(){var _a4,_b,_c;mergedDisabledRef.value||(props.passivelyActivated?(_a4=wrapperElRef.value)===null||_a4===void 0||_a4.focus():((_b=textareaElRef.value)===null||_b===void 0||_b.focus(),(_c=inputElRef.value)===null||_c===void 0||_c.focus()))}__name(focus,"focus");function blur(){var _a4;!((_a4=wrapperElRef.value)===null||_a4===void 0)&&_a4.contains(document.activeElement)&&document.activeElement.blur()}__name(blur,"blur");function select(){var _a4,_b;(_a4=textareaElRef.value)===null||_a4===void 0||_a4.select(),(_b=inputElRef.value)===null||_b===void 0||_b.select()}__name(select,"select");function activate(){mergedDisabledRef.value||(textareaElRef.value?textareaElRef.value.focus():inputElRef.value&&inputElRef.value.focus())}__name(activate,"activate");function deactivate(){const{value:wrapperEl}=wrapperElRef;wrapperEl!=null&&wrapperEl.contains(document.activeElement)&&wrapperEl!==document.activeElement&&handleWrapperKeydownEsc()}__name(deactivate,"deactivate");function scrollTo(options){if(props.type==="textarea"){const{value:textareaEl}=textareaElRef;textareaEl==null||textareaEl.scrollTo(options)}else{const{value:inputEl}=inputElRef;inputEl==null||inputEl.scrollTo(options)}}__name(scrollTo,"scrollTo");function syncMirror(value){const{type,pair,autosize}=props;if(!pair&&autosize)if(type==="textarea"){const{value:textareaMirrorEl}=textareaMirrorElRef;textareaMirrorEl&&(textareaMirrorEl.textContent="".concat(value!=null?value:"","\r\n"))}else{const{value:inputMirrorEl}=inputMirrorElRef;inputMirrorEl&&(value?inputMirrorEl.textContent=value:inputMirrorEl.innerHTML="&nbsp;")}}__name(syncMirror,"syncMirror");function handleTextAreaMirrorResize(){updateTextAreaStyle()}__name(handleTextAreaMirrorResize,"handleTextAreaMirrorResize");const placeholderStyleRef=ref({top:"0"});function handleTextAreaScroll(e2){var _a4;const{scrollTop}=e2.target;placeholderStyleRef.value.top="".concat(-scrollTop,"px"),(_a4=textareaScrollbarInstRef.value)===null||_a4===void 0||_a4.syncUnifiedContainer()}__name(handleTextAreaScroll,"handleTextAreaScroll");let stopWatchMergedValue1=null;watchEffect(()=>{const{autosize,type}=props;autosize&&type==="textarea"?stopWatchMergedValue1=watch(mergedValueRef,value=>{!Array.isArray(value)&&value!==syncSource&&syncMirror(value)}):stopWatchMergedValue1==null||stopWatchMergedValue1()});let stopWatchMergedValue2=null;watchEffect(()=>{props.type==="textarea"?stopWatchMergedValue2=watch(mergedValueRef,value=>{var _a4;!Array.isArray(value)&&value!==syncSource&&((_a4=textareaScrollbarInstRef.value)===null||_a4===void 0||_a4.syncUnifiedContainer())}):stopWatchMergedValue2==null||stopWatchMergedValue2()}),provide(inputInjectionKey,{mergedValueRef,maxlengthRef,mergedClsPrefixRef,countGraphemesRef:toRef(props,"countGraphemes")});const exposedProps={wrapperElRef,inputElRef,textareaElRef,isCompositing:isComposingRef,clear:clearValue,focus,blur,select,deactivate,activate,scrollTo},rtlEnabledRef=useRtl("Input",mergedRtlRef,mergedClsPrefixRef),cssVarsRef=computed(()=>{const{value:size}=mergedSizeRef,{common:{cubicBezierEaseInOut},self:{color,borderRadius,textColor,caretColor,caretColorError,caretColorWarning,textDecorationColor,border,borderDisabled,borderHover,borderFocus,placeholderColor,placeholderColorDisabled,lineHeightTextarea,colorDisabled,colorFocus,textColorDisabled,boxShadowFocus,iconSize,colorFocusWarning,boxShadowFocusWarning,borderWarning,borderFocusWarning,borderHoverWarning,colorFocusError,boxShadowFocusError,borderError,borderFocusError,borderHoverError,clearSize,clearColor,clearColorHover,clearColorPressed,iconColor,iconColorDisabled,suffixTextColor,countTextColor,countTextColorDisabled,iconColorHover,iconColorPressed,loadingColor,loadingColorError,loadingColorWarning,fontWeight,[createKey("padding",size)]:padding,[createKey("fontSize",size)]:fontSize,[createKey("height",size)]:height}}=themeRef.value,{left:paddingLeft,right:paddingRight}=getMargin(padding);return{"--n-bezier":cubicBezierEaseInOut,"--n-count-text-color":countTextColor,"--n-count-text-color-disabled":countTextColorDisabled,"--n-color":color,"--n-font-size":fontSize,"--n-font-weight":fontWeight,"--n-border-radius":borderRadius,"--n-height":height,"--n-padding-left":paddingLeft,"--n-padding-right":paddingRight,"--n-text-color":textColor,"--n-caret-color":caretColor,"--n-text-decoration-color":textDecorationColor,"--n-border":border,"--n-border-disabled":borderDisabled,"--n-border-hover":borderHover,"--n-border-focus":borderFocus,"--n-placeholder-color":placeholderColor,"--n-placeholder-color-disabled":placeholderColorDisabled,"--n-icon-size":iconSize,"--n-line-height-textarea":lineHeightTextarea,"--n-color-disabled":colorDisabled,"--n-color-focus":colorFocus,"--n-text-color-disabled":textColorDisabled,"--n-box-shadow-focus":boxShadowFocus,"--n-loading-color":loadingColor,"--n-caret-color-warning":caretColorWarning,"--n-color-focus-warning":colorFocusWarning,"--n-box-shadow-focus-warning":boxShadowFocusWarning,"--n-border-warning":borderWarning,"--n-border-focus-warning":borderFocusWarning,"--n-border-hover-warning":borderHoverWarning,"--n-loading-color-warning":loadingColorWarning,"--n-caret-color-error":caretColorError,"--n-color-focus-error":colorFocusError,"--n-box-shadow-focus-error":boxShadowFocusError,"--n-border-error":borderError,"--n-border-focus-error":borderFocusError,"--n-border-hover-error":borderHoverError,"--n-loading-color-error":loadingColorError,"--n-clear-color":clearColor,"--n-clear-size":clearSize,"--n-clear-color-hover":clearColorHover,"--n-clear-color-pressed":clearColorPressed,"--n-icon-color":iconColor,"--n-icon-color-hover":iconColorHover,"--n-icon-color-pressed":iconColorPressed,"--n-icon-color-disabled":iconColorDisabled,"--n-suffix-text-color":suffixTextColor}}),themeClassHandle=inlineThemeDisabled?useThemeClass("input",computed(()=>{const{value:size}=mergedSizeRef;return size[0]}),cssVarsRef,props):void 0;return Object.assign(Object.assign({},exposedProps),{wrapperElRef,inputElRef,inputMirrorElRef,inputEl2Ref,textareaElRef,textareaMirrorElRef,textareaScrollbarInstRef,rtlEnabled:rtlEnabledRef,uncontrolledValue:uncontrolledValueRef,mergedValue:mergedValueRef,passwordVisible:passwordVisibleRef,mergedPlaceholder:mergedPlaceholderRef,showPlaceholder1:showPlaceholder1Ref,showPlaceholder2:showPlaceholder2Ref,mergedFocus:mergedFocusRef,isComposing:isComposingRef,activated:activatedRef,showClearButton,mergedSize:mergedSizeRef,mergedDisabled:mergedDisabledRef,textDecorationStyle:textDecorationStyleRef,mergedClsPrefix:mergedClsPrefixRef,mergedBordered:mergedBorderedRef,mergedShowPasswordOn:mergedShowPasswordOnRef,placeholderStyle:placeholderStyleRef,mergedStatus:mergedStatusRef,textAreaScrollContainerWidth:textAreaScrollContainerWidthRef,handleTextAreaScroll,handleCompositionStart,handleCompositionEnd,handleInput,handleInputBlur,handleInputFocus,handleWrapperBlur,handleWrapperFocus,handleMouseEnter,handleMouseLeave,handleMouseDown,handleChange,handleClick,handleClear,handlePasswordToggleClick,handlePasswordToggleMousedown,handleWrapperKeydown,handleWrapperKeyup,handleTextAreaMirrorResize,getTextareaScrollContainer:__name(()=>textareaElRef.value,"getTextareaScrollContainer"),mergedTheme:themeRef,cssVars:inlineThemeDisabled?void 0:cssVarsRef,themeClass:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender})},render(){var _a4,_b;const{mergedClsPrefix,mergedStatus,themeClass,type,countGraphemes,onRender}=this,$slots=this.$slots;return onRender==null||onRender(),h$1("div",{ref:"wrapperElRef",class:["".concat(mergedClsPrefix,"-input"),themeClass,mergedStatus&&"".concat(mergedClsPrefix,"-input--").concat(mergedStatus,"-status"),{["".concat(mergedClsPrefix,"-input--rtl")]:this.rtlEnabled,["".concat(mergedClsPrefix,"-input--disabled")]:this.mergedDisabled,["".concat(mergedClsPrefix,"-input--textarea")]:type==="textarea",["".concat(mergedClsPrefix,"-input--resizable")]:this.resizable&&!this.autosize,["".concat(mergedClsPrefix,"-input--autosize")]:this.autosize,["".concat(mergedClsPrefix,"-input--round")]:this.round&&type!=="textarea",["".concat(mergedClsPrefix,"-input--pair")]:this.pair,["".concat(mergedClsPrefix,"-input--focus")]:this.mergedFocus,["".concat(mergedClsPrefix,"-input--stateful")]:this.stateful}],style:this.cssVars,tabindex:!this.mergedDisabled&&this.passivelyActivated&&!this.activated?0:void 0,onFocus:this.handleWrapperFocus,onBlur:this.handleWrapperBlur,onClick:this.handleClick,onMousedown:this.handleMouseDown,onMouseenter:this.handleMouseEnter,onMouseleave:this.handleMouseLeave,onCompositionstart:this.handleCompositionStart,onCompositionend:this.handleCompositionEnd,onKeyup:this.handleWrapperKeyup,onKeydown:this.handleWrapperKeydown},h$1("div",{class:"".concat(mergedClsPrefix,"-input-wrapper")},resolveWrappedSlot($slots.prefix,children=>children&&h$1("div",{class:"".concat(mergedClsPrefix,"-input__prefix")},children)),type==="textarea"?h$1(Scrollbar,{ref:"textareaScrollbarInstRef",class:"".concat(mergedClsPrefix,"-input__textarea"),container:this.getTextareaScrollContainer,triggerDisplayManually:!0,useUnifiedContainer:!0,internalHoistYRail:!0},{default:__name(()=>{var _a5,_b2;const{textAreaScrollContainerWidth}=this,scrollContainerWidthStyle={width:this.autosize&&textAreaScrollContainerWidth&&"".concat(textAreaScrollContainerWidth,"px")};return h$1(Fragment,null,h$1("textarea",Object.assign({},this.inputProps,{ref:"textareaElRef",class:["".concat(mergedClsPrefix,"-input__textarea-el"),(_a5=this.inputProps)===null||_a5===void 0?void 0:_a5.class],autofocus:this.autofocus,rows:Number(this.rows),placeholder:this.placeholder,value:this.mergedValue,disabled:this.mergedDisabled,maxlength:countGraphemes?void 0:this.maxlength,minlength:countGraphemes?void 0:this.minlength,readonly:this.readonly,tabindex:this.passivelyActivated&&!this.activated?-1:void 0,style:[this.textDecorationStyle[0],(_b2=this.inputProps)===null||_b2===void 0?void 0:_b2.style,scrollContainerWidthStyle],onBlur:this.handleInputBlur,onFocus:__name(e2=>{this.handleInputFocus(e2,2)},"onFocus"),onInput:this.handleInput,onChange:this.handleChange,onScroll:this.handleTextAreaScroll})),this.showPlaceholder1?h$1("div",{class:"".concat(mergedClsPrefix,"-input__placeholder"),style:[this.placeholderStyle,scrollContainerWidthStyle],key:"placeholder"},this.mergedPlaceholder[0]):null,this.autosize?h$1(VResizeObserver,{onResize:this.handleTextAreaMirrorResize},{default:__name(()=>h$1("div",{ref:"textareaMirrorElRef",class:"".concat(mergedClsPrefix,"-input__textarea-mirror"),key:"mirror"}),"default")}):null)},"default")}):h$1("div",{class:"".concat(mergedClsPrefix,"-input__input")},h$1("input",Object.assign({type:type==="password"&&this.mergedShowPasswordOn&&this.passwordVisible?"text":type},this.inputProps,{ref:"inputElRef",class:["".concat(mergedClsPrefix,"-input__input-el"),(_a4=this.inputProps)===null||_a4===void 0?void 0:_a4.class],style:[this.textDecorationStyle[0],(_b=this.inputProps)===null||_b===void 0?void 0:_b.style],tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[0],disabled:this.mergedDisabled,maxlength:countGraphemes?void 0:this.maxlength,minlength:countGraphemes?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[0]:this.mergedValue,readonly:this.readonly,autofocus:this.autofocus,size:this.attrSize,onBlur:this.handleInputBlur,onFocus:__name(e2=>{this.handleInputFocus(e2,0)},"onFocus"),onInput:__name(e2=>{this.handleInput(e2,0)},"onInput"),onChange:__name(e2=>{this.handleChange(e2,0)},"onChange")})),this.showPlaceholder1?h$1("div",{class:"".concat(mergedClsPrefix,"-input__placeholder")},h$1("span",null,this.mergedPlaceholder[0])):null,this.autosize?h$1("div",{class:"".concat(mergedClsPrefix,"-input__input-mirror"),key:"mirror",ref:"inputMirrorElRef"},""):null),!this.pair&&resolveWrappedSlot($slots.suffix,children=>children||this.clearable||this.showCount||this.mergedShowPasswordOn||this.loading!==void 0?h$1("div",{class:"".concat(mergedClsPrefix,"-input__suffix")},[resolveWrappedSlot($slots["clear-icon-placeholder"],children2=>(this.clearable||children2)&&h$1(NBaseClear,{clsPrefix:mergedClsPrefix,show:this.showClearButton,onClear:this.handleClear},{placeholder:__name(()=>children2,"placeholder"),icon:__name(()=>{var _a5,_b2;return(_b2=(_a5=this.$slots)["clear-icon"])===null||_b2===void 0?void 0:_b2.call(_a5)},"icon")})),this.internalLoadingBeforeSuffix?null:children,this.loading!==void 0?h$1(NBaseSuffix,{clsPrefix:mergedClsPrefix,loading:this.loading,showArrow:!1,showClear:!1,style:this.cssVars}):null,this.internalLoadingBeforeSuffix?children:null,this.showCount&&this.type!=="textarea"?h$1(WordCount,null,{default:__name(props=>{var _a5;const{renderCount}=this;return renderCount?renderCount(props):(_a5=$slots.count)===null||_a5===void 0?void 0:_a5.call($slots,props)},"default")}):null,this.mergedShowPasswordOn&&this.type==="password"?h$1("div",{class:"".concat(mergedClsPrefix,"-input__eye"),onMousedown:this.handlePasswordToggleMousedown,onClick:this.handlePasswordToggleClick},this.passwordVisible?resolveSlot($slots["password-visible-icon"],()=>[h$1(NBaseIcon,{clsPrefix:mergedClsPrefix},{default:__name(()=>h$1(EyeIcon,null),"default")})]):resolveSlot($slots["password-invisible-icon"],()=>[h$1(NBaseIcon,{clsPrefix:mergedClsPrefix},{default:__name(()=>h$1(EyeOffIcon,null),"default")})])):null]):null)),this.pair?h$1("span",{class:"".concat(mergedClsPrefix,"-input__separator")},resolveSlot($slots.separator,()=>[this.separator])):null,this.pair?h$1("div",{class:"".concat(mergedClsPrefix,"-input-wrapper")},h$1("div",{class:"".concat(mergedClsPrefix,"-input__input")},h$1("input",{ref:"inputEl2Ref",type:this.type,class:"".concat(mergedClsPrefix,"-input__input-el"),tabindex:this.passivelyActivated&&!this.activated?-1:void 0,placeholder:this.mergedPlaceholder[1],disabled:this.mergedDisabled,maxlength:countGraphemes?void 0:this.maxlength,minlength:countGraphemes?void 0:this.minlength,value:Array.isArray(this.mergedValue)?this.mergedValue[1]:void 0,readonly:this.readonly,style:this.textDecorationStyle[1],onBlur:this.handleInputBlur,onFocus:__name(e2=>{this.handleInputFocus(e2,1)},"onFocus"),onInput:__name(e2=>{this.handleInput(e2,1)},"onInput"),onChange:__name(e2=>{this.handleChange(e2,1)},"onChange")}),this.showPlaceholder2?h$1("div",{class:"".concat(mergedClsPrefix,"-input__placeholder")},h$1("span",null,this.mergedPlaceholder[1])):null),resolveWrappedSlot($slots.suffix,children=>(this.clearable||children)&&h$1("div",{class:"".concat(mergedClsPrefix,"-input__suffix")},[this.clearable&&h$1(NBaseClear,{clsPrefix:mergedClsPrefix,show:this.showClearButton,onClear:this.handleClear},{icon:__name(()=>{var _a5;return(_a5=$slots["clear-icon"])===null||_a5===void 0?void 0:_a5.call($slots)},"icon"),placeholder:__name(()=>{var _a5;return(_a5=$slots["clear-icon-placeholder"])===null||_a5===void 0?void 0:_a5.call($slots)},"placeholder")}),children]))):null,this.mergedBordered?h$1("div",{class:"".concat(mergedClsPrefix,"-input__border")}):null,this.mergedBordered?h$1("div",{class:"".concat(mergedClsPrefix,"-input__state-border")}):null,this.showCount&&type==="textarea"?h$1(WordCount,null,{default:__name(props=>{var _a5;const{renderCount}=this;return renderCount?renderCount(props):(_a5=$slots.count)===null||_a5===void 0?void 0:_a5.call($slots,props)},"default")}):null)}});function useMessage(){const api=inject(messageApiInjectionKey,null);return api===null&&throwError("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),api}__name(useMessage,"useMessage");const iconMap$1={success:h$1(SuccessIcon,null),error:h$1(ErrorIcon,null),warning:h$1(WarningIcon,null),info:h$1(InfoIcon,null)},Circle=defineComponent({name:"ProgressCircle",props:{clsPrefix:{type:String,required:!0},status:{type:String,required:!0},strokeWidth:{type:Number,required:!0},fillColor:[String,Object],railColor:String,railStyle:[String,Object],percentage:{type:Number,default:0},offsetDegree:{type:Number,default:0},showIndicator:{type:Boolean,required:!0},indicatorTextColor:String,unit:String,viewBoxWidth:{type:Number,required:!0},gapDegree:{type:Number,required:!0},gapOffsetDegree:{type:Number,default:0}},setup(props,{slots}){function getPathStyles(percent,offsetDegree,strokeColor,type){const{gapDegree,viewBoxWidth,strokeWidth}=props,radius=50,beginPositionX=0,beginPositionY=radius,endPositionX=0,endPositionY=2*radius,centerX=50+strokeWidth/2,pathString="M ".concat(centerX,",").concat(centerX," m ").concat(beginPositionX,",").concat(beginPositionY,"\n      a ").concat(radius,",").concat(radius," 0 1 1 ").concat(endPositionX,",").concat(-endPositionY,"\n      a ").concat(radius,",").concat(radius," 0 1 1 ").concat(-endPositionX,",").concat(endPositionY),len2=Math.PI*2*radius,pathStyle={stroke:type==="rail"?strokeColor:typeof props.fillColor=="object"?"url(#gradient)":strokeColor,strokeDasharray:"".concat(percent/100*(len2-gapDegree),"px ").concat(viewBoxWidth*8,"px"),strokeDashoffset:"-".concat(gapDegree/2,"px"),transformOrigin:offsetDegree?"center":void 0,transform:offsetDegree?"rotate(".concat(offsetDegree,"deg)"):void 0};return{pathString,pathStyle}}__name(getPathStyles,"getPathStyles");const createGradientNode=__name(()=>{const isGradient=typeof props.fillColor=="object",from=isGradient?props.fillColor.stops[0]:"",to=isGradient?props.fillColor.stops[1]:"";return isGradient&&h$1("defs",null,h$1("linearGradient",{id:"gradient",x1:"0%",y1:"100%",x2:"100%",y2:"0%"},h$1("stop",{offset:"0%","stop-color":from}),h$1("stop",{offset:"100%","stop-color":to})))},"createGradientNode");return()=>{const{fillColor,railColor,strokeWidth,offsetDegree,status,percentage,showIndicator,indicatorTextColor,unit,gapOffsetDegree,clsPrefix}=props,{pathString:railPathString,pathStyle:railPathStyle}=getPathStyles(100,0,railColor,"rail"),{pathString:fillPathString,pathStyle:fillPathStyle}=getPathStyles(percentage,offsetDegree,fillColor,"fill"),viewBoxSize=100+strokeWidth;return h$1("div",{class:"".concat(clsPrefix,"-progress-content"),role:"none"},h$1("div",{class:"".concat(clsPrefix,"-progress-graph"),"aria-hidden":!0},h$1("div",{class:"".concat(clsPrefix,"-progress-graph-circle"),style:{transform:gapOffsetDegree?"rotate(".concat(gapOffsetDegree,"deg)"):void 0}},h$1("svg",{viewBox:"0 0 ".concat(viewBoxSize," ").concat(viewBoxSize)},createGradientNode(),h$1("g",null,h$1("path",{class:"".concat(clsPrefix,"-progress-graph-circle-rail"),d:railPathString,"stroke-width":strokeWidth,"stroke-linecap":"round",fill:"none",style:railPathStyle})),h$1("g",null,h$1("path",{class:["".concat(clsPrefix,"-progress-graph-circle-fill"),percentage===0&&"".concat(clsPrefix,"-progress-graph-circle-fill--empty")],d:fillPathString,"stroke-width":strokeWidth,"stroke-linecap":"round",fill:"none",style:fillPathStyle}))))),showIndicator?h$1("div",null,slots.default?h$1("div",{class:"".concat(clsPrefix,"-progress-custom-content"),role:"none"},slots.default()):status!=="default"?h$1("div",{class:"".concat(clsPrefix,"-progress-icon"),"aria-hidden":!0},h$1(NBaseIcon,{clsPrefix},{default:__name(()=>iconMap$1[status],"default")})):h$1("div",{class:"".concat(clsPrefix,"-progress-text"),style:{color:indicatorTextColor},role:"none"},h$1("span",{class:"".concat(clsPrefix,"-progress-text__percentage")},percentage),h$1("span",{class:"".concat(clsPrefix,"-progress-text__unit")},unit))):null)}}}),iconMap={success:h$1(SuccessIcon,null),error:h$1(ErrorIcon,null),warning:h$1(WarningIcon,null),info:h$1(InfoIcon,null)},Line=defineComponent({name:"ProgressLine",props:{clsPrefix:{type:String,required:!0},percentage:{type:Number,default:0},railColor:String,railStyle:[String,Object],fillColor:[String,Object],status:{type:String,required:!0},indicatorPlacement:{type:String,required:!0},indicatorTextColor:String,unit:{type:String,default:"%"},processing:{type:Boolean,required:!0},showIndicator:{type:Boolean,required:!0},height:[String,Number],railBorderRadius:[String,Number],fillBorderRadius:[String,Number]},setup(props,{slots}){const styleHeightRef=computed(()=>formatLength(props.height)),styleFillColorRef=computed(()=>{var _a4,_b;return typeof props.fillColor=="object"?"linear-gradient(to right, ".concat((_a4=props.fillColor)===null||_a4===void 0?void 0:_a4.stops[0]," , ").concat((_b=props.fillColor)===null||_b===void 0?void 0:_b.stops[1],")"):props.fillColor}),styleRailBorderRadiusRef=computed(()=>props.railBorderRadius!==void 0?formatLength(props.railBorderRadius):props.height!==void 0?formatLength(props.height,{c:.5}):""),styleFillBorderRadiusRef=computed(()=>props.fillBorderRadius!==void 0?formatLength(props.fillBorderRadius):props.railBorderRadius!==void 0?formatLength(props.railBorderRadius):props.height!==void 0?formatLength(props.height,{c:.5}):"");return()=>{const{indicatorPlacement,railColor,railStyle,percentage,unit,indicatorTextColor,status,showIndicator,processing,clsPrefix}=props;return h$1("div",{class:"".concat(clsPrefix,"-progress-content"),role:"none"},h$1("div",{class:"".concat(clsPrefix,"-progress-graph"),"aria-hidden":!0},h$1("div",{class:["".concat(clsPrefix,"-progress-graph-line"),{["".concat(clsPrefix,"-progress-graph-line--indicator-").concat(indicatorPlacement)]:!0}]},h$1("div",{class:"".concat(clsPrefix,"-progress-graph-line-rail"),style:[{backgroundColor:railColor,height:styleHeightRef.value,borderRadius:styleRailBorderRadiusRef.value},railStyle]},h$1("div",{class:["".concat(clsPrefix,"-progress-graph-line-fill"),processing&&"".concat(clsPrefix,"-progress-graph-line-fill--processing")],style:{maxWidth:"".concat(props.percentage,"%"),background:styleFillColorRef.value,height:styleHeightRef.value,lineHeight:styleHeightRef.value,borderRadius:styleFillBorderRadiusRef.value}},indicatorPlacement==="inside"?h$1("div",{class:"".concat(clsPrefix,"-progress-graph-line-indicator"),style:{color:indicatorTextColor}},slots.default?slots.default():"".concat(percentage).concat(unit)):null)))),showIndicator&&indicatorPlacement==="outside"?h$1("div",null,slots.default?h$1("div",{class:"".concat(clsPrefix,"-progress-custom-content"),style:{color:indicatorTextColor},role:"none"},slots.default()):status==="default"?h$1("div",{role:"none",class:"".concat(clsPrefix,"-progress-icon ").concat(clsPrefix,"-progress-icon--as-text"),style:{color:indicatorTextColor}},percentage,unit):h$1("div",{class:"".concat(clsPrefix,"-progress-icon"),"aria-hidden":!0},h$1(NBaseIcon,{clsPrefix},{default:__name(()=>iconMap[status],"default")}))):null)}}});function circlePath(r2,sw,vw=100){return"m ".concat(vw/2," ").concat(vw/2-r2," a ").concat(r2," ").concat(r2," 0 1 1 0 ").concat(2*r2," a ").concat(r2," ").concat(r2," 0 1 1 0 -").concat(2*r2)}__name(circlePath,"circlePath");const MultipleCircle=defineComponent({name:"ProgressMultipleCircle",props:{clsPrefix:{type:String,required:!0},viewBoxWidth:{type:Number,required:!0},percentage:{type:Array,default:[0]},strokeWidth:{type:Number,required:!0},circleGap:{type:Number,required:!0},showIndicator:{type:Boolean,required:!0},fillColor:{type:Array,default:__name(()=>[],"default")},railColor:{type:Array,default:__name(()=>[],"default")},railStyle:{type:Array,default:__name(()=>[],"default")}},setup(props,{slots}){const strokeDasharrayRef=computed(()=>props.percentage.map((v2,i2)=>"".concat(Math.PI*v2/100*(props.viewBoxWidth/2-props.strokeWidth/2*(1+2*i2)-props.circleGap*i2)*2,", ").concat(props.viewBoxWidth*8))),createGradientNode=__name((p2,index)=>{const item=props.fillColor[index],form=typeof item=="object"?item.stops[0]:"",to=typeof item=="object"?item.stops[1]:"";return typeof props.fillColor[index]=="object"&&h$1("linearGradient",{id:"gradient-".concat(index),x1:"100%",y1:"0%",x2:"0%",y2:"100%"},h$1("stop",{offset:"0%","stop-color":form}),h$1("stop",{offset:"100%","stop-color":to}))},"createGradientNode");return()=>{const{viewBoxWidth,strokeWidth,circleGap,showIndicator,fillColor,railColor,railStyle,percentage,clsPrefix}=props;return h$1("div",{class:"".concat(clsPrefix,"-progress-content"),role:"none"},h$1("div",{class:"".concat(clsPrefix,"-progress-graph"),"aria-hidden":!0},h$1("div",{class:"".concat(clsPrefix,"-progress-graph-circle")},h$1("svg",{viewBox:"0 0 ".concat(viewBoxWidth," ").concat(viewBoxWidth)},h$1("defs",null,percentage.map((p2,index)=>createGradientNode(p2,index))),percentage.map((p2,index)=>h$1("g",{key:index},h$1("path",{class:"".concat(clsPrefix,"-progress-graph-circle-rail"),d:circlePath(viewBoxWidth/2-strokeWidth/2*(1+2*index)-circleGap*index,strokeWidth,viewBoxWidth),"stroke-width":strokeWidth,"stroke-linecap":"round",fill:"none",style:[{strokeDashoffset:0,stroke:railColor[index]},railStyle[index]]}),h$1("path",{class:["".concat(clsPrefix,"-progress-graph-circle-fill"),p2===0&&"".concat(clsPrefix,"-progress-graph-circle-fill--empty")],d:circlePath(viewBoxWidth/2-strokeWidth/2*(1+2*index)-circleGap*index,strokeWidth,viewBoxWidth),"stroke-width":strokeWidth,"stroke-linecap":"round",fill:"none",style:{strokeDasharray:strokeDasharrayRef.value[index],strokeDashoffset:0,stroke:typeof fillColor[index]=="object"?"url(#gradient-".concat(index,")"):fillColor[index]}})))))),showIndicator&&slots.default?h$1("div",null,h$1("div",{class:"".concat(clsPrefix,"-progress-text")},slots.default())):null)}}}),style$2=c$1([cB("progress",{display:"inline-block"},[cB("progress-icon","\n color: var(--n-icon-color);\n transition: color .3s var(--n-bezier);\n "),cM("line","\n width: 100%;\n display: block;\n ",[cB("progress-content","\n display: flex;\n align-items: center;\n ",[cB("progress-graph",{flex:1})]),cB("progress-custom-content",{marginLeft:"14px"}),cB("progress-icon","\n width: 30px;\n padding-left: 14px;\n height: var(--n-icon-size-line);\n line-height: var(--n-icon-size-line);\n font-size: var(--n-icon-size-line);\n ",[cM("as-text","\n color: var(--n-text-color-line-outer);\n text-align: center;\n width: 40px;\n font-size: var(--n-font-size);\n padding-left: 4px;\n transition: color .3s var(--n-bezier);\n ")])]),cM("circle, dashboard",{width:"120px"},[cB("progress-custom-content","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n "),cB("progress-text","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: inherit;\n font-size: var(--n-font-size-circle);\n color: var(--n-text-color-circle);\n font-weight: var(--n-font-weight-circle);\n transition: color .3s var(--n-bezier);\n white-space: nowrap;\n "),cB("progress-icon","\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n color: var(--n-icon-color);\n font-size: var(--n-icon-size-circle);\n ")]),cM("multiple-circle","\n width: 200px;\n color: inherit;\n ",[cB("progress-text","\n font-weight: var(--n-font-weight-circle);\n color: var(--n-text-color-circle);\n position: absolute;\n left: 50%;\n top: 50%;\n transform: translateX(-50%) translateY(-50%);\n display: flex;\n align-items: center;\n justify-content: center;\n transition: color .3s var(--n-bezier);\n ")]),cB("progress-content",{position:"relative"}),cB("progress-graph",{position:"relative"},[cB("progress-graph-circle",[c$1("svg",{verticalAlign:"bottom"}),cB("progress-graph-circle-fill","\n stroke: var(--n-fill-color);\n transition:\n opacity .3s var(--n-bezier),\n stroke .3s var(--n-bezier),\n stroke-dasharray .3s var(--n-bezier);\n ",[cM("empty",{opacity:0})]),cB("progress-graph-circle-rail","\n transition: stroke .3s var(--n-bezier);\n overflow: hidden;\n stroke: var(--n-rail-color);\n ")]),cB("progress-graph-line",[cM("indicator-inside",[cB("progress-graph-line-rail","\n height: 16px;\n line-height: 16px;\n border-radius: 10px;\n ",[cB("progress-graph-line-fill","\n height: inherit;\n border-radius: 10px;\n "),cB("progress-graph-line-indicator","\n background: #0000;\n white-space: nowrap;\n text-align: right;\n margin-left: 14px;\n margin-right: 14px;\n height: inherit;\n font-size: 12px;\n color: var(--n-text-color-line-inner);\n transition: color .3s var(--n-bezier);\n ")])]),cM("indicator-inside-label","\n height: 16px;\n display: flex;\n align-items: center;\n ",[cB("progress-graph-line-rail","\n flex: 1;\n transition: background-color .3s var(--n-bezier);\n "),cB("progress-graph-line-indicator","\n background: var(--n-fill-color);\n font-size: 12px;\n transform: translateZ(0);\n display: flex;\n vertical-align: middle;\n height: 16px;\n line-height: 16px;\n padding: 0 10px;\n border-radius: 10px;\n position: absolute;\n white-space: nowrap;\n color: var(--n-text-color-line-inner);\n transition:\n right .2s var(--n-bezier),\n color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n ")]),cB("progress-graph-line-rail","\n position: relative;\n overflow: hidden;\n height: var(--n-rail-height);\n border-radius: 5px;\n background-color: var(--n-rail-color);\n transition: background-color .3s var(--n-bezier);\n ",[cB("progress-graph-line-fill","\n background: var(--n-fill-color);\n position: relative;\n border-radius: 5px;\n height: inherit;\n width: 100%;\n max-width: 0%;\n transition:\n background-color .3s var(--n-bezier),\n max-width .2s var(--n-bezier);\n ",[cM("processing",[c$1("&::after",'\n content: "";\n background-image: var(--n-line-bg-processing);\n animation: progress-processing-animation 2s var(--n-bezier) infinite;\n ')])])])])])]),c$1("@keyframes progress-processing-animation","\n 0% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 100%;\n opacity: 1;\n }\n 66% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n 100% {\n position: absolute;\n left: 0;\n top: 0;\n bottom: 0;\n right: 0;\n opacity: 0;\n }\n ")]),progressProps=Object.assign(Object.assign({},useTheme.props),{processing:Boolean,type:{type:String,default:"line"},gapDegree:Number,gapOffsetDegree:Number,status:{type:String,default:"default"},railColor:[String,Array],railStyle:[String,Array],color:[String,Array,Object],viewBoxWidth:{type:Number,default:100},strokeWidth:{type:Number,default:7},percentage:[Number,Array],unit:{type:String,default:"%"},showIndicator:{type:Boolean,default:!0},indicatorPosition:{type:String,default:"outside"},indicatorPlacement:{type:String,default:"outside"},indicatorTextColor:String,circleGap:{type:Number,default:1},height:Number,borderRadius:[String,Number],fillBorderRadius:[String,Number],offsetDegree:Number}),NProgress=defineComponent({name:"Progress",props:progressProps,setup(props){const mergedIndicatorPlacementRef=computed(()=>props.indicatorPlacement||props.indicatorPosition),gapDeg=computed(()=>{if(props.gapDegree||props.gapDegree===0)return props.gapDegree;if(props.type==="dashboard")return 75}),{mergedClsPrefixRef,inlineThemeDisabled}=useConfig(props),themeRef=useTheme("Progress","-progress",style$2,progressLight,props,mergedClsPrefixRef),cssVarsRef=computed(()=>{const{status}=props,{common:{cubicBezierEaseInOut},self:{fontSize,fontSizeCircle,railColor,railHeight,iconSizeCircle,iconSizeLine,textColorCircle,textColorLineInner,textColorLineOuter,lineBgProcessing,fontWeightCircle,[createKey("iconColor",status)]:iconColor,[createKey("fillColor",status)]:fillColor}}=themeRef.value;return{"--n-bezier":cubicBezierEaseInOut,"--n-fill-color":fillColor,"--n-font-size":fontSize,"--n-font-size-circle":fontSizeCircle,"--n-font-weight-circle":fontWeightCircle,"--n-icon-color":iconColor,"--n-icon-size-circle":iconSizeCircle,"--n-icon-size-line":iconSizeLine,"--n-line-bg-processing":lineBgProcessing,"--n-rail-color":railColor,"--n-rail-height":railHeight,"--n-text-color-circle":textColorCircle,"--n-text-color-line-inner":textColorLineInner,"--n-text-color-line-outer":textColorLineOuter}}),themeClassHandle=inlineThemeDisabled?useThemeClass("progress",computed(()=>props.status[0]),cssVarsRef,props):void 0;return{mergedClsPrefix:mergedClsPrefixRef,mergedIndicatorPlacement:mergedIndicatorPlacementRef,gapDeg,cssVars:inlineThemeDisabled?void 0:cssVarsRef,themeClass:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender}},render(){const{type,cssVars,indicatorTextColor,showIndicator,status,railColor,railStyle,color,percentage,viewBoxWidth,strokeWidth,mergedIndicatorPlacement,unit,borderRadius,fillBorderRadius,height,processing,circleGap,mergedClsPrefix,gapDeg,gapOffsetDegree,themeClass,$slots,onRender}=this;return onRender==null||onRender(),h$1("div",{class:[themeClass,"".concat(mergedClsPrefix,"-progress"),"".concat(mergedClsPrefix,"-progress--").concat(type),"".concat(mergedClsPrefix,"-progress--").concat(status)],style:cssVars,"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":percentage,role:type==="circle"||type==="line"||type==="dashboard"?"progressbar":"none"},type==="circle"||type==="dashboard"?h$1(Circle,{clsPrefix:mergedClsPrefix,status,showIndicator,indicatorTextColor,railColor,fillColor:color,railStyle,offsetDegree:this.offsetDegree,percentage,viewBoxWidth,strokeWidth,gapDegree:gapDeg===void 0?type==="dashboard"?75:0:gapDeg,gapOffsetDegree,unit},$slots):type==="line"?h$1(Line,{clsPrefix:mergedClsPrefix,status,showIndicator,indicatorTextColor,railColor,fillColor:color,railStyle,percentage,processing,indicatorPlacement:mergedIndicatorPlacement,unit,fillBorderRadius,railBorderRadius:borderRadius,height},$slots):type==="multiple-circle"?h$1(MultipleCircle,{clsPrefix:mergedClsPrefix,strokeWidth,railColor,fillColor:color,railStyle,viewBoxWidth,percentage,showIndicator,circleGap},$slots):null)}}),style$1=c$1([c$1("@keyframes spin-rotate","\n from {\n transform: rotate(0);\n }\n to {\n transform: rotate(360deg);\n }\n "),cB("spin-container","\n position: relative;\n ",[cB("spin-body","\n position: absolute;\n top: 50%;\n left: 50%;\n transform: translateX(-50%) translateY(-50%);\n ",[fadeInTransition()])]),cB("spin-body","\n display: inline-flex;\n align-items: center;\n justify-content: center;\n flex-direction: column;\n "),cB("spin","\n display: inline-flex;\n height: var(--n-size);\n width: var(--n-size);\n font-size: var(--n-size);\n color: var(--n-color);\n ",[cM("rotate","\n animation: spin-rotate 2s linear infinite;\n ")]),cB("spin-description","\n display: inline-block;\n font-size: var(--n-font-size);\n color: var(--n-text-color);\n transition: color .3s var(--n-bezier);\n margin-top: 8px;\n "),cB("spin-content","\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n pointer-events: all;\n ",[cM("spinning","\n user-select: none;\n -webkit-user-select: none;\n pointer-events: none;\n opacity: var(--n-opacity-spinning);\n ")])]),STROKE_WIDTH={small:20,medium:18,large:16},spinProps=Object.assign(Object.assign({},useTheme.props),{contentClass:String,contentStyle:[Object,String],description:String,stroke:String,size:{type:[String,Number],default:"medium"},show:{type:Boolean,default:!0},strokeWidth:Number,rotate:{type:Boolean,default:!0},spinning:{type:Boolean,validator:__name(()=>!0,"validator"),default:void 0},delay:Number}),NSpin=defineComponent({name:"Spin",props:spinProps,slots:Object,setup(props){const{mergedClsPrefixRef,inlineThemeDisabled}=useConfig(props),themeRef=useTheme("Spin","-spin",style$1,spinLight,props,mergedClsPrefixRef),cssVarsRef=computed(()=>{const{size:spinSize}=props,{common:{cubicBezierEaseInOut},self}=themeRef.value,{opacitySpinning,color,textColor}=self,size=typeof spinSize=="number"?pxfy(spinSize):self[createKey("size",spinSize)];return{"--n-bezier":cubicBezierEaseInOut,"--n-opacity-spinning":opacitySpinning,"--n-size":size,"--n-color":color,"--n-text-color":textColor}}),themeClassHandle=inlineThemeDisabled?useThemeClass("spin",computed(()=>{const{size}=props;return typeof size=="number"?String(size):size[0]}),cssVarsRef,props):void 0,compitableShow=useCompitable(props,["spinning","show"]),activeRef=ref(!1);return watchEffect(onCleanup=>{let timerId;if(compitableShow.value){const{delay}=props;if(delay){timerId=window.setTimeout(()=>{activeRef.value=!0},delay),onCleanup(()=>{clearTimeout(timerId)});return}}activeRef.value=compitableShow.value}),{mergedClsPrefix:mergedClsPrefixRef,active:activeRef,mergedStrokeWidth:computed(()=>{const{strokeWidth}=props;if(strokeWidth!==void 0)return strokeWidth;const{size}=props;return STROKE_WIDTH[typeof size=="number"?"medium":size]}),cssVars:inlineThemeDisabled?void 0:cssVarsRef,themeClass:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender}},render(){var _a4,_b;const{$slots,mergedClsPrefix,description}=this,rotate=$slots.icon&&this.rotate,descriptionNode=(description||$slots.description)&&h$1("div",{class:"".concat(mergedClsPrefix,"-spin-description")},description||((_a4=$slots.description)===null||_a4===void 0?void 0:_a4.call($slots))),icon=$slots.icon?h$1("div",{class:["".concat(mergedClsPrefix,"-spin-body"),this.themeClass]},h$1("div",{class:["".concat(mergedClsPrefix,"-spin"),rotate&&"".concat(mergedClsPrefix,"-spin--rotate")],style:$slots.default?"":this.cssVars},$slots.icon()),descriptionNode):h$1("div",{class:["".concat(mergedClsPrefix,"-spin-body"),this.themeClass]},h$1(NBaseLoading,{clsPrefix:mergedClsPrefix,style:$slots.default?"":this.cssVars,stroke:this.stroke,"stroke-width":this.mergedStrokeWidth,class:"".concat(mergedClsPrefix,"-spin")}),descriptionNode);return(_b=this.onRender)===null||_b===void 0||_b.call(this),$slots.default?h$1("div",{class:["".concat(mergedClsPrefix,"-spin-container"),this.themeClass],style:this.cssVars},h$1("div",{class:["".concat(mergedClsPrefix,"-spin-content"),this.active&&"".concat(mergedClsPrefix,"-spin-content--spinning"),this.contentClass],style:this.contentStyle},$slots),h$1(Transition,{name:"fade-in-transition"},{default:__name(()=>this.active?icon:null,"default")})):icon}}),uploadInjectionKey=createInjectionKey("n-upload"),style=c$1([cB("upload","width: 100%;",[cM("dragger-inside",[cB("upload-trigger","\n display: block;\n ")]),cM("drag-over",[cB("upload-dragger","\n border: var(--n-dragger-border-hover);\n ")])]),cB("upload-dragger","\n cursor: pointer;\n box-sizing: border-box;\n width: 100%;\n text-align: center;\n border-radius: var(--n-border-radius);\n padding: 24px;\n opacity: 1;\n transition:\n opacity .3s var(--n-bezier),\n border-color .3s var(--n-bezier),\n background-color .3s var(--n-bezier);\n background-color: var(--n-dragger-color);\n border: var(--n-dragger-border);\n ",[c$1("&:hover","\n border: var(--n-dragger-border-hover);\n "),cM("disabled","\n cursor: not-allowed;\n ")]),cB("upload-trigger","\n display: inline-block;\n box-sizing: border-box;\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[c$1("+",[cB("upload-file-list","margin-top: 8px;")]),cM("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n "),cM("image-card","\n width: 96px;\n height: 96px;\n ",[cB("base-icon","\n font-size: 24px;\n "),cB("upload-dragger","\n padding: 0;\n height: 100%;\n width: 100%;\n display: flex;\n align-items: center;\n justify-content: center;\n ")])]),cB("upload-file-list","\n line-height: var(--n-line-height);\n opacity: 1;\n transition: opacity .3s var(--n-bezier);\n ",[c$1("a, img","outline: none;"),cM("disabled","\n opacity: var(--n-item-disabled-opacity);\n cursor: not-allowed;\n ",[cB("upload-file","cursor: not-allowed;")]),cM("grid","\n display: grid;\n grid-template-columns: repeat(auto-fill, 96px);\n grid-gap: 8px;\n margin-top: 0;\n "),cB("upload-file","\n display: block;\n box-sizing: border-box;\n cursor: default;\n padding: 0px 12px 0 6px;\n transition: background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n ",[fadeInHeightExpandTransition(),cB("progress",[fadeInHeightExpandTransition({foldPadding:!0})]),c$1("&:hover","\n background-color: var(--n-item-color-hover);\n ",[cB("upload-file-info",[cE("action","\n opacity: 1;\n ")])]),cM("image-type","\n border-radius: var(--n-border-radius);\n text-decoration: underline;\n text-decoration-color: #0000;\n ",[cB("upload-file-info","\n padding-top: 0px;\n padding-bottom: 0px;\n width: 100%;\n height: 100%;\n display: flex;\n justify-content: space-between;\n align-items: center;\n padding: 6px 0;\n ",[cB("progress","\n padding: 2px 0;\n margin-bottom: 0;\n "),cE("name","\n padding: 0 8px;\n "),cE("thumbnail","\n width: 32px;\n height: 32px;\n font-size: 28px;\n display: flex;\n justify-content: center;\n align-items: center;\n ",[c$1("img","\n width: 100%;\n ")])])]),cM("text-type",[cB("progress","\n box-sizing: border-box;\n padding-bottom: 6px;\n margin-bottom: 6px;\n ")]),cM("image-card-type","\n position: relative;\n width: 96px;\n height: 96px;\n border: var(--n-item-border-image-card);\n border-radius: var(--n-border-radius);\n padding: 0;\n display: flex;\n align-items: center;\n justify-content: center;\n transition: border-color .3s var(--n-bezier), background-color .3s var(--n-bezier);\n border-radius: var(--n-border-radius);\n overflow: hidden;\n ",[cB("progress","\n position: absolute;\n left: 8px;\n bottom: 8px;\n right: 8px;\n width: unset;\n "),cB("upload-file-info","\n padding: 0;\n width: 100%;\n height: 100%;\n ",[cE("thumbnail","\n width: 100%;\n height: 100%;\n display: flex;\n flex-direction: column;\n align-items: center;\n justify-content: center;\n font-size: 36px;\n ",[c$1("img","\n width: 100%;\n ")])]),c$1("&::before",'\n position: absolute;\n z-index: 1;\n left: 0;\n right: 0;\n top: 0;\n bottom: 0;\n border-radius: inherit;\n opacity: 0;\n transition: opacity .2s var(--n-bezier);\n content: "";\n '),c$1("&:hover",[c$1("&::before","opacity: 1;"),cB("upload-file-info",[cE("thumbnail","opacity: .12;")])])]),cM("error-status",[c$1("&:hover","\n background-color: var(--n-item-color-hover-error);\n "),cB("upload-file-info",[cE("name","color: var(--n-item-text-color-error);"),cE("thumbnail","color: var(--n-item-text-color-error);")]),cM("image-card-type","\n border: var(--n-item-border-image-card-error);\n ")]),cM("with-url","\n cursor: pointer;\n ",[cB("upload-file-info",[cE("name","\n color: var(--n-item-text-color-success);\n text-decoration-color: var(--n-item-text-color-success);\n ",[c$1("a","\n text-decoration: underline;\n ")])])]),cB("upload-file-info","\n position: relative;\n padding-top: 6px;\n padding-bottom: 6px;\n display: flex;\n flex-wrap: nowrap;\n ",[cE("thumbnail","\n font-size: 18px;\n opacity: 1;\n transition: opacity .2s var(--n-bezier);\n color: var(--n-item-icon-color);\n ",[cB("base-icon","\n margin-right: 2px;\n vertical-align: middle;\n transition: color .3s var(--n-bezier);\n ")]),cE("action","\n padding-top: inherit;\n padding-bottom: inherit;\n position: absolute;\n right: 0;\n top: 0;\n bottom: 0;\n width: 80px;\n display: flex;\n align-items: center;\n transition: opacity .2s var(--n-bezier);\n justify-content: flex-end;\n opacity: 0;\n ",[cB("button",[c$1("&:not(:last-child)",{marginRight:"4px"}),cB("base-icon",[c$1("svg",[iconSwitchTransition()])])]),cM("image-type","\n position: relative;\n max-width: 80px;\n width: auto;\n "),cM("image-card-type","\n z-index: 2;\n position: absolute;\n width: 100%;\n height: 100%;\n left: 0;\n right: 0;\n bottom: 0;\n top: 0;\n display: flex;\n justify-content: center;\n align-items: center;\n ")]),cE("name","\n color: var(--n-item-text-color);\n flex: 1;\n display: flex;\n justify-content: center;\n text-overflow: ellipsis;\n overflow: hidden;\n flex-direction: column;\n text-decoration-color: #0000;\n font-size: var(--n-font-size);\n transition:\n color .3s var(--n-bezier),\n text-decoration-color .3s var(--n-bezier); \n ",[c$1("a","\n color: inherit;\n text-decoration: underline;\n ")])])])]),cB("upload-file-input","\n display: none;\n width: 0;\n height: 0;\n opacity: 0;\n ")]),uploadDraggerKey="__UPLOAD_DRAGGER__",NUploadDragger=defineComponent({name:"UploadDragger",[uploadDraggerKey]:!0,setup(_2,{slots}){const NUpload2=inject(uploadInjectionKey,null);return NUpload2||throwError("upload-dragger","`n-upload-dragger` must be placed inside `n-upload`."),()=>{const{mergedClsPrefixRef:{value:mergedClsPrefix},mergedDisabledRef:{value:mergedDisabled},maxReachedRef:{value:maxReached}}=NUpload2;return h$1("div",{class:["".concat(mergedClsPrefix,"-upload-dragger"),(mergedDisabled||maxReached)&&"".concat(mergedClsPrefix,"-upload-dragger--disabled")]},slots)}}}),renderImageIcon=h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},h$1("g",{fill:"none"},h$1("path",{d:"M21.75 3A3.25 3.25 0 0 1 25 6.25v15.5A3.25 3.25 0 0 1 21.75 25H6.25A3.25 3.25 0 0 1 3 21.75V6.25A3.25 3.25 0 0 1 6.25 3h15.5zm.583 20.4l-7.807-7.68a.75.75 0 0 0-.968-.07l-.084.07l-7.808 7.68c.183.065.38.1.584.1h15.5c.204 0 .4-.035.583-.1l-7.807-7.68l7.807 7.68zM21.75 4.5H6.25A1.75 1.75 0 0 0 4.5 6.25v15.5c0 .208.036.408.103.593l7.82-7.692a2.25 2.25 0 0 1 3.026-.117l.129.117l7.82 7.692c.066-.185.102-.385.102-.593V6.25a1.75 1.75 0 0 0-1.75-1.75zm-3.25 3a2.5 2.5 0 1 1 0 5a2.5 2.5 0 0 1 0-5zm0 1.5a1 1 0 1 0 0 2a1 1 0 0 0 0-2z",fill:"currentColor"}))),renderDocumentIcon=h$1("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 28 28"},h$1("g",{fill:"none"},h$1("path",{d:"M6.4 2A2.4 2.4 0 0 0 4 4.4v19.2A2.4 2.4 0 0 0 6.4 26h15.2a2.4 2.4 0 0 0 2.4-2.4V11.578c0-.729-.29-1.428-.805-1.944l-6.931-6.931A2.4 2.4 0 0 0 14.567 2H6.4zm-.9 2.4a.9.9 0 0 1 .9-.9H14V10a2 2 0 0 0 2 2h6.5v11.6a.9.9 0 0 1-.9.9H6.4a.9.9 0 0 1-.9-.9V4.4zm16.44 6.1H16a.5.5 0 0 1-.5-.5V4.06l6.44 6.44z",fill:"currentColor"}))),NUploadProgress=defineComponent({name:"UploadProgress",props:{show:Boolean,percentage:{type:Number,required:!0},status:{type:String,required:!0}},setup(){return{mergedTheme:inject(uploadInjectionKey).mergedThemeRef}},render(){return h$1(NFadeInExpandTransition,null,{default:__name(()=>this.show?h$1(NProgress,{type:"line",showIndicator:!1,percentage:this.percentage,status:this.status,height:2,theme:this.mergedTheme.peers.Progress,themeOverrides:this.mergedTheme.peerOverrides.Progress}):null,"default")})}});var __awaiter$2=function(thisArg,_arguments,P2,generator){function adopt(value){return value instanceof P2?value:new P2(function(resolve){resolve(value)})}return __name(adopt,"adopt"),new(P2||(P2=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e2){reject(e2)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e2){reject(e2)}}__name(rejected,"rejected");function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};function isImageFileType(type){return type.includes("image/")}__name(isImageFileType,"isImageFileType");function getExtname(url=""){const temp=url.split("/"),filenameWithoutSuffix=temp[temp.length-1].split(/#|\?/)[0];return(/\.[^./\\]*$/.exec(filenameWithoutSuffix)||[""])[0]}__name(getExtname,"getExtname");const imageExtensionRegex=/(webp|svg|png|gif|jpg|jpeg|jfif|bmp|dpg|ico)$/i,isImageFile=__name(file=>{if(file.type)return isImageFileType(file.type);const fileNameExtension=getExtname(file.name||"");if(imageExtensionRegex.test(fileNameExtension))return!0;const url=file.thumbnailUrl||file.url||"",urlExtension=getExtname(url);return!!(/^data:image\//.test(url)||imageExtensionRegex.test(urlExtension))},"isImageFile");function createImageDataUrl(file){return __awaiter$2(this,void 0,void 0,function*(){return yield new Promise(resolve=>{if(!file.type||!isImageFileType(file.type)){resolve("");return}resolve(window.URL.createObjectURL(file))})})}__name(createImageDataUrl,"createImageDataUrl");const environmentSupportFile=isBrowser&&window.FileReader&&window.File;function isFileSystemDirectoryEntry(item){return item.isDirectory}__name(isFileSystemDirectoryEntry,"isFileSystemDirectoryEntry");function isFileSystemFileEntry(item){return item.isFile}__name(isFileSystemFileEntry,"isFileSystemFileEntry");function getFilesFromEntries(entries,directory){return __awaiter$2(this,void 0,void 0,function*(){const fileAndEntries=[];function _getFilesFromEntries(entries2){return __awaiter$2(this,void 0,void 0,function*(){for(const entry of entries2)if(entry){if(directory&&isFileSystemDirectoryEntry(entry)){const directoryReader=entry.createReader();let allEntries=[],readEntries;try{do readEntries=yield new Promise((resolve,reject)=>{directoryReader.readEntries(resolve,reject)}),allEntries=allEntries.concat(readEntries);while(readEntries.length>0)}catch(e2){error("upload","error happens when handling directory upload",e2)}yield _getFilesFromEntries(allEntries)}else if(isFileSystemFileEntry(entry))try{const file=yield new Promise((resolve,reject)=>{entry.file(resolve,reject)});fileAndEntries.push({file,entry,source:"dnd"})}catch(e2){error("upload","error happens when handling file upload",e2)}}})}return __name(_getFilesFromEntries,"_getFilesFromEntries"),yield _getFilesFromEntries(entries),fileAndEntries})}__name(getFilesFromEntries,"getFilesFromEntries");function createSettledFileInfo(fileInfo){const{id,name,percentage,status,url,file,thumbnailUrl,type,fullPath,batchId}=fileInfo;return{id,name,percentage:percentage!=null?percentage:null,status,url:url!=null?url:null,file:file!=null?file:null,thumbnailUrl:thumbnailUrl!=null?thumbnailUrl:null,type:type!=null?type:null,fullPath:fullPath!=null?fullPath:null,batchId:batchId!=null?batchId:null}}__name(createSettledFileInfo,"createSettledFileInfo");function matchType(name,mimeType,accept){return name=name.toLowerCase(),mimeType=mimeType.toLocaleLowerCase(),accept=accept.toLocaleLowerCase(),accept.split(",").map(acceptAtom=>acceptAtom.trim()).filter(Boolean).some(acceptAtom=>{if(acceptAtom.startsWith(".")){if(name.endsWith(acceptAtom))return!0}else if(acceptAtom.includes("/")){const[type,subtype]=mimeType.split("/"),[acceptType,acceptSubtype]=acceptAtom.split("/");if((acceptType==="*"||type&&acceptType&&acceptType===type)&&(acceptSubtype==="*"||subtype&&acceptSubtype&&acceptSubtype===subtype))return!0}else return!0;return!1})}__name(matchType,"matchType");var __awaiter$1=function(thisArg,_arguments,P2,generator){function adopt(value){return value instanceof P2?value:new P2(function(resolve){resolve(value)})}return __name(adopt,"adopt"),new(P2||(P2=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e2){reject(e2)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e2){reject(e2)}}__name(rejected,"rejected");function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})};const buttonThemeOverrides={paddingMedium:"0 3px",heightMedium:"24px",iconSizeMedium:"18px"},NUploadFile=defineComponent({name:"UploadFile",props:{clsPrefix:{type:String,required:!0},file:{type:Object,required:!0},listType:{type:String,required:!0},index:{type:Number,required:!0}},setup(props){const NUpload2=inject(uploadInjectionKey),imageRef=ref(null),thumbnailUrlRef=ref(""),progressStatusRef=computed(()=>{const{file}=props;return file.status==="finished"?"success":file.status==="error"?"error":"info"}),buttonTypeRef=computed(()=>{const{file}=props;if(file.status==="error")return"error"}),showProgressRef=computed(()=>{const{file}=props;return file.status==="uploading"}),showCancelButtonRef=computed(()=>{if(!NUpload2.showCancelButtonRef.value)return!1;const{file}=props;return["uploading","pending","error"].includes(file.status)}),showRemoveButtonRef=computed(()=>{if(!NUpload2.showRemoveButtonRef.value)return!1;const{file}=props;return["finished"].includes(file.status)}),showDownloadButtonRef=computed(()=>{if(!NUpload2.showDownloadButtonRef.value)return!1;const{file}=props;return["finished"].includes(file.status)}),showRetryButtonRef=computed(()=>{if(!NUpload2.showRetryButtonRef.value)return!1;const{file}=props;return["error"].includes(file.status)}),mergedThumbnailUrlRef=useMemo(()=>thumbnailUrlRef.value||props.file.thumbnailUrl||props.file.url),showPreviewButtonRef=computed(()=>{if(!NUpload2.showPreviewButtonRef.value)return!1;const{file:{status},listType}=props;return["finished"].includes(status)&&mergedThumbnailUrlRef.value&&listType==="image-card"});function handleRetryClick(){return __awaiter$1(this,void 0,void 0,function*(){const onRetry=NUpload2.onRetryRef.value;onRetry&&(yield onRetry({file:props.file}))===!1||NUpload2.submit(props.file.id)})}__name(handleRetryClick,"handleRetryClick");function handleRemoveOrCancelClick(e2){e2.preventDefault();const{file}=props;["finished","pending","error"].includes(file.status)?handleRemove(file):["uploading"].includes(file.status)?handleAbort(file):warn("upload","The button clicked type is unknown.")}__name(handleRemoveOrCancelClick,"handleRemoveOrCancelClick");function handleDownloadClick(e2){e2.preventDefault(),handleDownload(props.file)}__name(handleDownloadClick,"handleDownloadClick");function handleRemove(file){const{xhrMap,doChange,onRemoveRef:{value:onRemove},mergedFileListRef:{value:mergedFileList}}=NUpload2;Promise.resolve(onRemove?onRemove({file:Object.assign({},file),fileList:mergedFileList,index:props.index}):!0).then(result=>{if(result===!1)return;const fileAfterChange=Object.assign({},file,{status:"removed"});xhrMap.delete(file.id),doChange(fileAfterChange,void 0,{remove:!0})})}__name(handleRemove,"handleRemove");function handleDownload(file){const{onDownloadRef:{value:onDownload},customDownloadRef:{value:customDownload}}=NUpload2;Promise.resolve(onDownload?onDownload(Object.assign({},file)):!0).then(res=>{res!==!1&&(customDownload?customDownload(Object.assign({},file)):download(file.url,file.name))})}__name(handleDownload,"handleDownload");function handleAbort(file){const{xhrMap}=NUpload2,xhr=xhrMap.get(file.id);xhr==null||xhr.abort(),handleRemove(Object.assign({},file))}__name(handleAbort,"handleAbort");function handlePreviewClick(e2){const{onPreviewRef:{value:onPreview}}=NUpload2;if(onPreview)onPreview(props.file,{event:e2});else if(props.listType==="image-card"){const{value}=imageRef;if(!value)return;value.click()}}__name(handlePreviewClick,"handlePreviewClick");const deriveFileThumbnailUrl=__name(()=>__awaiter$1(this,void 0,void 0,function*(){const{listType}=props;listType!=="image"&&listType!=="image-card"||NUpload2.shouldUseThumbnailUrlRef.value(props.file)&&(thumbnailUrlRef.value=yield NUpload2.getFileThumbnailUrlResolver(props.file))}),"deriveFileThumbnailUrl");return watchEffect(()=>{deriveFileThumbnailUrl()}),{mergedTheme:NUpload2.mergedThemeRef,progressStatus:progressStatusRef,buttonType:buttonTypeRef,showProgress:showProgressRef,disabled:NUpload2.mergedDisabledRef,showCancelButton:showCancelButtonRef,showRemoveButton:showRemoveButtonRef,showDownloadButton:showDownloadButtonRef,showRetryButton:showRetryButtonRef,showPreviewButton:showPreviewButtonRef,mergedThumbnailUrl:mergedThumbnailUrlRef,shouldUseThumbnailUrl:NUpload2.shouldUseThumbnailUrlRef,renderIcon:NUpload2.renderIconRef,imageRef,handleRemoveOrCancelClick,handleDownloadClick,handleRetryClick,handlePreviewClick}},render(){const{clsPrefix,mergedTheme,listType,file,renderIcon}=this;let icon;const isImageType=listType==="image";isImageType||listType==="image-card"?icon=!this.shouldUseThumbnailUrl(file)||!this.mergedThumbnailUrl?h$1("span",{class:"".concat(clsPrefix,"-upload-file-info__thumbnail")},renderIcon?renderIcon(file):isImageFile(file)?h$1(NBaseIcon,{clsPrefix},{default:renderImageIcon}):h$1(NBaseIcon,{clsPrefix},{default:renderDocumentIcon})):h$1("a",{rel:"noopener noreferer",target:"_blank",href:file.url||void 0,class:"".concat(clsPrefix,"-upload-file-info__thumbnail"),onClick:this.handlePreviewClick},listType==="image-card"?h$1(NImage,{src:this.mergedThumbnailUrl||void 0,previewSrc:file.url||void 0,alt:file.name,ref:"imageRef"}):h$1("img",{src:this.mergedThumbnailUrl||void 0,alt:file.name})):icon=h$1("span",{class:"".concat(clsPrefix,"-upload-file-info__thumbnail")},renderIcon?renderIcon(file):h$1(NBaseIcon,{clsPrefix},{default:__name(()=>h$1(AttachIcon,null),"default")}));const progress=h$1(NUploadProgress,{show:this.showProgress,percentage:file.percentage||0,status:this.progressStatus}),showName=listType==="text"||listType==="image";return h$1("div",{class:["".concat(clsPrefix,"-upload-file"),"".concat(clsPrefix,"-upload-file--").concat(this.progressStatus,"-status"),file.url&&file.status!=="error"&&listType!=="image-card"&&"".concat(clsPrefix,"-upload-file--with-url"),"".concat(clsPrefix,"-upload-file--").concat(listType,"-type")]},h$1("div",{class:"".concat(clsPrefix,"-upload-file-info")},icon,h$1("div",{class:"".concat(clsPrefix,"-upload-file-info__name")},showName&&(file.url&&file.status!=="error"?h$1("a",{rel:"noopener noreferer",target:"_blank",href:file.url||void 0,onClick:this.handlePreviewClick},file.name):h$1("span",{onClick:this.handlePreviewClick},file.name)),isImageType&&progress),h$1("div",{class:["".concat(clsPrefix,"-upload-file-info__action"),"".concat(clsPrefix,"-upload-file-info__action--").concat(listType,"-type")]},this.showPreviewButton?h$1(Button,{key:"preview",quaternary:!0,type:this.buttonType,onClick:this.handlePreviewClick,theme:mergedTheme.peers.Button,themeOverrides:mergedTheme.peerOverrides.Button,builtinThemeOverrides:buttonThemeOverrides},{icon:__name(()=>h$1(NBaseIcon,{clsPrefix},{default:__name(()=>h$1(EyeIcon,null),"default")}),"icon")}):null,(this.showRemoveButton||this.showCancelButton)&&!this.disabled&&h$1(Button,{key:"cancelOrTrash",theme:mergedTheme.peers.Button,themeOverrides:mergedTheme.peerOverrides.Button,quaternary:!0,builtinThemeOverrides:buttonThemeOverrides,type:this.buttonType,onClick:this.handleRemoveOrCancelClick},{icon:__name(()=>h$1(NIconSwitchTransition,null,{default:__name(()=>this.showRemoveButton?h$1(NBaseIcon,{clsPrefix,key:"trash"},{default:__name(()=>h$1(TrashIcon,null),"default")}):h$1(NBaseIcon,{clsPrefix,key:"cancel"},{default:__name(()=>h$1(CancelIcon,null),"default")}),"default")}),"icon")}),this.showRetryButton&&!this.disabled&&h$1(Button,{key:"retry",quaternary:!0,type:this.buttonType,onClick:this.handleRetryClick,theme:mergedTheme.peers.Button,themeOverrides:mergedTheme.peerOverrides.Button,builtinThemeOverrides:buttonThemeOverrides},{icon:__name(()=>h$1(NBaseIcon,{clsPrefix},{default:__name(()=>h$1(RetryIcon,null),"default")}),"icon")}),this.showDownloadButton?h$1(Button,{key:"download",quaternary:!0,type:this.buttonType,onClick:this.handleDownloadClick,theme:mergedTheme.peers.Button,themeOverrides:mergedTheme.peerOverrides.Button,builtinThemeOverrides:buttonThemeOverrides},{icon:__name(()=>h$1(NBaseIcon,{clsPrefix},{default:__name(()=>h$1(DownloadIcon,null),"default")}),"icon")}):null)),!isImageType&&progress)}}),NUploadTrigger=defineComponent({name:"UploadTrigger",props:{abstract:Boolean},slots:Object,setup(props,{slots}){const NUpload2=inject(uploadInjectionKey,null);NUpload2||throwError("upload-trigger","`n-upload-trigger` must be placed inside `n-upload`.");const{mergedClsPrefixRef,mergedDisabledRef,maxReachedRef,listTypeRef,dragOverRef,openOpenFileDialog,draggerInsideRef,handleFileAddition,mergedDirectoryDndRef,triggerClassRef,triggerStyleRef}=NUpload2,isImageCardTypeRef=computed(()=>listTypeRef.value==="image-card");function handleTriggerClick(){mergedDisabledRef.value||maxReachedRef.value||openOpenFileDialog()}__name(handleTriggerClick,"handleTriggerClick");function handleTriggerDragOver(e2){e2.preventDefault(),dragOverRef.value=!0}__name(handleTriggerDragOver,"handleTriggerDragOver");function handleTriggerDragEnter(e2){e2.preventDefault(),dragOverRef.value=!0}__name(handleTriggerDragEnter,"handleTriggerDragEnter");function handleTriggerDragLeave(e2){e2.preventDefault(),dragOverRef.value=!1}__name(handleTriggerDragLeave,"handleTriggerDragLeave");function handleTriggerDrop(e2){var _a4;if(e2.preventDefault(),!draggerInsideRef.value||mergedDisabledRef.value||maxReachedRef.value){dragOverRef.value=!1;return}const dataTransferItems=(_a4=e2.dataTransfer)===null||_a4===void 0?void 0:_a4.items;dataTransferItems!=null&&dataTransferItems.length?getFilesFromEntries(Array.from(dataTransferItems).map(item=>item.webkitGetAsEntry()),mergedDirectoryDndRef.value).then(files=>{handleFileAddition(files)}).finally(()=>{dragOverRef.value=!1}):dragOverRef.value=!1}return __name(handleTriggerDrop,"handleTriggerDrop"),()=>{var _a4;const{value:mergedClsPrefix}=mergedClsPrefixRef;return props.abstract?(_a4=slots.default)===null||_a4===void 0?void 0:_a4.call(slots,{handleClick:handleTriggerClick,handleDrop:handleTriggerDrop,handleDragOver:handleTriggerDragOver,handleDragEnter:handleTriggerDragEnter,handleDragLeave:handleTriggerDragLeave}):h$1("div",{class:["".concat(mergedClsPrefix,"-upload-trigger"),(mergedDisabledRef.value||maxReachedRef.value)&&"".concat(mergedClsPrefix,"-upload-trigger--disabled"),isImageCardTypeRef.value&&"".concat(mergedClsPrefix,"-upload-trigger--image-card"),triggerClassRef.value],style:triggerStyleRef.value,onClick:handleTriggerClick,onDrop:handleTriggerDrop,onDragover:handleTriggerDragOver,onDragenter:handleTriggerDragEnter,onDragleave:handleTriggerDragLeave},isImageCardTypeRef.value?h$1(NUploadDragger,null,{default:__name(()=>resolveSlot(slots.default,()=>[h$1(NBaseIcon,{clsPrefix:mergedClsPrefix},{default:__name(()=>h$1(AddIcon,null),"default")})]),"default")}):slots)}}}),NUploadFileList=defineComponent({name:"UploadFileList",setup(_2,{slots}){const NUpload2=inject(uploadInjectionKey,null);NUpload2||throwError("upload-file-list","`n-upload-file-list` must be placed inside `n-upload`.");const{abstractRef,mergedClsPrefixRef,listTypeRef,mergedFileListRef,fileListClassRef,fileListStyleRef,cssVarsRef,themeClassRef,maxReachedRef,showTriggerRef,imageGroupPropsRef}=NUpload2,isImageCardTypeRef=computed(()=>listTypeRef.value==="image-card"),renderFileList=__name(()=>mergedFileListRef.value.map((file,index)=>h$1(NUploadFile,{clsPrefix:mergedClsPrefixRef.value,key:file.id,file,index,listType:listTypeRef.value})),"renderFileList"),renderUploadFileList=__name(()=>isImageCardTypeRef.value?h$1(NImageGroup,Object.assign({},imageGroupPropsRef.value),{default:renderFileList}):h$1(NFadeInExpandTransition,{group:!0},{default:renderFileList}),"renderUploadFileList");return()=>{const{value:mergedClsPrefix}=mergedClsPrefixRef,{value:abstract}=abstractRef;return h$1("div",{class:["".concat(mergedClsPrefix,"-upload-file-list"),isImageCardTypeRef.value&&"".concat(mergedClsPrefix,"-upload-file-list--grid"),abstract?themeClassRef==null?void 0:themeClassRef.value:void 0,fileListClassRef.value],style:[abstract&&cssVarsRef?cssVarsRef.value:"",fileListStyleRef.value]},renderUploadFileList(),showTriggerRef.value&&!maxReachedRef.value&&isImageCardTypeRef.value&&h$1(NUploadTrigger,null,slots))}}});var __awaiter=__name(function(thisArg,_arguments,P2,generator){function adopt(value){return value instanceof P2?value:new P2(function(resolve){resolve(value)})}return __name(adopt,"adopt"),new(P2||(P2=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e2){reject(e2)}}__name(fulfilled,"fulfilled");function rejected(value){try{step(generator.throw(value))}catch(e2){reject(e2)}}__name(rejected,"rejected");function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}__name(step,"step"),step((generator=generator.apply(thisArg,_arguments||[])).next())})},"__awaiter");function createXhrHandlers(inst,file,xhr){const{doChange,xhrMap}=inst;let percentage=0;function handleXHRError(e2){var _a4;let fileAfterChange=Object.assign({},file,{status:"error",percentage});xhrMap.delete(file.id),fileAfterChange=createSettledFileInfo(((_a4=inst.onError)===null||_a4===void 0?void 0:_a4.call(inst,{file:fileAfterChange,event:e2}))||fileAfterChange),doChange(fileAfterChange,e2)}__name(handleXHRError,"handleXHRError");function handleXHRLoad(e2){var _a4;if(inst.isErrorState){if(inst.isErrorState(xhr)){handleXHRError(e2);return}}else if(xhr.status<200||xhr.status>=300){handleXHRError(e2);return}let fileAfterChange=Object.assign({},file,{status:"finished",percentage});xhrMap.delete(file.id),fileAfterChange=createSettledFileInfo(((_a4=inst.onFinish)===null||_a4===void 0?void 0:_a4.call(inst,{file:fileAfterChange,event:e2}))||fileAfterChange),doChange(fileAfterChange,e2)}return __name(handleXHRLoad,"handleXHRLoad"),{handleXHRLoad,handleXHRError,handleXHRAbort(e2){const fileAfterChange=Object.assign({},file,{status:"removed",file:null,percentage});xhrMap.delete(file.id),doChange(fileAfterChange,e2)},handleXHRProgress(e2){const fileAfterChange=Object.assign({},file,{status:"uploading"});if(e2.lengthComputable){const progress=Math.ceil(e2.loaded/e2.total*100);fileAfterChange.percentage=progress,percentage=progress}doChange(fileAfterChange,e2)}}}__name(createXhrHandlers,"createXhrHandlers");function customSubmitImpl(options){const{inst,file,data,headers,withCredentials,action,customRequest}=options,{doChange}=options.inst;let percentage=0;customRequest({file,data,headers,withCredentials,action,onProgress(event){const fileAfterChange=Object.assign({},file,{status:"uploading"}),progress=event.percent;fileAfterChange.percentage=progress,percentage=progress,doChange(fileAfterChange)},onFinish(){var _a4;let fileAfterChange=Object.assign({},file,{status:"finished",percentage});fileAfterChange=createSettledFileInfo(((_a4=inst.onFinish)===null||_a4===void 0?void 0:_a4.call(inst,{file:fileAfterChange}))||fileAfterChange),doChange(fileAfterChange)},onError(){var _a4;let fileAfterChange=Object.assign({},file,{status:"error",percentage});fileAfterChange=createSettledFileInfo(((_a4=inst.onError)===null||_a4===void 0?void 0:_a4.call(inst,{file:fileAfterChange}))||fileAfterChange),doChange(fileAfterChange)}})}__name(customSubmitImpl,"customSubmitImpl");function registerHandler(inst,file,request){const handlers=createXhrHandlers(inst,file,request);request.onabort=handlers.handleXHRAbort,request.onerror=handlers.handleXHRError,request.onload=handlers.handleXHRLoad,request.upload&&(request.upload.onprogress=handlers.handleXHRProgress)}__name(registerHandler,"registerHandler");function unwrapFunctionValue(data,file){return typeof data=="function"?data({file}):data||{}}__name(unwrapFunctionValue,"unwrapFunctionValue");function setHeaders(request,headers,file){const headersObject=unwrapFunctionValue(headers,file);headersObject&&Object.keys(headersObject).forEach(key=>{request.setRequestHeader(key,headersObject[key])})}__name(setHeaders,"setHeaders");function appendData(formData,data,file){const dataObject=unwrapFunctionValue(data,file);dataObject&&Object.keys(dataObject).forEach(key=>{formData.append(key,dataObject[key])})}__name(appendData,"appendData");function submitImpl(inst,fieldName,file,{method,action,withCredentials,responseType,headers,data}){const request=new XMLHttpRequest;request.responseType=responseType,inst.xhrMap.set(file.id,request),request.withCredentials=withCredentials;const formData=new FormData;if(appendData(formData,data,file),file.file!==null&&formData.append(fieldName,file.file),registerHandler(inst,file,request),action!==void 0){request.open(method.toUpperCase(),action),setHeaders(request,headers,file),request.send(formData);const fileAfterChange=Object.assign({},file,{status:"uploading"});inst.doChange(fileAfterChange)}}__name(submitImpl,"submitImpl");const uploadProps=Object.assign(Object.assign({},useTheme.props),{name:{type:String,default:"file"},accept:String,action:String,customRequest:Function,directory:Boolean,directoryDnd:{type:Boolean,default:void 0},method:{type:String,default:"POST"},multiple:Boolean,showFileList:{type:Boolean,default:!0},data:[Object,Function],headers:[Object,Function],withCredentials:Boolean,responseType:{type:String,default:""},disabled:{type:Boolean,default:void 0},onChange:Function,onRemove:Function,onFinish:Function,onError:Function,onRetry:Function,onBeforeUpload:Function,isErrorState:Function,onDownload:Function,customDownload:Function,defaultUpload:{type:Boolean,default:!0},fileList:Array,"onUpdate:fileList":[Function,Array],onUpdateFileList:[Function,Array],fileListClass:String,fileListStyle:[String,Object],defaultFileList:{type:Array,default:__name(()=>[],"default")},showCancelButton:{type:Boolean,default:!0},showRemoveButton:{type:Boolean,default:!0},showDownloadButton:Boolean,showRetryButton:{type:Boolean,default:!0},showPreviewButton:{type:Boolean,default:!0},listType:{type:String,default:"text"},onPreview:Function,shouldUseThumbnailUrl:{type:Function,default:__name(file=>environmentSupportFile?isImageFile(file):!1,"default")},createThumbnailUrl:Function,abstract:Boolean,max:Number,showTrigger:{type:Boolean,default:!0},imageGroupProps:Object,inputProps:Object,triggerClass:String,triggerStyle:[String,Object],renderIcon:Function}),NUpload=defineComponent({name:"Upload",props:uploadProps,setup(props){props.abstract&&props.listType==="image-card"&&throwError("upload","when the list-type is image-card, abstract is not supported.");const{mergedClsPrefixRef,inlineThemeDisabled}=useConfig(props),themeRef=useTheme("Upload","-upload",style,uploadLight,props,mergedClsPrefixRef),formItem=useFormItem(props),uncontrolledFileListRef=ref(props.defaultFileList),controlledFileListRef=toRef(props,"fileList"),inputElRef=ref(null),draggerInsideRef={value:!1},dragOverRef=ref(!1),xhrMap=new Map,_mergedFileListRef=useMergedState(controlledFileListRef,uncontrolledFileListRef),mergedFileListRef=computed(()=>_mergedFileListRef.value.map(createSettledFileInfo)),maxReachedRef=computed(()=>{const{max}=props;return max!==void 0?mergedFileListRef.value.length>=max:!1});function openOpenFileDialog(){var _a4;(_a4=inputElRef.value)===null||_a4===void 0||_a4.click()}__name(openOpenFileDialog,"openOpenFileDialog");function handleFileInputChange(e2){const target=e2.target;handleFileAddition(target.files?Array.from(target.files).map(file=>({file,entry:null,source:"input"})):null,e2),target.value=""}__name(handleFileInputChange,"handleFileInputChange");function doUpdateFileList(files){const{"onUpdate:fileList":_onUpdateFileList,onUpdateFileList}=props;_onUpdateFileList&&call(_onUpdateFileList,files),onUpdateFileList&&call(onUpdateFileList,files),uncontrolledFileListRef.value=files}__name(doUpdateFileList,"doUpdateFileList");const mergedMultipleRef=computed(()=>props.multiple||props.directory),doChange=__name((fileAfterChange,event,options={append:!1,remove:!1})=>{const{append,remove}=options,fileListAfterChange=Array.from(mergedFileListRef.value),fileIndex=fileListAfterChange.findIndex(file=>file.id===fileAfterChange.id);if(append||remove||~fileIndex){append?fileListAfterChange.push(fileAfterChange):remove?fileListAfterChange.splice(fileIndex,1):fileListAfterChange.splice(fileIndex,1,fileAfterChange);const{onChange}=props;onChange&&onChange({file:fileAfterChange,fileList:fileListAfterChange,event}),doUpdateFileList(fileListAfterChange)}},"doChange");function handleFileAddition(fileAndEntries,e2){if(!fileAndEntries||fileAndEntries.length===0)return;const{onBeforeUpload}=props;fileAndEntries=mergedMultipleRef.value?fileAndEntries:[fileAndEntries[0]];const{max,accept}=props;fileAndEntries=fileAndEntries.filter(({file,source})=>source==="dnd"&&(accept!=null&&accept.trim())?matchType(file.name,file.type,accept):!0),max&&(fileAndEntries=fileAndEntries.slice(0,max-mergedFileListRef.value.length));const batchId=createId();Promise.all(fileAndEntries.map(_a4=>__awaiter(this,[_a4],void 0,function*({file,entry}){var _b;const fileInfo={id:createId(),batchId,name:file.name,status:"pending",percentage:0,file,url:null,type:file.type,thumbnailUrl:null,fullPath:(_b=entry==null?void 0:entry.fullPath)!==null&&_b!==void 0?_b:"/".concat(file.webkitRelativePath||file.name)};return!onBeforeUpload||(yield onBeforeUpload({file:fileInfo,fileList:mergedFileListRef.value}))!==!1?fileInfo:null}))).then(fileInfos=>__awaiter(this,void 0,void 0,function*(){let nextTickChain=Promise.resolve();fileInfos.forEach(fileInfo=>{nextTickChain=nextTickChain.then(nextTick).then(()=>{fileInfo&&doChange(fileInfo,e2,{append:!0})})}),yield nextTickChain})).then(()=>{props.defaultUpload&&submit()})}__name(handleFileAddition,"handleFileAddition");function submit(fileId){const{method,action,withCredentials,headers,data,name:fieldName}=props,filesToUpload=fileId!==void 0?mergedFileListRef.value.filter(file=>file.id===fileId):mergedFileListRef.value,shouldReupload=fileId!==void 0;filesToUpload.forEach(file=>{const{status}=file;(status==="pending"||status==="error"&&shouldReupload)&&(props.customRequest?customSubmitImpl({inst:{doChange,xhrMap,onFinish:props.onFinish,onError:props.onError},file,action,withCredentials,headers,data,customRequest:props.customRequest}):submitImpl({doChange,xhrMap,onFinish:props.onFinish,onError:props.onError,isErrorState:props.isErrorState},fieldName,file,{method,action,withCredentials,responseType:props.responseType,headers,data}))})}__name(submit,"submit");function getFileThumbnailUrlResolver(file){var _a4;if(file.thumbnailUrl)return file.thumbnailUrl;const{createThumbnailUrl}=props;return createThumbnailUrl?(_a4=createThumbnailUrl(file.file,file))!==null&&_a4!==void 0?_a4:file.url||"":file.url?file.url:file.file?createImageDataUrl(file.file):""}__name(getFileThumbnailUrlResolver,"getFileThumbnailUrlResolver");const cssVarsRef=computed(()=>{const{common:{cubicBezierEaseInOut},self:{draggerColor,draggerBorder,draggerBorderHover,itemColorHover,itemColorHoverError,itemTextColorError,itemTextColorSuccess,itemTextColor,itemIconColor,itemDisabledOpacity,lineHeight,borderRadius,fontSize,itemBorderImageCardError,itemBorderImageCard}}=themeRef.value;return{"--n-bezier":cubicBezierEaseInOut,"--n-border-radius":borderRadius,"--n-dragger-border":draggerBorder,"--n-dragger-border-hover":draggerBorderHover,"--n-dragger-color":draggerColor,"--n-font-size":fontSize,"--n-item-color-hover":itemColorHover,"--n-item-color-hover-error":itemColorHoverError,"--n-item-disabled-opacity":itemDisabledOpacity,"--n-item-icon-color":itemIconColor,"--n-item-text-color":itemTextColor,"--n-item-text-color-error":itemTextColorError,"--n-item-text-color-success":itemTextColorSuccess,"--n-line-height":lineHeight,"--n-item-border-image-card-error":itemBorderImageCardError,"--n-item-border-image-card":itemBorderImageCard}}),themeClassHandle=inlineThemeDisabled?useThemeClass("upload",void 0,cssVarsRef,props):void 0;provide(uploadInjectionKey,{mergedClsPrefixRef,mergedThemeRef:themeRef,showCancelButtonRef:toRef(props,"showCancelButton"),showDownloadButtonRef:toRef(props,"showDownloadButton"),showRemoveButtonRef:toRef(props,"showRemoveButton"),showRetryButtonRef:toRef(props,"showRetryButton"),onRemoveRef:toRef(props,"onRemove"),onDownloadRef:toRef(props,"onDownload"),customDownloadRef:toRef(props,"customDownload"),mergedFileListRef,triggerClassRef:toRef(props,"triggerClass"),triggerStyleRef:toRef(props,"triggerStyle"),shouldUseThumbnailUrlRef:toRef(props,"shouldUseThumbnailUrl"),renderIconRef:toRef(props,"renderIcon"),xhrMap,submit,doChange,showPreviewButtonRef:toRef(props,"showPreviewButton"),onPreviewRef:toRef(props,"onPreview"),getFileThumbnailUrlResolver,listTypeRef:toRef(props,"listType"),dragOverRef,openOpenFileDialog,draggerInsideRef,handleFileAddition,mergedDisabledRef:formItem.mergedDisabledRef,maxReachedRef,fileListClassRef:toRef(props,"fileListClass"),fileListStyleRef:toRef(props,"fileListStyle"),abstractRef:toRef(props,"abstract"),acceptRef:toRef(props,"accept"),cssVarsRef:inlineThemeDisabled?void 0:cssVarsRef,themeClassRef:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender,showTriggerRef:toRef(props,"showTrigger"),imageGroupPropsRef:toRef(props,"imageGroupProps"),mergedDirectoryDndRef:computed(()=>{var _a4;return(_a4=props.directoryDnd)!==null&&_a4!==void 0?_a4:props.directory}),onRetryRef:toRef(props,"onRetry")});const exposedMethods={clear:__name(()=>{uncontrolledFileListRef.value=[]},"clear"),submit,openOpenFileDialog};return Object.assign({mergedClsPrefix:mergedClsPrefixRef,draggerInsideRef,inputElRef,mergedTheme:themeRef,dragOver:dragOverRef,mergedMultiple:mergedMultipleRef,cssVars:inlineThemeDisabled?void 0:cssVarsRef,themeClass:themeClassHandle==null?void 0:themeClassHandle.themeClass,onRender:themeClassHandle==null?void 0:themeClassHandle.onRender,handleFileInputChange},exposedMethods)},render(){var _a4,_b;const{draggerInsideRef,mergedClsPrefix,$slots,directory,onRender}=this;if($slots.default&&!this.abstract){const firstChild=$slots.default()[0];!((_a4=firstChild==null?void 0:firstChild.type)===null||_a4===void 0)&&_a4[uploadDraggerKey]&&(draggerInsideRef.value=!0)}const inputNode=h$1("input",Object.assign({},this.inputProps,{ref:"inputElRef",type:"file",class:"".concat(mergedClsPrefix,"-upload-file-input"),accept:this.accept,multiple:this.mergedMultiple,onChange:this.handleFileInputChange,webkitdirectory:directory||void 0,directory:directory||void 0}));return this.abstract?h$1(Fragment,null,(_b=$slots.default)===null||_b===void 0?void 0:_b.call($slots),h$1(Teleport,{to:"body"},inputNode)):(onRender==null||onRender(),h$1("div",{class:["".concat(mergedClsPrefix,"-upload"),draggerInsideRef.value&&"".concat(mergedClsPrefix,"-upload--dragger-inside"),this.dragOver&&"".concat(mergedClsPrefix,"-upload--drag-over"),this.themeClass],style:this.cssVars},inputNode,this.showTrigger&&this.listType!=="image-card"&&h$1(NUploadTrigger,null,$slots),this.showFileList&&h$1(NUploadFileList,null,$slots)))}});function useThemeVars(){const configProviderInjection=inject(configProviderInjectionKey,null);return computed(()=>{if(configProviderInjection===null)return derived;const{mergedThemeRef:{value:mergedTheme},mergedThemeOverridesRef:{value:mergedThemeOverrides}}=configProviderInjection,currentThemeVars=(mergedTheme==null?void 0:mergedTheme.common)||derived;return mergedThemeOverrides!=null&&mergedThemeOverrides.common?Object.assign({},currentThemeVars,mergedThemeOverrides.common):currentThemeVars})}__name(useThemeVars,"useThemeVars");/*!
* @indoorequal/vue-maplibre-gl v8.4.0
* (c) 2025 Franois de Metz <francois@2metz.fr>
* @license MIT
*/var te$1=Object.defineProperty,oe$1=__name((e2,o2,r2)=>o2 in e2?te$1(e2,o2,{enumerable:!0,configurable:!0,writable:!0,value:r2}):e2[o2]=r2,"oe$1"),F$1=__name((e2,o2,r2)=>oe$1(e2,typeof o2!="symbol"?o2+"":o2,r2),"F$1");const ge$1=Symbol("map"),L$1=ge$1,E$1=Symbol("isLoaded"),fe$1=Symbol("isInitialized"),K$1=fe$1,O$1=Symbol("componentId"),C$1=Symbol("sourceId"),x$1=Symbol("sourceLayerRegistry"),ye$1=["error","load","idle","remove","render","resize","webglcontextlost","webglcontextrestored","dataloading","data","tiledataloading","sourcedataloading","styledataloading","sourcedata","styledata","styleimagemissing","dataabort","sourcedataabort","boxzoomcancel","boxzoomstart","boxzoomend","touchcancel","touchmove","touchend","touchstart","click","contextmenu","dblclick","mousemove","mouseup","mousedown","mouseout","mouseover","movestart","move","moveend","zoomstart","zoom","zoomend","rotatestart","rotate","rotateend","dragstart","drag","dragend","pitchstart","pitch","pitchend","wheel","terrain","cooperativegestureprevented"];function ve$1(e2,o2,r2,a2){return t2=>r2.emit(a2,{type:t2.type,map:o2,component:e2,event:t2})}__name(ve$1,"ve$1");function pe$1(e2,o2){const r2=maplibreGlExports.LngLat.convert(e2),a2=maplibreGlExports.LngLat.convert(o2);return r2.lng===a2.lng&&r2.lat===a2.lat}__name(pe$1,"pe$1");var T$1=(e2=>(e2.TOP_LEFT="top-left",e2.TOP_RIGHT="top-right",e2.BOTTOM_LEFT="bottom-left",e2.BOTTOM_RIGHT="bottom-right",e2))(T$1||{});const I$1=Object.values(T$1),H$1=new Map,Q$1=Symbol("default");function be(e2,o2,r2=Q$1){var t2;let a2=H$1.get(r2);return a2||(a2=reactive({isLoaded:!1,isMounted:!1,language:null}),H$1.set(r2,a2)),a2.isLoaded=((t2=o2.value)==null?void 0:t2.loaded())||!1,a2.isMounted=!1,a2.component=e2,a2.map=o2.value,a2}__name(be,"be");const Se=defineComponent({name:"MglMap",props:{width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},attributionControl:{type:[Boolean,Object],default:void 0},bearing:{type:Number},bearingSnap:{type:Number},bounds:{type:[Array,Object]},boxZoom:{type:Boolean,default:void 0},center:{type:[Array,Object]},clickTolerance:{type:Number},collectResourceTiming:{type:Boolean,default:void 0},crossSourceCollisions:{type:Boolean,default:void 0},dragPan:{type:Boolean,default:void 0},dragRotate:{type:Boolean,default:void 0},doubleClickZoom:{type:Boolean,default:void 0},hash:{type:[Boolean,String],default:void 0},fadeDuration:{type:Number},fitBoundsOptions:{type:Object},interactive:{type:Boolean,default:void 0},keyboard:{type:Boolean,default:void 0},locale:{type:Object},localIdeographFontFamily:{type:String},logoPosition:{type:[String],validator:__name(e2=>e2 in T$1,"validator")},maxBounds:{type:[Array,Object]},maxPitch:{type:Number},maxZoom:{type:Number},minPitch:{type:Number},minZoom:{type:Number},pitch:{type:Number},pitchWithRotate:{type:Boolean,default:void 0},canvasContextAttributes:{type:Object},refreshExpiredTiles:{type:Boolean,default:void 0},renderWorldCopies:{type:Boolean,default:void 0},scrollZoom:{type:Boolean,default:void 0},mapStyle:{type:[String,Object]},trackResize:{type:Boolean,default:void 0},transformRequest:{type:Function},transformCameraUpdate:{type:Function},touchZoomRotate:{type:Boolean,default:void 0},touchPitch:{type:Boolean,default:void 0},zoom:{type:Number},maxTileCacheSize:{type:Number},mapKey:{type:[String,Symbol]},pixelRatio:{type:Number},validateStyle:{type:Boolean,default:void 0},cooperativeGestures:{type:Object}},emits:["map:error","map:load","map:idle","map:remove","map:render","map:resize","map:webglcontextlost","map:webglcontextrestored","map:dataloading","map:data","map:tiledataloading","map:sourcedataloading","map:styledataloading","map:sourcedata","map:styledata","map:styleimagemissing","map:dataabort","map:sourcedataabort","map:boxzoomcancel","map:boxzoomstart","map:boxzoomend","map:touchcancel","map:touchmove","map:touchend","map:touchstart","map:click","map:contextmenu","map:dblclick","map:mousemove","map:mouseup","map:mousedown","map:mouseout","map:mouseover","map:movestart","map:move","map:moveend","map:zoomstart","map:zoom","map:zoomend","map:rotatestart","map:rotate","map:rotateend","map:dragstart","map:drag","map:dragend","map:pitchstart","map:pitch","map:pitchend","map:wheel","map:terrain","map:cooperativegestureprevented","map:projectiontransition","update:center","update:zoom","update:pitch","update:bearing"],slots:Object,setup(e2,o2){const r2=markRaw(getCurrentInstance()),a2=shallowRef(),t2=shallowRef(),l2=ref(!1),m2=ref(!1),i2=new Map,y2=be(r2,t2,e2.mapKey);provide(L$1,t2),provide(E$1,m2),provide(K$1,l2),provide(O$1,r2.uid),provide(C$1,""),watch(()=>e2.bearing,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setBearing(u2))}),watch(()=>e2.bounds,u2=>{var c2;u2&&((c2=t2.value)==null||c2.fitBounds(u2,e2.fitBoundsOptions))}),watch(()=>e2.center,u2=>{var q2,A2;const c2=(q2=t2.value)==null?void 0:q2.getCenter();u2&&c2&&!pe$1(u2,c2)&&((A2=t2.value)==null||A2.setCenter(u2))}),watch(()=>e2.maxBounds,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setMaxBounds(u2))}),watch(()=>e2.maxPitch,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setMaxPitch(u2))}),watch(()=>e2.maxZoom,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setMaxZoom(u2))}),watch(()=>e2.minPitch,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setMinPitch(u2))}),watch(()=>e2.minZoom,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setMinZoom(u2))}),watch(()=>e2.pitch,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setPitch(u2))}),watch(()=>e2.renderWorldCopies,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setRenderWorldCopies(u2))}),watch(()=>e2.mapStyle,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setStyle(u2))}),watch(()=>e2.transformRequest,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setTransformRequest(u2))}),watch(()=>e2.zoom,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setZoom(u2))}),watch(()=>e2.zoom,u2=>{var c2;u2&&((c2=t2.value)==null||c2.setZoom(u2))});function n2(){y2.isMounted=!0;const u2={...e2,style:e2.mapStyle,container:a2.value};for(const c2 of Object.keys(u2))u2[c2]===void 0&&delete u2[c2];if(t2.value=markRaw(new maplibreGlExports.Map(u2)),y2.map=t2.value,l2.value=!0,i2.set("__load",()=>(m2.value=!0,y2.isLoaded=!0)),t2.value.on("load",i2.get("__load")),i2.set("__moveend",()=>o2.emit("update:center",t2.value.getCenter())),t2.value.on("moveend",i2.get("__moveend")),i2.set("__zoomend",()=>o2.emit("update:zoom",t2.value.getZoom())),t2.value.on("zoomend",i2.get("__zoomend")),i2.set("__pitchend",()=>o2.emit("update:pitch",t2.value.getPitch())),t2.value.on("pitchend",i2.get("__pitchend")),i2.set("__rotateend",()=>o2.emit("update:bearing",t2.value.getBearing())),t2.value.on("rotateend",i2.get("__rotateend")),r2.vnode.props){for(const c2 of ye$1)if(r2.vnode.props["onMap:"+c2]){const q2="map:".concat(c2),A2=ve$1(r2,t2.value,o2,q2);i2.set(c2,A2),t2.value.on(c2,A2)}}t2.value.getCanvas().addEventListener("webglcontextlost",S2)}__name(n2,"n");async function s2(){y2.isMounted=!1,y2.isLoaded=!1,m2.value=!1,t2.value&&(t2.value.getCanvas().removeEventListener("webglcontextlost",S2),l2.value=!1,i2.forEach((u2,c2)=>{t2.value.off(c2.startsWith("__")?c2.substring(2):c2,u2)}),t2.value.remove())}__name(s2,"s");function S2(){s2(),nextTick(n2)}return __name(S2,"S"),onMounted(n2),onBeforeUnmount(s2),o2.expose({map:t2}),()=>[h$1("div",{ref:a2,style:{height:e2.height,width:e2.width}}),l2.value&&o2.slots.default?o2.slots.default({}):void 0]},render(){return null}});function Me$1(e2,o2,r2){watch(e2,a2=>{var t2,l2;a2&&I$1.indexOf(a2)===-1||((t2=o2.value)!=null&&t2.hasControl(r2)&&o2.value.removeControl(r2),(l2=o2.value)==null||l2.addControl(r2,a2))},{immediate:!0})}__name(Me$1,"Me$1");function _$1(e2,o2){const r2=inject(L$1),a2=inject(K$1),t2=shallowRef();return t2.value=e2(),Me$1(()=>o2.position,r2,t2.value),onBeforeUnmount(()=>{var l2;return a2.value&&((l2=r2.value)==null?void 0:l2.removeControl(t2.value))}),{control:t2,map:r2}}__name(_$1,"_$1");const _Le=class _Le{constructor(o2,r2){F$1(this,"container"),this.isAdded=o2,this.container=document.createElement("div"),this.setClasses(r2)}getDefaultPosition(){return T$1.TOP_LEFT}onAdd(){return nextTick(()=>this.isAdded.value=!0),this.container}onRemove(){this.isAdded.value=!1,this.container.remove()}setClasses(o2){this.container.className=o2}};__name(_Le,"Le");let Le=_Le;const Oe=defineComponent({name:"MglCustomControl",props:{position:{type:String,validator:__name(e2=>I$1.indexOf(e2)!==-1,"validator")},class:{type:String,default:"maplibregl-ctrl maplibregl-ctrl-group"}},slots:Object,setup(e2,{slots:o2}){const r2=ref(!1),{control:a2}=_$1(()=>new Le(r2,e2.class),e2);return watch(()=>e2.class,()=>a2.value.setClasses(e2.class)),()=>{var t2;return r2.value?h$1(Teleport,{to:a2.value.container},(t2=o2.default)==null?void 0:t2.call(o2,{})):createCommentVNode("custom-component")}},render(){return null}}),Ce$1=defineComponent({name:"MglFullscreenControl",props:{position:{type:String,validator:__name(e2=>I$1.indexOf(e2)!==-1,"validator")},container:{type:Object,default:null}},setup(e2){const{control:o2,map:r2}=_$1(()=>new maplibreGlExports.FullscreenControl({container:e2.container||void 0}),e2);function a2(){nextTick(()=>{var t2;return(t2=r2.value)==null?void 0:t2.resize()})}__name(a2,"a"),o2.value.on("fullscreenstart",a2),o2.value.on("fullscreenend",a2),onBeforeUnmount(()=>{o2.value.off("fullscreenstart",a2),o2.value.off("fullscreenend",a2)})},render(){return null}}),xe$1=defineComponent({name:"MglGeolocateControl",props:{position:{type:String,default:T$1.TOP_RIGHT,validator:__name(e2=>I$1.indexOf(e2)!==-1,"validator")},positionOptions:{type:Object,default:__name(()=>({enableHighAccuracy:!1,timeout:6e3}),"default")},fitBoundsOptions:{type:Object,default:__name(()=>({maxZoom:15}),"default")},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},emits:["trackuserlocationstart","trackuserlocationend","userlocationlostfocus","userlocationfocus","geolocate","error","outofmaxbounds"],setup(e2,o2){const{control:r2}=_$1(()=>new maplibreGlExports.GeolocateControl({positionOptions:e2.positionOptions,fitBoundsOptions:e2.fitBoundsOptions,trackUserLocation:e2.trackUserLocation,showAccuracyCircle:e2.showAccuracyCircle,showUserLocation:e2.showUserLocation}),e2);function a2(t2){const l2=__name(m2=>{o2.emit(t2,m2)},"l");r2.value.on(t2,l2),onBeforeUnmount(()=>{r2.value.off(t2,l2)})}__name(a2,"a"),a2("trackuserlocationstart"),a2("trackuserlocationend"),a2("userlocationlostfocus"),a2("userlocationfocus"),a2("geolocate"),a2("error"),a2("outofmaxbounds")},render(){return null}}),Ie$1=defineComponent({name:"MglNavigationControl",props:{position:{type:String,validator:__name(e2=>I$1.indexOf(e2)!==-1,"validator")},showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:Boolean},setup(e2){_$1(()=>new maplibreGlExports.NavigationControl({showCompass:e2.showCompass,showZoom:e2.showZoom,visualizePitch:e2.visualizePitch}),e2)},render(){return null}});var X$1=(e2=>(e2.IMPERIAL="imperial",e2.METRIC="metric",e2.NAUTICAL="nautical",e2))(X$1||{});const ze$1=Object.values(X$1),Ne=defineComponent({name:"MglScaleControl",props:{position:{type:String,validator:__name(e2=>I$1.indexOf(e2)!==-1,"validator")},maxWidth:{type:Number,default:100},unit:{type:String,default:"metric",validator:__name(e2=>ze$1.indexOf(e2)!==-1,"validator")}},setup(e2){_$1(()=>new maplibreGlExports.ScaleControl({maxWidth:e2.maxWidth,unit:e2.unit}),e2)},render(){return null}});var _a;let j$1=(_a=class{constructor(){F$1(this,"unmountHandlers",new Map)}registerUnmountHandler(o2,r2){this.unmountHandlers.set(o2,r2)}unregisterUnmountHandler(o2){this.unmountHandlers.delete(o2)}unmount(){this.unmountHandlers.forEach(o2=>o2())}},__name(_a,"j"),_a);var _a2;const P$1=(_a2=class{static genSourceOpts(o2){const r2={...o2};for(const a2 of Object.keys(r2))(r2[a2]===void 0||a2==="sourceId")&&delete r2[a2];return r2}static getSourceRef(o2,r2){const a2=typeof r2=="string",t2=String(o2)+(a2?r2:"");let l2=_a2.REFS.get(t2);return l2||(l2=ref(a2?null:void 0),_a2.REFS.set(t2,l2)),l2}},__name(_a2,"P"),_a2);F$1(P$1,"REFS",new Map);let p$1=P$1;function w$1(e2,o2,r2){const a2=inject(L$1),t2=inject(E$1);function l2(){t2.value&&(a2.value.addSource(o2.sourceId,p$1.genSourceOpts(o2)),e2.value=a2.value.getSource(o2.sourceId))}return __name(l2,"l"),watch(t2,l2,{immediate:!0}),a2.value.on("style.load",l2),onBeforeUnmount(()=>{t2.value&&(r2.unmount(),a2.value.removeSource(o2.sourceId)),a2.value.off("style.load",l2)})}__name(w$1,"w$1");const Ae=defineComponent({name:"MglGeoJsonSource",props:{sourceId:{type:String,required:!0},data:{type:[Object,String],required:!0},maxzoom:Number,attribution:String,buffer:Number,tolerance:Number,cluster:Boolean,clusterRadius:Number,clusterMaxZoom:Number,clusterMinPoints:Number,clusterProperties:Object,lineMetrics:Boolean,generateId:Boolean,promoteId:[Object,String],filter:[Array,String,Object]},slots:Object,setup(e2,{slots:o2}){const r2=inject(O$1),a2=p$1.getSourceRef(r2,e2.sourceId),t2=new j$1,l2={...e2,type:"geojson"};return provide(C$1,e2.sourceId),provide(x$1,t2),w$1(a2,l2,t2),watch([isRef(e2.data)?e2.data:()=>e2.data,a2],([m2,i2])=>{i2==null||i2.setData(m2||{type:"FeatureCollection",features:[]})},{immediate:!0}),()=>[createCommentVNode("GeoJSON Source"),a2.value&&o2.default?o2.default({}):void 0]}}),b$1=["click","dblclick","mousedown","mouseup","mousemove","mouseenter","mouseleave","mouseover","mouseout","contextmenu","touchstart","touchend","touchcancel"];function z$1(){return{layerId:{type:String,required:!0},source:{type:String},metadata:{type:[Object,Array,String,Number]},sourceLayer:{type:String},minzoom:{type:Number},maxzoom:{type:Number},filter:{type:Object},before:{type:String},layout:{type:Object},paint:{type:Object}}}__name(z$1,"z$1");function Fe(e2,o2,r2,a2){const t2={id:e2,type:o2,source:r2.source||a2,metadata:r2.metadata,minzoom:r2.minzoom,maxzoom:r2.maxzoom,"source-layer":r2.sourceLayer,filter:r2.filter,paint:r2.paint,layout:r2.layout};for(const l2 of Object.keys(t2))t2[l2]===void 0&&delete t2[l2];return t2}__name(Fe,"Fe");function Ze(e2,o2,r2){if(r2.props)for(const a2 of b$1){const t2="on"+a2.charAt(0).toUpperCase()+a2.substr(1);r2.props[t2]&&e2.on(a2,o2,r2.props[t2])}}__name(Ze,"Ze");function He$1(e2,o2,r2){if(r2.props)for(const a2 of b$1){const t2="on"+a2.charAt(0).toUpperCase()+a2.substr(1);r2.props[t2]&&e2.off(a2,o2,r2.props[t2])}}__name(He$1,"He$1");function ee$1(e2,o2){const r2=inject(L$1),a2=inject(E$1),t2=inject(x$1);function l2(){a2.value&&(o2&&He$1(r2.value,e2,o2.vnode),r2.value.getLayer(e2)&&r2.value.removeLayer(e2))}__name(l2,"l"),t2.registerUnmountHandler(e2,l2),onBeforeUnmount(()=>{t2.unregisterUnmountHandler(e2),l2()})}__name(ee$1,"ee$1");defineComponent({name:"MglBackgroundLayer",props:{layerId:{type:String,required:!0},metadata:[Object,Array,String,Number],minzoom:Number,maxzoom:Number,before:String,layout:Object,paint:Object},emits:[...b$1],setup(e2){const o2=inject(L$1),r2=inject(E$1);return ee$1(e2.layerId),watch(()=>e2.layout,a2=>{if(a2)for(const[t2,l2]of Object.entries(a2))o2.value.setLayoutProperty(e2.layerId,t2,l2)}),watch(()=>e2.paint,a2=>{if(a2)for(const[t2,l2]of Object.entries(a2))o2.value.setPaintProperty(e2.layerId,t2,l2)}),watch(r2,a2=>{a2&&o2.value.addLayer({id:e2.layerId,type:"background",metadata:e2.metadata,minzoom:e2.minzoom,maxzoom:e2.maxzoom,layout:e2.layout,paint:e2.paint},e2.before||void 0)},{immediate:!0}),()=>createCommentVNode("Background Layer")}});function N$1(e2,o2){const r2=inject(C$1);if(!r2&&!o2.source)return;const a2=getCurrentInstance(),t2=inject(L$1),l2=inject(E$1),m2=inject(O$1),i2=p$1.getSourceRef(m2,o2.source||r2);return ee$1(o2.layerId,a2),watch(()=>o2.minzoom,()=>t2.value.setLayerZoomRange(o2.layerId,o2.minzoom||0,o2.maxzoom||24)),watch(()=>o2.maxzoom,()=>t2.value.setLayerZoomRange(o2.layerId,o2.minzoom||0,o2.maxzoom||24)),watch(()=>o2.layout,y2=>{if(y2)for(const[n2,s2]of Object.entries(y2))t2.value.setLayoutProperty(o2.layerId,n2,s2)},{deep:!0}),watch(()=>o2.paint,y2=>{if(y2)for(const[n2,s2]of Object.entries(y2))t2.value.setPaintProperty(o2.layerId,n2,s2)},{deep:!0}),watch(()=>o2.filter,y2=>t2.value.setFilter(o2.layerId,y2),{deep:!0}),watch([l2,i2],([y2,n2])=>{y2&&(n2||n2===void 0)&&(t2.value.addLayer(Fe(o2.layerId,e2,o2,r2),o2.before||void 0),Ze(t2.value,o2.layerId,a2.vnode))},{immediate:!0}),()=>createCommentVNode("".concat(e2," Layer"))}__name(N$1,"N$1");defineComponent({name:"MglCircleLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("circle",e2)}});defineComponent({name:"MglFillLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("fill",e2)}});defineComponent({name:"MglFillExtrusionLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("fill-extrusion",e2)}});defineComponent({name:"MglHeatmapLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("heatmap",e2)}});defineComponent({name:"MglHillshadeLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("hillshade",e2)}});const Je=defineComponent({name:"MglLineLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("line",e2)}});defineComponent({name:"MglRasterLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("raster",e2)}});defineComponent({name:"MglSymbolLayer",props:z$1(),emits:[...b$1],setup(e2){return N$1("symbol",e2)}});function t$1(){return t$1=Object.assign?Object.assign.bind():function(t2){for(var e2=1;e2<arguments.length;e2++){var i2=arguments[e2];for(var o2 in i2)({}).hasOwnProperty.call(i2,o2)&&(t2[o2]=i2[o2])}return t2},t$1.apply(null,arguments)}__name(t$1,"t$1");var e;(function(t2){t2.Commit="commit",t2.Provisional="provisional",t2.Finish="finish"})(e||(e={}));const i={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT_FEATURE_ID:"selectionPointFeatureId",SELECTION_POINT:"selectionPoint"},o="currentlyDrawing",s="edited",n="closingPoint",r="snappingPoint",a="coordinatePoint",d="coordinatePointFeatureId",h="coordinatePointIds",l=10;function c(t2){return!!(t2&&typeof t2=="object"&&t2!==null&&!Array.isArray(t2))}__name(c,"c");function u(t2){return!!(t2&&typeof t2=="object"&&"properties"in t2&&typeof t2.properties=="object"&&t2.properties!==null&&"mode"in t2.properties)}__name(u,"u");function p(t2){return!!function(t3){return typeof t3=="number"&&!isNaN(new Date(t3).valueOf())}(t2)}__name(p,"p");const y="Feature mode property does not match the mode being added to";var f;(function(t2){t2.Drawing="drawing",t2.Select="select",t2.Static="static",t2.Render="render"})(f||(f={}));const m={rightClick:!0,contextMenu:!1,leftClick:!0,onDragStart:!0,onDrag:!0,onDragEnd:!0},_v=class _v{get state(){return this._state}set state(t2){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(t2){if(typeof t2!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=t2}registerBehaviors(t2){}constructor(t2,e2=!1){this._state="unregistered",this._styles={},this.pointerEvents=m,this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=f.Drawing,this.mode="base",e2||this.updateOptions(t2)}updateOptions(e2){e2!=null&&e2.styles&&(this.styles=t$1({},this._styles,e2.styles)),e2!=null&&e2.pointerDistance&&(this.pointerDistance=e2.pointerDistance),e2!=null&&e2.validation&&(this.validate=e2&&e2.validation),e2!=null&&e2.projection&&(this.projection=e2.projection),(e2==null?void 0:e2.pointerEvents)!==void 0&&(this.pointerEvents=e2.pointerEvents)}allowPointerEvent(t2,e2){return typeof t2=="boolean"?t2:typeof t2!="function"||t2(e2)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(t2){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=t2.store,this.store.registerOnChange(t2.onChange),this.setDoubleClickToZoom=t2.setDoubleClickToZoom,this.project=t2.project,this.unproject=t2.unproject,this.onSelect=t2.onSelect,this.onDeselect=t2.onDeselect,this.setCursor=t2.setCursor,this.onStyleChange=t2.onChange,this.onFinish=t2.onFinish,this.coordinatePrecision=t2.coordinatePrecision,this.registerBehaviors({mode:t2.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:t2.coordinatePrecision,projection:this.projection})}validateFeature(t2){return this.performFeatureValidation(t2)}afterFeatureAdded(t2){}performFeatureValidation(t2){if(this._state==="unregistered")throw new Error("Mode must be registered");const i2=function(t3,e2){let i3;if(c(t3))if(t3.id==null)i3="Feature has no id";else if(typeof t3.id!="string"&&typeof t3.id!="number")i3="Feature must be string or number as per GeoJSON spec";else if(e2(t3.id))if(c(t3.geometry))if(c(t3.properties))if(typeof t3.geometry.type=="string"&&["Polygon","LineString","Point"].includes(t3.geometry.type))if(Array.isArray(t3.geometry.coordinates)){if(!t3.properties.mode||typeof t3.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else i3="Feature coordinates is not an array";else i3="Feature is not Point, LineString or Polygon";else i3="Feature has no properties";else i3="Feature has no geometry";else i3="Feature must match the id strategy (default is UUID4)";else i3="Feature is not object";return i3?{valid:!1,reason:i3}:{valid:!0}}(t2,this.store.idStrategy.isValidId);if(this.validate){const o2=this.validate(t2,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Provisional});return{valid:i2.valid&&o2.valid,reason:o2.reason}}return{valid:i2.valid,reason:i2.reason}}validateModeFeature(t2,e2){const i2=this.performFeatureValidation(t2);return i2.valid?t2.properties.mode!==this.mode?{valid:!1,reason:y}:e2(t2):{valid:!1,reason:i2.reason}}onFinish(t2,e2){}onDeselect(t2){}onSelect(t2){}onKeyDown(t2){}onKeyUp(t2){}onMouseMove(t2){}onClick(t2){}onDragStart(t2,e2){}onDrag(t2,e2){}onDragEnd(t2,e2){}getHexColorStylingValue(t2,e2,i2){return this.getStylingValue(t2,e2,i2)}getNumericStylingValue(t2,e2,i2){return this.getStylingValue(t2,e2,i2)}getStylingValue(t2,e2,i2){return t2===void 0?e2:typeof t2=="function"?t2(i2):t2}};__name(_v,"v");let v=_v;const _C=class _C extends v{constructor(...t2){super(...t2),this.type=f.Select}};__name(_C,"C");let C=_C;function P(t2,e2){const i2=__name(t3=>t3*Math.PI/180,"i"),o2=i2(t2[1]),s2=i2(t2[0]),n2=i2(e2[1]),r2=n2-o2,a2=i2(e2[0])-s2,d2=Math.sin(r2/2)*Math.sin(r2/2)+Math.cos(o2)*Math.cos(n2)*Math.sin(a2/2)*Math.sin(a2/2);return 2*Math.atan2(Math.sqrt(d2),Math.sqrt(1-d2))*6371e3/1e3}__name(P,"P");const I=63710088e-1;function x(t2){return t2%360*Math.PI/180}__name(x,"x");function M(t2){return t2/6371.0088}__name(M,"M");function S(t2){return t2%(2*Math.PI)*180/Math.PI}__name(S,"S");function E(t2,e2=9){const i2=Math.pow(10,e2);return Math.round(t2*i2)/i2}__name(E,"E");const F=57.29577951308232,w=.017453292519943295,D=6378137,b=__name((t2,e2)=>({x:t2===0?0:t2*w*D,y:e2===0?0:Math.log(Math.tan(Math.PI/4+e2*w/2))*D}),"b"),k=__name((t2,e2)=>({lng:t2===0?0:F*(t2/D),lat:e2===0?0:(2*Math.atan(Math.exp(e2/D))-Math.PI/2)*F}),"k");function O(t2,e2,i2){const o2=x(t2[0]),s2=x(t2[1]),n2=x(i2),r2=M(e2),a2=Math.asin(Math.sin(s2)*Math.cos(r2)+Math.cos(s2)*Math.sin(r2)*Math.cos(n2));return[S(o2+Math.atan2(Math.sin(n2)*Math.sin(r2)*Math.cos(s2),Math.cos(r2)-Math.sin(s2)*Math.sin(a2))),S(a2)]}__name(O,"O");function _(t2){const{center:e2,radiusKilometers:i2,coordinatePrecision:o2}=t2,s2=t2.steps?t2.steps:64,n2=[];for(let t3=0;t3<s2;t3++){const r2=O(e2,i2,-360*t3/s2);n2.push([E(r2[0],o2),E(r2[1],o2)])}return n2.push(n2[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[n2]},properties:{}}}__name(_,"_");function j(t2){let e2;if(t2.geometry.type==="Polygon")e2=t2.geometry.coordinates;else{if(t2.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e2=[t2.geometry.coordinates]}const i2=[];for(let t3=0;t3<e2.length;t3++)for(let i3=0;i3<e2[t3].length-1;i3++)for(let o3=0;o3<e2.length;o3++)for(let n2=0;n2<e2[o3].length-1;n2++)s2(t3,i3,o3,n2);return i2.length>0;function o2(t3){return t3<0||t3>1}function s2(t3,s3,n2,r2){const a2=e2[t3][s3],d2=e2[t3][s3+1],h2=e2[n2][r2],l2=e2[n2][r2+1],c2=function(t4,e3,i3,o3){if(W(t4,i3)||W(t4,o3)||W(e3,i3)||W(o3,i3))return null;const s4=t4[0],n3=t4[1],r3=e3[0],a3=e3[1],d3=i3[0],h3=i3[1],l3=o3[0],c3=o3[1],u3=(s4-r3)*(h3-c3)-(n3-a3)*(d3-l3);return u3===0?null:[((s4*a3-n3*r3)*(d3-l3)-(s4-r3)*(d3*c3-h3*l3))/u3,((s4*a3-n3*r3)*(h3-c3)-(n3-a3)*(d3*c3-h3*l3))/u3]}(a2,d2,h2,l2);if(c2===null)return;let u2,p2;u2=d2[0]!==a2[0]?(c2[0]-a2[0])/(d2[0]-a2[0]):(c2[1]-a2[1])/(d2[1]-a2[1]),p2=l2[0]!==h2[0]?(c2[0]-h2[0])/(l2[0]-h2[0]):(c2[1]-h2[1])/(l2[1]-h2[1]),o2(u2)||o2(p2)||(c2.toString(),i2.push(c2))}}__name(j,"j");function W(t2,e2){return t2[0]===e2[0]&&t2[1]===e2[1]}__name(W,"W");function B(t2,e2){return N(t2[0])<=e2&&N(t2[1])<=e2}__name(B,"B");function G(t2){return t2.length===2&&typeof t2[0]=="number"&&typeof t2[1]=="number"&&t2[0]!==1/0&&t2[1]!==1/0&&(i2=t2[0])>=-180&&i2<=180&&(e2=t2[1])>=-90&&e2<=90;var e2,i2}__name(G,"G");function N(t2){let e2=1,i2=0;for(;Math.round(t2*e2)/e2!==t2;)e2*=10,i2++;return i2}__name(N,"N");const L="Feature has holes",T="Feature has less than 4 coordinates",V="Feature has invalid coordinates",U="Feature coordinates are not closed";function A(t2,e2){if(t2.geometry.type!=="Polygon")return{valid:!1,reason:"Feature is not a Polygon"};if(t2.geometry.coordinates.length!==1)return{valid:!1,reason:L};if(t2.geometry.coordinates[0].length<4)return{valid:!1,reason:T};for(let i3=0;i3<t2.geometry.coordinates[0].length;i3++){if(!G(t2.geometry.coordinates[0][i3]))return{valid:!1,reason:V};if(!B(t2.geometry.coordinates[0][i3],e2))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return(i2=t2.geometry.coordinates[0][0])[0]!==(o2=t2.geometry.coordinates[0][t2.geometry.coordinates[0].length-1])[0]||i2[1]!==o2[1]?{valid:!1,reason:U}:{valid:!0};var i2,o2}__name(A,"A");function R(t2,e2){const i2=A(t2,e2);return i2.valid?j(t2)?{valid:!1,reason:"Feature intersects itself"}:{valid:!0}:i2}__name(R,"R");const K={cancel:"Escape",finish:"Enter"},z={start:"crosshair"},_X=class _X extends v{constructor(t2){super(t2,!0),this.mode="circle",this.center=void 0,this.clickCount=0,this.currentCircleId=void 0,this.keyEvents=K,this.cursors=z,this.startingRadiusKilometers=1e-5,this.cursorMovedAfterInitialCursorDown=!1,this.updateOptions(t2)}updateOptions(e2){super.updateOptions(e2),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors)),(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents)),e2!=null&&e2.startingRadiusKilometers&&(this.startingRadiusKilometers=e2.startingRadiusKilometers)}close(){if(this.currentCircleId===void 0)return;this.store.updateProperty([{id:this.currentCircleId,property:o,value:void 0}]);const t2=this.currentCircleId;if(this.validate&&t2){const i2=this.store.getGeometryCopy(t2);if(!this.validate({type:"Feature",id:t2,geometry:i2,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Finish}).valid)return}this.cursorMovedAfterInitialCursorDown=!1,this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),this.onFinish(t2,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(t2){if(t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2))if(this.clickCount===0){this.center=[t2.lng,t2.lat];const e2=_({center:this.center,radiusKilometers:this.startingRadiusKilometers,coordinatePrecision:this.coordinatePrecision}),[i2]=this.store.create([{geometry:e2.geometry,properties:{mode:this.mode,radiusKilometers:this.startingRadiusKilometers,[o]:!0}}]);this.currentCircleId=i2,this.clickCount++,this.cursorMovedAfterInitialCursorDown=!1,this.setDrawing()}else this.clickCount===1&&this.center&&this.currentCircleId!==void 0&&this.cursorMovedAfterInitialCursorDown&&this.updateCircle(t2),this.close()}onMouseMove(t2){this.cursorMovedAfterInitialCursorDown=!0,this.updateCircle(t2)}onKeyDown(){}onKeyUp(t2){t2.key===this.keyEvents.cancel?this.cleanUp():t2.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const t2=this.currentCircleId;this.center=void 0,this.currentCircleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted();try{t2!==void 0&&this.store.delete([t2])}catch(t3){}}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e2.type==="Feature"&&e2.geometry.type==="Polygon"&&e2.properties.mode===this.mode&&(i2.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,i2.polygonFillColor,e2),i2.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,i2.polygonOutlineColor,e2),i2.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,i2.polygonOutlineWidth,e2),i2.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,i2.polygonFillOpacity,e2),i2.zIndex=l),i2}validateFeature(t2){return this.validateModeFeature(t2,t3=>R(t3,this.coordinatePrecision))}updateCircle(t2){if(this.clickCount===1&&this.center&&this.currentCircleId){const i2=P(this.center,[t2.lng,t2.lat]);let o2;if(this.projection==="web-mercator"){const e2=function(t3,e3){const i3=1e3*P(t3,e3);if(i3===0)return 1;const{x:o3,y:s2}=b(t3[0],t3[1]),{x:n2,y:r2}=b(e3[0],e3[1]);return Math.sqrt(Math.pow(n2-o3,2)+Math.pow(r2-s2,2))/i3}(this.center,[t2.lng,t2.lat]);o2=function(t3){const{center:e3,radiusKilometers:i3,coordinatePrecision:o3}=t3,s2=t3.steps?t3.steps:64,n2=1e3*i3,[r2,a2]=e3,{x:d2,y:h2}=b(r2,a2),l2=[];for(let t4=0;t4<s2;t4++){const e4=360*t4/s2*Math.PI/180,i4=n2*Math.cos(e4),r3=n2*Math.sin(e4),[a3,c2]=[d2+i4,h2+r3],{lng:u2,lat:p2}=k(a3,c2);l2.push([E(u2,o3),E(p2,o3)])}return l2.push(l2[0]),{type:"Feature",geometry:{type:"Polygon",coordinates:[l2]},properties:{}}}({center:this.center,radiusKilometers:i2*e2,coordinatePrecision:this.coordinatePrecision})}else{if(this.projection!=="globe")throw new Error("Invalid projection");o2=_({center:this.center,radiusKilometers:i2,coordinatePrecision:this.coordinatePrecision})}if(this.validate&&!this.validate({type:"Feature",id:this.currentCircleId,geometry:o2.geometry,properties:{radiusKilometers:i2}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Provisional}).valid)return;this.store.updateGeometry([{id:this.currentCircleId,geometry:o2.geometry}]),this.store.updateProperty([{id:this.currentCircleId,property:"radiusKilometers",value:i2}])}}};__name(_X,"X");let X=_X;const Y=__name((t2,e2)=>{const{x:i2,y:o2}=t2,{x:s2,y:n2}=e2,r2=s2-i2,a2=n2-o2;return Math.sqrt(a2*a2+r2*r2)},"Y");function H(t2){if(!function(t3){const e3=t3.coordinates[0];let i2=0;for(let t4=0;t4<e3.length-1;t4++){const[o2,s2]=e3[t4],[n2,r2]=e3[t4+1];i2+=(n2-o2)*(r2+s2)}return i2<0}(t2))return{type:"Polygon",coordinates:[t2.coordinates[0].reverse()]}}__name(H,"H");const q={cancel:"Escape",finish:"Enter"},$={start:"crosshair",close:"pointer"},_Z=class _Z extends v{constructor(t2){super(t2,!0),this.mode="freehand",this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.minDistance=20,this.keyEvents=q,this.cursors=$,this.preventPointsNearClose=!0,this.autoClose=!1,this.autoCloseTimeout=500,this.hasLeftStartingPoint=!1,this.preventNewFeature=!1,this.updateOptions(t2)}updateOptions(e2){super.updateOptions(e2),e2!=null&&e2.minDistance&&(this.minDistance=e2.minDistance),(e2==null?void 0:e2.preventPointsNearClose)!==void 0&&(this.preventPointsNearClose=e2.preventPointsNearClose),(e2==null?void 0:e2.autoClose)!==void 0&&(this.autoClose=e2.autoClose),e2!=null&&e2.autoCloseTimeout&&(this.autoCloseTimeout=e2.autoCloseTimeout),(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents)),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors))}close(){if(this.currentId===void 0)return;if(this.currentId){const t3=H(this.store.getGeometryCopy(this.currentId));t3&&this.store.updateGeometry([{id:this.currentId,geometry:t3}]),this.store.updateProperty([{id:this.currentId,property:o,value:void 0}])}const t2=this.currentId;if(this.validate&&t2){const i2=this.store.getGeometryCopy(t2);if(!this.validate({type:"Feature",id:t2,geometry:i2,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Finish}).valid)return}this.closingPointId&&this.store.delete([this.closingPointId]),this.startingClick=!1,this.currentId=void 0,this.closingPointId=void 0,this.hasLeftStartingPoint=!1,this.state==="drawing"&&this.setStarted(),this.onFinish(t2,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(t2){if(this.currentId===void 0||this.startingClick===!1)return;const i2=this.store.getGeometryCopy(this.currentId),o2=i2.coordinates[0].length-2,[s2,n2]=i2.coordinates[0][o2],{x:r2,y:a2}=this.project(s2,n2),d2=Y({x:r2,y:a2},{x:t2.containerX,y:t2.containerY}),[h2,l2]=i2.coordinates[0][0],{x:c2,y:u2}=this.project(h2,l2);if(Y({x:c2,y:u2},{x:t2.containerX,y:t2.containerY})<this.pointerDistance){if(this.autoClose&&this.hasLeftStartingPoint&&(this.preventNewFeature=!0,setTimeout(()=>{this.preventNewFeature=!1},this.autoCloseTimeout),this.close()),this.setCursor(this.cursors.close),this.preventPointsNearClose)return}else this.hasLeftStartingPoint=!0,this.setCursor(this.cursors.start);if(d2<this.minDistance)return;i2.coordinates[0].pop();const p2={type:"Polygon",coordinates:[[...i2.coordinates[0],[t2.lng,t2.lat],i2.coordinates[0][0]]]};this.validate&&!this.validate({type:"Feature",id:this.currentId,geometry:p2,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Provisional}).valid||this.store.updateGeometry([{id:this.currentId,geometry:p2}])}onClick(t2){if(t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2)){if(this.preventNewFeature)return;if(this.startingClick===!1){const[e2,i2]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat]]]},properties:{mode:this.mode,[o]:!0}},{geometry:{type:"Point",coordinates:[t2.lng,t2.lat]},properties:{mode:this.mode,[n]:!0}}]);return this.currentId=e2,this.closingPointId=i2,this.startingClick=!0,void this.setDrawing()}this.close()}}onKeyDown(){}onKeyUp(t2){t2.key===this.keyEvents.cancel?this.cleanUp():t2.key===this.keyEvents.finish&&this.startingClick===!0&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const t2=this.currentId,e2=this.closingPointId;this.closingPointId=void 0,this.currentId=void 0,this.startingClick=!1,this.state==="drawing"&&this.setStarted();try{t2!==void 0&&this.store.delete([t2]),e2!==void 0&&this.store.delete([e2])}catch(t3){}}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e2.type==="Feature"&&e2.geometry.type==="Polygon"&&e2.properties.mode===this.mode?(i2.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,i2.polygonFillColor,e2),i2.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,i2.polygonOutlineColor,e2),i2.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,i2.polygonOutlineWidth,e2),i2.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,i2.polygonFillOpacity,e2),i2.zIndex=l,i2):(e2.type==="Feature"&&e2.geometry.type==="Point"&&e2.properties.mode===this.mode&&(i2.pointWidth=this.getNumericStylingValue(this.styles.closingPointWidth,i2.pointWidth,e2),i2.pointColor=this.getHexColorStylingValue(this.styles.closingPointColor,i2.pointColor,e2),i2.pointOutlineColor=this.getHexColorStylingValue(this.styles.closingPointOutlineColor,i2.pointOutlineColor,e2),i2.pointOutlineWidth=this.getNumericStylingValue(this.styles.closingPointOutlineWidth,2,e2),i2.zIndex=50),i2)}validateFeature(t2){return this.validateModeFeature(t2,t3=>A(t3,this.coordinatePrecision))}};__name(_Z,"Z");let Z=_Z;const _J=class _J{constructor({store:t2,mode:e2,project:i2,unproject:o2,pointerDistance:s2,coordinatePrecision:n2,projection:r2}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=t2,this.mode=e2,this.project=i2,this.unproject=o2,this.pointerDistance=s2,this.coordinatePrecision=n2,this.projection=r2}};__name(_J,"J");let J=_J;function Q({unproject:t2,point:e2,pointerDistance:i2}){const o2=i2/2,{x:s2,y:n2}=e2;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[t2(s2-o2,n2-o2),t2(s2+o2,n2-o2),t2(s2+o2,n2+o2),t2(s2-o2,n2+o2),t2(s2-o2,n2-o2)].map(t3=>[t3.lng,t3.lat])]}}}__name(Q,"Q");const _tt=class _tt extends J{constructor(t2){super(t2)}create(t2){const{containerX:e2,containerY:i2}=t2;return Q({unproject:this.unproject,point:{x:e2,y:i2},pointerDistance:this.pointerDistance})}};__name(_tt,"tt");let tt=_tt;const _et=class _et extends J{constructor(t2){super(t2)}measure(t2,e2){const{x:i2,y:o2}=this.project(e2[0],e2[1]);return Y({x:i2,y:o2},{x:t2.containerX,y:t2.containerY})}};__name(_et,"et");let et=_et;const _it=class _it extends J{constructor(t2,e2,i2){super(t2),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=t3=>this.getSnappable(t3,t4=>!!(t4.properties&&t4.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(t3,e3)=>this.getSnappable(t3,t4=>!!(t4.properties&&t4.properties.mode===this.mode&&t4.id!==e3)).coordinate,this.config=t2,this.pixelDistance=e2,this.clickBoundingBox=i2}getSnappable(t2,e2){const i2=this.clickBoundingBox.create(t2),o2=this.store.search(i2,e2),s2={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return o2.forEach(e3=>{let i3;if(e3.geometry.type==="Polygon")i3=e3.geometry.coordinates[0];else{if(e3.geometry.type!=="LineString")return;i3=e3.geometry.coordinates}i3.forEach((i4,o3)=>{const n2=this.pixelDistance.measure(t2,i4);n2<s2.minDist&&n2<this.pointerDistance&&(s2.coordinate=i4,s2.minDist=n2,s2.featureId=e3.id,s2.featureCoordinateIndex=o3)})}),s2}};__name(_it,"it");let it=_it;function ot(t2,e2,i2){const o2=x(t2[0]),s2=x(t2[1]),n2=x(i2),r2=M(e2),a2=Math.asin(Math.sin(s2)*Math.cos(r2)+Math.cos(s2)*Math.sin(r2)*Math.cos(n2));return[S(o2+Math.atan2(Math.sin(n2)*Math.sin(r2)*Math.cos(s2),Math.cos(r2)-Math.sin(s2)*Math.sin(a2))),S(a2)]}__name(ot,"ot");function nt(t2,e2){const i2=x(t2[0]),o2=x(e2[0]),s2=x(t2[1]),n2=x(e2[1]),r2=Math.sin(o2-i2)*Math.cos(n2),a2=Math.cos(s2)*Math.sin(n2)-Math.sin(s2)*Math.cos(n2)*Math.cos(o2-i2);return S(Math.atan2(r2,a2))}__name(nt,"nt");function rt({x:t2,y:e2},{x:i2,y:o2}){const s2=i2-t2,n2=o2-e2;if(s2===0&&n2===0)return 0;let r2=Math.atan2(n2,s2);return r2*=180/Math.PI,r2>180?r2-=360:r2<-180&&(r2+=360),r2}__name(rt,"rt");function dt(t2,e2,i2){const o2=[],s2=t2.length;let n2,r2,a2,d2=0;for(let s3=0;s3<t2.length&&!(e2>=d2&&s3===t2.length-1);s3++){if(d2>e2&&o2.length===0){if(n2=e2-d2,!n2)return o2.push(t2[s3]),o2;r2=nt(t2[s3],t2[s3-1])-180,a2=ot(t2[s3],n2,r2),o2.push(a2)}if(d2>=i2)return n2=i2-d2,n2?(r2=nt(t2[s3],t2[s3-1])-180,a2=ot(t2[s3],n2,r2),o2.push(a2),o2):(o2.push(t2[s3]),o2);if(d2>=e2&&o2.push(t2[s3]),s3===t2.length-1)return o2;d2+=P(t2[s3],t2[s3+1])}if(d2<e2&&t2.length===s2)throw new Error("Start position is beyond line");const h2=t2[t2.length-1];return[h2,h2]}__name(dt,"dt");function ht(t2){return t2*(Math.PI/180)}__name(ht,"ht");function lt(t2){return t2*(180/Math.PI)}__name(lt,"lt");const _ct=class _ct extends J{constructor(t2){super(t2),this.config=void 0,this.config=t2}generateInsertionCoordinates(t2,e2,i2){const o2=[t2,e2];let s2=0;for(let t3=0;t3<o2.length-1;t3++)s2+=P(o2[0],o2[1]);if(s2<=i2)return o2;let n2=s2/i2-1;Number.isInteger(n2)||(n2=Math.floor(n2)+1);const r2=[];for(let t3=0;t3<n2;t3++){const e3=dt(o2,i2*t3,i2*(t3+1));r2.push(e3)}const a2=[];for(let t3=0;t3<r2.length;t3++)a2.push(r2[t3][1]);return this.limitCoordinates(a2)}generateInsertionGeodesicCoordinates(t2,e2,i2){const o2=P(t2,e2),s2=function(t3,e3,i3){const o3=[],s3=ht(t3[1]),n2=ht(t3[0]),r2=ht(e3[1]),a2=ht(e3[0]);i3+=1;const d2=2*Math.asin(Math.sqrt(Math.sin((r2-s3)/2)**2+Math.cos(s3)*Math.cos(r2)*Math.sin((a2-n2)/2)**2));if(d2===0||isNaN(d2))return o3;for(let t4=0;t4<=i3;t4++){const e4=t4/i3,h2=Math.sin((1-e4)*d2)/Math.sin(d2),l2=Math.sin(e4*d2)/Math.sin(d2),c2=h2*Math.cos(s3)*Math.cos(n2)+l2*Math.cos(r2)*Math.cos(a2),u2=h2*Math.cos(s3)*Math.sin(n2)+l2*Math.cos(r2)*Math.sin(a2),p2=h2*Math.sin(s3)+l2*Math.sin(r2);if(isNaN(c2)||isNaN(u2)||isNaN(p2))continue;const g=Math.atan2(p2,Math.sqrt(c2**2+u2**2)),y2=Math.atan2(u2,c2);isNaN(g)||isNaN(y2)||o3.push([lt(y2),lt(g)])}return o3.slice(1,-1)}(t2,e2,Math.floor(o2/i2));return this.limitCoordinates(s2)}limitCoordinates(t2){return t2.map(t3=>[E(t3[0],this.config.coordinatePrecision),E(t3[1],this.config.coordinatePrecision)])}};__name(_ct,"ct");let ct=_ct;function ut(t2,e2){return t2[0]===e2[0]&&t2[1]===e2[1]}__name(ut,"ut");function pt(t2,e2){if(t2.geometry.type!=="LineString")return{valid:!1,reason:"Feature is not a LineString"};if(t2.geometry.coordinates.length<2)return{valid:!1,reason:"Feature has less than 2 coordinates"};for(let i2=0;i2<t2.geometry.coordinates.length;i2++){if(!G(t2.geometry.coordinates[i2]))return{valid:!1,reason:"Feature has invalid coordinates"};if(!B(t2.geometry.coordinates[i2],e2))return{valid:!1,reason:"Feature has coordinates with excessive precision"}}return{valid:!0}}__name(pt,"pt");function gt(t2){return Math.sqrt(Math.pow(t2[0],2)+Math.pow(t2[1],2)+Math.pow(t2[2],2))}__name(gt,"gt");function yt(t2,e2){const i2=function(t3,e3){const[i3,o2,s2]=t3,[n2,r2,a2]=e3;return i3*n2+o2*r2+s2*a2}(t2,e2)/(gt(t2)*gt(e2));return Math.acos(Math.min(Math.max(i2,-1),1))}__name(yt,"yt");function ft(t2){const e2=x(t2[1]),i2=x(t2[0]);return[Math.cos(e2)*Math.cos(i2),Math.cos(e2)*Math.sin(i2),Math.sin(e2)]}__name(ft,"ft");function mt(t2){const[e2,i2,o2]=t2,s2=S(Math.asin(o2));return[S(Math.atan2(i2,e2)),s2]}__name(mt,"mt");function vt(t2,e2,i2){const o2=ft(t2),s2=ft(e2),n2=ft(i2),[r2,a2,d2]=n2,[h2,l2,c2]=function(t3,e3){const[i3,o3,s3]=t3,[n3,r3,a3]=e3;return[o3*a3-s3*r3,s3*n3-i3*a3,i3*r3-o3*n3]}(o2,s2),u2=l2*d2-c2*a2,p2=c2*r2-h2*d2,g=h2*a2-l2*r2,y2=g*l2-p2*c2,f2=u2*c2-g*h2,m2=p2*h2-u2*l2,v2=1/Math.sqrt(Math.pow(y2,2)+Math.pow(f2,2)+Math.pow(m2,2)),C2=[y2*v2,f2*v2,m2*v2],I2=[-1*y2*v2,-1*f2*v2,-1*m2*v2],x2=yt(o2,s2),M2=yt(o2,C2),S2=yt(s2,C2),E2=yt(o2,I2),F2=yt(s2,I2);let w2;return w2=M2<E2&&M2<F2||S2<E2&&S2<F2?C2:I2,yt(o2,w2)>x2||yt(s2,w2)>x2?P(mt(w2),mt(o2))<=P(mt(w2),mt(s2))?[mt(o2),!0,!1]:[mt(s2),!1,!0]:[mt(w2),!1,!1]}__name(vt,"vt");function Ct(t2,e2,i2){const o2=e2.x-t2.x,s2=e2.y-t2.y,n2=Math.max(0,Math.min(1,((i2.x-t2.x)*o2+(i2.y-t2.y)*s2)/(o2*o2+s2*s2)));return{x:t2.x+n2*o2,y:t2.y+n2*s2}}__name(Ct,"Ct");const _Pt=class _Pt extends J{constructor(t2,e2,i2){super(t2),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=t3=>{const e3=this.getSnappable(t3,t4=>!!(t4.properties&&t4.properties.mode===this.mode));return e3.coordinate?[E(e3.coordinate[0],this.config.coordinatePrecision),E(e3.coordinate[1],this.config.coordinatePrecision)]:void 0},this.getSnappableCoordinate=(t3,e3)=>{const i3=this.getSnappable(t3,t4=>!!(t4.properties&&t4.properties.mode===this.mode&&t4.id!==e3));return i3.coordinate?[E(i3.coordinate[0],this.config.coordinatePrecision),E(i3.coordinate[1],this.config.coordinatePrecision)]:void 0},this.config=t2,this.pixelDistance=e2,this.clickBoundingBox=i2}getSnappable(t2,e2){const i2=this.clickBoundingBox.create(t2),o2=this.store.search(i2,e2),s2={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDistance:1/0};return o2.forEach(e3=>{let i3;if(e3.geometry.type==="Polygon")i3=e3.geometry.coordinates[0];else{if(e3.geometry.type!=="LineString")return;i3=e3.geometry.coordinates}const o3=[];for(let t3=0;t3<i3.length-1;t3++)o3.push([i3[t3],i3[t3+1]]);let n2;const r2=[t2.lng,t2.lat];if(this.config.projection==="web-mercator"?n2=function(t3,e4){let i4=[1/0,1/0],o4=1/0,s3=0;for(let n3 of e4){const r3=n3[0],a3=n3[1];let d2,h2=1/0;const l2=b(r3[0],r3[1]),c2=b(a3[0],a3[1]),u2=b(t3[0],t3[1]);if(r3[0]===t3[0]&&r3[1]===t3[1])d2=r3;else if(a3[0]===t3[0]&&a3[1]===t3[1])d2=a3;else{const{x:t4,y:e5}=Ct(l2,c2,u2),{lng:i5,lat:o5}=k(t4,e5);d2=[i5,o5]}d2&&(h2=Y(u2,b(d2[0],d2[1])),h2<o4&&(i4=d2,o4=h2,s3=e4.indexOf(n3)))}return o4===1/0?void 0:{coordinate:i4,lineIndex:s3,distance:o4}}(r2,o3):this.config.projection==="globe"&&(n2=function(t3,e4){let i4=[1/0,1/0],o4=1/0,s3=0;for(let n3 of e4){const r3=n3[0],a3=n3[1];let d2,h2=1/0;r3[0]===t3[0]&&r3[1]===t3[1]?d2=r3:a3[0]===t3[0]&&a3[1]===t3[1]?d2=a3:[d2]=vt(r3,a3,t3),d2&&(h2=P(t3,d2),h2<o4&&(i4=d2,o4=h2,s3=e4.indexOf(n3)))}return o4===1/0?void 0:{coordinate:i4,distance:o4,lineIndex:s3}}(r2,o3)),!n2)return;const a2=this.pixelDistance.measure(t2,n2.coordinate);a2<s2.minDistance&&a2<this.pointerDistance&&(s2.featureId=e3.id,s2.coordinate=[E(n2.coordinate[0],this.config.coordinatePrecision),E(n2.coordinate[1],this.config.coordinatePrecision)],s2.featureCoordinateIndex=n2.lineIndex,s2.minDistance=a2)}),s2}};__name(_Pt,"Pt");let Pt=_Pt;const It={cancel:"Escape",finish:"Enter"},xt={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"},_Mt=class _Mt extends v{constructor(t2){super(t2,!0),this.mode="linestring",this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.keyEvents=It,this.snapping=void 0,this.cursors=xt,this.mouseMove=!1,this.insertCoordinates=void 0,this.lastCommitedCoordinates=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinateSnapping=void 0,this.insertPoint=void 0,this.lineSnapping=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(t2)}updateOptions(e2){super.updateOptions(e2),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors)),e2!=null&&e2.snapping&&(this.snapping=e2.snapping),(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents)),e2!=null&&e2.insertCoordinates&&(this.insertCoordinates=e2.insertCoordinates),e2&&e2.editable&&(this.editable=e2.editable)}close(){if(this.currentId===void 0)return;const t2=this.store.getGeometryCopy(this.currentId);t2.coordinates.pop(),this.updateGeometries([...t2.coordinates],void 0,e.Commit),this.store.updateProperty([{id:this.currentId,property:o,value:void 0}]);const i2=this.currentId;this.closingPointId&&this.store.delete([this.closingPointId]),this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.closingPointId=void 0,this.snappedPointId=void 0,this.lastCommitedCoordinates=void 0,this.state==="drawing"&&this.setStarted(),this.onFinish(i2,{mode:this.mode,action:"draw"})}updateGeometries(t2,e2,i2){if(!this.currentId)return;const o2={type:"LineString",coordinates:t2};if(this.validate&&!this.validate({type:"Feature",geometry:o2},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:i2}).valid)return;const s2=[{id:this.currentId,geometry:o2}];this.closingPointId&&e2&&s2.push({id:this.closingPointId,geometry:{type:"Point",coordinates:e2}}),i2==="commit"&&(this.lastCommitedCoordinates=o2.coordinates),this.store.updateGeometry(s2)}generateInsertCoordinates(t2,e2){if(!this.insertCoordinates||!this.lastCommitedCoordinates)throw new Error("Not able to insert coordinates");if(this.insertCoordinates.strategy!=="amount")throw new Error("Strategy does not exist");const i2=P(t2,e2)/(this.insertCoordinates.value+1);let o2=[];return this.projection==="globe"?o2=this.insertPoint.generateInsertionGeodesicCoordinates(t2,e2,i2):this.projection==="web-mercator"&&(o2=this.insertPoint.generateInsertionCoordinates(t2,e2,i2)),o2}createLine(t2){const[e2]=this.store.create([{geometry:{type:"LineString",coordinates:[t2,t2]},properties:{mode:this.mode,[o]:!0}}]);this.lastCommitedCoordinates=[t2,t2],this.currentId=e2,this.currentCoordinate++,this.setDrawing()}firstUpdateToLine(t2){if(!this.currentId)return;const i2=this.store.getGeometryCopy(this.currentId).coordinates,[o2]=this.store.create([{geometry:{type:"Point",coordinates:[...t2]},properties:{mode:this.mode}}]);this.closingPointId=o2,this.setCursor(this.cursors.close);const s2=[...i2,t2];this.updateGeometries(s2,void 0,e.Commit),this.currentCoordinate++}updateToLine(t2,i2){if(!this.currentId)return;const o2=this.store.getGeometryCopy(this.currentId).coordinates,[s2,n2]=this.lastCommitedCoordinates?this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1]:o2[o2.length-2],{x:r2,y:a2}=this.project(s2,n2);if(Y({x:r2,y:a2},{x:i2.x,y:i2.y})<this.pointerDistance)return void this.close();this.setCursor(this.cursors.close);const d2=[...o2,t2];this.updateGeometries(d2,o2[o2.length-1],e.Commit),this.currentCoordinate++}registerBehaviors(t2){this.coordinateSnapping=new it(t2,new et(t2),new tt(t2)),this.insertPoint=new ct(t2),this.clickBoundingBox=new tt(t2),this.pixelDistance=new et(t2),this.lineSnapping=new Pt(t2,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new it(t2,this.pixelDistance,this.clickBoundingBox)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(t2){this.mouseMove=!0,this.setCursor(this.cursors.start);const i2=this.snapCoordinate(t2);if(i2){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:i2}}]);else{const[t3]=this.store.create([{geometry:{type:"Point",coordinates:i2},properties:{mode:this.mode,[r]:!0}}]);this.snappedPointId=t3}t2.lng=i2[0],t2.lat=i2[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const o2=i2||[t2.lng,t2.lat];if(this.currentId===void 0||this.currentCoordinate===0)return;const s2=this.store.getGeometryCopy(this.currentId).coordinates;if(s2.pop(),this.closingPointId){const[e2,i3]=s2[s2.length-1],{x:o3,y:n3}=this.project(e2,i3);Y({x:o3,y:n3},{x:t2.containerX,y:t2.containerY})<this.pointerDistance&&this.setCursor(this.cursors.close)}let n2=[...s2,o2];if(this.insertCoordinates&&this.currentId&&this.lastCommitedCoordinates){const t3=this.lastCommitedCoordinates[this.lastCommitedCoordinates.length-1],e2=o2;if(!ut(t3,e2)){const i3=this.generateInsertCoordinates(t3,e2);n2=[...this.lastCommitedCoordinates.slice(0,-1),...i3,o2]}}this.updateGeometries(n2,void 0,e.Provisional)}onRightClick(t2){if(!this.editable||this.state!=="started")return;const{featureId:i2,featureCoordinateIndex:o2}=this.coordinateSnapping.getSnappable(t2,t3=>this.lineStringFilter(t3));if(!i2||o2===void 0)return;const s2=this.store.getGeometryCopy(i2);let n2;if(s2.type==="LineString"&&(n2=s2.coordinates,!(n2.length<=2))){if(n2.splice(o2,1),this.validate&&!this.validate({id:i2,type:"Feature",geometry:s2,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Commit}).valid)return;this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:i2,geometry:s2}]),this.onFinish(i2,{mode:this.mode,action:"edit"})}}onLeftClick(t2){this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);const e2=this.snapCoordinate(t2)||[t2.lng,t2.lat];this.currentCoordinate===0?this.createLine(e2):this.currentCoordinate===1&&this.currentId?this.firstUpdateToLine(e2):this.currentId&&this.updateToLine(e2,{x:t2.containerX,y:t2.containerY})}onClick(t2){(t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2))&&(this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(t2),this.mouseMove=!1,t2.button==="right"?this.onRightClick(t2):t2.button==="left"&&this.onLeftClick(t2))}onKeyDown(){}onKeyUp(t2){t2.key===this.keyEvents.cancel&&this.cleanUp(),t2.key===this.keyEvents.finish&&this.close()}onDragStart(t2,e2){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,t2)||!this.editable)return;let i2;if(this.state==="started"){const e3=this.lineSnapping.getSnappable(t2,t3=>this.lineStringFilter(t3));e3.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=e3.featureCoordinateIndex,this.editedFeatureId=e3.featureId,i2=e3.coordinate);const o2=this.coordinateSnapping.getSnappable(t2,t3=>this.lineStringFilter(t3));o2.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o2.featureCoordinateIndex,this.editedFeatureId=o2.featureId,i2=o2.coordinate)}if(this.editedFeatureId&&i2){if(!this.editedPointId){const[t3]=this.store.create([{geometry:{type:"Point",coordinates:i2},properties:{mode:this.mode,[s]:!0}}]);this.editedPointId=t3}this.setCursor(this.cursors.dragStart),e2(!1)}}onDrag(t2,i2){if(!this.allowPointerEvent(this.pointerEvents.onDrag,t2)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o2=this.store.getGeometryCopy(this.editedFeatureId);this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?o2.coordinates[this.editedFeatureCoordinateIndex]=[t2.lng,t2.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o2.coordinates.splice(this.editedInsertIndex,0,[t2.lng,t2.lat]),this.editedFeatureCoordinateIndex++);const n2={type:"LineString",coordinates:o2.coordinates};this.validate&&!this.validate({type:"Feature",geometry:n2,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:n2}]),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[t2.lng,t2.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!0}]))}onDragEnd(t2,e2){this.allowPointerEvent(this.pointerEvents.onDragEnd,t2)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,e2(!0))}cleanUp(){const t2=this.currentId,e2=this.closingPointId,i2=this.snappedPointId;this.closingPointId=void 0,this.snappedPointId=void 0,this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{t2!==void 0&&this.store.delete([t2]),i2!==void 0&&this.store.delete([i2]),e2!==void 0&&this.store.delete([e2])}catch(t3){}}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e2.type==="Feature"&&e2.geometry.type==="LineString"&&e2.properties.mode===this.mode)return i2.lineStringColor=this.getHexColorStylingValue(this.styles.lineStringColor,i2.lineStringColor,e2),i2.lineStringWidth=this.getNumericStylingValue(this.styles.lineStringWidth,i2.lineStringWidth,e2),i2.zIndex=l,i2;if(e2.type==="Feature"&&e2.geometry.type==="Point"&&e2.properties.mode===this.mode){const t2=e2.properties[n];return i2.pointColor=this.getHexColorStylingValue(t2?this.styles.closingPointColor:this.styles.snappingPointColor,i2.pointColor,e2),i2.pointWidth=this.getNumericStylingValue(t2?this.styles.closingPointWidth:this.styles.snappingPointWidth,i2.pointWidth,e2),i2.pointOutlineColor=this.getHexColorStylingValue(t2?this.styles.closingPointOutlineColor:this.styles.snappingPointOutlineColor,"#ffffff",e2),i2.pointOutlineWidth=this.getNumericStylingValue(t2?this.styles.closingPointOutlineWidth:this.styles.snappingPointOutlineWidth,2,e2),i2.zIndex=50,i2}return i2}validateFeature(t2){return this.validateModeFeature(t2,t3=>pt(t3,this.coordinatePrecision))}lineStringFilter(t2){return!!(t2.geometry.type==="LineString"&&t2.properties&&t2.properties.mode===this.mode)}snapCoordinate(t2){var e2,i2,o2;let s2;if((e2=this.snapping)!=null&&e2.toLine){let e3;e3=this.currentId?this.lineSnapping.getSnappableCoordinate(t2,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(t2),e3&&(s2=e3)}return(i2=this.snapping)!=null&&i2.toCoordinate&&(s2=this.currentId?this.coordinateSnapping.getSnappableCoordinate(t2,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(t2)),(o2=this.snapping)!=null&&o2.toCustom&&(s2=this.snapping.toCustom(t2,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),s2}};__name(_Mt,"Mt");let Mt=_Mt;const St="Feature is not a Point",Et="Feature has invalid coordinates",Ft="Feature has coordinates with excessive precision";function wt(t2,e2){return t2.geometry.type!=="Point"?{valid:!1,reason:St}:G(t2.geometry.coordinates)?B(t2.geometry.coordinates,e2)?{valid:!0}:{valid:!1,reason:Ft}:{valid:!1,reason:Et}}__name(wt,"wt");const Dt={create:"crosshair",dragStart:"grabbing",dragEnd:"crosshair"},_bt=class _bt extends v{constructor(t2){super(t2,!0),this.mode="point",this.cursors=Dt,this.editable=!1,this.editedFeatureId=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.updateOptions(t2)}updateOptions(e2){super.updateOptions(e2),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors)),e2!=null&&e2.editable&&(this.editable=e2.editable)}start(){this.setStarted(),this.setCursor(this.cursors.create)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(t2){t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2)?this.onRightClick(t2):t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)&&this.onLeftClick(t2)}onMouseMove(){}onKeyDown(){}onKeyUp(){}cleanUp(){this.editedFeatureId=void 0}onDragStart(t2,e2){if(this.allowPointerEvent(this.pointerEvents.onDragStart,t2)){if(this.editable){const e3=this.getNearestPointFeature(t2);this.editedFeatureId=e3==null?void 0:e3.id}this.editedFeatureId&&(this.setCursor(this.cursors.dragStart),e2(!1))}}onDrag(t2,i2){this.allowPointerEvent(this.pointerEvents.onDrag,t2)&&this.editedFeatureId!==void 0&&(this.validate&&!this.validate({type:"Feature",geometry:{type:"Point",coordinates:[t2.lng,t2.lat]},properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Finish}).valid||(this.store.updateGeometry([{id:this.editedFeatureId,geometry:{type:"Point",coordinates:[t2.lng,t2.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!0}])))}onDragEnd(t2,e2){this.allowPointerEvent(this.pointerEvents.onDragEnd,t2)&&this.editedFeatureId!==void 0&&(this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.setCursor(this.cursors.dragEnd),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!1}]),this.editedFeatureId=void 0,e2(!0))}registerBehaviors(t2){this.pixelDistance=new et(t2),this.clickBoundingBox=new tt(t2)}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e2.type==="Feature"&&e2.geometry.type==="Point"&&e2.properties.mode===this.mode){const t2=!!(e2.id&&this.editedFeatureId===e2.id);i2.pointWidth=this.getNumericStylingValue(t2?this.styles.editedPointWidth:this.styles.pointWidth,i2.pointWidth,e2),i2.pointColor=this.getHexColorStylingValue(t2?this.styles.editedPointColor:this.styles.pointColor,i2.pointColor,e2),i2.pointOutlineColor=this.getHexColorStylingValue(t2?this.styles.editedPointOutlineColor:this.styles.pointOutlineColor,i2.pointOutlineColor,e2),i2.pointOutlineWidth=this.getNumericStylingValue(t2?this.styles.editedPointOutlineWidth:this.styles.pointOutlineWidth,2,e2),i2.zIndex=30}return i2}validateFeature(t2){return this.validateModeFeature(t2,t3=>wt(t3,this.coordinatePrecision))}onLeftClick(t2){const i2={type:"Point",coordinates:[t2.lng,t2.lat]},o2={mode:this.mode};if(this.validate&&!this.validate({type:"Feature",geometry:i2,properties:o2},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Finish}).valid)return;const[s2]=this.store.create([{geometry:i2,properties:o2}]);this.onFinish(s2,{mode:this.mode,action:"draw"})}onRightClick(t2){if(!this.editable)return;const e2=this.getNearestPointFeature(t2);e2&&this.store.delete([e2.id])}getNearestPointFeature(t2){const e2=this.clickBoundingBox.create(t2),i2=this.store.search(e2);let o2,s2=1/0;for(let e3=0;e3<i2.length;e3++){const n2=i2[e3];if(n2.geometry.type!=="Point"||n2.properties.mode!==this.mode)continue;const r2=this.pixelDistance.measure(t2,n2.geometry.coordinates);r2>s2||r2>this.pointerDistance||(s2=r2,o2=n2)}return o2}};__name(_bt,"bt");let bt=_bt;const _kt=class _kt extends J{constructor(t2,e2){super(t2),this.config=void 0,this.pixelDistance=void 0,this._startEndPoints=[],this.config=t2,this.pixelDistance=e2}get ids(){return this._startEndPoints.concat()}set ids(t2){}create(t2,e2){if(this.ids.length)throw new Error("Opening and closing points already created");if(t2.length<=3)throw new Error("Requires at least 4 coordinates");this._startEndPoints=this.store.create([{geometry:{type:"Point",coordinates:t2[0]},properties:{mode:e2,[n]:!0}},{geometry:{type:"Point",coordinates:t2[t2.length-2]},properties:{mode:e2,[n]:!0}}])}delete(){this.ids.length&&(this.store.delete(this.ids),this._startEndPoints=[])}update(t2){if(this.ids.length!==2)throw new Error("No closing points to update");this.store.updateGeometry([{id:this.ids[0],geometry:{type:"Point",coordinates:t2[0]}},{id:this.ids[1],geometry:{type:"Point",coordinates:t2[t2.length-3]}}])}isClosingPoint(t2){const e2=this.store.getGeometryCopy(this.ids[0]),i2=this.store.getGeometryCopy(this.ids[1]),o2=this.pixelDistance.measure(t2,e2.coordinates),s2=this.pixelDistance.measure(t2,i2.coordinates);return{isClosing:o2<this.pointerDistance,isPreviousClosing:s2<this.pointerDistance}}};__name(_kt,"kt");let kt=_kt;const _Ot=class _Ot extends J{constructor(t2){super(t2)}createOrUpdate(t2){const e2=this.store.getGeometryCopy(t2),i2=this.store.getPropertiesCopy(t2);let o2;if(e2.type==="Polygon")o2=e2.coordinates[0].slice(0,-1);else{if(e2.type!=="LineString")return;o2=e2.coordinates}const s2=this.store.getPropertiesCopy(t2),n2=s2.coordinatePointIds;if(n2)if(n2&&n2.every(t3=>this.store.has(t3))){const e3=s2.coordinatePointIds,n3=e3.map(t3=>this.store.getGeometryCopy(t3).coordinates);if(e3.length!==o2.length){this.deleteCoordinatePoints(e3);const s3=this.createPoints(o2,i2.mode,t2);this.setFeatureCoordinatePoints(t2,s3)}else o2.forEach((t3,i3)=>{t3[0]===n3[i3][0]&&t3[1]===n3[i3][1]||this.store.updateGeometry([{id:e3[i3],geometry:{type:"Point",coordinates:t3}}])})}else{const e3=n2.filter(t3=>this.store.has(t3));e3.length&&this.deleteCoordinatePoints(e3);const s3=this.createPoints(o2,i2.mode,t2);this.setFeatureCoordinatePoints(t2,s3)}else{const e3=this.createPoints(o2,i2.mode,t2);this.setFeatureCoordinatePoints(t2,e3)}}deletePointsByFeatureIds(t2){for(const e2 of t2)this.deleteIfPresent(e2)}getUpdated(e2,i2){const o2=this.store.getPropertiesCopy(e2);if(o2.coordinatePointIds)return o2.coordinatePointIds.map((e3,o3)=>({id:e3,geometry:t$1({},this.store.getGeometryCopy(e3),{coordinates:i2[o3]})}))}createPoints(t2,e2,i2){return this.store.create(t2.map((t3,o2)=>({geometry:{type:"Point",coordinates:t3},properties:{mode:e2,[a]:!0,[d]:i2,index:o2}})))}setFeatureCoordinatePoints(t2,e2){this.store.updateProperty([{id:t2,property:h,value:e2}])}deleteCoordinatePoints(t2){const e2=t2.filter(t3=>this.store.has(t3));this.store.delete(e2)}deleteIfPresent(t2){const e2=this.store.getPropertiesCopy(t2).coordinatePointIds;e2&&(this.deleteCoordinatePoints(e2),this.setFeatureCoordinatePoints(t2,null))}};__name(_Ot,"Ot");let Ot=_Ot;const _t={cancel:"Escape",finish:"Enter"},jt={start:"crosshair",close:"pointer",dragStart:"grabbing",dragEnd:"crosshair"},_Wt=class _Wt extends v{constructor(t2){super(t2,!0),this.mode="polygon",this.currentCoordinate=0,this.currentId=void 0,this.keyEvents=_t,this.cursors=jt,this.mouseMove=!1,this.showCoordinatePoints=!1,this.snapping=void 0,this.snappedPointId=void 0,this.editable=!1,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedSnapType=void 0,this.editedInsertIndex=void 0,this.editedPointId=void 0,this.coordinatePoints=void 0,this.lineSnapping=void 0,this.coordinateSnapping=void 0,this.pixelDistance=void 0,this.closingPoints=void 0,this.clickBoundingBox=void 0,this.updateOptions(t2)}updateOptions(e2){if(super.updateOptions(e2),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors)),(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents)),e2!=null&&e2.snapping&&(this.snapping=e2.snapping),(e2==null?void 0:e2.editable)!==void 0&&(this.editable=e2.editable),(e2==null?void 0:e2.pointerEvents)!==void 0&&(this.pointerEvents=e2.pointerEvents),(e2==null?void 0:e2.showCoordinatePoints)!==void 0){if(this.showCoordinatePoints=e2.showCoordinatePoints,this.coordinatePoints&&e2.showCoordinatePoints===!0)this.store.copyAllWhere(t2=>t2.mode===this.mode).map(t2=>t2.id).forEach(t2=>{this.coordinatePoints.createOrUpdate(t2)});else if(this.coordinatePoints&&this.showCoordinatePoints===!1){const t2=this.store.copyAllWhere(t3=>t3.mode===this.mode&&!!t3[h]);this.coordinatePoints.deletePointsByFeatureIds(t2.map(t3=>t3.id))}}}close(){if(this.currentId===void 0)return;const t2=this.store.getGeometryCopy(this.currentId).coordinates[0];if(t2.length<5||!this.updatePolygonGeometry([...t2.slice(0,-2),t2[0]],e.Finish))return;const i2=this.currentId;if(this.currentId){const t3=H(this.store.getGeometryCopy(this.currentId));t3&&this.store.updateGeometry([{id:this.currentId,geometry:t3}]),this.store.updateProperty([{id:this.currentId,property:o,value:void 0}])}this.snappedPointId&&this.store.delete([this.snappedPointId]),this.currentCoordinate=0,this.currentId=void 0,this.snappedPointId=void 0,this.closingPoints.delete(),this.state==="drawing"&&this.setStarted(),this.onFinish(i2,{mode:this.mode,action:"draw"})}registerBehaviors(t2){this.clickBoundingBox=new tt(t2),this.pixelDistance=new et(t2),this.lineSnapping=new Pt(t2,this.pixelDistance,this.clickBoundingBox),this.coordinateSnapping=new it(t2,this.pixelDistance,this.clickBoundingBox),this.closingPoints=new kt(t2,this.pixelDistance),this.coordinatePoints=new Ot(t2)}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(t2){this.mouseMove=!0,this.setCursor(this.cursors.start);const i2=this.snapCoordinate(t2);if(i2){if(this.snappedPointId)this.store.updateGeometry([{id:this.snappedPointId,geometry:{type:"Point",coordinates:i2}}]);else{const[t3]=this.store.create([{geometry:{type:"Point",coordinates:i2},properties:{mode:this.mode,[r]:!0}}]);this.snappedPointId=t3}t2.lng=i2[0],t2.lat=i2[1]}else this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0);if(this.currentId===void 0||this.currentCoordinate===0)return;const o2=this.store.getGeometryCopy(this.currentId).coordinates[0];let s2;if(this.currentCoordinate===1){const e2=1/Math.pow(10,this.coordinatePrecision-1),i3=Math.max(1e-6,e2);s2=[o2[0],[t2.lng,t2.lat],[t2.lng,t2.lat-i3],o2[0]]}else if(this.currentCoordinate===2)s2=[o2[0],o2[1],[t2.lng,t2.lat],o2[0]];else{const{isClosing:e2,isPreviousClosing:i3}=this.closingPoints.isClosingPoint(t2);i3||e2?(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.setCursor(this.cursors.close),s2=[...o2.slice(0,-2),o2[0],o2[0]]):s2=[...o2.slice(0,-2),[t2.lng,t2.lat],o2[0]]}this.updatePolygonGeometry(s2,e.Provisional)}updatePolygonGeometry(t2,e2){if(!this.currentId)return!1;const i2={type:"Polygon",coordinates:[t2]};return!(this.validate&&!this.validate({type:"Feature",geometry:i2},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e2}).valid||(this.store.updateGeometry([{id:this.currentId,geometry:i2}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.currentId),0))}snapCoordinate(t2){var e2,i2,o2;let s2;if((e2=this.snapping)!=null&&e2.toLine){let e3;e3=this.currentId?this.lineSnapping.getSnappableCoordinate(t2,this.currentId):this.lineSnapping.getSnappableCoordinateFirstClick(t2),e3&&(s2=e3)}if((i2=this.snapping)!=null&&i2.toCoordinate){let e3;e3=this.currentId?this.coordinateSnapping.getSnappableCoordinate(t2,this.currentId):this.coordinateSnapping.getSnappableCoordinateFirstClick(t2),e3&&(s2=e3)}return(o2=this.snapping)!=null&&o2.toCustom&&(s2=this.snapping.toCustom(t2,{currentCoordinate:this.currentCoordinate,currentId:this.currentId,getCurrentGeometrySnapshot:this.currentId?()=>this.store.getGeometryCopy(this.currentId):()=>null,project:this.project,unproject:this.unproject})),s2}polygonFilter(t2){return!!(t2.geometry.type==="Polygon"&&t2.properties&&t2.properties.mode===this.mode)}onRightClick(t2){if(!this.editable||this.state!=="started")return;const{featureId:i2,featureCoordinateIndex:o2}=this.coordinateSnapping.getSnappable(t2,t3=>this.polygonFilter(t3));if(!i2||o2===void 0)return;const s2=this.store.getGeometryCopy(i2);let n2;s2.type==="Polygon"&&(n2=s2.coordinates[0],n2.length<=4||(s2.type!=="Polygon"||o2!==0&&o2!==n2.length-1?n2.splice(o2,1):(n2.shift(),n2.pop(),n2.push([n2[0][0],n2[0][1]])),(!this.validate||this.validate({id:i2,type:"Feature",geometry:s2,properties:{}},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Commit}).valid)&&(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:i2,geometry:s2}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(i2),this.onFinish(i2,{mode:this.mode,action:"edit"}))))}onLeftClick(t2){if(this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.currentCoordinate===0){const e2=this.snapCoordinate(t2);e2&&(t2.lng=e2[0],t2.lat=e2[1]);const[i2]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat]]]},properties:{mode:this.mode,[o]:!0}}]);this.currentId=i2,this.currentCoordinate++,this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(i2),this.setDrawing()}else if(this.currentCoordinate===1&&this.currentId){const i2=this.snapCoordinate(t2);i2&&(t2.lng=i2[0],t2.lat=i2[1]);const o2=this.store.getGeometryCopy(this.currentId);if(ut([t2.lng,t2.lat],o2.coordinates[0][0])||!this.updatePolygonGeometry([o2.coordinates[0][0],[t2.lng,t2.lat],[t2.lng,t2.lat],o2.coordinates[0][0]],e.Commit))return;this.currentCoordinate++}else if(this.currentCoordinate===2&&this.currentId){const i2=this.snapCoordinate(t2);i2&&(t2.lng=i2[0],t2.lat=i2[1]);const o2=this.store.getGeometryCopy(this.currentId).coordinates[0];if(ut([t2.lng,t2.lat],o2[1])||!this.updatePolygonGeometry([o2[0],o2[1],[t2.lng,t2.lat],[t2.lng,t2.lat],o2[0]],e.Commit))return;this.currentCoordinate===2&&this.closingPoints.create(o2,"polygon"),this.currentCoordinate++}else if(this.currentId){const i2=this.store.getGeometryCopy(this.currentId).coordinates[0],{isClosing:o2,isPreviousClosing:s2}=this.closingPoints.isClosingPoint(t2);if(s2||o2)this.close();else{const o3=this.snapCoordinate(t2);if(o3&&(t2.lng=o3[0],t2.lat=o3[1]),ut([t2.lng,t2.lat],i2[this.currentCoordinate-1]))return;const s3=function(t3=[[[0,0],[0,1],[1,1],[1,0],[0,0]]]){return{type:"Feature",geometry:{type:"Polygon",coordinates:t3},properties:{}}}([[...i2.slice(0,-1),[t2.lng,t2.lat],i2[0]]]);if(!this.updatePolygonGeometry(s3.geometry.coordinates[0],e.Commit))return;this.currentCoordinate++,this.closingPoints.ids.length&&this.closingPoints.update(s3.geometry.coordinates[0])}}}onClick(t2){this.currentCoordinate>0&&!this.mouseMove&&this.onMouseMove(t2),this.mouseMove=!1,t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2)?this.onRightClick(t2):t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)&&this.onLeftClick(t2)}onKeyUp(t2){t2.key===this.keyEvents.cancel?this.cleanUp():t2.key===this.keyEvents.finish&&this.close()}onKeyDown(){}onDragStart(t2,e2){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,t2)||!this.editable)return;let i2;if(this.state==="started"){const e3=this.lineSnapping.getSnappable(t2,t3=>this.polygonFilter(t3));e3.coordinate&&(this.editedSnapType="line",this.editedFeatureCoordinateIndex=e3.featureCoordinateIndex,this.editedFeatureId=e3.featureId,i2=e3.coordinate);const o2=this.coordinateSnapping.getSnappable(t2,t3=>this.polygonFilter(t3));o2.coordinate&&(this.editedSnapType="coordinate",this.editedFeatureCoordinateIndex=o2.featureCoordinateIndex,this.editedFeatureId=o2.featureId,i2=o2.coordinate)}if(this.editedFeatureId&&i2){if(!this.editedPointId){const[t3]=this.store.create([{geometry:{type:"Point",coordinates:i2},properties:{mode:this.mode,[s]:!0}}]);this.editedPointId=t3}this.setCursor(this.cursors.dragStart),e2(!1)}}onDrag(t2,i2){if(!this.allowPointerEvent(this.pointerEvents.onDrag,t2)||this.editedFeatureId===void 0||this.editedFeatureCoordinateIndex===void 0)return;const o2=this.store.getGeometryCopy(this.editedFeatureId),n2=o2.coordinates[0];this.editedSnapType==="coordinate"||this.editedSnapType==="line"&&this.editedInsertIndex!==void 0?this.editedFeatureCoordinateIndex===0||this.editedFeatureCoordinateIndex===o2.coordinates[0].length-1?(n2[0]=[t2.lng,t2.lat],n2[n2.length-1]=[t2.lng,t2.lat]):n2[this.editedFeatureCoordinateIndex]=[t2.lng,t2.lat]:this.editedSnapType==="line"&&this.editedInsertIndex===void 0&&(this.editedInsertIndex=this.editedFeatureCoordinateIndex+1,o2.coordinates[0].splice(this.editedInsertIndex,0,[t2.lng,t2.lat]),this.editedFeatureCoordinateIndex++);const r2={type:"Polygon",coordinates:o2.coordinates};this.validate&&!this.validate({type:"Feature",geometry:r2,properties:this.store.getPropertiesCopy(this.editedFeatureId)},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Provisional}).valid||(this.snapping&&this.snappedPointId&&(this.store.delete([this.snappedPointId]),this.snappedPointId=void 0),this.store.updateGeometry([{id:this.editedFeatureId,geometry:r2}]),this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(this.editedFeatureId),this.editedPointId&&this.store.updateGeometry([{id:this.editedPointId,geometry:{type:"Point",coordinates:[t2.lng,t2.lat]}}]),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!0}]))}onDragEnd(t2,e2){this.allowPointerEvent(this.pointerEvents.onDragEnd,t2)&&this.editedFeatureId!==void 0&&(this.setCursor(this.cursors.dragEnd),this.editedPointId&&(this.store.delete([this.editedPointId]),this.editedPointId=void 0),this.store.updateProperty([{id:this.editedFeatureId,property:s,value:!1}]),this.onFinish(this.editedFeatureId,{mode:this.mode,action:"edit"}),this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,e2(!0))}cleanUp(){const t2=this.currentId,e2=this.snappedPointId,i2=this.editedPointId;this.currentId=void 0,this.snappedPointId=void 0,this.editedPointId=void 0,this.editedFeatureId=void 0,this.editedFeatureCoordinateIndex=void 0,this.editedInsertIndex=void 0,this.editedSnapType=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted();try{t2&&this.coordinatePoints.deletePointsByFeatureIds([t2]),t2!==void 0&&this.store.delete([t2]),i2!==void 0&&this.store.delete([i2]),e2!==void 0&&this.store.delete([e2]),this.closingPoints.ids.length&&this.closingPoints.delete()}catch(t3){}}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e2.properties.mode===this.mode){if(e2.geometry.type==="Polygon")return i2.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,i2.polygonFillColor,e2),i2.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,i2.polygonOutlineColor,e2),i2.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,i2.polygonOutlineWidth,e2),i2.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,i2.polygonFillOpacity,e2),i2.zIndex=l,i2;if(e2.geometry.type==="Point"){const t2=e2.properties[s],o2=e2.properties[a],d2=t2?"editedPoint":e2.properties[n]?"closingPoint":e2.properties[r]?"snappingPoint":o2?"coordinatePoint":void 0;if(!d2)return i2;const h2={editedPoint:{width:this.styles.editedPointOutlineWidth,color:this.styles.editedPointColor,outlineColor:this.styles.editedPointOutlineColor,outlineWidth:this.styles.editedPointOutlineWidth},closingPoint:{width:this.styles.closingPointWidth,color:this.styles.closingPointColor,outlineColor:this.styles.closingPointOutlineColor,outlineWidth:this.styles.closingPointOutlineWidth},snappingPoint:{width:this.styles.snappingPointWidth,color:this.styles.snappingPointColor,outlineColor:this.styles.snappingPointOutlineColor,outlineWidth:this.styles.snappingPointOutlineWidth},coordinatePoint:{width:this.styles.coordinatePointWidth,color:this.styles.coordinatePointColor,outlineColor:this.styles.coordinatePointOutlineColor,outlineWidth:this.styles.coordinatePointOutlineWidth}};return i2.pointWidth=this.getNumericStylingValue(h2[d2].width,i2.pointWidth,e2),i2.pointColor=this.getHexColorStylingValue(h2[d2].color,i2.pointColor,e2),i2.pointOutlineColor=this.getHexColorStylingValue(h2[d2].outlineColor,i2.pointOutlineColor,e2),i2.pointOutlineWidth=this.getNumericStylingValue(h2[d2].outlineWidth,2,e2),i2.zIndex=t2?40:o2?20:30,i2}}return i2}afterFeatureAdded(t2){this.showCoordinatePoints&&this.coordinatePoints.createOrUpdate(t2.id)}validateFeature(t2){return this.validateModeFeature(t2,t3=>A(t3,this.coordinatePrecision))}};__name(_Wt,"Wt");let Wt=_Wt;const Bt={cancel:"Escape",finish:"Enter"},Gt={start:"crosshair"},_Nt=class _Nt extends v{constructor(t2){super(t2,!0),this.mode="rectangle",this.center=void 0,this.clickCount=0,this.currentRectangleId=void 0,this.keyEvents=Bt,this.cursors=Gt,this.updateOptions(t2)}updateOptions(e2){super.updateOptions(e2),e2!=null&&e2.cursors&&(this.cursors=t$1({},this.cursors,e2.cursors)),(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={cancel:null,finish:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents))}updateRectangle(t2,e2){if(this.clickCount===1&&this.center&&this.currentRectangleId){const i2=this.store.getGeometryCopy(this.currentRectangleId).coordinates[0][0],o2={type:"Polygon",coordinates:[[i2,[t2.lng,i2[1]],[t2.lng,t2.lat],[i2[0],t2.lat],i2]]};if(this.validate&&!this.validate({id:this.currentRectangleId,geometry:o2},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e2}).valid)return;this.store.updateGeometry([{id:this.currentRectangleId,geometry:o2}])}}close(){const t2=this.currentRectangleId;if(t2){const e2=H(this.store.getGeometryCopy(t2));e2&&this.store.updateGeometry([{id:t2,geometry:e2}]),this.store.updateProperty([{id:t2,property:o,value:void 0}])}this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),t2!==void 0&&this.onFinish(t2,{mode:this.mode,action:"draw"})}start(){this.setStarted(),this.setCursor(this.cursors.start)}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onClick(t2){if(t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2))if(this.clickCount===0){this.center=[t2.lng,t2.lat];const[e2]=this.store.create([{geometry:{type:"Polygon",coordinates:[[[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat],[t2.lng,t2.lat]]]},properties:{mode:this.mode,[o]:!0}}]);this.currentRectangleId=e2,this.clickCount++,this.setDrawing()}else this.updateRectangle(t2,e.Finish),this.close()}onMouseMove(t2){this.updateRectangle(t2,e.Provisional)}onKeyDown(){}onKeyUp(t2){t2.key===this.keyEvents.cancel?this.cleanUp():t2.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){const t2=this.currentRectangleId;this.center=void 0,this.currentRectangleId=void 0,this.clickCount=0,this.state==="drawing"&&this.setStarted(),t2!==void 0&&this.store.delete([t2])}styleFeature(e2){const i2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});return e2.type==="Feature"&&e2.geometry.type==="Polygon"&&e2.properties.mode===this.mode&&(i2.polygonFillColor=this.getHexColorStylingValue(this.styles.fillColor,i2.polygonFillColor,e2),i2.polygonOutlineColor=this.getHexColorStylingValue(this.styles.outlineColor,i2.polygonOutlineColor,e2),i2.polygonOutlineWidth=this.getNumericStylingValue(this.styles.outlineWidth,i2.polygonOutlineWidth,e2),i2.polygonFillOpacity=this.getNumericStylingValue(this.styles.fillOpacity,i2.polygonFillOpacity,e2),i2.zIndex=l),i2}validateFeature(t2){return this.validateModeFeature(t2,t3=>R(t3,this.coordinatePrecision))}};__name(_Nt,"Nt");let Nt=_Nt;function Tt(t2,e2){const i2=t2,o2=e2,s2=x(i2[1]),n2=x(o2[1]);let r2=x(o2[0]-i2[0]);r2>Math.PI&&(r2-=2*Math.PI),r2<-Math.PI&&(r2+=2*Math.PI);const a2=Math.log(Math.tan(n2/2+Math.PI/4)/Math.tan(s2/2+Math.PI/4)),d2=(S(Math.atan2(r2,a2))+360)%360;return d2>180?-(360-d2):d2}__name(Tt,"Tt");function Vt(t2,e2,i2){let o2=e2;e2<0&&(o2=-Math.abs(o2));const s2=o2/I,n2=t2[0]*Math.PI/180,r2=x(t2[1]),a2=x(i2),d2=s2*Math.cos(a2);let h2=r2+d2;Math.abs(h2)>Math.PI/2&&(h2=h2>0?Math.PI-h2:-Math.PI-h2);const l2=Math.log(Math.tan(h2/2+Math.PI/4)/Math.tan(r2/2+Math.PI/4)),c2=Math.abs(l2)>1e-11?d2/l2:Math.cos(r2),u2=[(180*(n2+s2*Math.sin(a2)/c2)/Math.PI+540)%360-180,180*h2/Math.PI];return u2[0]+=u2[0]-t2[0]>180?-360:t2[0]-u2[0]>180?360:0,u2}__name(Vt,"Vt");function Ut(t2,e2,i2,o2,s2){const n2=o2(t2[0],t2[1]),r2=o2(e2[0],e2[1]),{lng:a2,lat:d2}=s2((n2.x+r2.x)/2,(n2.y+r2.y)/2);return[E(a2,i2),E(d2,i2)]}__name(Ut,"Ut");function At(t2,e2,i2){const o2=Vt(t2,1e3*P(t2,e2)/2,Tt(t2,e2));return[E(o2[0],i2),E(o2[1],i2)]}__name(At,"At");function Rt({featureCoords:t2,precision:e2,unproject:i2,project:o2,projection:s2}){const n2=[];for(let r2=0;r2<t2.length-1;r2++){let a2;if(s2==="web-mercator")a2=Ut(t2[r2],t2[r2+1],e2,o2,i2);else{if(s2!=="globe")throw new Error("Invalid projection");a2=At(t2[r2],t2[r2+1],e2)}n2.push(a2)}return n2}__name(Rt,"Rt");const _Kt=class _Kt extends J{constructor(t2,e2,i2){super(t2),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=t2,this.selectionPointBehavior=e2,this.coordinatePointBehavior=i2}get ids(){return this._midPoints.concat()}set ids(t2){}insert(t2,e2,i2){const o2=this.store.getGeometryCopy(e2),{midPointFeatureId:s2,midPointSegment:n2}=this.store.getPropertiesCopy(e2),r2=this.store.getGeometryCopy(s2),a2=r2.type==="Polygon"?r2.coordinates[0]:r2.coordinates;a2.splice(n2+1,0,o2.coordinates),r2.coordinates=r2.type==="Polygon"?[a2]:a2,this.store.updateGeometry([{id:s2,geometry:r2}]),this.store.getPropertiesCopy(t2)[h]&&this.coordinatePointBehavior.createOrUpdate(t2),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(a2,s2,i2),this.selectionPointBehavior.create(a2,r2.type,s2)}create(t2,e2,o2){if(!this.store.has(e2))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(t3,e3,i2,o3,s2,n2){return Rt({featureCoords:t3,precision:i2,project:o3,unproject:s2,projection:n2}).map((t4,i3)=>({geometry:{type:"Point",coordinates:t4},properties:e3(i3)}))}(t2,t3=>({mode:this.mode,[i.MID_POINT]:!0,midPointSegment:t3,midPointFeatureId:e2}),o2,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(t2){if(this._midPoints.length!==0)return Rt({featureCoords:t2,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((t3,e2)=>({id:this._midPoints[e2],geometry:{type:"Point",coordinates:t3}}))}};__name(_Kt,"Kt");let Kt=_Kt;const _zt=class _zt extends J{constructor(t2){super(t2),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(t2){}create(t2,e2,o2){this._selectionPoints=this.store.create(function(t3,e3,i2){const o3=[],s2=e3==="Polygon"?t3.length-1:t3.length;for(let e4=0;e4<s2;e4++)o3.push({geometry:{type:"Point",coordinates:t3[e4]},properties:i2(e4)});return o3}(t2,e2,t3=>({mode:this.mode,index:t3,[i.SELECTION_POINT]:!0,[i.SELECTION_POINT_FEATURE_ID]:o2})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(t2){if(this._selectionPoints.length!==0)return this._selectionPoints.map((e2,i2)=>({id:e2,geometry:{type:"Point",coordinates:t2[i2]}}))}getOneUpdated(t2,e2){if(this._selectionPoints[t2]!==void 0)return{id:this._selectionPoints[t2],geometry:{type:"Point",coordinates:e2}}}};__name(_zt,"zt");let zt=_zt;function Xt(t2,e2){let i2=!1;for(let r2=0,a2=e2.length;r2<a2;r2++){const a3=e2[r2];for(let e3=0,r3=a3.length,d2=r3-1;e3<r3;d2=e3++)(s2=a3[e3])[1]>(o2=t2)[1]!=(n2=a3[d2])[1]>o2[1]&&o2[0]<(n2[0]-s2[0])*(o2[1]-s2[1])/(n2[1]-s2[1])+s2[0]&&(i2=!i2)}var o2,s2,n2;return i2}__name(Xt,"Xt");const Yt=__name((t2,e2,i2)=>{const o2=__name(t3=>t3*t3,"o"),s2=__name((t3,e3)=>o2(t3.x-e3.x)+o2(t3.y-e3.y),"s");return Math.sqrt(((t3,e3,i3)=>{const o3=s2(e3,i3);if(o3===0)return s2(t3,e3);let n2=((t3.x-e3.x)*(i3.x-e3.x)+(t3.y-e3.y)*(i3.y-e3.y))/o3;return n2=Math.max(0,Math.min(1,n2)),s2(t3,{x:e3.x+n2*(i3.x-e3.x),y:e3.y+n2*(i3.y-e3.y)})})(t2,e2,i2))},"Yt"),_Ht=class _Ht extends J{constructor(t2,e2,i2){super(t2),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=t2,this.createClickBoundingBox=e2,this.pixelDistance=i2}find(t2,e2){let o2,s2,n2,r2,a2=1/0,d2=1/0,h2=1/0;const l2=this.createClickBoundingBox.create(t2),c2=this.store.search(l2);for(let l3=0;l3<c2.length;l3++){const u2=c2[l3],p2=u2.geometry;if(p2.type==="Point"){if(u2.properties.selectionPoint||u2.properties.coordinatePoint||!e2&&u2.properties[i.MID_POINT])continue;const s3=this.pixelDistance.measure(t2,p2.coordinates);u2.properties[i.MID_POINT]&&s3<this.pointerDistance&&s3<h2?(h2=s3,n2=u2):!u2.properties[i.MID_POINT]&&s3<this.pointerDistance&&s3<a2&&(a2=s3,o2=u2)}else if(p2.type==="LineString"){if(o2)continue;for(let e3=0;e3<p2.coordinates.length-1;e3++){const i2=p2.coordinates[e3],o3=p2.coordinates[e3+1],n3=Yt({x:t2.containerX,y:t2.containerY},this.project(i2[0],i2[1]),this.project(o3[0],o3[1]));n3<this.pointerDistance&&n3<d2&&(d2=n3,s2=u2)}}else if(p2.type==="Polygon"){if(o2||s2)continue;Xt([t2.lng,t2.lat],p2.coordinates)&&(r2=u2)}}return{clickedFeature:o2||s2||r2,clickedMidPoint:n2}}};__name(_Ht,"Ht");let Ht=_Ht;const _qt=class _qt extends J{constructor(t2,e2,i2,o2,s2){super(t2),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=t2,this.featuresAtCursorEvent=e2,this.selectionPoints=i2,this.midPoints=o2,this.coordinatePoints=s2}startDragging(t2,e2){this.draggedFeatureId=e2,this.dragPosition=[t2.lng,t2.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(t2,e2){const{clickedFeature:i2}=this.featuresAtCursorEvent.find(t2,!0);return!(!i2||i2.id!==e2)}drag(t2,i2){if(!this.draggedFeatureId)return;const o2=this.store.getGeometryCopy(this.draggedFeatureId),s2=[t2.lng,t2.lat];if(o2.type==="Polygon"||o2.type==="LineString"){let n2,r2;if(o2.type==="Polygon"?(n2=o2.coordinates[0],r2=n2.length-1):(n2=o2.coordinates,r2=n2.length),!this.dragPosition)return!1;for(let t3=0;t3<r2;t3++){const e2=n2[t3];let i3,o3;if(this.config.projection==="web-mercator"){const t4=b(this.dragPosition[0],this.dragPosition[1]),n3=b(s2[0],s2[1]),r3=b(e2[0],e2[1]),a3={x:t4.x-n3.x,y:t4.y-n3.y},d3=r3.x-a3.x,h3=r3.y-a3.y,{lng:l2,lat:c2}=k(d3,h3);i3=l2,o3=c2}else{const t4=[this.dragPosition[0]-s2[0],this.dragPosition[1]-s2[1]];i3=e2[0]-t4[0],o3=e2[1]-t4[1]}if(i3=E(i3,this.config.coordinatePrecision),o3=E(o3,this.config.coordinatePrecision),i3>180||i3<-180||o3>90||o3<-90)return!1;n2[t3]=[i3,o3]}o2.type==="Polygon"&&(n2[n2.length-1]=[n2[0][0],n2[0][1]]);const a2=this.selectionPoints.getUpdated(n2)||[],d2=this.midPoints.getUpdated(n2)||[],h2=this.coordinatePoints.getUpdated(this.draggedFeatureId,n2)||[];if(i2&&!i2({type:"Feature",id:this.draggedFeatureId,geometry:o2,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:e.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o2},...a2,...d2,...h2]),this.dragPosition=[t2.lng,t2.lat]}else o2.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:s2}}]),this.dragPosition=[t2.lng,t2.lat])}};__name(_qt,"qt");let qt=_qt;const _$t=class _$t extends J{constructor(t2,e2,i2,o2,s2,n2,r2){super(t2),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.lineSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=t2,this.pixelDistance=e2,this.selectionPoints=i2,this.midPoints=o2,this.coordinatePoints=s2,this.coordinateSnapping=n2,this.lineSnapping=r2}getClosestCoordinate(t2,e2){const i2={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let o2;if(e2.type==="LineString")o2=e2.coordinates;else{if(e2.type!=="Polygon")return i2;o2=e2.coordinates[0]}for(let s2=0;s2<o2.length;s2++){const n2=this.pixelDistance.measure(t2,o2[s2]);if(n2<this.pointerDistance&&n2<i2.dist){const t3=e2.type==="Polygon"&&(s2===o2.length-1||s2===0);i2.dist=n2,i2.index=t3?0:s2,i2.isFirstOrLastPolygonCoord=t3}}return i2}getDraggableIndex(t2,e2){const i2=this.store.getGeometryCopy(e2),o2=this.getClosestCoordinate(t2,i2);return o2.index===-1?-1:o2.index}snapCoordinate(t2,e2,i2){let o2=[t2.lng,t2.lat];const s2=__name(t3=>!!(t3.properties&&t3.properties.mode===i2.properties.mode&&t3.id!==this.draggedCoordinate.id),"s");if(e2!=null&&e2.toLine){let e3;e3=this.lineSnapping.getSnappable(t2,s2).coordinate,e3&&(o2=e3)}if(e2.toCoordinate){let e3;e3=this.coordinateSnapping.getSnappable(t2,s2).coordinate,e3&&(o2=e3)}if(e2!=null&&e2.toCustom){let s3;s3=e2.toCustom(t2,{currentCoordinate:this.draggedCoordinate.index,currentId:i2.id,getCurrentGeometrySnapshot:i2.id?()=>this.store.getGeometryCopy(i2.id):()=>null,project:this.project,unproject:this.unproject}),s3&&(o2=s3)}return o2}drag(t2,i2,o2,s2){const n2=this.draggedCoordinate.id;if(n2===null)return!1;const r2=this.draggedCoordinate.index,a2=this.store.getGeometryCopy(n2),d2=this.store.getPropertiesCopy(n2),h2=a2.type==="LineString"?a2.coordinates:a2.coordinates[0],l2=a2.type==="Polygon"&&(r2===h2.length-1||r2===0),c2={type:"Feature",id:n2,geometry:a2,properties:d2},u2=this.snapCoordinate(t2,s2,c2);if(t2.lng>180||t2.lng<-180||t2.lat>90||t2.lat<-90)return!1;if(l2){const t3=h2.length-1;h2[0]=u2,h2[t3]=u2}else h2[r2]=u2;const p2=this.selectionPoints.getOneUpdated(r2,u2),g=p2?[p2]:[],y2=this.midPoints.getUpdated(h2)||[],f2=this.coordinatePoints.getUpdated(n2,h2)||[];return!(a2.type!=="Point"&&!i2&&j({geometry:a2})||o2&&!o2(c2,{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:e.Provisional}).valid||(this.store.updateGeometry([{id:n2,geometry:a2},...g,...y2,...f2]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(t2,e2){this.draggedCoordinate={id:t2,index:e2}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}};__name(_$t,"$t");let $t=_$t;function Zt(t2){let e2=0,i2=0,o2=0;return(t2.geometry.type==="Polygon"?t2.geometry.coordinates[0].slice(0,-1):t2.geometry.coordinates).forEach(t3=>{e2+=t3[0],i2+=t3[1],o2++},!0),[e2/o2,i2/o2]}__name(Zt,"Zt");function Jt(t2){const e2=(t2.geometry.type==="Polygon"?t2.geometry.coordinates[0]:t2.geometry.coordinates).map(t3=>{const{x:e3,y:i2}=b(t3[0],t3[1]);return[e3,i2]});return t2.geometry.type==="Polygon"?function(t3){let e3=0,i2=0,o2=0;const s2=t3.length;for(let n2=0;n2<s2-1;n2++){const[s3,r2]=t3[n2],[a2,d2]=t3[n2+1],h2=s3*d2-a2*r2;e3+=h2,i2+=(s3+a2)*h2,o2+=(r2+d2)*h2}return e3/=2,i2/=6*e3,o2/=6*e3,{x:i2,y:o2}}(e2):function(t3){const e3=t3.length;let i2=0,o2=0;for(let s2=0;s2<e3;s2++){const[e4,n2]=t3[s2];i2+=e4,o2+=n2}return{x:i2/e3,y:o2/e3}}(e2)}__name(Jt,"Jt");const _Qt=class _Qt extends J{constructor(t2,e2,i2,o2){super(t2),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryCentroid=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.config=t2,this.selectionPoints=e2,this.midPoints=i2,this.coordinatePoints=o2}reset(){this.lastBearing=void 0,this.selectedGeometry=void 0,this.selectedGeometryWebMercatorCentroid=void 0,this.selectedGeometryCentroid=void 0}rotate(t2,i2,o2){this.selectedGeometry||(this.selectedGeometry=this.store.getGeometryCopy(i2));const s2=this.selectedGeometry;if(s2.type!=="Polygon"&&s2.type!=="LineString")return;const n2=[t2.lng,t2.lat];let r2;const a2={type:"Feature",geometry:s2,properties:{}};if(this.config.projection==="web-mercator"){this.selectedGeometryWebMercatorCentroid||(this.selectedGeometryWebMercatorCentroid=Jt(a2));const e2=b(t2.lng,t2.lat);if(r2=rt(this.selectedGeometryWebMercatorCentroid,e2),r2===0)return;if(!this.lastBearing)return void(this.lastBearing=r2);((t3,e3)=>{if(e3===0||e3===360||e3===-360)return t3;const i3=.017453292519943295*e3,o3=(t3.geometry.type==="Polygon"?t3.geometry.coordinates[0]:t3.geometry.coordinates).map(([t4,e4])=>b(t4,e4)),s3=o3.reduce((t4,e4)=>({x:t4.x+e4.x,y:t4.y+e4.y}),{x:0,y:0});s3.x/=o3.length,s3.y/=o3.length;const n3=o3.map(t4=>({x:s3.x+(t4.x-s3.x)*Math.cos(i3)-(t4.y-s3.y)*Math.sin(i3),y:s3.y+(t4.x-s3.x)*Math.sin(i3)+(t4.y-s3.y)*Math.cos(i3)})).map(({x:t4,y:e4})=>[k(t4,e4).lng,k(t4,e4).lat]);t3.geometry.type==="Polygon"?t3.geometry.coordinates[0]=n3:t3.geometry.coordinates=n3})(a2,-(this.lastBearing-r2))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(this.selectedGeometryCentroid||(this.selectedGeometryCentroid=Zt({geometry:s2})),r2=Tt(this.selectedGeometryCentroid,n2),!this.lastBearing)return void(this.lastBearing=r2+180);(function(t3,e2){if(e2===0||e2===360||e2===-360)return t3;const i3=Zt(t3);(t3.geometry.type==="Polygon"?t3.geometry.coordinates[0]:t3.geometry.coordinates).forEach(t4=>{const o3=Tt(i3,t4)+e2,s3=function(t5,e3){t5[0]+=t5[0]-e3[0]>180?-360:e3[0]-t5[0]>180?360:0;const i4=I,o4=e3[1]*Math.PI/180,s4=t5[1]*Math.PI/180,n4=s4-o4;let r3=Math.abs(t5[0]-e3[0])*Math.PI/180;r3>Math.PI&&(r3-=2*Math.PI);const a3=Math.log(Math.tan(s4/2+Math.PI/4)/Math.tan(o4/2+Math.PI/4)),d3=Math.abs(a3)>1e-11?n4/a3:Math.cos(o4);return Math.sqrt(n4*n4+d3*d3*r3*r3)*i4}(i3,t4),n3=Vt(i3,s3,o3);t4[0]=n3[0],t4[1]=n3[1]})})(a2,-(this.lastBearing-(r2+180)))}const d2=s2.type==="Polygon"?s2.coordinates[0]:s2.coordinates;d2.forEach(t3=>{t3[0]=E(t3[0],this.coordinatePrecision),t3[1]=E(t3[1],this.coordinatePrecision)});const h2=this.midPoints.getUpdated(d2)||[],l2=this.selectionPoints.getUpdated(d2)||[],c2=this.coordinatePoints.getUpdated(i2,d2)||[];if(o2&&!o2({id:i2,type:"Feature",geometry:s2,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:e.Provisional}))return!1;this.store.updateGeometry([{id:i2,geometry:s2},...l2,...h2,...c2]),this.projection==="web-mercator"?this.lastBearing=r2:this.projection==="globe"&&(this.lastBearing=r2+180)}};__name(_Qt,"Qt");let Qt=_Qt;const _te=class _te extends J{constructor(t2,e2){super(t2),this.config=void 0,this.dragCoordinateResizeBehavior=void 0,this.config=t2,this.dragCoordinateResizeBehavior=e2}scale(t2,e2,i2){if(!this.dragCoordinateResizeBehavior.isDragging()){const i3=this.dragCoordinateResizeBehavior.getDraggableIndex(t2,e2);this.dragCoordinateResizeBehavior.startDragging(e2,i3)}this.dragCoordinateResizeBehavior.drag(t2,"center-fixed",i2)}reset(){this.dragCoordinateResizeBehavior.stopDragging()}};__name(_te,"te");let te=_te;const _ee=class _ee extends J{constructor(t2,e2,i2,o2,s2){super(t2),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=t2,this.pixelDistance=e2,this.selectionPoints=i2,this.midPoints=o2,this.coordinatePoints=s2}getClosestCoordinate(t2,e2){const i2={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let o2;if(e2.type==="LineString")o2=e2.coordinates;else{if(e2.type!=="Polygon")return i2;o2=e2.coordinates[0]}for(let s2=0;s2<o2.length;s2++){const n2=this.pixelDistance.measure(t2,o2[s2]);if(n2<this.pointerDistance&&n2<i2.dist){const t3=e2.type==="Polygon"&&(s2===o2.length-1||s2===0);i2.dist=n2,i2.index=t3?0:s2,i2.isFirstOrLastPolygonCoord=t3}}return i2}isValidDragWebMercator(t2,e2,i2){switch(t2){case 0:if(e2<=0||i2>=0)return!1;break;case 1:if(i2>=0)return!1;break;case 2:if(e2>=0||i2>=0)return!1;break;case 3:if(e2>=0)return!1;break;case 4:if(e2>=0||i2<=0)return!1;break;case 5:if(i2<=0)return!1;break;case 6:if(e2<=0||i2<=0)return!1;break;case 7:if(e2<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const t2=this.getFeature(this.draggedCoordinate.id);if(!t2)return null;const e2=this.getNormalisedCoordinates(t2.geometry);return{boundingBox:this.getBBoxWebMercator(e2),feature:t2,updatedCoords:e2,selectedCoordinate:e2[this.draggedCoordinate.index]}}centerWebMercatorDrag(t2){const e2=this.getSelectedFeatureDataWebMercator();if(!e2)return null;const{feature:i2,boundingBox:o2,updatedCoords:s2,selectedCoordinate:n2}=e2,r2=Jt(i2);if(!r2)return null;const a2=b(n2[0],n2[1]),{closestBBoxIndex:d2}=this.getIndexesWebMercator(o2,a2),h2=b(t2.lng,t2.lat);return this.scaleWebMercator({closestBBoxIndex:d2,updatedCoords:s2,webMercatorCursor:h2,webMercatorSelected:a2,webMercatorOrigin:r2}),s2}centerFixedWebMercatorDrag(t2){const e2=this.getSelectedFeatureDataWebMercator();if(!e2)return null;const{feature:i2,boundingBox:o2,updatedCoords:s2,selectedCoordinate:n2}=e2,r2=Jt(i2);if(!r2)return null;const a2=b(n2[0],n2[1]),{closestBBoxIndex:d2}=this.getIndexesWebMercator(o2,a2),h2=b(t2.lng,t2.lat);return this.scaleFixedWebMercator({closestBBoxIndex:d2,updatedCoords:s2,webMercatorCursor:h2,webMercatorSelected:a2,webMercatorOrigin:r2}),s2}scaleFixedWebMercator({closestBBoxIndex:t2,webMercatorOrigin:e2,webMercatorSelected:i2,webMercatorCursor:o2,updatedCoords:s2}){if(!this.isValidDragWebMercator(t2,e2.x-o2.x,e2.y-o2.y))return null;let n2=Y(e2,o2)/Y(e2,i2);return n2<0&&(n2=this.minimumScale),this.performWebMercatorScale(s2,e2.x,e2.y,n2,n2),s2}oppositeFixedWebMercatorDrag(t2){const e2=this.getSelectedFeatureDataWebMercator();if(!e2)return null;const{boundingBox:i2,updatedCoords:o2,selectedCoordinate:s2}=e2,n2=b(s2[0],s2[1]),{oppositeBboxIndex:r2,closestBBoxIndex:a2}=this.getIndexesWebMercator(i2,n2),d2={x:i2[r2][0],y:i2[r2][1]},h2=b(t2.lng,t2.lat);return this.scaleFixedWebMercator({closestBBoxIndex:a2,updatedCoords:o2,webMercatorCursor:h2,webMercatorSelected:n2,webMercatorOrigin:d2}),o2}oppositeWebMercatorDrag(t2){const e2=this.getSelectedFeatureDataWebMercator();if(!e2)return null;const{boundingBox:i2,updatedCoords:o2,selectedCoordinate:s2}=e2,n2=b(s2[0],s2[1]),{oppositeBboxIndex:r2,closestBBoxIndex:a2}=this.getIndexesWebMercator(i2,n2),d2={x:i2[r2][0],y:i2[r2][1]},h2=b(t2.lng,t2.lat);return this.scaleWebMercator({closestBBoxIndex:a2,updatedCoords:o2,webMercatorCursor:h2,webMercatorSelected:n2,webMercatorOrigin:d2}),o2}scaleWebMercator({closestBBoxIndex:t2,webMercatorOrigin:e2,webMercatorSelected:i2,webMercatorCursor:o2,updatedCoords:s2}){const n2=e2.x-o2.x,r2=e2.y-o2.y;if(!this.isValidDragWebMercator(t2,n2,r2))return null;let a2=1;n2!==0&&t2!==1&&t2!==5&&(a2=1-(e2.x-i2.x-n2)/n2);let d2=1;return r2!==0&&t2!==3&&t2!==7&&(d2=1-(e2.y-i2.y-r2)/r2),this.validateScale(a2,d2)?(a2<0&&(a2=this.minimumScale),d2<0&&(d2=this.minimumScale),this.performWebMercatorScale(s2,e2.x,e2.y,a2,d2),s2):null}getFeature(t2){if(this.draggedCoordinate.id===null)return null;const e2=this.store.getGeometryCopy(t2);return e2.type!=="Polygon"&&e2.type!=="LineString"?null:{id:t2,type:"Feature",geometry:e2,properties:{}}}getNormalisedCoordinates(t2){return t2.type==="Polygon"?t2.coordinates[0]:t2.coordinates}validateScale(t2,e2){const i2=!isNaN(t2)&&e2<Number.MAX_SAFE_INTEGER,o2=!isNaN(e2)&&e2<Number.MAX_SAFE_INTEGER;return i2&&o2}performWebMercatorScale(t2,e2,i2,o2,s2){t2.forEach(t3=>{const{x:n2,y:r2}=b(t3[0],t3[1]),a2=e2+(n2-e2)*o2,d2=i2+(r2-i2)*s2,{lng:h2,lat:l2}=k(a2,d2);t3[0]=h2,t3[1]=l2})}getBBoxWebMercator(t2){const e2=[1/0,1/0,-1/0,-1/0];(t2=t2.map(t3=>{const{x:e3,y:i3}=b(t3[0],t3[1]);return[e3,i3]})).forEach(([t3,i3])=>{t3<e2[0]&&(e2[0]=t3),i3<e2[1]&&(e2[1]=i3),t3>e2[2]&&(e2[2]=t3),i3>e2[3]&&(e2[3]=i3)});const[i2,o2,s2,n2]=e2;return[[i2,n2],[(i2+s2)/2,n2],[s2,n2],[s2,n2+(o2-n2)/2],[s2,o2],[(i2+s2)/2,o2],[i2,o2],[i2,n2+(o2-n2)/2]]}getIndexesWebMercator(t2,e2){let i2,o2=1/0;for(let s2=0;s2<t2.length;s2++){const n2=Y({x:e2.x,y:e2.y},{x:t2[s2][0],y:t2[s2][1]});n2<o2&&(i2=s2,o2=n2)}if(i2===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[i2],closestBBoxIndex:i2}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(t2,e2){this.draggedCoordinate={id:t2,index:e2}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(t2,e2){const i2=this.store.getGeometryCopy(e2),o2=this.getClosestCoordinate(t2,i2);return o2.index===-1?-1:o2.index}drag(t2,i2,o2){if(!this.draggedCoordinate.id)return!1;const s2=this.getFeature(this.draggedCoordinate.id);if(!s2)return!1;let n2=null;if(i2==="center"?n2=this.centerWebMercatorDrag(t2):i2==="opposite"?n2=this.oppositeWebMercatorDrag(t2):i2==="center-fixed"?n2=this.centerFixedWebMercatorDrag(t2):i2==="opposite-fixed"&&(n2=this.oppositeFixedWebMercatorDrag(t2)),!n2)return!1;for(let t3=0;t3<n2.length;t3++){const e2=n2[t3];if(e2[0]=E(e2[0],this.coordinatePrecision),e2[1]=E(e2[1],this.coordinatePrecision),!B(e2,this.coordinatePrecision))return!1}const r2=this.midPoints.getUpdated(n2)||[],a2=this.selectionPoints.getUpdated(n2)||[],d2=this.coordinatePoints.getUpdated(s2.id,n2)||[],h2={type:s2.geometry.type,coordinates:s2.geometry.type==="Polygon"?[n2]:n2};return!(o2&&!o2({id:this.draggedCoordinate.id,type:"Feature",geometry:h2,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:e.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:h2},...a2,...r2,...d2]),0))}};__name(_ee,"ee");let ee=_ee;const ie={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},oe={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"},_se=class _se extends C{constructor(t2){super(t2,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=ie,this.cursors=oe,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.lineSnap=void 0,this.updateOptions(t2)}updateOptions(e2){if(super.updateOptions(e2),this.cursors=e2&&e2.cursors?t$1({},this.cursors,e2.cursors):oe,(e2==null?void 0:e2.keyEvents)===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e2!=null&&e2.keyEvents&&(this.keyEvents=t$1({},this.keyEvents,e2.keyEvents)),(e2==null?void 0:e2.dragEventThrottle)!==void 0&&(this.dragEventThrottle=e2.dragEventThrottle),(e2==null?void 0:e2.allowManualDeselection)!==void 0&&(this.allowManualDeselection=e2.allowManualDeselection),e2!=null&&e2.flags){this.flags=t$1({},this.flags,e2.flags),this.validations={};for(const t2 in this.flags){const e3=this.flags[t2].feature;e3&&e3.validation&&(this.validations[t2]=e3.validation)}}}selectFeature(t2){this.select(t2,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(t2){this.pixelDistance=new et(t2),this.clickBoundingBox=new tt(t2),this.featuresAtMouseEvent=new Ht(t2,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new zt(t2),this.coordinatePoints=new Ot(t2),this.midPoints=new Kt(t2,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new it(t2,this.pixelDistance,this.clickBoundingBox),this.lineSnap=new Pt(t2,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new Qt(t2,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new qt(t2,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new $t(t2,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap,this.lineSnap),this.dragCoordinateResizeFeature=new ee(t2,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new te(t2,this.dragCoordinateResizeFeature)}deselectFeature(){this.deselect()}deselect(){const t2=this.selected.filter(t3=>this.store.has(t3)).map(t3=>({id:t3,property:i.SELECTED,value:!1}));this.store.updateProperty(t2),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(t2){if(!this.selectionPoints.ids.length)return;let i2,o2=1/0;if(this.selectionPoints.ids.forEach(e2=>{const s3=this.store.getGeometryCopy(e2),n3=this.pixelDistance.measure(t2,s3.coordinates);n3<this.pointerDistance&&n3<o2&&(o2=n3,i2=this.store.getPropertiesCopy(e2))}),!i2)return;const s2=i2.selectionPointFeatureId,n2=i2.index,r2=this.store.getPropertiesCopy(s2),a2=this.flags[r2.mode],d2=this.validations[r2.mode];if(!(a2&&a2.feature&&a2.feature.coordinates&&a2.feature.coordinates.deletable))return;const h2=this.store.getGeometryCopy(s2);let l2;if(h2.type==="Polygon"){if(l2=h2.coordinates[0],l2.length<=4)return}else if(h2.type==="LineString"&&(l2=h2.coordinates,l2.length<=2))return;if(!l2||(h2.type!=="Polygon"||n2!==0&&n2!==l2.length-1?l2.splice(n2,1):(l2.shift(),l2.pop(),l2.push([l2[0][0],l2[0][1]])),d2&&!d2({id:s2,type:"Feature",geometry:h2,properties:r2},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:e.Commit}).valid))return;const c2=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(c2),this.store.updateGeometry([{id:s2,geometry:h2}]),r2.coordinatePointIds&&this.coordinatePoints.createOrUpdate(s2),this.selectionPoints.create(l2,h2.type,s2),a2&&a2.feature&&a2.feature.coordinates&&a2.feature.coordinates.midpoints&&this.midPoints.create(l2,s2,this.coordinatePrecision)}select(t2,e2=!0){if(this.selected[0]===t2)return;const{mode:o2}=this.store.getPropertiesCopy(t2),s2=this.flags[o2];if(!s2||!s2.feature)return;const n2=this.selected[0];if(n2){if(n2===t2)return;this.deselect()}e2&&this.setCursor(this.cursors.pointerOver),this.selected=[t2],this.store.updateProperty([{id:t2,property:i.SELECTED,value:!0}]),this.onSelect(t2);const{type:r2,coordinates:a2}=this.store.getGeometryCopy(t2);if(r2!=="LineString"&&r2!=="Polygon")return;const d2=r2==="LineString"?a2:a2[0];d2&&s2&&s2.feature.coordinates&&(this.selectionPoints.create(d2,r2,t2),s2.feature.coordinates.midpoints&&this.midPoints.create(d2,t2,this.coordinatePrecision))}onLeftClick(t2){const{clickedFeature:e2,clickedMidPoint:i2}=this.featuresAtMouseEvent.find(t2,this.selected.length>0);if(this.selected.length&&i2)this.midPoints.insert(this.selected[0],i2.id,this.coordinatePrecision);else if(e2&&e2.id)this.select(e2.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(t2){t2.button==="right"&&this.allowPointerEvent(this.pointerEvents.rightClick,t2)||t2.isContextMenu&&this.allowPointerEvent(this.pointerEvents.contextMenu,t2)?this.onRightClick(t2):t2.button==="left"&&this.allowPointerEvent(this.pointerEvents.leftClick,t2)&&this.onLeftClick(t2)}canScale(t2){return this.keyEvents.scale&&this.keyEvents.scale.every(e2=>t2.heldKeys.includes(e2))}canRotate(t2){return this.keyEvents.rotate&&this.keyEvents.rotate.every(e2=>t2.heldKeys.includes(e2))}preventDefaultKeyEvent(t2){const e2=this.canRotate(t2),i2=this.canScale(t2);(e2||i2)&&t2.preventDefault()}onKeyDown(t2){this.preventDefaultKeyEvent(t2)}onKeyUp(t2){if(this.preventDefaultKeyEvent(t2),this.keyEvents.delete&&t2.key===this.keyEvents.delete){if(!this.selected.length)return;const t3=this.selected[0];this.onDeselect(this.selected[0]),this.coordinatePoints.deletePointsByFeatureIds([t3]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&t2.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(t2,e2){if(!this.allowPointerEvent(this.pointerEvents.onDragStart,t2)||!this.selected.length)return;const i2=this.store.getPropertiesCopy(this.selected[0]),o2=this.flags[i2.mode];if(!(o2&&o2.feature&&(o2.feature.draggable||o2.feature.coordinates&&o2.feature.coordinates.draggable||o2.feature.coordinates&&o2.feature.coordinates.resizable||o2.feature.coordinates&&typeof o2.feature.coordinates.midpoints=="object"&&o2.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;const s2=this.selected[0],n2=this.dragCoordinate.getDraggableIndex(t2,s2);if(o2&&o2.feature&&o2.feature.coordinates&&(o2.feature.coordinates.draggable||o2.feature.coordinates.resizable)&&n2!==-1)return this.setCursor(this.cursors.dragStart),o2.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(s2,n2):this.dragCoordinate.startDragging(s2,n2),void e2(!1);if(o2&&o2.feature&&o2.feature.coordinates&&typeof o2.feature.coordinates.midpoints=="object"&&o2.feature.coordinates.midpoints.draggable){const{clickedMidPoint:i3}=this.featuresAtMouseEvent.find(t2,this.selected.length>0);if(this.selected.length&&i3){this.midPoints.insert(s2,i3.id,this.coordinatePrecision);const o3=this.dragCoordinate.getDraggableIndex(t2,s2);return this.dragCoordinate.startDragging(s2,o3),void e2(!1)}}return o2&&o2.feature&&o2.feature.draggable&&this.dragFeature.canDrag(t2,s2)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(t2,s2),void e2(!1)):void 0}onDrag(t2,e2){if(!this.allowPointerEvent(this.pointerEvents.onDrag,t2))return;const i2=this.selected[0];if(!i2)return;const o2=this.store.getPropertiesCopy(i2),s2=this.flags[o2.mode],n2=(s2&&s2.feature&&s2.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const r2=this.validations[o2.mode];if(s2&&s2.feature&&s2.feature.rotateable&&this.canRotate(t2))return e2(!1),void this.rotateFeature.rotate(t2,i2,r2);if(s2&&s2.feature&&s2.feature.scaleable&&this.canScale(t2))return e2(!1),void this.scaleFeature.scale(t2,i2,r2);if(this.dragCoordinateResizeFeature.isDragging()&&s2.feature&&s2.feature.coordinates&&s2.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return e2(!1),void this.dragCoordinateResizeFeature.drag(t2,s2.feature.coordinates.resizable,r2)}if(this.dragCoordinate.isDragging()){var a2;const e3=(a2=s2.feature)==null||(a2=a2.coordinates)==null?void 0:a2.snappable;let i3={toCoordinate:!1};return e3===!0?i3={toCoordinate:!0}:typeof e3=="object"&&(i3=e3),void this.dragCoordinate.drag(t2,n2,r2,i3)}this.dragFeature.isDragging()?this.dragFeature.drag(t2,r2):e2(!0)}onDragEnd(t2,e2){this.allowPointerEvent(this.pointerEvents.onDragEnd,t2)&&(this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),e2(!0))}onMouseMove(t2){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let e2=!1;this.midPoints.ids.forEach(i3=>{if(e2)return;const o3=this.store.getGeometryCopy(i3);this.pixelDistance.measure(t2,o3.coordinates)<this.pointerDistance&&(e2=!0)});let i2=!1;if(this.selectionPoints.ids.forEach(o3=>{const s2=this.store.getGeometryCopy(o3);this.pixelDistance.measure(t2,s2.coordinates)<this.pointerDistance&&(e2=!1,i2=!0)}),e2)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:o2}=this.featuresAtMouseEvent.find(t2,!0);this.setCursor(this.selected.length>0&&(o2&&o2.id===this.selected[0]||i2)?this.cursors.pointerOver:"unset")}styleFeature(e2){const o2=t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e2.properties.mode===this.mode&&e2.geometry.type==="Point"){if(e2.properties.selectionPoint)return o2.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,o2.pointColor,e2),o2.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,o2.pointOutlineColor,e2),o2.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,o2.pointWidth,e2),o2.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e2),o2.zIndex=30,o2;if(e2.properties.midPoint)return o2.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,o2.pointColor,e2),o2.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,o2.pointOutlineColor,e2),o2.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e2),o2.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e2),o2.zIndex=50,o2}else if(e2.properties[i.SELECTED]){if(e2.geometry.type==="Polygon")return o2.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,o2.polygonFillColor,e2),o2.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,o2.polygonOutlineWidth,e2),o2.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,o2.polygonOutlineColor,e2),o2.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,o2.polygonFillOpacity,e2),o2.zIndex=l,o2;if(e2.geometry.type==="LineString")return o2.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,o2.lineStringColor,e2),o2.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,o2.lineStringWidth,e2),o2.zIndex=l,o2;if(e2.geometry.type==="Point")return o2.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,o2.pointWidth,e2),o2.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,o2.pointColor,e2),o2.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,o2.pointOutlineColor,e2),o2.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,o2.pointOutlineWidth,e2),o2.zIndex=l,o2}return o2}};__name(_se,"se");let se=_se;const _ne=class _ne extends v{constructor(...t2){super(...t2),this.type=f.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return t$1({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}};__name(_ne,"ne");let ne=_ne;function re(t2,e2,i2,o2,s2){for(;o2>i2;){if(o2-i2>600){const n3=o2-i2+1,r3=e2-i2+1,a3=Math.log(n3),d2=.5*Math.exp(2*a3/3),h2=.5*Math.sqrt(a3*d2*(n3-d2)/n3)*(r3-n3/2<0?-1:1);re(t2,e2,Math.max(i2,Math.floor(e2-r3*d2/n3+h2)),Math.min(o2,Math.floor(e2+(n3-r3)*d2/n3+h2)),s2)}const n2=t2[e2];let r2=i2,a2=o2;for(ae(t2,i2,e2),s2(t2[o2],n2)>0&&ae(t2,i2,o2);r2<a2;){for(ae(t2,r2,a2),r2++,a2--;s2(t2[r2],n2)<0;)r2++;for(;s2(t2[a2],n2)>0;)a2--}s2(t2[i2],n2)===0?ae(t2,i2,a2):(a2++,ae(t2,a2,o2)),a2<=e2&&(i2=a2+1),e2<=a2&&(o2=a2-1)}}__name(re,"re");function ae(t2,e2,i2){const o2=t2[e2];t2[e2]=t2[i2],t2[i2]=o2}__name(ae,"ae");function de(t2,e2){he(t2,0,t2.children.length,e2,t2)}__name(de,"de");function he(t2,e2,i2,o2,s2){s2||(s2=ve([])),s2.minX=1/0,s2.minY=1/0,s2.maxX=-1/0,s2.maxY=-1/0;for(let n2=e2;n2<i2;n2++){const e3=t2.children[n2];le(s2,t2.leaf?o2(e3):e3)}return s2}__name(he,"he");function le(t2,e2){return t2.minX=Math.min(t2.minX,e2.minX),t2.minY=Math.min(t2.minY,e2.minY),t2.maxX=Math.max(t2.maxX,e2.maxX),t2.maxY=Math.max(t2.maxY,e2.maxY),t2}__name(le,"le");function ce(t2,e2){return t2.minX-e2.minX}__name(ce,"ce");function ue(t2,e2){return t2.minY-e2.minY}__name(ue,"ue");function pe(t2){return(t2.maxX-t2.minX)*(t2.maxY-t2.minY)}__name(pe,"pe");function ge(t2){return t2.maxX-t2.minX+(t2.maxY-t2.minY)}__name(ge,"ge");function ye(t2,e2){const i2=Math.max(t2.minX,e2.minX),o2=Math.max(t2.minY,e2.minY),s2=Math.min(t2.maxX,e2.maxX),n2=Math.min(t2.maxY,e2.maxY);return Math.max(0,s2-i2)*Math.max(0,n2-o2)}__name(ye,"ye");function fe(t2,e2){return t2.minX<=e2.minX&&t2.minY<=e2.minY&&e2.maxX<=t2.maxX&&e2.maxY<=t2.maxY}__name(fe,"fe");function me(t2,e2){return e2.minX<=t2.maxX&&e2.minY<=t2.maxY&&e2.maxX>=t2.minX&&e2.maxY>=t2.minY}__name(me,"me");function ve(t2){return{children:t2,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}__name(ve,"ve");function Ce(t2,e2,i2,o2,s2){const n2=[e2,i2];for(;n2.length;){if((i2=n2.pop())-(e2=n2.pop())<=o2)continue;const r2=e2+Math.ceil((i2-e2)/o2/2)*o2;re(t2,r2,e2,i2,s2),n2.push(e2,r2,r2,i2)}}__name(Ce,"Ce");const _Pe=class _Pe{constructor(t2){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,t2),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(t2){let e2=this.data;const i2=[];if(!me(t2,e2))return i2;const o2=this.toBBox,s2=[];for(;e2;){for(let n2=0;n2<e2.children.length;n2++){const r2=e2.children[n2],a2=e2.leaf?o2(r2):r2;me(t2,a2)&&(e2.leaf?i2.push(r2):fe(t2,a2)?this._all(r2,i2):s2.push(r2))}e2=s2.pop()}return i2}collides(t2){let e2=this.data;if(me(t2,e2)){const i2=[];for(;e2;){for(let o2=0;o2<e2.children.length;o2++){const s2=e2.children[o2],n2=e2.leaf?this.toBBox(s2):s2;if(me(t2,n2)){if(e2.leaf||fe(t2,n2))return!0;i2.push(s2)}}e2=i2.pop()}}return!1}load(t2){if(t2.length<this._minEntries){for(let e3=0;e3<t2.length;e3++)this.insert(t2[e3]);return}let e2=this._build(t2.slice(),0,t2.length-1,0);if(this.data.children.length)if(this.data.height===e2.height)this._splitRoot(this.data,e2);else{if(this.data.height<e2.height){const t3=this.data;this.data=e2,e2=t3}this._insert(e2,this.data.height-e2.height-1,!0)}else this.data=e2}insert(t2){this._insert(t2,this.data.height-1)}clear(){this.data=ve([])}remove(t2){let e2=this.data;const i2=this.toBBox(t2),o2=[],s2=[];let n2,r2,a2=!1;for(;e2||o2.length;){if(e2||(e2=o2.pop(),r2=o2[o2.length-1],n2=s2.pop(),a2=!0),e2.leaf){const i3=e2.children.indexOf(t2);i3!==-1&&(e2.children.splice(i3,1),o2.push(e2),this._condense(o2))}a2||e2.leaf||!fe(e2,i2)?r2?(n2++,e2=r2.children[n2],a2=!1):e2=null:(o2.push(e2),s2.push(n2),n2=0,r2=e2,e2=e2.children[0])}}toBBox(t2){return t2}compareMinX(t2,e2){return t2.minX-e2.minX}compareMinY(t2,e2){return t2.minY-e2.minY}_all(t2,e2){const i2=[];for(;t2;)t2.leaf?e2.push(...t2.children):i2.push(...t2.children),t2=i2.pop();return e2}_build(t2,e2,i2,o2){const s2=i2-e2+1;let n2,r2=this._maxEntries;if(s2<=r2)return n2=ve(t2.slice(e2,i2+1)),de(n2,this.toBBox),n2;o2||(o2=Math.ceil(Math.log(s2)/Math.log(r2)),r2=Math.ceil(s2/Math.pow(r2,o2-1))),n2=ve([]),n2.leaf=!1,n2.height=o2;const a2=Math.ceil(s2/r2),d2=a2*Math.ceil(Math.sqrt(r2));Ce(t2,e2,i2,d2,this.compareMinX);for(let s3=e2;s3<=i2;s3+=d2){const e3=Math.min(s3+d2-1,i2);Ce(t2,s3,e3,a2,this.compareMinY);for(let i3=s3;i3<=e3;i3+=a2){const s4=Math.min(i3+a2-1,e3);n2.children.push(this._build(t2,i3,s4,o2-1))}}return de(n2,this.toBBox),n2}_chooseSubtree(t2,e2,i2,o2){for(;o2.push(e2),!e2.leaf&&o2.length-1!==i2;){let i3,o3=1/0,r2=1/0;for(let a2=0;a2<e2.children.length;a2++){const d2=e2.children[a2],h2=pe(d2),l2=(s2=t2,n2=d2,(Math.max(n2.maxX,s2.maxX)-Math.min(n2.minX,s2.minX))*(Math.max(n2.maxY,s2.maxY)-Math.min(n2.minY,s2.minY))-h2);l2<r2?(r2=l2,o3=h2<o3?h2:o3,i3=d2):l2===r2&&h2<o3&&(o3=h2,i3=d2)}e2=i3||e2.children[0]}var s2,n2;return e2}_insert(t2,e2,i2){const o2=i2?t2:this.toBBox(t2),s2=[],n2=this._chooseSubtree(o2,this.data,e2,s2);for(n2.children.push(t2),le(n2,o2);e2>=0&&s2[e2].children.length>this._maxEntries;)this._split(s2,e2),e2--;this._adjustParentBBoxes(o2,s2,e2)}_split(t2,e2){const i2=t2[e2],o2=i2.children.length,s2=this._minEntries;this._chooseSplitAxis(i2,s2,o2);const n2=this._chooseSplitIndex(i2,s2,o2),r2=ve(i2.children.splice(n2,i2.children.length-n2));r2.height=i2.height,r2.leaf=i2.leaf,de(i2,this.toBBox),de(r2,this.toBBox),e2?t2[e2-1].children.push(r2):this._splitRoot(i2,r2)}_splitRoot(t2,e2){this.data=ve([t2,e2]),this.data.height=t2.height+1,this.data.leaf=!1,de(this.data,this.toBBox)}_chooseSplitIndex(t2,e2,i2){let o2,s2=1/0,n2=1/0;for(let r2=e2;r2<=i2-e2;r2++){const e3=he(t2,0,r2,this.toBBox),a2=he(t2,r2,i2,this.toBBox),d2=ye(e3,a2),h2=pe(e3)+pe(a2);d2<s2?(s2=d2,o2=r2,n2=h2<n2?h2:n2):d2===s2&&h2<n2&&(n2=h2,o2=r2)}return o2||i2-e2}_chooseSplitAxis(t2,e2,i2){const o2=t2.leaf?this.compareMinX:ce,s2=t2.leaf?this.compareMinY:ue;this._allDistMargin(t2,e2,i2,o2)<this._allDistMargin(t2,e2,i2,s2)&&t2.children.sort(o2)}_allDistMargin(t2,e2,i2,o2){t2.children.sort(o2);const s2=this.toBBox,n2=he(t2,0,e2,s2),r2=he(t2,i2-e2,i2,s2);let a2=ge(n2)+ge(r2);for(let o3=e2;o3<i2-e2;o3++){const e3=t2.children[o3];le(n2,t2.leaf?s2(e3):e3),a2+=ge(n2)}for(let o3=i2-e2-1;o3>=e2;o3--){const e3=t2.children[o3];le(r2,t2.leaf?s2(e3):e3),a2+=ge(r2)}return a2}_adjustParentBBoxes(t2,e2,i2){for(let o2=i2;o2>=0;o2--)le(e2[o2],t2)}_condense(t2){for(let e2,i2=t2.length-1;i2>=0;i2--)t2[i2].children.length===0?i2>0?(e2=t2[i2-1].children,e2.splice(e2.indexOf(t2[i2]),1)):this.clear():de(t2[i2],this.toBBox)}};__name(_Pe,"Pe");let Pe=_Pe;const _Ie=class _Ie{constructor(t2){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new Pe(t2&&t2.maxEntries?t2.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(t2,e2){this.idToNode.set(t2.id,e2),this.nodeToId.set(e2,t2.id)}toBBox(t2){const e2=[],i2=[];let o2;if(t2.geometry.type==="Polygon")o2=t2.geometry.coordinates[0];else if(t2.geometry.type==="LineString")o2=t2.geometry.coordinates;else{if(t2.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");o2=[t2.geometry.coordinates]}for(let t3=0;t3<o2.length;t3++)i2.push(o2[t3][1]),e2.push(o2[t3][0]);const s2=Math.min(...i2),n2=Math.max(...i2);return{minX:Math.min(...e2),minY:s2,maxX:Math.max(...e2),maxY:n2}}insert(t2){if(this.idToNode.get(String(t2.id)))throw new Error("Feature already exists");const e2=this.toBBox(t2);this.setMaps(t2,e2),this.tree.insert(e2)}load(t2){const e2=[],i2=new Set;t2.forEach(t3=>{const o2=this.toBBox(t3);if(this.setMaps(t3,o2),i2.has(String(t3.id)))throw new Error("Duplicate feature ID found ".concat(t3.id));i2.add(String(t3.id)),e2.push(o2)}),this.tree.load(e2)}update(t2){this.remove(t2.id);const e2=this.toBBox(t2);this.setMaps(t2,e2),this.tree.insert(e2)}remove(t2){const e2=this.idToNode.get(t2);if(!e2)throw new Error("".concat(t2," not inserted into the spatial index"));this.tree.remove(e2)}clear(){this.tree.clear()}search(t2){return this.tree.search(this.toBBox(t2)).map(t3=>this.nodeToId.get(t3))}collides(t2){return this.tree.collides(this.toBBox(t2))}};__name(_Ie,"Ie");let Ie=_Ie;const xe={getId:__name(()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t2){const e2=16*Math.random()|0;return(t2=="x"?e2:3&e2|8).toString(16)}),"getId"),isValidId:__name(t2=>typeof t2=="string"&&t2.length===36,"isValidId")},_Me=class _Me{constructor(t2){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new Ie,this.tracked=!t2||t2.tracked!==!1,this.idStrategy=t2&&t2.idStrategy?t2.idStrategy:xe}clone(t2){return JSON.parse(JSON.stringify(t2))}getId(){return this.idStrategy.getId()}has(t2){return!!this.store[t2]}load(t2,e2,i2,o2){if(t2.length===0)return[];let s2=this.clone(t2);const n2=[],r2=[];return s2=s2.filter(t3=>{t3.id==null&&(t3.id=this.idStrategy.getId());const o3=t3.id;if(e2){const i3=e2(t3);if(!i3.valid)return r2.push({id:o3,valid:!1,reason:i3.reason}),!1}if(this.tracked){if(t3.properties.createdAt){if(!p(t3.properties.createdAt))return r2.push({id:t3.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else t3.properties.createdAt=+new Date;if(t3.properties.updatedAt){if(!p(t3.properties.updatedAt))return r2.push({id:t3.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else t3.properties.updatedAt=+new Date}return this.has(o3)?(r2.push({id:o3,valid:!1,reason:"Feature already exists with this id: ".concat(o3)}),!1):(this.store[o3]=t3,n2.push(o3),i2&&i2(t3),r2.push({id:o3,valid:!0}),!0)}),this.spatialIndex.load(s2),n2.length>0&&this._onChange(n2,"create",o2),r2}search(t2,e2){const i2=this.spatialIndex.search(t2).map(t3=>this.store[t3]);return this.clone(e2?i2.filter(e2):i2)}registerOnChange(t2){this._onChange=(e2,i2,o2)=>{t2(e2,i2,o2)}}getGeometryCopy(t2){const e2=this.store[t2];if(!e2)throw new Error("No feature with this id (".concat(t2,"), can not get geometry copy"));return this.clone(e2.geometry)}getPropertiesCopy(t2){const e2=this.store[t2];if(!e2)throw new Error("No feature with this id (".concat(t2,"), can not get properties copy"));return this.clone(e2.properties)}updateProperty(t2,e2){const i2=[];t2.forEach(({id:t3,property:e3,value:o2})=>{const s2=this.store[t3];if(!s2)throw new Error("No feature with this (".concat(t3,"), can not update geometry"));i2.push(t3),o2===void 0?delete s2.properties[e3]:s2.properties[e3]=o2,this.tracked&&(s2.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i2,"update",e2)}updateGeometry(t2,e2){const i2=[];t2.forEach(({id:t3,geometry:e3})=>{i2.push(t3);const o2=this.store[t3];if(!o2)throw new Error("No feature with this (".concat(t3,"), can not update geometry"));o2.geometry=this.clone(e3),this.spatialIndex.update(o2),this.tracked&&(o2.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(i2,"update",e2)}create(e2,i2){const o2=[];return e2.forEach(({geometry:e3,properties:i3})=>{let s2,n2=t$1({},i3);this.tracked&&(s2=+new Date,i3?(n2.createdAt=typeof i3.createdAt=="number"?i3.createdAt:s2,n2.updatedAt=typeof i3.updatedAt=="number"?i3.updatedAt:s2):n2={createdAt:s2,updatedAt:s2});const r2=this.getId(),a2={id:r2,type:"Feature",geometry:e3,properties:n2};this.store[r2]=a2,this.spatialIndex.insert(a2),o2.push(r2)}),this._onChange&&this._onChange([...o2],"create",i2),o2}delete(t2,e2){t2.forEach(t3=>{if(!this.store[t3])throw new Error("No feature with id ".concat(t3,", can not delete"));delete this.store[t3],this.spatialIndex.remove(t3)}),this._onChange&&this._onChange([...t2],"delete",e2)}copy(t2){return this.clone(this.store[t2])}copyAll(){return this.clone(Object.keys(this.store).map(t2=>this.store[t2]))}copyAllWhere(t2){return this.clone(Object.keys(this.store).map(t3=>this.store[t3]).filter(e2=>e2.properties&&t2(e2.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}};__name(_Me,"Me");let Me=_Me;const _ze=class _ze{constructor({name:t2,callback:e2,unregister:i2,register:o2}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=t2,this.register=()=>{this.registered||(this.registered=!0,o2(e2))},this.unregister=()=>{this.register&&(this.registered=!1,i2(e2))},this.callback=e2}};__name(_ze,"ze");let ze=_ze;var _a3,Xe={__proto__:null,TerraDrawBaseAdapter:(_a3=class{constructor(t2){this._nextKeyUpIsContextMenu=!1,this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof t2.minPixelDragDistance=="number"?t2.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof t2.minPixelDragDistanceSelecting=="number"?t2.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof t2.minPixelDragDistanceDrawing=="number"?t2.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof t2.coordinatePrecision=="number"?t2.coordinatePrecision:9}getButton(t2){return t2.button===-1?"neither":t2.button===0?"left":t2.button===1?"middle":t2.button===2?"right":"neither"}getMapElementXYPosition(t2){const e2=this.getMapEventElement(),{left:i2,top:o2}=e2.getBoundingClientRect();return{containerX:t2.clientX-i2,containerY:t2.clientY-o2}}getDrawEventFromEvent(t2,e2=!1){const i2=this.getLngLatFromEvent(t2);if(!i2)return null;const{lng:o2,lat:s2}=i2,{containerX:n2,containerY:r2}=this.getMapElementXYPosition(t2),a2=this.getButton(t2),d2=Array.from(this._heldKeys);return{lng:E(o2,this._coordinatePrecision),lat:E(s2,this._coordinatePrecision),containerX:n2,containerY:r2,button:a2,heldKeys:d2,isContextMenu:e2}}register(t2){this._currentModeCallbacks=t2,this._listeners=this.getAdapterListeners(),this._listeners.forEach(t3=>{t3.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new ze({name:"pointerdown",callback:__name(t2=>{if(!this._currentModeCallbacks||!t2.isPrimary)return;const e2=this.getDrawEventFromEvent(t2);e2&&(this._dragState="pre-dragging",this._lastDrawEvent=e2)},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("pointerdown",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("pointerdown",t2)},"unregister")}),new ze({name:"pointermove",callback:__name(t2=>{if(!this._currentModeCallbacks||!t2.isPrimary)return;t2.preventDefault();const e2=this.getDrawEventFromEvent(t2);if(e2)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e2),this._lastDrawEvent=e2;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const t3={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},i2={x:e2.containerX,y:e2.containerY},o2=this._currentModeCallbacks.getState(),s2=Y(t3,i2);let n2=!1;if(n2=o2==="drawing"?s2<this._minPixelDragDistanceDrawing:o2==="selecting"?s2<this._minPixelDragDistanceSelecting:s2<this._minPixelDragDistance,n2)return;this._nextKeyUpIsContextMenu=!1,this._dragState="dragging",this._currentModeCallbacks.onDragStart(e2,t4=>{this.setDraggability.bind(this)(t4)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e2,t3=>{this.setDraggability.bind(this)(t3)})},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("pointermove",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("pointermove",t2)},"unregister")}),new ze({name:"contextmenu",callback:__name(t2=>{this._currentModeCallbacks&&(t2.preventDefault(),this._nextKeyUpIsContextMenu=!0)},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("contextmenu",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("contextmenu",t2)},"unregister")}),new ze({name:"pointerup",callback:__name(t2=>{if(!this._currentModeCallbacks||t2.target!==this.getMapEventElement()||!t2.isPrimary)return;const e2=this.getDrawEventFromEvent(t2);e2&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e2,t3=>{this.setDraggability.bind(this)(t3)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||(this._nextKeyUpIsContextMenu&&(e2.isContextMenu=!0,this._nextKeyUpIsContextMenu=!1),this._currentModeCallbacks.onClick(e2)),this._dragState="not-dragging",this.setDraggability(!0))},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("pointerup",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("pointerup",t2)},"unregister")}),new ze({name:"keyup",callback:__name(t2=>{this._currentModeCallbacks&&(this._heldKeys.delete(t2.key),this._currentModeCallbacks.onKeyUp({key:t2.key,heldKeys:Array.from(this._heldKeys),preventDefault:__name(()=>t2.preventDefault(),"preventDefault")}))},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("keyup",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("keyup",t2)},"unregister")}),new ze({name:"keydown",callback:__name(t2=>{this._currentModeCallbacks&&(this._heldKeys.add(t2.key),this._currentModeCallbacks.onKeyDown({key:t2.key,heldKeys:Array.from(this._heldKeys),preventDefault:__name(()=>t2.preventDefault(),"preventDefault")}))},"callback"),register:__name(t2=>{this.getMapEventElement().addEventListener("keydown",t2)},"register"),unregister:__name(t2=>{this.getMapEventElement().removeEventListener("keydown",t2)},"unregister")})]}unregister(){this._listeners.forEach(t2=>{t2.unregister()}),this.clear(),this._currentModeCallbacks=void 0}},__name(_a3,"TerraDrawBaseAdapter"),_a3)};const _He=class _He{constructor(e2){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e2.adapter,this._mode=new ne;const i2=new Set,o2=e2.modes.reduce((t2,e3)=>{if(i2.has(e3.mode))throw new Error("There is already a ".concat(e3.mode," mode provided"));return i2.add(e3.mode),t2[e3.mode]=e3,t2},{}),s2=Object.keys(o2);if(s2.length===0)throw new Error("No modes provided");s2.forEach(t2=>{if(o2[t2].type===f.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=t2}}),this._modes=t$1({},o2,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new Me({tracked:!!e2.tracked,idStrategy:e2.idStrategy?e2.idStrategy:void 0});const n2=__name(t2=>{const e3=[],i3=this._store.copyAll().filter(i4=>!t2.includes(i4.id)||(e3.push(i4),!1));return{changed:e3,unchanged:i3}},"n"),r2=__name((t2,e3)=>{this._enabled&&this._eventListeners.finish.forEach(i3=>{i3(t2,e3)})},"r"),a2=__name((t2,e3,i3)=>{if(!this._enabled)return;this._eventListeners.change.forEach(o4=>{o4(t2,e3,i3)});const{changed:o3,unchanged:s3}=n2(t2);e3==="create"?this._adapter.render({created:o3,deletedIds:[],unchanged:s3,updated:[]},this.getModeStyles()):e3==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:s3,updated:o3},this.getModeStyles()):e3==="delete"?this._adapter.render({created:[],deletedIds:t2,unchanged:s3,updated:[]},this.getModeStyles()):e3==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:s3,updated:[]},this.getModeStyles())},"a"),d2=__name(t2=>{if(!this._enabled)return;this._eventListeners.select.forEach(e4=>{e4(t2)});const{changed:e3,unchanged:i3}=n2([t2]);this._adapter.render({created:[],deletedIds:[],unchanged:i3,updated:e3},this.getModeStyles())},"d"),h2=__name(t2=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(t3=>{t3()});const{changed:e3,unchanged:i3}=n2([t2]);e3&&this._adapter.render({created:[],deletedIds:[],unchanged:i3,updated:e3},this.getModeStyles())},"h");Object.keys(this._modes).forEach(t2=>{this._modes[t2].register({mode:t2,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:a2,onSelect:d2,onDeselect:h2,onFinish:r2,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const t2={};return Object.keys(this._modes).forEach(e2=>{t2[e2]=t3=>this._instanceSelectMode&&t3.properties[i.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(t3):this._modes[e2].styleFeature.bind(this._modes[e2])(t3)}),t2}featuresAtLocation({lng:t2,lat:e2},s2){const r2=s2&&s2.pointerDistance!==void 0?s2.pointerDistance:30,d2=!s2||s2.ignoreSelectFeatures===void 0||s2.ignoreSelectFeatures,h2=!(!s2||s2.ignoreCoordinatePoints===void 0)&&s2.ignoreCoordinatePoints,l2=!(!s2||s2.ignoreCurrentlyDrawing===void 0)&&s2.ignoreCurrentlyDrawing,c2=!(!s2||s2.ignoreClosingPoints===void 0)&&s2.ignoreClosingPoints,u2=this._adapter.unproject.bind(this._adapter),p2=this._adapter.project.bind(this._adapter),g=p2(t2,e2),y2=Q({unproject:u2,point:g,pointerDistance:r2});return this._store.search(y2).filter(u3=>{if(d2&&(u3.properties[i.MID_POINT]||u3.properties[i.SELECTION_POINT])||h2&&u3.properties[a]||c2&&u3.properties[n]||l2&&u3.properties[o])return!1;if(u3.geometry.type==="Point"){const t3=u3.geometry.coordinates,e3=p2(t3[0],t3[1]);return Y(g,e3)<r2}if(u3.geometry.type==="LineString"){const t3=u3.geometry.coordinates;for(let e3=0;e3<t3.length-1;e3++){const i2=t3[e3],o2=t3[e3+1];if(Yt(g,p2(i2[0],i2[1]),p2(o2[0],o2[1]))<r2)return!0}return!1}if(Xt([t2,e2],u3.geometry.coordinates))return!0;if(s2!=null&&s2.includePolygonsWithinPointerDistance){const t3=u3.geometry.coordinates;for(const e3 of t3)for(let t4=0;t4<e3.length-1;t4++){const i2=e3[t4],o2=e3[t4+1],s3=p2(i2[0],i2[1]),n2=p2(o2[0],o2[1]);if(Yt(g,s3,n2)<r2)return!0}}return!1})}getSelectMode(){if(this.checkEnabled(),!this._instanceSelectMode)throw new Error("No select mode defined in instance");return this.getMode()!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}setModeStyles(t2,e2){if(this.checkEnabled(),!this._modes[t2])throw new Error("No mode with this name present");this._modes[t2].styles=e2}updateModeOptions(t2,e2){if(this.checkEnabled(),!this._modes[t2])throw new Error("No mode with this name present");this._modes[t2].updateOptions(e2)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(t2){if(this._store.has(t2))return this._store.copy(t2)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(t2){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}getModeState(){return this._mode.state}setMode(t2){if(this.checkEnabled(),!this._modes[t2])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[t2],this._mode.start()}removeFeatures(t2){this.checkEnabled();const e2=[];t2.forEach(t3=>{if(!this._store.has(t3))throw new Error("No feature with id ".concat(t3,", can not delete"));const o2=this._store.copy(t3);o2.properties[i.SELECTED]&&this.deselectFeature(t3),o2.properties[h]&&e2.push(...o2.properties[h])}),this._store.delete([...t2,...e2],{origin:"api"})}selectFeature(t2){this.getSelectMode().selectFeature(t2)}deselectFeature(t2){this.getSelectMode().deselectFeature(t2)}getFeatureId(){return this._store.getId()}hasFeature(t2){return this._store.has(t2)}addFeatures(t2){return this.checkEnabled(),t2.length===0?[]:this._store.load(t2,t3=>{if(u(t3)){const e2=t3.properties.mode,i2=this._modes[e2];if(!i2)return{id:t3.id,valid:!1,reason:"".concat(e2," mode is not in the list of instantiated modes")};const o2=i2.validateFeature.bind(i2)(t3);return{id:t3.id,valid:o2.valid,reason:o2.reason?o2.reason:o2.valid?void 0:"Feature is invalid"}}return{id:t3.id,valid:!1,reason:"Mode property does not exist"}},t3=>{if(u(t3)){const e2=this._modes[t3.properties.mode];e2&&e2.afterFeatureAdded&&e2.afterFeatureAdded(t3)}},{origin:"api"})}start(){this._enabled||(this._enabled=!0,this._adapter.register({onReady:__name(()=>{this._eventListeners.ready.forEach(t2=>{t2()})},"onReady"),getState:__name(()=>this._mode.state,"getState"),onClick:__name(t2=>{this._mode.onClick(t2)},"onClick"),onMouseMove:__name(t2=>{this._mode.onMouseMove(t2)},"onMouseMove"),onKeyDown:__name(t2=>{this._mode.onKeyDown(t2)},"onKeyDown"),onKeyUp:__name(t2=>{this._mode.onKeyUp(t2)},"onKeyUp"),onDragStart:__name((t2,e2)=>{this._mode.onDragStart(t2,e2)},"onDragStart"),onDrag:__name((t2,e2)=>{this._mode.onDrag(t2,e2)},"onDrag"),onDragEnd:__name((t2,e2)=>{this._mode.onDragEnd(t2,e2)},"onDragEnd"),onClear:__name(()=>{this._mode.cleanUp(),this._store.clear()},"onClear")}))}getFeaturesAtLngLat(t2,e2){const{lng:i2,lat:o2}=t2;return this.featuresAtLocation({lng:i2,lat:o2},e2)}getFeaturesAtPointerEvent(t2,e2){const i2=this._adapter.getLngLatFromEvent.bind(this._adapter)(t2);return i2===null?[]:this.featuresAtLocation(i2,e2)}stop(){this._enabled&&(this._enabled=!1,this._adapter.unregister())}on(t2,e2){const i2=this._eventListeners[t2];i2.includes(e2)||i2.push(e2)}off(t2,e2){const i2=this._eventListeners[t2];i2.includes(e2)&&i2.splice(i2.indexOf(e2),1)}};__name(_He,"He");let He=_He;const _t2=class _t2 extends Xe.TerraDrawBaseAdapter{constructor(e2){super(e2),this._renderBeforeLayerId=void 0,this._initialDragPan=void 0,this._initialDragRotate=void 0,this._nextRender=void 0,this._map=void 0,this._container=void 0,this.changedIds={deletion:!1,points:!1,linestrings:!1,polygons:!1,styling:!1},this._map=e2.map,this._container=this._map.getContainer(),this._initialDragRotate=this._map.dragRotate.isEnabled(),this._initialDragPan=this._map.dragPan.isEnabled(),this._renderBeforeLayerId=e2.renderBelowLayerId}_addGeoJSONSource(e2,t2){this._map.addSource(e2,{type:"geojson",data:{type:"FeatureCollection",features:t2},tolerance:0})}_addFillLayer(e2){return this._map.addLayer({id:e2,source:e2,type:"fill",layout:{"fill-sort-key":["get","zIndex"]},paint:{"fill-color":["get","polygonFillColor"],"fill-opacity":["get","polygonFillOpacity"]}})}_addFillOutlineLayer(e2){return this._map.addLayer({id:e2+"-outline",source:e2,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","polygonOutlineWidth"],"line-color":["get","polygonOutlineColor"]}})}_addLineLayer(e2){return this._map.addLayer({id:e2,source:e2,type:"line",layout:{"line-sort-key":["get","zIndex"]},paint:{"line-width":["get","lineStringWidth"],"line-color":["get","lineStringColor"]}})}_addPointLayer(e2){return this._map.addLayer({id:e2,source:e2,type:"circle",layout:{"circle-sort-key":["get","zIndex"]},paint:{"circle-stroke-color":["get","pointOutlineColor"],"circle-stroke-width":["get","pointOutlineWidth"],"circle-radius":["get","pointWidth"],"circle-color":["get","pointColor"]}})}_addLayer(e2,t2){t2==="Point"&&this._addPointLayer(e2),t2==="LineString"&&this._addLineLayer(e2),t2==="Polygon"&&(this._addFillLayer(e2),this._addFillOutlineLayer(e2))}_addGeoJSONLayer(e2,t2){const i2="td-".concat(e2.toLowerCase());return this._addGeoJSONSource(i2,t2),this._addLayer(i2,e2),i2}_setGeoJSONLayerData(e2,t2){const i2="td-".concat(e2.toLowerCase());return this._map.getSource(i2).setData({type:"FeatureCollection",features:t2}),i2}updateChangedIds(e2){[...e2.updated,...e2.created].forEach(e3=>{e3.geometry.type==="Point"?this.changedIds.points=!0:e3.geometry.type==="LineString"?this.changedIds.linestrings=!0:e3.geometry.type==="Polygon"&&(this.changedIds.polygons=!0)}),e2.deletedIds.length>0&&(this.changedIds.deletion=!0),e2.created.length===0&&e2.updated.length===0&&e2.deletedIds.length===0&&(this.changedIds.styling=!0)}getLngLatFromEvent(e2){const{left:t2,top:i2}=this._container.getBoundingClientRect();return this.unproject(e2.clientX-t2,e2.clientY-i2)}getMapEventElement(){return this._map.getCanvas()}setDraggability(e2){e2?(this._initialDragRotate&&this._map.dragRotate.enable(),this._initialDragPan&&this._map.dragPan.enable()):(this._initialDragRotate&&this._map.dragRotate.disable(),this._initialDragPan&&this._map.dragPan.disable())}project(e2,t2){const{x:i2,y:n2}=this._map.project({lng:e2,lat:t2});return{x:i2,y:n2}}unproject(e2,t2){const{lng:i2,lat:n2}=this._map.unproject({x:e2,y:t2});return{lng:i2,lat:n2}}setCursor(e2){const t2=this._map.getCanvas();e2==="unset"?t2.style.removeProperty("cursor"):t2.style.cursor=e2}setDoubleClickToZoom(e2){e2?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}render(e2,t2){this.updateChangedIds(e2),this._nextRender&&cancelAnimationFrame(this._nextRender),this._nextRender=requestAnimationFrame(()=>{if(!this._currentModeCallbacks)return;const i2=[...e2.created,...e2.updated,...e2.unchanged],n2=[],o2=[],r2=[];for(let e3=0;e3<i2.length;e3++){const a3=i2[e3],{properties:s3}=a3,l3=t2[s3.mode](a3);a3.geometry.type==="Point"?(s3.pointColor=l3.pointColor,s3.pointOutlineColor=l3.pointOutlineColor,s3.pointOutlineWidth=l3.pointOutlineWidth,s3.pointWidth=l3.pointWidth,s3.zIndex=l3.zIndex,n2.push(a3)):a3.geometry.type==="LineString"?(s3.lineStringColor=l3.lineStringColor,s3.lineStringWidth=l3.lineStringWidth,o2.push(a3)):a3.geometry.type==="Polygon"&&(s3.polygonFillColor=l3.polygonFillColor,s3.polygonFillOpacity=l3.polygonFillOpacity,s3.polygonOutlineColor=l3.polygonOutlineColor,s3.polygonOutlineWidth=l3.polygonOutlineWidth,r2.push(a3))}const a2=this.changedIds.deletion||this.changedIds.styling,s2=a2||this.changedIds.linestrings,l2=a2||this.changedIds.polygons;(a2||this.changedIds.points)&&this._setGeoJSONLayerData("Point",n2),s2&&this._setGeoJSONLayerData("LineString",o2),l2&&this._setGeoJSONLayerData("Polygon",r2),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1}})}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this._nextRender&&(cancelAnimationFrame(this._nextRender),this._nextRender=void 0),this._setGeoJSONLayerData("Point",[]),this._setGeoJSONLayerData("LineString",[]),this._setGeoJSONLayerData("Polygon",[]))}getCoordinatePrecision(){return super.getCoordinatePrecision()}unregister(){super.unregister(),this.changedIds={points:!1,linestrings:!1,polygons:!1,deletion:!1,styling:!1},this._map.removeLayer("td-point"),this._map.removeSource("td-point"),this._map.removeLayer("td-linestring"),this._map.removeSource("td-linestring"),this._map.removeLayer("td-polygon"),this._map.removeLayer("td-polygon-outline"),this._map.removeSource("td-polygon")}register(e2){var t2;super.register(e2);const i2=this._addGeoJSONLayer("Polygon",[]),n2=this._addGeoJSONLayer("LineString",[]),o2=this._addGeoJSONLayer("Point",[]);this._renderBeforeLayerId&&(this._map.moveLayer(o2,this._renderBeforeLayerId),this._map.moveLayer(n2,o2),this._map.moveLayer(i2+"-outline",n2),this._map.moveLayer(i2,n2)),(t2=this._currentModeCallbacks)!=null&&t2.onReady&&this._currentModeCallbacks.onReady()}};__name(_t2,"t");let t=_t2;const iconConfigProviderProps={size:[String,Number],color:String,tag:String},iconConfigInjectionKey=Symbol("IconConfigInjection"),defaultTag="span",Icon=defineComponent({name:"Icon",props:iconConfigProviderProps,setup(props,{slots}){const IconConfigProvider=inject(iconConfigInjectionKey,null),mergedSizeRef=computed(()=>{var _a4;const _size=(_a4=props.size)!==null&&_a4!==void 0?_a4:IconConfigProvider==null?void 0:IconConfigProvider.size;if(_size!==void 0)return typeof _size=="number"||/^\d+$/.test(_size)?"".concat(_size,"px"):_size}),mergedColorRef=computed(()=>{const{color}=props;return color===void 0?IconConfigProvider?IconConfigProvider.color:void 0:color}),mergedTagRef=computed(()=>{var _a4;const{tag}=props;return tag===void 0?(_a4=IconConfigProvider==null?void 0:IconConfigProvider.tag)!==null&&_a4!==void 0?_a4:defaultTag:tag});return onBeforeMount(()=>{mountStyle()}),()=>h$1(mergedTagRef.value,{class:"xicon",style:{color:mergedColorRef.value,fontSize:mergedSizeRef.value}},[renderSlot(slots,"default")])}}),byteToHex=[];for(let i2=0;i2<256;++i2)byteToHex.push((i2+256).toString(16).slice(1));function unsafeStringify(arr,offset=0){return(byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]).toLowerCase()}__name(unsafeStringify,"unsafeStringify");let getRandomValues;const rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");getRandomValues=crypto.getRandomValues.bind(crypto)}return getRandomValues(rnds8)}__name(rng,"rng");const randomUUID=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),native={randomUUID};function v4(options,buf,offset){var _a4,_b,_c;if(native.randomUUID&&!options)return native.randomUUID();options=options||{};const rnds=(_c=(_b=options.random)!=null?_b:(_a4=options.rng)==null?void 0:_a4.call(options))!=null?_c:rng();if(rnds.length<16)throw new Error("Random bytes length must be >= 16");return rnds[6]=rnds[6]&15|64,rnds[8]=rnds[8]&63|128,unsafeStringify(rnds)}__name(v4,"v4");const useRouteStore=defineStore("routes",()=>{const routes=ref([]),currentRouteId=ref(null);async function init(){const result=await storeGet("routes");result&&(routes.value=isString(result)?JSON.parse(result):result)}__name(init,"init");async function addRoute(route){const newRoute={...route,id:v4()};return routes.value.push(newRoute),await storeSet("routes",cloneDeep(routes.value)),await storeSave(),newRoute}__name(addRoute,"addRoute");async function deleteRoute(id){routes.value=routes.value.filter(r2=>r2.id!==id),currentRouteId.value===id&&(currentRouteId.value=null),await storeSet("routes",cloneDeep(routes.value)),await storeSave()}__name(deleteRoute,"deleteRoute");async function addPointToRoute(id,point){const route=routes.value.find(r2=>r2.id===id);route&&(route.points.length>0&&isEqual(route.points[route.points.length-1],point)||(route.points.push(point),await storeSet("routes",cloneDeep(routes.value)),await storeSave()))}__name(addPointToRoute,"addPointToRoute");async function updateRoute(id,updates){const route=routes.value.find(r2=>r2.id===id);route&&(Object.assign(route,updates),await storeSet("routes",cloneDeep(routes.value)),await storeSave())}return __name(updateRoute,"updateRoute"),{routes,currentRouteId,init,addRoute,deleteRoute,addPointToRoute,updateRoute}});function saveString(text,fileType,fileName){const blob=new Blob([text],{type:fileType}),a2=document.createElement("a");a2.download=fileName,a2.href=URL.createObjectURL(blob),a2.dataset.downloadurl=[fileType,a2.download,a2.href].join(":"),a2.style.display="none",document.body.appendChild(a2),a2.click(),document.body.removeChild(a2),setTimeout(()=>{URL.revokeObjectURL(a2.href)},1500)}__name(saveString,"saveString");const _hoisted_1$3={class:"flex-col justify-center items-center gap-4 w-full"},_hoisted_2$3={class:"flex justify-end gap-4"},_sfc_main$4=defineComponent({__name:"TextFileUploaderDialog",props:mergeModels({multiple:{type:Boolean},icon:{},prompt:{},types:{}},{show:{default:!1,type:Boolean},showModifiers:{}}),emits:mergeModels(["update:value","confirm"],["update:show"]),setup(__props,{emit:__emit}){const message=useMessage(),props=__props,emits=__emit,showModal=useModel(__props,"show");let contents=[];const handleChange=__name(files=>{contents=[];for(const file of files){const raw=file.file;if(raw)if(props.types.includes(raw.type)){const reader=new FileReader;reader.onload=e2=>{var _a4;(_a4=e2.target)!=null&&_a4.result&&contents.push(e2.target.result),contents.length===files.length&&emits("update:value",contents)},reader.readAsText(raw)}else message.warning("Skipped file ".concat(file.name," due to unsupported type ").concat(raw.type))}},"handleChange"),handleConfirm=__name(()=>{emits("confirm",contents),showModal.value=!1},"handleConfirm"),beforeUpload=__name(data=>{var _a4,_b,_c,_d;return props.types.includes((_b=(_a4=data.file.file)==null?void 0:_a4.type)!=null?_b:"")?!0:(message.error("Unsupported file type ".concat((_d=(_c=data.file.file)==null?void 0:_c.type)!=null?_d:"unknown",". Supported types: ['").concat(props.types.join("', '"),"']")),!1)},"beforeUpload");return(_ctx,_cache)=>(openBlock(),createBlock(unref(NModal),{show:showModal.value,"onUpdate:show":_cache[2]||(_cache[2]=$event=>showModal.value=$event),preset:"dialog",title:"Dialog"},{header:withCtx(()=>_cache[3]||(_cache[3]=[createTextVNode(" File Upload ")])),default:withCtx(()=>{var _a4;return[createBaseVNode("div",_hoisted_1$3,[createVNode(unref(NUpload),{multiple:(_a4=props.multiple)!=null?_a4:!1,onChange:_cache[0]||(_cache[0]=({fileList})=>handleChange(fileList)),onBeforeUpload:beforeUpload},{default:withCtx(()=>[createVNode(unref(NUploadDragger),null,{default:withCtx(()=>{var _a5;return[createVNode(unref(Icon),{size:36,name:"upload",class:"opacity-50"},{default:withCtx(()=>{var _a6;return[(openBlock(),createBlock(resolveDynamicComponent((_a6=props.icon)!=null?_a6:unref(Upload))))]}),_:1}),createBaseVNode("div",null,toDisplayString((_a5=props.prompt)!=null?_a5:"Drag and drop a file here or click to upload"),1)]}),_:1})]),_:1},8,["multiple"])])]}),action:withCtx(()=>[createBaseVNode("div",_hoisted_2$3,[createVNode(unref(Button),{onClick:_cache[1]||(_cache[1]=$event=>showModal.value=!1)},{default:withCtx(()=>_cache[4]||(_cache[4]=[createTextVNode("Cancel")])),_:1,__:[4]}),createVNode(unref(Button),{type:"primary",onClick:handleConfirm},{default:withCtx(()=>_cache[5]||(_cache[5]=[createTextVNode("Upload")])),_:1,__:[5]})])]),_:1},8,["show"]))}}),_sfc_main$3=defineComponent({__name:"MglDrawer",props:{show:{type:Boolean,default:!1},showModifiers:{}},emits:mergeModels(["update:width","click","contextmenu"],["update:show"]),setup(__props,{emit:__emit}){useCssVars(_ctx=>({"35e21170":drawerWidth.value,"3d7df430":unref(theme).modalColor,"06469490":unref(theme).borderRadius,"160a12b3":drawerTranslation.value}));const emit=__emit,theme=useThemeVars(),routeDrawer=useTemplateRef("route-drawer"),routeDrawerWidth=computed(()=>{var _a4,_b,_c,_d,_e,_f;return Math.min(clamp(Math.round(((_c=(_b=(_a4=routeDrawer.value)==null?void 0:_a4.parentElement)==null?void 0:_b.clientWidth)!=null?_c:2e3)*.4),320,640),((_f=(_e=(_d=routeDrawer.value)==null?void 0:_d.parentElement)==null?void 0:_e.clientWidth)!=null?_f:1/0)-48)}),drawerTranslation=computed(()=>"".concat(-16-routeDrawerWidth.value,"px")),drawerWidth=computed(()=>"".concat(routeDrawerWidth.value,"px")),show=useModel(__props,"show");return watch(routeDrawerWidth,()=>emit("update:width",routeDrawerWidth.value)),(_ctx,_cache)=>(openBlock(),createBlock(Transition,{name:"slide"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",{class:"route-drawer",ref:"route-drawer",onClick:_cache[0]||(_cache[0]=e2=>emit("click",e2)),onContextmenu:_cache[1]||(_cache[1]=e2=>emit("contextmenu",e2))},[renderSlot(_ctx.$slots,"default",{},void 0,!0)],544),[[vShow,show.value]])]),_:3}))}}),MglDrawer=_export_sfc(_sfc_main$3,[["__scopeId","data-v-802be7eb"]]),_hoisted_1$2={class:"menu-list"},_hoisted_2$2=["onClick","onContextmenu","onTouchstart"],_hoisted_3$2={class:"swipe-container"},_hoisted_4$1={style:{height:"fit-content",padding:"8px 12px"}},_hoisted_5$1=["onClick"],_sfc_main$2=defineComponent({__name:"SelectableSwipeableMenuList",props:{items:{},selectedId:{},menuOptions:{},swipeActions:{}},emits:["select","contextmenu"],setup(__props,{emit:__emit}){useCssVars(_ctx=>({52250711:unref(theme).hoverColor,"07246ce8":unref(theme).borderRadius,"72c3138b":unref(theme).primaryColor,"509813d2":unref(theme).bodyColor,"2f6668fe":swipeTransitionDuration.value}));const props=__props,emit=__emit,theme=useThemeVars(),swipeTransitionDuration=ref("0s"),swipeState=ref({startX:0,delta:0,currentX:0,containerWidth:0,activeId:null}),showContextMenu=ref(!1),contextMenuX=ref(0),contextMenuY=ref(0),selectedItem=ref(null);function handleTouchStart(e2,itemId){var _a4;swipeState.value.activeId!==itemId&&clearSwipeState();const touch=e2.touches[0];swipeState.value={startX:touch.clientX,delta:(_a4=swipeState.value.delta)!=null?_a4:0,currentX:touch.clientX,containerWidth:e2.currentTarget.offsetWidth,activeId:itemId}}__name(handleTouchStart,"handleTouchStart");function handleTouchMove(e2){swipeState.value.activeId&&(swipeState.value.currentX=e2.touches[0].clientX,swipeState.value.delta+=swipeState.value.startX-swipeState.value.currentX,swipeState.value.delta=clamp(swipeState.value.delta,0,swipeState.value.containerWidth),swipeState.value.startX=e2.touches[0].clientX)}__name(handleTouchMove,"handleTouchMove");function handleTouchEnd(){swipeState.value.activeId&&(swipeTransitionDuration.value="".concat(swipeState.value.delta/swipeState.value.containerWidth*.3,"s"),setTimeout(()=>{swipeTransitionDuration.value="0s"},300),swipeState.value.delta=swipeState.value.delta>swipeState.value.containerWidth*.4?swipeState.value.containerWidth:0)}__name(handleTouchEnd,"handleTouchEnd");function handleItemClick(e2,item){e2.stopPropagation(),!(swipeState.value.delta>5)&&(clearSwipeState(),emit("select",item.id))}__name(handleItemClick,"handleItemClick");function clearSwipeState(){swipeState.value={startX:0,delta:0,currentX:0,containerWidth:0,activeId:null}}__name(clearSwipeState,"clearSwipeState");function openItemContextMenu(e2,item){if(e2.stopPropagation(),e2.preventDefault(),showContextMenu.value){showContextMenu.value=!1;return}selectedItem.value=item,contextMenuX.value=e2.clientX,contextMenuY.value=e2.clientY,showContextMenu.value=!0,emit("contextmenu",e2,item)}return __name(openItemContextMenu,"openItemContextMenu"),(_ctx,_cache)=>(openBlock(),createElementBlock(Fragment,null,[createBaseVNode("div",_hoisted_1$2,[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.items,item=>(openBlock(),createElementBlock("div",{key:item.id,onClick:__name($event=>handleItemClick($event,item),"onClick"),onContextmenu:withModifiers(e2=>openItemContextMenu(e2,item),["prevent"]),onTouchstart:__name($event=>handleTouchStart($event,item.id),"onTouchstart"),onTouchmove:handleTouchMove,onTouchend:handleTouchEnd,class:normalizeClass(["menu-list-item",...item.id===props.selectedId?["active"]:[]]),style:normalizeStyle({"touch-action":swipeState.value.activeId===item.id?"pan-y":"auto"})},[createBaseVNode("div",_hoisted_3$2,[createBaseVNode("div",{class:"content-col",style:normalizeStyle({transform:"translateX(".concat(swipeState.value.activeId===item.id?-swipeState.value.delta:0,"px)"),willChange:swipeState.value.activeId===item.id?"transform":"auto"})},[renderSlot(_ctx.$slots,"item",{item},()=>{var _a4;return[createBaseVNode("div",_hoisted_4$1,[createBaseVNode("div",null,toDisplayString((_a4=item.name)!=null?_a4:"Untitled"),1)])]},!0)],4),createBaseVNode("div",{class:"actions-col",style:normalizeStyle({width:"".concat(swipeState.value.activeId===item.id?swipeState.value.delta:0,"px"),willChange:swipeState.value.activeId===item.id?"width":"auto"})},[(openBlock(!0),createElementBlock(Fragment,null,renderList(props.swipeActions,action=>(openBlock(),createElementBlock("button",{key:action.name,class:"menu-action",onClick:__name(()=>{action.action(item.id),swipeState.value.activeId=null},"onClick"),style:normalizeStyle({background:action.color||unref(theme).primaryColorSuppl})},toDisplayString(action.label),13,_hoisted_5$1))),128))],4)])],46,_hoisted_2$2))),128))]),createVNode(unref(NDropdown),{show:showContextMenu.value,x:contextMenuX.value,y:contextMenuY.value,options:props.menuOptions,onClickoutside:_cache[0]||(_cache[0]=$event=>showContextMenu.value=!1),placement:"bottom-start",trigger:"manual"},null,8,["show","x","y","options"])],64))}}),SelectableSwipeableMenuList=_export_sfc(_sfc_main$2,[["__scopeId","data-v-05bf1ca5"]]),_hoisted_1$1={class:"p-4",style:{height:"100%"}},_hoisted_2$1={class:"text-lg font-bold mb-4"},_hoisted_3$1={style:{height:"fit-content",padding:"8px 12px","text-align":"left"}},_sfc_main$1=defineComponent({__name:"TrackerViewRouteDrawer",props:{show:{type:Boolean,default:!1},showModifiers:{}},emits:mergeModels(["update:width"],["update:show"]),setup(__props,{emit:__emit}){useCssVars(_ctx=>({"874f5c72":unref(theme).borderRadius,"730ad0a0":unref(theme).hoverColor,e3823f50:unref(theme).primaryColorPressed,"27f6f86a":unref(theme).primaryColor,"9bab54d0":unref(theme).bodyColor}));const{t:t2}=useI18n(),emit=__emit,routeStore=useRouteStore(),theme=useThemeVars(),show=useModel(__props,"show"),showRouteContextMenu=ref(!1),contextMenuX=ref(0),contextMenuY=ref(0),selectedRoute=ref(null),showRenameDialog=ref(!1),newRouteName=ref(""),renameRouteId=ref(null),listMenuOptions=[{label:t2("components.trackerViewRouteDrawer.contextMenu.new"),key:"new",props:{onClick:__name(()=>{showRouteContextMenu.value=!1,routeStore.addRoute({name:"Untitled Route",points:[]})},"onClick")}}],itemMenuOptions=[{label:t2("components.trackerViewRouteDrawer.contextMenu.rename"),key:"rename",props:{onClick:__name(()=>{var _a4;(_a4=selectedRoute.value)!=null&&_a4.id&&(newRouteName.value=selectedRoute.value.name||"",showRenameDialog.value=!0)},"onClick")}},{label:t2("components.trackerViewRouteDrawer.contextMenu.delete"),key:"delete",props:{onClick:__name(()=>{selectedRoute.value&&routeStore.deleteRoute(selectedRoute.value.id)},"onClick")}},{key:"divider-1",type:"divider"},...listMenuOptions],swipeActions=[{label:t2("components.trackerViewRouteDrawer.contextMenu.rename"),name:"rename",action:__name(id=>{const route=routeStore.routes.find(r2=>r2.id===id);renameRouteId.value=id,newRouteName.value=(route==null?void 0:route.name)||"",showRenameDialog.value=!0},"action")},{label:t2("components.trackerViewRouteDrawer.contextMenu.delete"),name:"delete",action:__name(id=>routeStore.deleteRoute(id),"action"),color:theme.value.errorColorSuppl}];function openRouteContextMenu(e2){if(e2.stopPropagation(),e2.preventDefault(),renameRouteId.value=routeStore.currentRouteId,showRouteContextMenu.value){showRouteContextMenu.value=!1;return}contextMenuX.value=e2.clientX,contextMenuY.value=e2.clientY,showRouteContextMenu.value=!0}__name(openRouteContextMenu,"openRouteContextMenu");async function handleRename(routeId){newRouteName.value.trim()&&(await routeStore.updateRoute(routeId,{name:newRouteName.value.trim()}),showRenameDialog.value=!1)}return __name(handleRename,"handleRename"),(_ctx,_cache)=>(openBlock(),createElementBlock(Fragment,null,[createVNode(MglDrawer,{show:show.value,"onUpdate:show":_cache[2]||(_cache[2]=$event=>show.value=$event),onClick:_cache[3]||(_cache[3]=()=>unref(routeStore).currentRouteId=null),"onUpdate:width":_cache[4]||(_cache[4]=w2=>emit("update:width",w2)),onContextmenu:_cache[5]||(_cache[5]=e2=>openRouteContextMenu(e2))},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$1,[createBaseVNode("p",_hoisted_2$1,toDisplayString(unref(t2)("components.trackerViewRouteDrawer.routes")),1),createVNode(SelectableSwipeableMenuList,{items:unref(routeStore).routes,"selected-id":unref(routeStore).currentRouteId,"menu-options":itemMenuOptions,"swipe-actions":swipeActions,onSelect:_cache[0]||(_cache[0]=id=>unref(routeStore).currentRouteId=id),onContextmenu:_cache[1]||(_cache[1]=(_2,item)=>{var _a4;renameRouteId.value=(_a4=item==null?void 0:item.id)!=null?_a4:null,selectedRoute.value=item!=null?item:null})},{item:withCtx(({item:route})=>{var _a4;return[createBaseVNode("div",_hoisted_3$1,[createBaseVNode("div",null,toDisplayString((_a4=route.name)!=null?_a4:unref(t2)("components.trackerViewRouteDrawer.nameNewRoute")),1),createBaseVNode("div",null,toDisplayString(unref(t2)("components.trackerViewRouteDrawer.points",{num:route.points.length})),1)])]}),_:1},8,["items","selected-id"])])]),_:1},8,["show"]),createVNode(unref(NDropdown),{show:showRouteContextMenu.value,x:contextMenuX.value,y:contextMenuY.value,options:listMenuOptions,onClickoutside:_cache[6]||(_cache[6]=$event=>showRouteContextMenu.value=!1),placement:"bottom-start",trigger:"manual"},null,8,["show","x","y"]),createVNode(unref(NModal),{preset:"dialog",show:showRenameDialog.value,"onUpdate:show":_cache[9]||(_cache[9]=$event=>showRenameDialog.value=$event),title:"Rename Route","positive-text":"Save","negative-text":"Cancel",onPositiveClick:_cache[10]||(_cache[10]=()=>{renameRouteId.value&&handleRename(renameRouteId.value)})},{default:withCtx(()=>[createVNode(unref(NInput),{value:newRouteName.value,"onUpdate:value":_cache[7]||(_cache[7]=$event=>newRouteName.value=$event),placeholder:"Enter new route name",onKeyup:_cache[8]||(_cache[8]=withKeys(()=>{renameRouteId.value&&handleRename(renameRouteId.value)},["enter"]))},null,8,["value"])]),_:1},8,["show"])],64))}}),TrackerViewRouteDrawer=_export_sfc(_sfc_main$1,[["__scopeId","data-v-769c8e91"]]),_hoisted_1={style:{width:"100%",height:"100%",position:"relative",overflow:"hidden"}},_hoisted_2={key:0,style:{width:"100%",height:"100%"}},_hoisted_3=["title","onClick"],_hoisted_4=["title"],_hoisted_5={key:1,style:{width:"100%",height:"100%",display:"grid","place-content":"center"}},_sfc_main=defineComponent({__name:"TrackerView",setup(__props){const settings=useSettingsStore(),message=useMessage(),locator=inject("geolocation"),{t:t$12}=useI18n(),i18n=useI18n(),zoom=ref(7),styleUrl="https://api.maptiler.com/maps/basic-v2/style.json?key=".concat("dCeXFrS9lgSF8hm5C6nm"),location=ref({latitude:0,longitude:0}),map=shallowRef(null),draw=shallowRef(null),activeDrawMethod=ref("select"),pathRecording=ref(!1),routeStore=useRouteStore(),path=computed(()=>{if(!routeStore.currentRouteId)return[];const route=routeStore.routes.find(r2=>r2.id===routeStore.currentRouteId);return(route==null?void 0:route.points)||[]}),uploadModelOpened=ref(!1),singlePointMarker=new maplibreGlExports.Marker,geojsonSource=computed(()=>{if(path.value.length>1||path.value.length===0)return singlePointMarker.remove(),{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:path.value.map(coord=>[coord.longitude,coord.latitude])}}]};if(path.value.length===1){singlePointMarker.setLngLat([path.value[0].longitude,path.value[0].latitude]);const localMap=map.value;localMap&&singlePointMarker.addTo(localMap)}return{type:"FeatureCollection",features:[]}}),drawerModes=[{mode:new Nt,name:t$12("trackerView.terraDrawTools.rect"),icon:Vector},{mode:new bt,name:t$12("trackerView.terraDrawTools.point"),icon:MapPin},{mode:new Wt,name:t$12("trackerView.terraDrawTools.polygon"),icon:Polygon},{mode:new X,name:t$12("trackerView.terraDrawTools.circle"),icon:Circle$1},{mode:new Mt,name:t$12("trackerView.terraDrawTools.line"),icon:Line$1},{mode:new se({allowManualDeselection:!0,flags:{point:{feature:{draggable:!0}},polygon:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},linestring:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},freehand:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},circle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}},rectangle:{feature:{draggable:!0,coordinates:{midpoints:!0,draggable:!0,deletable:!0}}}}}),name:t$12("trackerView.terraDrawTools.select"),icon:HandFinger},{mode:new Z,name:t$12("trackerView.terraDrawTools.draw"),icon:HandMove}];watch([()=>settings.settings.mapLanguage,()=>i18n.locale.value],v2=>{v2&&map.value&&changeMapLanguage(map.value,v2[0]==="interface"?v2[1]:v2[0])});const changeMapLanguage=__name((map2,lang)=>{const language=lang==="zh-CN"?"zh":"en",layers=["City labels","Road labels","Station labels","Airport labels","Continent labels","Country labels"];for(const layer of layers)map2.setLayoutProperty(layer,"text-field",["get","name:".concat(language)])},"changeMapLanguage");function initMap(event){var _a4;map.value=event.map,map.value&&changeMapLanguage(map.value,i18n.locale.value),(_a4=map.value)==null||_a4.on("click",()=>{isRouteDrawerOpen.value=!1}),draw.value=new He({adapter:new t({map:map.value}),modes:drawerModes.map(item=>item.mode)}),draw.value.start()}__name(initMap,"initMap");let watchingHandler=-1;async function changeRecordState(){try{if(pathRecording.value=!pathRecording.value,pathRecording.value){if(routeStore.currentRouteId)await routeStore.addPointToRoute(routeStore.currentRouteId,locator.presentLocation);else{const newRoute=await routeStore.addRoute({points:[locator.presentLocation],name:t$12("trackerView.nameNewRoute")});openDrawerTooltip(),routeStore.currentRouteId=newRoute.id}watchingHandler=locator.addListener(newPoint=>{routeStore.addPointToRoute(routeStore.currentRouteId,newPoint)})}else watchingHandler!==-1&&(locator.removeListener(watchingHandler),pathRecording.value=!1,watchingHandler=-1)}catch(err){console.error(err)}}__name(changeRecordState,"changeRecordState");async function savePath(){saveString(JSON.stringify(geojsonSource.value),"application/json","tracked-path-export")}__name(savePath,"savePath");let loadTextFileDialogCallback=ref(async _2=>{});function loadFromText(){return new Promise(async(resolve,reject)=>{loadTextFileDialogCallback.value=async contents=>{contents.length===0?reject(new Error("No file selected")):resolve(contents)},uploadModelOpened.value=!0})}__name(loadFromText,"loadFromText");function loadTrackFromFile(){loadFromText().then(contents=>{const points=JSON.parse(contents[0]).features[0].geometry.coordinates.map(coord=>({latitude:coord[1],longitude:coord[0]}));routeStore.addRoute({points,name:t$12("trackerView.nameNewlyImportedRoute")}).then(openDrawerTooltip)}).catch(error2=>{message.error(error2)})}__name(loadTrackFromFile,"loadTrackFromFile");const routeDrawerWidth=ref(0),isRouteDrawerOpen=ref(!1);watch(isRouteDrawerOpen,val=>{var _a4;return(_a4=map.value)==null?void 0:_a4.easeTo({padding:{left:val?routeDrawerWidth.value:0},duration:500})});const toggleRouteDrawer=__name(()=>isRouteDrawerOpen.value=!isRouteDrawerOpen.value,"toggleRouteDrawer"),drawerTooltipOpened=ref(!1),openDrawerTooltip=__name(()=>{drawerTooltipOpened.value||(drawerTooltipOpened.value=!0,setTimeout(()=>{drawerTooltipOpened.value=!1},3e3))},"openDrawerTooltip"),initialLocateError=ref(""),locationReady=ref(!1);return onMounted(async()=>{var _a4,_b;try{location.value=await locator.refresh(),locator.usingGPS||message.warning(t$12("trackerView.gpsWarning"),{duration:5e3})}catch(err){initialLocateError.value=(_a4=err.message)!=null?_a4:String(err)}locationReady.value=!0,await storeInit(),await routeStore.init(),(_b=draw.value)==null||_b.start()}),(_ctx,_cache)=>(openBlock(),createElementBlock("div",_hoisted_1,[createVNode(unref(NCard),{class:"map-layout","content-style":"padding: 0;"},{default:withCtx(()=>[createVNode(Transition,{name:"map-load"},{default:withCtx(()=>[locationReady.value&&!initialLocateError.value?(openBlock(),createElementBlock("div",_hoisted_2,[createVNode(unref(Se),{"map-style":styleUrl,center:[location.value.longitude,location.value.latitude],zoom:zoom.value,height:"100%","onMap:load":initMap},{default:withCtx(()=>[createVNode(unref(Ie$1),{position:"top-left"}),unref(locator).usingGPS?(openBlock(),createBlock(unref(xe$1),{key:0,position:"top-left","track-user-location":!0})):createCommentVNode("",!0),createVNode(unref(Ce$1),{position:"top-left"}),createVNode(unref(Ne),{position:"bottom-left"}),createVNode(unref(Oe),{position:"top-right"},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(drawerModes,item=>createBaseVNode("button",{key:item.name,class:normalizeClass(["!flex justify-center items-center",item.mode.mode===activeDrawMethod.value?"!bg-blue-200 rounded-sm transition-colors":""]),title:item.name,onClick:__name(()=>{var _a4,_b,_c;console.log("activeDrawMethod",activeDrawMethod.value),activeDrawMethod.value===item.mode.mode?((_a4=draw.value)==null||_a4.setMode("select"),activeDrawMethod.value="select"):(activeDrawMethod.value=item.mode.mode,(_b=draw.value)==null||_b.start(),(_c=draw.value)==null||_c.setMode(item.mode.mode))},"onClick")},[createVNode(unref(Icon),{size:20},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(item.icon),{class:"stroke-stone-800 text-stone-800"}))]),_:2},1024)],10,_hoisted_3)),64))]),_:1}),createVNode(unref(Oe),{position:"bottom-left"},{default:withCtx(()=>[createVNode(unref(NPopover),{trigger:"manual",show:drawerTooltipOpened.value},{trigger:withCtx(()=>[createBaseVNode("button",{class:normalizeClass("!flex justify-center items-center transition-all hover:rounded-sm stroke-sky-800 fill-sky-700 text-sky-800"),onClick:toggleRouteDrawer},[createVNode(unref(Icon),{size:24},{default:withCtx(()=>[createVNode(unref(Route))]),_:1})])]),default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(unref(t$12)("trackerView.uiRouteCheckoutTip")),1)]),_:1},8,["show"])]),_:1}),createVNode(unref(Oe),{position:"top-right"},{default:withCtx(()=>[createBaseVNode("button",{class:normalizeClass(["!flex justify-center items-center transition-all hover:rounded-sm",pathRecording.value?"hover:!bg-red-700 hover:stroke-white hover:text-white stroke-red-700 fill-red-600 text-red-700":"stroke-sky-800 fill-sky-700 text-sky-800"]),title:pathRecording.value?unref(t$12)("trackerView.uiRecordingStatus.on"):unref(t$12)("trackerView.uiRecordingStatus.off"),onClick:changeRecordState},[createVNode(unref(Icon),{size:20},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(pathRecording.value?unref(Square):unref(PlayerRecord)),{size:pathRecording.value?16:20,class:"stroke-inherit text-inherit"},null,8,["size"]))]),_:1})],10,_hoisted_4),path.value.length>0&&!pathRecording.value?(openBlock(),createElementBlock("button",{key:0,class:"stroke-red-700 text-red-700 hover:!bg-red-700 hover:stroke-white hover:text-white hover:rounded-sm transition-all !flex justify-center items-center",onClick:_cache[0]||(_cache[0]=$event=>unref(routeStore).currentRouteId&&unref(routeStore).updateRoute(unref(routeStore).currentRouteId,{points:[]}))},[createVNode(unref(Icon),{size:20},{default:withCtx(()=>[createVNode(unref(Backspace),{class:"stroke-inherit text-inherit",style:{transform:"translateX(-1.3px)"},size:"20"})]),_:1})])):createCommentVNode("",!0),path.value.length>0&&!pathRecording.value?(openBlock(),createElementBlock("button",{key:1,class:"!flex justify-center items-center",onClick:savePath},[createVNode(unref(Icon),{size:20},{default:withCtx(()=>[createVNode(unref(DeviceFloppy),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):createCommentVNode("",!0),path.value.length===0&&!pathRecording.value?(openBlock(),createElementBlock("button",{key:2,class:"!flex justify-center items-center",onClick:loadTrackFromFile},[createVNode(unref(Icon),{size:20},{default:withCtx(()=>[createVNode(unref(Upload),{class:"stroke-stone-800 text-stone-800",size:"20"})]),_:1})])):createCommentVNode("",!0)]),_:1}),createVNode(unref(Ae),{"source-id":"geojson",data:geojsonSource.value},{default:withCtx(()=>[createVNode(unref(Je),{"layer-id":"geojson",layout:{"line-join":"round","line-cap":"round"},paint:{"line-width":5,"line-color":"#008800","line-opacity":.8}})]),_:1},8,["data"])]),_:1},8,["center","zoom"])])):(openBlock(),createElementBlock("div",_hoisted_5,[initialLocateError.value?(openBlock(),createBlock(unref(NAlert),{key:1,title:unref(t$12)("app.error"),type:"error"},{default:withCtx(()=>[createBaseVNode("div",null,[_cache[4]||(_cache[4]=createBaseVNode("br",null,null,-1)),createBaseVNode("b",null,toDisplayString(unref(t$12)("app.error"))+": ",1),_cache[5]||(_cache[5]=createBaseVNode("br",null,null,-1)),createBaseVNode("code",null,toDisplayString(initialLocateError.value),1)])]),_:1},8,["title"])):(openBlock(),createBlock(unref(NSpin),{key:0,size:"large"},{description:withCtx(()=>[createVNode(unref(NText),null,{default:withCtx(()=>[createTextVNode(toDisplayString(unref(t$12)("trackerView.locationLoading")),1)]),_:1})]),_:1}))]))]),_:1})]),_:1}),createVNode(_sfc_main$4,{show:uploadModelOpened.value,"onUpdate:show":_cache[1]||(_cache[1]=$event=>uploadModelOpened.value=$event),types:["application/json","text/plain"],onConfirm:unref(loadTextFileDialogCallback)},null,8,["show","onConfirm"]),createVNode(TrackerViewRouteDrawer,{show:isRouteDrawerOpen.value,"onUpdate:show":_cache[2]||(_cache[2]=$event=>isRouteDrawerOpen.value=$event),"onUpdate:width":_cache[3]||(_cache[3]=width=>routeDrawerWidth.value=width)},null,8,["show"])]))}}),TrackerView=_export_sfc(_sfc_main,[["__scopeId","data-v-be2f9b04"]]);export{TrackerView as default};
